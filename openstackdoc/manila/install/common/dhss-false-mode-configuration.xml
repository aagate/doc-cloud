<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/manila/doc/source/install/common/dhss-false-mode-configuration.rst">
    <enumerated_list enumtype="arabic" prefix="" start="2" suffix=".">
        <list_item>
            <paragraph>Create the LVM physical volume <literal>/dev/sdc</literal>:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># pvcreate /dev/sdc
Physical volume "/dev/sdc" successfully created</literal_block>
        </list_item>
        <list_item>
            <paragraph>Create the LVM volume group <literal>manila-volumes</literal>:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># vgcreate manila-volumes /dev/sdc
Volume group "manila-volumes" successfully created</literal_block>
            <paragraph>The Shared File Systems service creates logical volumes in this volume
                group.</paragraph>
        </list_item>
        <list_item>
            <paragraph>Only instances can access Shared File Systems service volumes. However,
                the underlying operating system manages the devices associated with
                the volumes. By default, the LVM volume scanning tool scans the
                <literal>/dev</literal> directory for block storage devices that
                contain volumes. If projects use LVM on their volumes, the scanning
                tool detects these volumes and attempts to cache them which can cause
                a variety of problems with both the underlying operating system
                and project volumes. You must reconfigure LVM to scan only the devices
                that contain the <literal>cinder-volume</literal> and <literal>manila-volumes</literal> volume groups.
                Edit the <literal>/etc/lvm/lvm.conf</literal> file and complete the following actions:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>In the <literal>devices</literal> section, add a filter that accepts the
                        <literal>/dev/sdb</literal> and <literal>/dev/sdc</literal> devices and rejects all other devices:</paragraph>
                    <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">devices {
...
filter = [ "a/sdb/", "a/sdc", "r/.*/"]</literal_block>
                    <warning>
                        <paragraph>If your storage nodes use LVM on the operating system disk, you
                            must also add the associated device to the filter. For example,
                            if the <literal>/dev/sda</literal> device contains the operating system:</paragraph>
                        <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">filter = [ "a/sda/", "a/sdb/", "a/sdc", "r/.*/"]</literal_block>
                        <paragraph>Similarly, if your compute nodes use LVM on the operating
                            system disk, you must also modify the filter in the
                            <literal>/etc/lvm/lvm.conf</literal> file on those nodes to include only
                            the operating system disk. For example, if the <literal>/dev/sda</literal>
                            device contains the operating system:</paragraph>
                        <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">filter = [ "a/sda/", "r/.*/"]</literal_block>
                    </warning>
                </list_item>
            </bullet_list>
        </list_item>
    </enumerated_list>
    <section ids="configure-components" names="configure\ components">
        <title>Configure components</title>
        <enumerated_list enumtype="arabic" prefix="" suffix=".">
            <list_item>
                <paragraph>Edit the <literal>/etc/manila/manila.conf</literal> file and complete the following
                    actions:</paragraph>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph>In the <literal>[DEFAULT]</literal> section, enable the LVM driver and the NFS
                            protocol:</paragraph>
                        <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
...
enabled_share_backends = lvm
enabled_share_protocols = NFS</literal_block>
                        <note>
                            <paragraph>Back end names are arbitrary. As an example, this guide uses the name
                                of the driver.</paragraph>
                        </note>
                    </list_item>
                    <list_item>
                        <paragraph>In the <literal>[lvm]</literal> section, configure the LVM driver:</paragraph>
                        <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[lvm]
share_backend_name = LVM
share_driver = manila.share.drivers.lvm.LVMShareDriver
driver_handles_share_servers = False
lvm_share_volume_group = manila-volumes
lvm_share_export_ip = MANAGEMENT_INTERFACE_IP_ADDRESS</literal_block>
                        <paragraph>Replace <literal>MANAGEMENT_INTERFACE_IP_ADDRESS</literal> with the IP address
                            of the management network interface on your storage node,
                            typically 10.0.0.41 for the first node in the example architecture
                            shown below:</paragraph>
                        <figure ids="id1">
                            <image alt="Hardware requirements" candidates="{'*': 'install/common/figures/hwreqs.png'}" uri="install/common/figures/hwreqs.png"></image>
                            <caption><strong>Hardware requirements</strong>.</caption>
                        </figure>
                    </list_item>
                </bullet_list>
            </list_item>
        </enumerated_list>
    </section>
</document>
