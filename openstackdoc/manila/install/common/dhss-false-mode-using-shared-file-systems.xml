<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/manila/doc/source/install/common/dhss-false-mode-using-shared-file-systems.rst">
    <section ids="creating-shares-with-shared-file-systems-option-1-dhss-false" names="creating\ shares\ with\ shared\ file\ systems\ option\ 1\ (dhss\ =\ false)">
        <title>Creating shares with Shared File Systems Option 1 (DHSS = False)</title>
    </section>
    <section ids="create-a-share-type" names="create\ a\ share\ type">
        <title>Create a share type</title>
        <paragraph>Disable DHSS (<literal>driver_handles_share_servers</literal>) before creating a share using
            the LVM driver.</paragraph>
        <enumerated_list enumtype="arabic" prefix="" suffix=".">
            <list_item>
                <paragraph>Source the admin credentials to gain access to admin-only CLI commands:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ . admin-openrc</literal_block>
            </list_item>
            <list_item>
                <paragraph>Create a default share type with DHSS disabled. A default share type will
                    allow you to create shares with this driver, without having to specify
                    the share type explicitly during share creation.</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila type-create default_share_type False
+----------------------+--------------------------------------+
| Property             | Value                                |
+----------------------+--------------------------------------+
| required_extra_specs | driver_handles_share_servers : False |
| Name                 | default_share_type                   |
| Visibility           | public                               |
| is_default           | -                                    |
| ID                   | 3df065c8-6ca4-4b80-a5cb-e633c0439097 |
| optional_extra_specs | snapshot_support : True              |
+----------------------+--------------------------------------+</literal_block>
                <paragraph>Set this default share type in <literal>manila.conf</literal> under the <literal>[DEFAULT]</literal>
                    section and restart the <literal>manila-api</literal> service before proceeding.
                    Unless you do so, the default share type will not be effective.</paragraph>
                <note>
                    <paragraph>Creating and configuring a default share type is optional. If you wish
                        to use the shared file system service with a variety of share types,
                        where each share creation request could specify a type, please refer to
                        the Share types usage documentation <title_reference>here
                            &lt;http://docs.openstack.org/admin-guide/shared-file-systems-share-types.html&gt;_</title_reference>.</paragraph>
                </note>
            </list_item>
        </enumerated_list>
    </section>
    <section ids="create-a-share" names="create\ a\ share">
        <title>Create a share</title>
        <enumerated_list enumtype="arabic" prefix="" suffix=".">
            <list_item>
                <paragraph>Source the <literal>demo</literal> credentials to perform
                    the following steps as a non-administrative project:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ . demo-openrc</literal_block>
            </list_item>
            <list_item>
                <paragraph>Create an NFS share. Since a default share type has been created and
                    configured, it need not be specified in the request.</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila create NFS 1 --name share1
+-----------------------------+--------------------------------------+
| Property                    | Value                                |
+-----------------------------+--------------------------------------+
| status                      | creating                             |
| share_type_name             | default_share_type                   |
| description                 | None                                 |
| availability_zone           | None                                 |
| share_network_id            | None                                 |
| host                        |                                      |
| access_rules_status         | active                               |
| snapshot_id                 | None                                 |
| is_public                   | False                                |
| task_state                  | None                                 |
| snapshot_support            | True                                 |
| id                          | 55c401b3-3112-4294-aa9f-3cc355a4e361 |
| size                        | 1                                    |
| name                        | share1                               |
| share_type                  | 3df065c8-6ca4-4b80-a5cb-e633c0439097 |
| has_replicas                | False                                |
| replication_type            | None                                 |
| created_at                  | 2016-03-30T19:10:33.000000           |
| share_proto                 | NFS                                  |
| consistency_group_id        | None                                 |
| source_cgsnapshot_member_id | None                                 |
| project_id                  | 3a46a53a377642a284e1d12efabb3b5a     |
| metadata                    | {}                                   |
+-----------------------------+--------------------------------------+</literal_block>
            </list_item>
            <list_item>
                <paragraph>After some time, the share status should change from <literal>creating</literal>
                    to <literal>available</literal>:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila list
+--------------------------------------+--------+------+-------------+-----------+-----------+--------------------+-----------------------------+-------------------+
| ID                                   | Name   | Size | Share Proto | Status    | Is Public | Share Type Name    | Host                        | Availability Zone |
+--------------------------------------+--------+------+-------------+-----------+-----------+--------------------+-----------------------------+-------------------+
| 55c401b3-3112-4294-aa9f-3cc355a4e361 | share1 | 1    | NFS         | available | False     | default_share_type | storage@lvm#lvm-single-pool | nova              |
+--------------------------------------+--------+------+-------------+-----------+-----------+--------------------+-----------------------------+-------------------+</literal_block>
            </list_item>
            <list_item>
                <paragraph>Determine export IP address of the share:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila show share1
+-----------------------------+------------------------------------------------------------------------------------+
| Property                    | Value                                                                              |
+-----------------------------+------------------------------------------------------------------------------------+
| status                      | available                                                                          |
| share_type_name             | default_share_type                                                                 |
| description                 | None                                                                               |
| availability_zone           | nova                                                                               |
| share_network_id            | None                                                                               |
| export_locations            |                                                                                    |
|                             | path = 10.0.0.41:/var/lib/manila/mnt/share-8e13a98f-c310-41df-ac90-fc8bce4910b8    |
|                             | id = 3c8d0ada-cadf-48dd-85b8-d4e8c3b1e204                                          |
|                             | preferred = False                                                                  |
| host                        | storage@lvm#lvm-single-pool                                                        |
| access_rules_status         | active                                                                             |
| snapshot_id                 | None                                                                               |
| is_public                   | False                                                                              |
| task_state                  | None                                                                               |
| snapshot_support            | True                                                                               |
| id                          | 55c401b3-3112-4294-aa9f-3cc355a4e361                                               |
| size                        | 1                                                                                  |
| name                        | share1                                                                             |
| share_type                  | c6dfcfc6-9920-420e-8b0a-283d578efef5                                               |
| has_replicas                | False                                                                              |
| replication_type            | None                                                                               |
| created_at                  | 2016-03-30T19:10:33.000000                                                         |
| share_proto                 | NFS                                                                                |
| consistency_group_id        | None                                                                               |
| source_cgsnapshot_member_id | None                                                                               |
| project_id                  | 3a46a53a377642a284e1d12efabb3b5a                                                   |
| metadata                    | {}                                                                                 |
+-----------------------------+------------------------------------------------------------------------------------+</literal_block>
            </list_item>
        </enumerated_list>
    </section>
    <section ids="allow-access-to-the-share" names="allow\ access\ to\ the\ share">
        <title>Allow access to the share</title>
        <enumerated_list enumtype="arabic" prefix="" suffix=".">
            <list_item>
                <paragraph>Configure access to the new share before attempting to mount it via
                    the network. The compute instance (whose IP address is referenced by the
                    INSTANCE_IP below) must have network connectivity to the network specified
                    in the share network.</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila access-allow share1 ip INSTANCE_IP
+--------------+--------------------------------------+
| Property     | Value                                |
+--------------+--------------------------------------+
| share_id     | 55c401b3-3112-4294-aa9f-3cc355a4e361 |
| access_type  | ip                                   |
| access_to    | 10.0.0.46                            |
| access_level | rw                                   |
| state        | new                                  |
| id           | f88eab01-7197-44bf-ad0f-d6ca6f99fc96 |
+--------------+--------------------------------------+</literal_block>
            </list_item>
        </enumerated_list>
    </section>
    <section ids="mount-the-share-on-a-compute-instance" names="mount\ the\ share\ on\ a\ compute\ instance">
        <title>Mount the share on a compute instance</title>
        <enumerated_list enumtype="arabic" prefix="" suffix=".">
            <list_item>
                <paragraph>Log into your compute instance and create a folder where the mount will
                    be placed:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ mkdir ~/test_folder</literal_block>
            </list_item>
            <list_item>
                <paragraph>Mount the NFS share in the compute instance using the export location of
                    the share:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># mount -vt nfs 10.0.0.41:/var/lib/manila/mnt/share-8e13a98f-c310-41df-ac90-fc8bce4910b8 ~/test_folder</literal_block>
            </list_item>
        </enumerated_list>
    </section>
</document>
