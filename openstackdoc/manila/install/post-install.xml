<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/manila/doc/source/install/post-install.rst">
    <target refid="post-install"></target>
    <section ids="creating-and-using-shared-file-systems post-install" names="creating\ and\ using\ shared\ file\ systems post-install">
        <title>Creating and using shared file systems</title>
        <paragraph>Depending on the option chosen while installing the share node (Option with
            share server management and one without); the steps to create and use your
            shared file systems will vary. When the Shared File Systems service handles
            the creation and management of share servers, you would need to specify the
            <literal>share network</literal> with the request to create a share. Either modes will vary
            in their respective share type definition. When using the driver mode with
            automatic handling of share servers, a service image is needed as specified
            in your configuration. The instructions below enumerate the steps for both
            driver modes. Follow what is appropriate for your installation.</paragraph>
        <section ids="creating-shares-with-shared-file-systems-option-1-dhss-false" names="creating\ shares\ with\ shared\ file\ systems\ option\ 1\ (dhss\ =\ false)">
            <title>Creating shares with Shared File Systems Option 1 (DHSS = False)</title>
        </section>
        <section ids="create-a-share-type" names="create\ a\ share\ type">
            <title>Create a share type</title>
            <paragraph>Disable DHSS (<literal>driver_handles_share_servers</literal>) before creating a share using
                the LVM driver.</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Source the admin credentials to gain access to admin-only CLI commands:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ . admin-openrc</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Create a default share type with DHSS disabled. A default share type will
                        allow you to create shares with this driver, without having to specify
                        the share type explicitly during share creation.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila type-create default_share_type False
+----------------------+--------------------------------------+
| Property             | Value                                |
+----------------------+--------------------------------------+
| required_extra_specs | driver_handles_share_servers : False |
| Name                 | default_share_type                   |
| Visibility           | public                               |
| is_default           | -                                    |
| ID                   | 3df065c8-6ca4-4b80-a5cb-e633c0439097 |
| optional_extra_specs | snapshot_support : True              |
+----------------------+--------------------------------------+</literal_block>
                    <paragraph>Set this default share type in <literal>manila.conf</literal> under the <literal>[DEFAULT]</literal>
                        section and restart the <literal>manila-api</literal> service before proceeding.
                        Unless you do so, the default share type will not be effective.</paragraph>
                    <note>
                        <paragraph>Creating and configuring a default share type is optional. If you wish
                            to use the shared file system service with a variety of share types,
                            where each share creation request could specify a type, please refer to
                            the Share types usage documentation <title_reference>here
                                &lt;http://docs.openstack.org/admin-guide/shared-file-systems-share-types.html&gt;_</title_reference>.</paragraph>
                    </note>
                </list_item>
            </enumerated_list>
        </section>
        <section dupnames="create\ a\ share" ids="create-a-share">
            <title>Create a share</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Source the <literal>demo</literal> credentials to perform
                        the following steps as a non-administrative project:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ . demo-openrc</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Create an NFS share. Since a default share type has been created and
                        configured, it need not be specified in the request.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila create NFS 1 --name share1
+-----------------------------+--------------------------------------+
| Property                    | Value                                |
+-----------------------------+--------------------------------------+
| status                      | creating                             |
| share_type_name             | default_share_type                   |
| description                 | None                                 |
| availability_zone           | None                                 |
| share_network_id            | None                                 |
| host                        |                                      |
| access_rules_status         | active                               |
| snapshot_id                 | None                                 |
| is_public                   | False                                |
| task_state                  | None                                 |
| snapshot_support            | True                                 |
| id                          | 55c401b3-3112-4294-aa9f-3cc355a4e361 |
| size                        | 1                                    |
| name                        | share1                               |
| share_type                  | 3df065c8-6ca4-4b80-a5cb-e633c0439097 |
| has_replicas                | False                                |
| replication_type            | None                                 |
| created_at                  | 2016-03-30T19:10:33.000000           |
| share_proto                 | NFS                                  |
| consistency_group_id        | None                                 |
| source_cgsnapshot_member_id | None                                 |
| project_id                  | 3a46a53a377642a284e1d12efabb3b5a     |
| metadata                    | {}                                   |
+-----------------------------+--------------------------------------+</literal_block>
                </list_item>
                <list_item>
                    <paragraph>After some time, the share status should change from <literal>creating</literal>
                        to <literal>available</literal>:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila list
+--------------------------------------+--------+------+-------------+-----------+-----------+--------------------+-----------------------------+-------------------+
| ID                                   | Name   | Size | Share Proto | Status    | Is Public | Share Type Name    | Host                        | Availability Zone |
+--------------------------------------+--------+------+-------------+-----------+-----------+--------------------+-----------------------------+-------------------+
| 55c401b3-3112-4294-aa9f-3cc355a4e361 | share1 | 1    | NFS         | available | False     | default_share_type | storage@lvm#lvm-single-pool | nova              |
+--------------------------------------+--------+------+-------------+-----------+-----------+--------------------+-----------------------------+-------------------+</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Determine export IP address of the share:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila show share1
+-----------------------------+------------------------------------------------------------------------------------+
| Property                    | Value                                                                              |
+-----------------------------+------------------------------------------------------------------------------------+
| status                      | available                                                                          |
| share_type_name             | default_share_type                                                                 |
| description                 | None                                                                               |
| availability_zone           | nova                                                                               |
| share_network_id            | None                                                                               |
| export_locations            |                                                                                    |
|                             | path = 10.0.0.41:/var/lib/manila/mnt/share-8e13a98f-c310-41df-ac90-fc8bce4910b8    |
|                             | id = 3c8d0ada-cadf-48dd-85b8-d4e8c3b1e204                                          |
|                             | preferred = False                                                                  |
| host                        | storage@lvm#lvm-single-pool                                                        |
| access_rules_status         | active                                                                             |
| snapshot_id                 | None                                                                               |
| is_public                   | False                                                                              |
| task_state                  | None                                                                               |
| snapshot_support            | True                                                                               |
| id                          | 55c401b3-3112-4294-aa9f-3cc355a4e361                                               |
| size                        | 1                                                                                  |
| name                        | share1                                                                             |
| share_type                  | c6dfcfc6-9920-420e-8b0a-283d578efef5                                               |
| has_replicas                | False                                                                              |
| replication_type            | None                                                                               |
| created_at                  | 2016-03-30T19:10:33.000000                                                         |
| share_proto                 | NFS                                                                                |
| consistency_group_id        | None                                                                               |
| source_cgsnapshot_member_id | None                                                                               |
| project_id                  | 3a46a53a377642a284e1d12efabb3b5a                                                   |
| metadata                    | {}                                                                                 |
+-----------------------------+------------------------------------------------------------------------------------+</literal_block>
                </list_item>
            </enumerated_list>
        </section>
        <section dupnames="allow\ access\ to\ the\ share" ids="allow-access-to-the-share">
            <title>Allow access to the share</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Configure access to the new share before attempting to mount it via
                        the network. The compute instance (whose IP address is referenced by the
                        INSTANCE_IP below) must have network connectivity to the network specified
                        in the share network.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila access-allow share1 ip INSTANCE_IP
+--------------+--------------------------------------+
| Property     | Value                                |
+--------------+--------------------------------------+
| share_id     | 55c401b3-3112-4294-aa9f-3cc355a4e361 |
| access_type  | ip                                   |
| access_to    | 10.0.0.46                            |
| access_level | rw                                   |
| state        | new                                  |
| id           | f88eab01-7197-44bf-ad0f-d6ca6f99fc96 |
+--------------+--------------------------------------+</literal_block>
                </list_item>
            </enumerated_list>
        </section>
        <section dupnames="mount\ the\ share\ on\ a\ compute\ instance" ids="mount-the-share-on-a-compute-instance">
            <title>Mount the share on a compute instance</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Log into your compute instance and create a folder where the mount will
                        be placed:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ mkdir ~/test_folder</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Mount the NFS share in the compute instance using the export location of
                        the share:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># mount -vt nfs 10.0.0.41:/var/lib/manila/mnt/share-8e13a98f-c310-41df-ac90-fc8bce4910b8 ~/test_folder</literal_block>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="creating-shares-with-shared-file-systems-option-2-dhss-true" names="creating\ shares\ with\ shared\ file\ systems\ option\ 2\ (dhss\ =\ true)">
            <title>Creating shares with Shared File Systems Option 2 (DHSS = True)</title>
            <paragraph>Before being able to create a share, manila with the generic driver and
                the DHSS (<literal>driver_handles_share_servers</literal>) mode enabled requires the
                definition of at least an image, a network and a share-network for being
                used to create a share server. For that <title_reference>back end</title_reference> configuration, the share
                server is an instance where NFS shares are served.</paragraph>
            <note>
                <paragraph>This configuration automatically creates a cinder volume for every share.
                    The cinder volumes are attached to share servers according to the
                    definition of a share network.</paragraph>
            </note>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Source the admin credentials to gain access to admin-only CLI commands:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ . admin-openrc.sh</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Create a default share type with DHSS enabled. A default share type will
                        allow you to create shares with this driver, without having to specify
                        the share type explicitly during share creation.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila type-create default_share_type True
+----------------------+--------------------------------------+
| Property             | Value                                |
+----------------------+--------------------------------------+
| required_extra_specs | driver_handles_share_servers : True  |
| Name                 | default_share_type                   |
| Visibility           | public                               |
| is_default           | -                                    |
| ID                   | 8a35da28-0f74-490d-afff-23664ecd4f01 |
| optional_extra_specs | snapshot_support : True              |
+----------------------+--------------------------------------+</literal_block>
                    <paragraph>Set this default share type in <literal>manila.conf</literal> under the <literal>[DEFAULT]</literal>
                        section and restart the <literal>manila-api</literal> service before proceeding.
                        Unless you do so, the default share type will not be effective.</paragraph>
                    <note>
                        <paragraph>Creating and configuring a default share type is optional. If you wish
                            to use the shared file system service with a variety of share types,
                            where each share creation request could specify a type, please refer to
                            the Share types usage documentation <title_reference>here
                                &lt;http://docs.openstack.org/admin-guide/shared-file-systems-share-types.html&gt;_</title_reference>.</paragraph>
                    </note>
                </list_item>
                <list_item>
                    <paragraph>Create a manila share server image in the Image service. You may skip this
                        step and use any existing image. However, for mounting a share, the service
                        image must contain the NFS packages as appropriate for the operating system.
                        Whatever image you choose to be the service image, be sure to set the
                        configuration values <literal>service_image_name</literal>, <literal>service_instance_flavor_id</literal>,
                        <literal>service_instance_user</literal> and <literal>service_instance_password</literal> in
                        <literal>manila.conf</literal>.</paragraph>
                    <note>
                        <paragraph>Any changes made to <literal>manila.conf</literal> while the <literal>manila-share</literal> service
                            is running will require a restart of the service to be effective.</paragraph>
                    </note>
                    <note>
                        <paragraph>As an alternative to specifying a plain-text
                            <literal>service_instance_password</literal> in your configuration, a key-pair may be
                            specified with options <literal>path_to_public_key</literal> and
                            <literal>path_to_private_key</literal> to configure and allow password-less SSH access
                            between the <title_reference>share node</title_reference> and the share server/s created.</paragraph>
                    </note>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ glance image-create \
--copy-from http://tarballs.openstack.org/manila-image-elements/images/manila-service-image-master.qcow2 \
--name "manila-service-image" \
--disk-format qcow2 \
--container-format bare \
--visibility public --progress
[=============================&gt;] 100%
+------------------+--------------------------------------+
| Property         | Value                                |
+------------------+--------------------------------------+
| checksum         | 48a08e746cf0986e2bc32040a9183445     |
| container_format | bare                                 |
| created_at       | 2016-01-26T19:52:24Z                 |
| disk_format      | qcow2                                |
| id               | 1fc7f29e-8fe6-44ef-9c3c-15217e83997c |
| min_disk         | 0                                    |
| min_ram          | 0                                    |
| name             | manila-service-image                 |
| owner            | e2c965830ecc4162a002bf16ddc91ab7     |
| protected        | False                                |
| size             | 306577408                            |
| status           | active                               |
| tags             | []                                   |
| updated_at       | 2016-01-26T19:52:28Z                 |
| virtual_size     | None                                 |
| visibility       | public                               |
+------------------+--------------------------------------+</literal_block>
                </list_item>
                <list_item>
                    <paragraph>List available networks in order to get id and subnets of the private
                        network:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ neutron net-list
+--------------------------------------+---------+----------------------------------------------------+
| id                                   | name    | subnets                                            |
+--------------------------------------+---------+----------------------------------------------------+
| 0e62efcd-8cee-46c7-b163-d8df05c3c5ad | public  | 5cc70da8-4ee7-4565-be53-b9c011fca011 10.3.31.0/24  |
| 7c6f9b37-76b4-463e-98d8-27e5686ed083 | private | 3482f524-8bff-4871-80d4-5774c2730728 172.16.1.0/24 |
+--------------------------------------+---------+----------------------------------------------------+</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Source the <literal>demo</literal> credentials to perform
                        the following steps as a non-administrative project:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ . demo-openrc.sh</literal_block>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila share-network-create --name demo-share-network1 \
--neutron-net-id PRIVATE_NETWORK_ID \
--neutron-subnet-id PRIVATE_NETWORK_SUBNET_ID
+-------------------+--------------------------------------+
| Property          | Value                                |
+-------------------+--------------------------------------+
| name              | demo-share-network1                  |
| segmentation_id   | None                                 |
| created_at        | 2016-01-26T20:03:41.877838           |
| neutron_subnet_id | 3482f524-8bff-4871-80d4-5774c2730728 |
| updated_at        | None                                 |
| network_type      | None                                 |
| neutron_net_id    | 7c6f9b37-76b4-463e-98d8-27e5686ed083 |
| ip_version        | None                                 |
| nova_net_id       | None                                 |
| cidr              | None                                 |
| project_id        | e2c965830ecc4162a002bf16ddc91ab7     |
| id                | 58b2f0e6-5509-4830-af9c-97f525a31b14 |
| description       | None                                 |
+-------------------+--------------------------------------+</literal_block>
                </list_item>
            </enumerated_list>
        </section>
        <section dupnames="create\ a\ share" ids="id1">
            <title>Create a share</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Create an NFS share using the share network. Since a default share type has
                        been created and configured, it need not be specified in the request.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila create NFS 1 --name demo-share1 --share-network demo-share-network1
+-----------------------------+--------------------------------------+
| Property                    | Value                                |
+-----------------------------+--------------------------------------+
| status                      | None                                 |
| share_type_name             | default_share_type                   |
| description                 | None                                 |
| availability_zone           | None                                 |
| share_network_id            | 58b2f0e6-5509-4830-af9c-97f525a31b14 |
| host                        | None                                 |
| snapshot_id                 | None                                 |
| is_public                   | False                                |
| task_state                  | None                                 |
| snapshot_support            | True                                 |
| id                          | 016ca18f-bdd5-48e1-88c0-782e4c1aa28c |
| size                        | 1                                    |
| name                        | demo-share1                          |
| share_type                  | 8a35da28-0f74-490d-afff-23664ecd4f01 |
| created_at                  | 2016-01-26T20:08:50.502877           |
| export_location             | None                                 |
| share_proto                 | NFS                                  |
| consistency_group_id        | None                                 |
| source_cgsnapshot_member_id | None                                 |
| project_id                  | 48e8c35b2ac6495d86d4be61658975e7     |
| metadata                    | {}                                   |
+-----------------------------+--------------------------------------+</literal_block>
                </list_item>
                <list_item>
                    <paragraph>After some time, the share status should change from <literal>creating</literal>
                        to <literal>available</literal>:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila list
+--------------------------------------+-------------+------+-------------+-----------+-----------+------------------------+-----------------------------+-------------------+
| ID                                   | Name        | Size | Share Proto | Status    | Is Public | Share Type Name        | Host                        | Availability Zone |
+--------------------------------------+-------------+------+-------------+-----------+-----------+------------------------+-----------------------------+-------------------+
| 5f8a0574-a95e-40ff-b898-09fd8d6a1fac | demo-share1 | 1    | NFS         | available | False     |   default_share_type   | storagenode@generic#GENERIC | nova              |
+--------------------------------------+-------------+------+-------------+-----------+-----------+------------------------+-----------------------------+-------------------+</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Determine export IP address of the share:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila show demo-share1
+-----------------------------+------------------------------------------------------------------------------------+
| Property                    | Value                                                                              |
+-----------------------------+------------------------------------------------------------------------------------+
| status                      | available                                                                          |
| share_type_name             | default_share_type                                                                 |
| description                 | None                                                                               |
| availability_zone           | nova                                                                               |
| share_network_id            | 58b2f0e6-5509-4830-af9c-97f525a31b14                                               |
| export_locations            |                                                                                    |
|                             | path = 10.254.0.6:/shares/share-0bfd69a1-27f0-4ef5-af17-7cd50bce6550               |
|                             | id = e525cbca-b3cc-4adf-a1cb-b1bf48fa2422                                          |
|                             | preferred = False                                                                  |
| host                        | storagenode@generic#GENERIC                                                        |
| access_rules_status         | active                                                                             |
| snapshot_id                 | None                                                                               |
| is_public                   | False                                                                              |
| task_state                  | None                                                                               |
| snapshot_support            | True                                                                               |
| id                          | 5f8a0574-a95e-40ff-b898-09fd8d6a1fac                                               |
| size                        | 1                                                                                  |
| name                        | demo-share1                                                                        |
| share_type                  | 8a35da28-0f74-490d-afff-23664ecd4f01                                               |
| has_replicas                | False                                                                              |
| replication_type            | None                                                                               |
| created_at                  | 2016-03-30T19:10:33.000000                                                         |
| share_proto                 | NFS                                                                                |
| consistency_group_id        | None                                                                               |
| source_cgsnapshot_member_id | None                                                                               |
| project_id                  | 48e8c35b2ac6495d86d4be61658975e7                                                   |
| metadata                    | {}                                                                                 |
+-----------------------------+------------------------------------------------------------------------------------+</literal_block>
                </list_item>
            </enumerated_list>
        </section>
        <section dupnames="allow\ access\ to\ the\ share" ids="id2">
            <title>Allow access to the share</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Configure access to the new share before attempting to mount it via
                        the network. The compute instance (whose IP address is referenced by the
                        INSTANCE_IP below) must have network connectivity to the network specified
                        in the share network.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila access-allow demo-share1 ip INSTANCE_IP
+--------------+--------------------------------------+
| Property     | Value                                |
+--------------+--------------------------------------+
| share_id     | 5f8a0574-a95e-40ff-b898-09fd8d6a1fac |
| access_type  | ip                                   |
| access_to    | 10.0.0.46                            |
| access_level | rw                                   |
| state        | new                                  |
| id           | aefeab01-7197-44bf-ad0f-d6ca6f99fc96 |
+--------------+--------------------------------------+</literal_block>
                </list_item>
            </enumerated_list>
        </section>
        <section dupnames="mount\ the\ share\ on\ a\ compute\ instance" ids="id3">
            <title>Mount the share on a compute instance</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Log into your compute instance and create a folder where the mount will
                        be placed:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ mkdir ~/test_folder</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Mount the NFS share in the compute instance using the export location of
                        the share:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ mount -vt nfs 10.254.0.6:/shares/share-0bfd69a1-27f0-4ef5-af17-7cd50bce6550 ~/test_folder</literal_block>
                </list_item>
            </enumerated_list>
            <paragraph>For more information about how to manage shares, see the
                <reference name="OpenStack End User Guide" refuri="http://docs.openstack.org/user-guide/cli_manage_shares.html">OpenStack End User Guide</reference><target ids="openstack-end-user-guide" names="openstack\ end\ user\ guide" refuri="http://docs.openstack.org/user-guide/cli_manage_shares.html"></target></paragraph>
        </section>
    </section>
</document>
