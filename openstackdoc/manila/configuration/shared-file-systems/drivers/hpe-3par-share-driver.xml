<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/manila/doc/source/configuration/shared-file-systems/drivers/hpe-3par-share-driver.rst">
    <section ids="hpe-3par-driver" names="hpe\ 3par\ driver">
        <title>HPE 3PAR driver</title>
        <paragraph>The HPE 3PAR driver provides NFS and CIFS shared file systems to
            OpenStack using HPE 3PAR’s File Persona capabilities.</paragraph>
        <section ids="hpe-3par-file-persona-software-suite-concepts-and-terminology" names="hpe\ 3par\ file\ persona\ software\ suite\ concepts\ and\ terminology">
            <title>HPE 3PAR File Persona Software Suite concepts and terminology</title>
            <paragraph>The software suite comprises the following managed objects:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>File Provisioning Groups (FPGs)</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Virtual File Servers (VFSs)</paragraph>
                </list_item>
                <list_item>
                    <paragraph>File Stores</paragraph>
                </list_item>
                <list_item>
                    <paragraph>File Shares</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>The File Persona Software Suite is built upon the resilient mesh-active
                architecture of HPE 3PAR StoreServ and benefits from HPE 3PAR storage
                foundation of wide-striped logical disks and autonomic
                <literal>Common Provisioning Groups (CPGs)</literal>. A CPG can be shared between file and
                block to create the File Shares or the logical unit numbers (LUNs) to
                provide true convergence.</paragraph>
            <paragraph><literal>A File Provisioning Group (FPG)</literal> is an instance of the HPE intellectual
                property Adaptive File System. It controls how files are stored and retrieved.
                Each FPG is transparently constructed from one or multiple
                Virtual Volumes (VVs) and is the unit for replication and disaster recovery
                for File Persona Software Suite. There are up to 16 FPGs supported on a
                node pair.</paragraph>
            <paragraph><literal>A Virtual File Server (VFS)</literal> is conceptually like a server. As such, it
                presents virtual IP addresses to clients, participates in user authentication
                services, and can have properties for such things as user/group quota
                management and antivirus policies. Up to 16 VFSs are supported on a node pair,
                one per FPG.</paragraph>
            <paragraph><literal>File Stores</literal> are the slice of a VFS and FPG at which snapshots are taken,
                capacity quota management can be performed, and antivirus scan service
                policies customized. There are up to 256 File Stores supported on a node pair,
                16 File Stores per VFS.</paragraph>
            <paragraph><literal>File Shares</literal> are what provide data access to clients via SMB, NFS, and the
                Object Access API, subject to the share permissions applied to them. Multiple
                File Shares can be created for a File Store and at different directory levels
                within a File Store.</paragraph>
        </section>
        <section ids="supported-shared-filesystems" names="supported\ shared\ filesystems">
            <title>Supported shared filesystems</title>
            <paragraph>The driver supports CIFS and NFS shares.</paragraph>
        </section>
        <section ids="operations-supported" names="operations\ supported">
            <title>Operations supported</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Create a share.</paragraph>
                    <paragraph>– Share is not accessible until access rules allow access.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Delete a share.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Allow share access.</paragraph>
                    <paragraph>Note the following limitations:</paragraph>
                    <paragraph>– IP access rules are required for NFS share access.</paragraph>
                    <paragraph>– User access rules are not allowed for NFS shares.</paragraph>
                    <paragraph>– User access rules are required for SMB share access.</paragraph>
                    <paragraph>– User access requires a File Persona local user for SMB shares.</paragraph>
                    <paragraph>– Shares are read/write (and subject to ACLs).</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Deny share access.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a snapshot.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Delete a snapshot.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a share from a snapshot.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Extend a share.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Shrink a share.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Share networks.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>HPE 3PAR File Persona driver can be configured to work with or without
                share networks. When using share networks, the HPE 3PAR
                driver allocates an FSIP on the back end FPG (VFS) to match the share
                network’s subnet and segmentation ID. Security groups associated
                with share networks are ignored.</paragraph>
        </section>
        <section ids="operations-not-supported" names="operations\ not\ supported">
            <title>Operations not supported</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Manage and unmanage</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Manila Experimental APIs (consistency groups, replication, and migration)
                        were added in Mitaka but have not yet been implemented by the HPE 3PAR
                        File Persona driver.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="requirements" names="requirements">
            <title>Requirements</title>
            <paragraph>On the OpenStack host running the Manila share service:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>python-3parclient version 4.2.0 or newer from PyPI.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>On the HPE 3PAR array:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>HPE 3PAR Operating System software version 3.2.1 MU3 or higher.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>A license that enables the File Persona feature.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The array class and hardware configuration must support File Persona.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="pre-configuration-on-the-hpe-3par-storeserv" names="pre-configuration\ on\ the\ hpe\ 3par\ storeserv">
            <title>Pre-configuration on the HPE 3PAR StoreServ</title>
            <paragraph>The following HPE 3PAR CLI commands show how to set up the HPE 3PAR StoreServ
                to use File Persona with OpenStack Manila. HPE 3PAR File Persona must be
                licensed, initialized, and started on the HPE 3PAR storage.</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">cli% startfs 0:2:1 1:2:1
cli% setfs nodeip -ipaddress 10.10.10.11 -subnet 255.255.240.0 0
cli% setfs nodeip -ipaddress 10.10.10.12 -subnet 255.255.240.0 1
cli% setfs dns 192.168.8.80,127.127.5.50 foo.com,bar.com
cli% setfs gw 10.10.10.10</literal_block>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>A File Provisioning Group (FPG) must be created for use with the
                        Shared File Systems service.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">cli% createfpg examplecpg examplefpg 18T</literal_block>
                </list_item>
                <list_item>
                    <paragraph>A Virtual File Server (VFS) must be created on the FPG.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The VFS must be configured with an appropriate share export IP
                        address.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">cli% createvfs -fpg examplefpg 10.10.10.101 255.255.0.0 examplevfs</literal_block>
                </list_item>
                <list_item>
                    <paragraph>A local user in the Administrators group is needed for CIFS (SMB) shares.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">cli% createfsgroup fsusers
cli% createfsuser –passwd &lt;password&gt; -enable true -grplist
Users,Administrators –primarygroup fsusers fsadmin</literal_block>
                </list_item>
                <list_item>
                    <paragraph>The WSAPI with HTTP and/or HTTPS must be enabled and started.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">cli% setwsapi -https enable
cli% startwsapi</literal_block>
                </list_item>
            </bullet_list>
        </section>
        <section ids="hpe-3par-shared-file-system-driver-configuration" names="hpe\ 3par\ shared\ file\ system\ driver\ configuration">
            <title>HPE 3PAR shared file system driver configuration</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Install the python-3parclient python package on the OpenStack Block Storage
                        system:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ pip install 'python-3parclient&gt;=4.0,&lt;5.0'</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Manila configuration file</paragraph>
                    <paragraph>The Manila configuration file (typically <literal>/etc/manila/manila.conf</literal>)
                        defines and configures the Manila drivers and backends. After updating the
                        configuration file, the Manila share service must be restarted for changes
                        to take effect.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Enable share protocols</paragraph>
                    <paragraph>To enable share protocols, an optional list of supported protocols can be
                        specified using the <literal>enabled_share_protocols</literal> setting in the <literal>DEFAULT</literal>
                        section of the <literal>manila.conf</literal> file. The default is <literal>NFS, CIFS</literal> which
                        allows both protocols supported by HPE 3PAR (NFS and SMB). Where Manila
                        uses the term <literal>CIFS</literal>, HPE 3PAR uses the term <literal>SMB</literal>. Use the
                        <literal>enabled_share_protocols</literal> option if you want to only provide one type of
                        share (for example, only NFS) or if you want to explicitly avoid the
                        introduction of other protocols that can be added for other drivers in the
                        future.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Enable share back ends</paragraph>
                    <paragraph>In the <literal>[DEFAULT]</literal> section of the Manila configuration file, use the
                        <literal>enabled_share_backends</literal> option to specify the name of one or more
                        back-end configuration sections to be enabled. To enable multiple
                        back ends, use a comma-separated list.</paragraph>
                    <note>
                        <paragraph>The name of the backend’s configuration section is used (which may
                            be different from the <literal>share_backend_name</literal> value)</paragraph>
                    </note>
                </list_item>
                <list_item>
                    <paragraph>Configure each back end</paragraph>
                    <paragraph>For each back end, a configuration section defines the driver and back end
                        options. These include common Manila options, as well as driver-specific
                        options. The following <literal>Driver options</literal> section describes
                        the parameters that need to be configured in the Manila
                        configuration file for the HPE 3PAR driver.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="driver-options" names="driver\ options">
            <title>Driver options</title>
            <paragraph>The following table contains the configuration options specific to the
                share driver.</paragraph>
            <comment xml:space="preserve">Warning: Do not edit this file. It is automatically generated from the
software project's code and your changes will be overwritten.

The tool to generate this file lives in openstack-doc-tools repository.

Please make any changes needed in the code, then run the
autogenerate-config-doc tool from the openstack-doc-tools repository, or
ask for help on the documentation mailing list, IRC channel or meeting.</comment>
            <target refid="manila-hpe3par"></target>
            <table classes="config-ref-table" ids="id2 manila-hpe3par" names="manila-hpe3par">
                <title>Description of HPE 3PAR share driver configuration options</title>
                <tgroup cols="2">
                    <colspec colwidth="50"></colspec>
                    <colspec colwidth="50"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Configuration option = Default value</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph><strong>[DEFAULT]</strong></paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>hpe3par_api_url</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) 3PAR WSAPI Server Url like <reference refuri="https:/">https:/</reference>/&lt;3par ip&gt;:8080/api/v1</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>hpe3par_cifs_admin_access_domain</literal> = <literal>LOCAL_CLUSTER</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) File system domain for the CIFS admin user.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>hpe3par_cifs_admin_access_password</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) File system admin password for CIFS.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>hpe3par_cifs_admin_access_username</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) File system admin user name for CIFS.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>hpe3par_debug</literal> = <literal>False</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Boolean) Enable HTTP debugging to 3PAR</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>hpe3par_fpg</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Unknown) The File Provisioning Group (FPG) to use</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>hpe3par_fstore_per_share</literal> = <literal>False</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Boolean) Use one filestore per share</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>hpe3par_password</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) 3PAR password for the user specified in hpe3par_username</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>hpe3par_require_cifs_ip</literal> = <literal>False</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Boolean) Require IP access rules for CIFS (in addition to user)</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>hpe3par_san_ip</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) IP address of SAN controller</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>hpe3par_san_login</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Username for SAN controller</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>hpe3par_san_password</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Password for SAN controller</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>hpe3par_san_ssh_port</literal> = <literal>22</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Port number) SSH port to use with SAN</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>hpe3par_share_mount_path</literal> = <literal>/mnt/</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) The path where shares will be mounted when deleting nested file trees.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>hpe3par_username</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) 3PAR username with the ‘edit’ role</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
        <section ids="hpe-3par-manila-driver-configuration-example" names="hpe\ 3par\ manila\ driver\ configuration\ example">
            <title>HPE 3PAR Manila driver configuration example</title>
            <paragraph>The following parameters shows a sample subset of the <literal>manila.conf</literal> file,
                which configures two backends and the relevant <literal>[DEFAULT]</literal> options. A real
                configuration would include additional <literal>[DEFAULT]</literal> options and additional
                sections that are not discussed in this document. In this example, the
                backends are using different FPGs on the same array:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
enabled_share_backends = HPE1,HPE2
enabled_share_protocols = NFS,CIFS
default_share_type = default
[HPE1]
share_backend_name = HPE3PAR1
share_driver = manila.share.drivers.hpe.hpe_3par_driver.HPE3ParShareDriver
driver_handles_share_servers = False
max_over_subscription_ratio = 1
hpe3par_fpg = examplefpg,10.10.10.101
hpe3par_san_ip = 10.20.30.40
hpe3par_api_url = https://10.20.30.40:8080/api/v1
hpe3par_username = &lt;username&gt;
hpe3par_password = &lt;password&gt;
hpe3par_san_login = &lt;san_username&gt;
hpe3par_san_password = &lt;san_password&gt;
hpe3par_debug = False
hpe3par_cifs_admin_access_username = &lt;fs_admin&gt;
hpe3par_cifs_admin_access_password = &lt;fs_password&gt;
[HPE2]
share_backend_name = HPE3PAR2
share_driver = manila.share.drivers.hpe.hpe_3par_driver.HPE3ParShareDriver
driver_handles_share_servers = False
max_over_subscription_ratio = 1
hpe3par_fpg = examplefpg2,10.10.10.102
hpe3par_san_ip = 10.20.30.40
hpe3par_api_url = https://10.20.30.40:8080/api/v1
hpe3par_username = &lt;username&gt;
hpe3par_password = &lt;password&gt;
hpe3par_san_login = &lt;san_username&gt;
hpe3par_san_password = &lt;san_password&gt;
hpe3par_debug = False
hpe3par_cifs_admin_access_username = &lt;fs_admin&gt;
hpe3par_cifs_admin_access_password = &lt;password&gt;</literal_block>
        </section>
        <section ids="network-approach" names="network\ approach">
            <title>Network approach</title>
            <paragraph>Network connectivity between the storage array (SSH/CLI and WSAPI) and the
                Manila host is required for share management. Network connectivity between
                the clients and the VFS is required for mounting and using the shares.
                This includes:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Routing from the client to the external network.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Assigning the client an external IP address, for example a floating IP.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Configuring the Shared File Systems service host networking properly
                        for IP forwarding.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Configuring the VFS networking properly for client subnets.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Configuring network segmentation, if applicable.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>In the OpenStack Kilo release, the HPE 3PAR driver did not support share
                networks. Share access from clients to HPE 3PAR shares required external
                network access (external to OpenStack) and was set up and configured outside
                of Manila.</paragraph>
            <paragraph>In the OpenStack Liberty release, the HPE 3PAR driver could run with or
                without share networks. The configuration option
                <literal>driver_handles_share_servers``( ``True</literal> or <literal>False</literal> ) indicated whether
                share networks could be used. When set to <literal>False</literal>, the HPE 3PAR driver
                behaved as described earlier for Kilo. When set to <literal>True</literal>, the share
                network’s subnet, segmentation ID and IP address range were used to allocate
                an FSIP on the HPE 3PAR. There is a limit of four FSIPs per VFS. For clients
                to communicate with shares via this FSIP, the client must have access to the
                external network using the subnet and segmentation ID of the share network.</paragraph>
            <paragraph>For example, the client must be routed to the neutron provider network with
                external access. The Manila host networking configuration and network
                switches must support the subnet routing. If the VLAN segmentation ID is used,
                communication with the share will use the FSIP IP address. Neutron networking
                is required for HPE 3PAR share network support. Flat and VLAN provider
                networks are supported, but the HPE 3PAR driver does not support share network
                security groups.</paragraph>
        </section>
        <section ids="share-access" names="share\ access">
            <title>Share access</title>
            <paragraph>A share that is mounted before access is allowed can appear to be an empty
                read-only share. After granting access, the share must be remounted.</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>IP access rules are required for NFS.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>SMB shares require user access rules.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>With the proper access rules, share access is not limited to the OpenStack
                environment. Access rules added via Manila or directly in HPE 3PAR CLI can be
                used to allow access to clients outside of the stack. The HPE 3PAR VFS/FSIP
                settings determine the subnets visible for HPE 3PAR share access.</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>IP access rules</paragraph>
                    <paragraph>To allow IP access to a share in the horizon UI, find the share in the
                        Project|Manage Compute|Shares view. Use the <literal>Manage Rules</literal> action to add
                        a rule. Select IP as the access type, and enter the external IP address
                        (for example, the floating IP) of the client in the <literal>Access to</literal> box.</paragraph>
                    <paragraph>You can also use the command line to allow IP access to a share in the
                        horizon UI with the command:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila access-allow &lt;share-id&gt; ip &lt;ip-address&gt;</literal_block>
                </list_item>
                <list_item>
                    <paragraph>User access rules</paragraph>
                    <paragraph>To allow user access to a share in the horizon UI, find the share in the
                        Project|Manage Compute|Shares view. Use the <literal>Manage Rules</literal> action to add
                        a rule. Select user as the access type and enter user name in the
                        <literal>Access to</literal> box.</paragraph>
                    <paragraph>You can also use the command line to allow user access to a share in the
                        horizon UI with the command:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila access-allow &lt;share-id&gt; user &lt;user name&gt;</literal_block>
                    <paragraph>The user name must be an HPE 3PAR user.</paragraph>
                    <paragraph>Share access is different from file system permissions,
                        for example, ACLs on files and folders. If a user wants to read a file,
                        the user must have at least read permissions on the share and an ACL that
                        grants him read permissions on the file or folder. Even with
                        full control share access, it does not mean every user can do
                        everything due to the additional restrictions of the folder ACLs.</paragraph>
                    <paragraph>To modify the file or folder ACLs, allow access to an HPE 3PAR File Persona
                        local user that is in the administrator’s group and connect to the share
                        using that user’s credentials. Then, use the appropriate mechanism to
                        modify the ACL or permissions to allow different access than what is
                        provided by default.</paragraph>
                </list_item>
            </bullet_list>
            <target refid="share-types"></target>
        </section>
        <section dupnames="share\ types" ids="share-types id1" names="share\ types">
            <title>Share types</title>
            <paragraph>When creating a share, a share type can be specified to determine where and
                how the share will be created. If a share type is not specified, the
                <literal>default_share_type</literal> set in the Shared File Systems service configuration
                file is used.</paragraph>
            <paragraph>Manila share types are a type or label that can be selected at share creation
                time in OpenStack. These types can be created either in the <literal>Admin</literal> horizon
                UI or using the command line, as follows:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila --os-username admin --os-tenant-name demo type-create
–is_public false &lt;name&gt; false</literal_block>
            <paragraph>The <literal>&lt;name&gt;</literal> is the name of the new share type. False at the end specifies
                <literal>driver_handles_share_servers=False</literal>. The <literal>driver_handles_share_servers</literal>
                setting in the share type needs to match the setting configured for the
                back end in the <literal>manila.conf</literal> file.</paragraph>
            <paragraph><literal>is_public</literal> is used to indicate whether this share type is applicable to all
                tenants or will be assigned to specific tenants.</paragraph>
            <paragraph><literal>--os-username admin --os-tenant-name demo</literal> are only needed if your
                environment variables do not specify the desired user and tenant.</paragraph>
            <paragraph>For share types that are not public, use Manila <literal>type-access-add</literal> to assign
                the share type to a tenant.</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Using share types to require share networks</paragraph>
                    <paragraph>The Shared File Systems service requires that the share type include the
                        <literal>driver_handles_share_servers</literal> extra-spec. This ensures that the share is
                        created on a back end that supports the requested
                        <literal>driver_handles_share_servers</literal> (share networks) capability. From the
                        Liberty release forward, both <literal>True</literal> and <literal>False</literal> are supported.</paragraph>
                    <paragraph>The <literal>driver_handles_share_servers</literal> setting in the share type must match
                        the setting in the back end configuration.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Using share types to select backends by name</paragraph>
                    <paragraph>Administrators can optionally specify that a particular share type be
                        explicitly associated with a single back end (or group of backends) by
                        including the extra spec share_backend_name to match the name specified
                        within the <literal>share_backend_name</literal> option in the back end configuration.</paragraph>
                    <paragraph>When a share type is not selected during share creation, the default share
                        type is used. To prevent creating these shares on any back end, the default
                        share type needs to be specific enough to find appropriate default backends
                        (or to find none if the default should not be used). The following example
                        shows how to set share_backend_name for a share type.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila --os-username admin --os-tenant-name demo type-key &lt;share-type&gt;
set share_backend_name=HPE3PAR2</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Using share types to select backends with capabilities</paragraph>
                    <paragraph>The HPE 3PAR driver automatically reports capabilities based on the FPG
                        used for each back end. An administrator can create share types with extra
                        specs, which controls share types that can use FPGs with or without
                        specific capabilities.</paragraph>
                    <paragraph>With the OpenStack Liberty release or later, below section shows the extra
                        specs used with the capabilities filter and the HPE 3PAR driver:</paragraph>
                    <definition_list>
                        <definition_list_item>
                            <term><literal>hpe3par_flash_cache</literal></term>
                            <definition>
                                <paragraph>When the value is set to <literal>&lt;is&gt; True</literal> (or <literal>&lt;is&gt; False</literal>), shares of
                                    this type are only created on a back end that uses HPE 3PAR Adaptive
                                    Flash Cache. For Adaptive Flash Cache, the HPE 3PAR StoreServ Storage
                                    array must meet the following requirements:</paragraph>
                                <bullet_list bullet="-">
                                    <list_item>
                                        <paragraph>Adaptive Flash Cache license installed</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>Available SSDs</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>Adaptive Flash Cache must be enabled on the HPE 3PAR StoreServ
                                            Storage array. This is done with the following CLI command:</paragraph>
                                        <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">cli% createflashcache &lt;size&gt;</literal_block>
                                        <paragraph><literal>&lt;size&gt;</literal> must be in 16 GB increments. For example, the below command
                                            creates 128 GB of Flash Cache for each node pair in the array.</paragraph>
                                        <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">cli% createflashcache 128g</literal_block>
                                    </list_item>
                                    <list_item>
                                        <paragraph>Adaptive Flash Cache must be enabled for the VV set used by an FPG.
                                            For example, <literal>setflashcache vvset:&lt;fpgname&gt;</literal>. The VV set name is the
                                            same as the FPG name.</paragraph>
                                        <note>
                                            <paragraph>This setting affects all shares in that FPG (on that back end).</paragraph>
                                        </note>
                                    </list_item>
                                </bullet_list>
                            </definition>
                        </definition_list_item>
                        <definition_list_item>
                            <term><literal>Dedupe</literal></term>
                            <definition>
                                <paragraph>When the value is set to <literal>&lt;is&gt; True</literal> (or <literal>&lt;is&gt; False</literal>), shares of
                                    this type are only created on a back end that uses deduplication. For HPE
                                    3PAR File Persona, the provisioning type is determined when the FPG is
                                    created. Using the <literal>createfpg –tdvv</literal> option creates an FPG that
                                    supports both dedupe and thin provisioning. A thin deduplication license
                                    must be installed to use the tdvv option.</paragraph>
                            </definition>
                        </definition_list_item>
                        <definition_list_item>
                            <term><literal>thin_provisioning</literal></term>
                            <definition>
                                <paragraph>When the value is set to <literal>&lt;is&gt; True</literal> (or <literal>&lt;is&gt; False</literal>), shares of
                                    this type are only created on a back end that uses thin (or full)
                                    provisioning. For HPE 3PAR File Persona, the provisioning type is
                                    determined when the FPG is created. By default, FPGs are created with
                                    thin provisioning. The capacity filter uses the total provisioned space
                                    and configured <literal>max_oversubscription_ratio</literal> when filtering and weighing
                                    backends that use thin provisioning.</paragraph>
                            </definition>
                        </definition_list_item>
                    </definition_list>
                </list_item>
                <list_item>
                    <paragraph>Using share types to influence share creation options</paragraph>
                    <paragraph>Scoped extra-specs are used to influence vendor-specific implementation
                        details. Scoped extra-specs use a prefix followed by a colon. For HPE 3PAR,
                        these extra specs have a prefix of hpe3par.</paragraph>
                    <paragraph>The following HPE 3PAR extra-specs are used when creating CIFS (SMB)
                        shares:</paragraph>
                    <definition_list>
                        <definition_list_item>
                            <term><literal>hpe3par:smb_access_based_enum</literal></term>
                            <definition>
                                <paragraph><literal>smb_access_based_enum</literal> (Access Based Enumeration) specifies if users
                                    can see only the files and directories to which they have been allowed
                                    access on the shares. Valid values are <literal>True</literal> or <literal>False</literal>.
                                    The default is <literal>False</literal>.</paragraph>
                            </definition>
                        </definition_list_item>
                        <definition_list_item>
                            <term><literal>hpe3par:smb_continuous_avail</literal></term>
                            <definition>
                                <paragraph><literal>smb_continuous_avail</literal> (Continuous Availability) specifies if
                                    continuous availability features of SMB3 should be enabled for this
                                    share. Valid values are <literal>True</literal> or <literal>False</literal>. The default is <literal>True</literal>.</paragraph>
                            </definition>
                        </definition_list_item>
                        <definition_list_item>
                            <term><literal>hpe3par:smb_cache</literal></term>
                            <definition>
                                <paragraph><literal>smb_cache</literal> specifies client-side caching for offline files. The
                                    default value is <literal>manual</literal>. Valid values are:</paragraph>
                                <bullet_list bullet="-">
                                    <list_item>
                                        <paragraph><literal>off</literal> — the client must not cache any files from this share. The
                                            share is configured to disallow caching.</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph><literal>manual</literal> — the client must allow only manual caching for the files
                                            open from this share.</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph><literal>optimized</literal> — the client may cache every file that it opens from
                                            this share. Also, the client may satisfy the file requests from its
                                            local cache. The share is configured to allow automatic caching of
                                            programs and documents.</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph><literal>auto</literal> — the client may cache every file that it opens from this
                                            share. The share is configured to allow automatic caching of
                                            documents.</paragraph>
                                    </list_item>
                                </bullet_list>
                            </definition>
                        </definition_list_item>
                    </definition_list>
                    <paragraph>When creating NFS shares, the following HPE 3PAR extra-specs are used:</paragraph>
                    <definition_list>
                        <definition_list_item>
                            <term><literal>hpe3par:nfs_options</literal></term>
                            <definition>
                                <paragraph>Comma separated list of NFS export options.</paragraph>
                                <paragraph>The NFS export options have the following limitations:</paragraph>
                                <paragraph><literal>ro</literal> and <literal>rw</literal> are not allowed (will be determined by the driver)</paragraph>
                                <paragraph><literal>no_subtree_check</literal> and <literal>fsid</literal> are not allowed per HPE 3PAR CLI
                                    support</paragraph>
                                <paragraph><literal>(in)secure</literal> and <literal>(no_)root_squash</literal> are not allowed because the HPE
                                    3PAR driver controls those settings</paragraph>
                                <paragraph>All other NFS options are forwarded to the HPE 3PAR as part of share
                                    creation. The HPE 3PAR performs additional validation at share creation
                                    time. For details, see the HPE 3PAR CLI help.</paragraph>
                            </definition>
                        </definition_list_item>
                    </definition_list>
                </list_item>
            </bullet_list>
        </section>
        <section ids="implementation-characteristics" names="implementation\ characteristics">
            <title>Implementation characteristics</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Shares from snapshots</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>When a share is created from a snapshot, the share must be deleted
                                before the snapshot can be deleted. This is enforced by the driver.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>A snapshot of an empty share will appear to work correctly, but
                                attempting to create a share from an empty share snapshot may fail with
                                an <literal>NFS Create export</literal> error.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>HPE 3PAR File Persona snapshots are for an entire File Store. In Manila,
                                they appear as snapshots of shares. A share sub-directory is used to
                                give the appearance of a share snapshot when using <literal>create share from
snapshot</literal> .</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Snapshots</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>For HPE 3PAR File Persona, snapshots are per File Store and not per
                                share. So, the HPE 3PAR limit of 1024 snapshots per File Store results
                                in a Manila limit of 1024 snapshots per tenant on each back end FPG.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Before deleting a share, you must delete its snapshots. This is enforced
                                by Manila. For HPE 3PAR File Persona, this also kicks off a snapshot
                                reclamation.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Size enforcement</paragraph>
                    <paragraph>Manila users create shares with size limits. HPE 3PAR enforces size limits
                        by using File Store quotas. When using <literal>hpe3par_fstore_per_share``=
``True``(the non-default setting) there is only one share per File Store,
so the size enforcement acts as expected. When using
``hpe3par_fstore_per_share</literal> = <literal>False</literal> (the default), the HPE 3PAR Manila
                        driver uses one File Store for multiple shares. In this case, the size of
                        the File Store limit is set to the cumulative limit of its Manila share
                        sizes. This can allow one tenant share to exceed the limit and affect the
                        space available for the same tenant’s other shares. One tenant cannot use
                        another tenant’s File Store.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>File removal</paragraph>
                    <paragraph>When shares are removed and the <literal>hpe3par_fstore_per_share``=``False</literal>
                        setting is used (the default), files may be left behind in the File Store.
                        Prior to Mitaka, removal of obsolete share directories and files that have
                        been stranded would require tools outside of OpenStack/Manila. In Mitaka
                        and later, the driver mounts the File Store to remove the deleted share’s
                        subdirectory and files. For SMB/CIFS share, it requires the
                        <literal>hpe3par_cifs_admin_access_username</literal> and
                        <literal>hpe3par_cifs_admin_access_password</literal> configuration. If the mount and
                        delete cannot be performed, an error is logged and the share is deleted
                        in Manila. Due to the potential space held by leftover files, File Store
                        quotas are not reduced when shares are removed.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Multi-tenancy</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>Network</paragraph>
                            <paragraph>The <literal>driver_handles_share_servers</literal> configuration setting determines
                                whether share networks are supported. When
                                <literal>driver_handles_share_servers</literal> is set to <literal>True</literal>, a share network is
                                required to create a share. The administrator creates share networks
                                with the desired network, subnet, IP range, and segmentation ID. The HPE
                                3PAR is configured with an FSIP using the same subnet and
                                segmentation ID and an IP address allocated from the neutron network.
                                Using share network-specific IP addresses, subnets, and segmentation IDs
                                give the appearance of better tenant isolation. Shares on an FPG,
                                however, are accessible via any of the FSIPs (subject to access rules).
                                Back end filtering should be used for further separation.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Back end filtering</paragraph>
                            <paragraph>A Manila HPE 3PAR back end configuration refers to a specific array and
                                a specific FPG. With multiple backends and multiple tenants, the
                                scheduler determines where shares will be created. In a scenario where
                                an array or back end needs to be restricted to one or more specific
                                tenants, share types can be used to influence the selection of a
                                back end. For more information on using share types,
                                see <reference name="Share types" refid="share-types">Share types</reference> .</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Tenant limit</paragraph>
                            <paragraph>The HPE 3PAR driver uses one File Store per tenant per protocol in each
                                configured FPG. When only one back end is configured, this results in a
                                limit of eight tenants (16 if only using one protocol). Use multiple
                                back end configurations to introduce additional FPGs on the same array
                                to increase the tenant limit.</paragraph>
                            <paragraph>When using share networks, an FSIP is created for each share network
                                (when its first share is created on the back end). The HPE 3PAR supports
                                4 FSIPs per FPG (VFS). One of those 4 FSIPs is reserved for the initial
                                VFS IP, so the share network limit is 48 share networks per node pair.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
        </section>
    </section>
</document>
