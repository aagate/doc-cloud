<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/manila/doc/source/configuration/shared-file-systems/drivers/zfs-on-linux-driver.rst">
    <section ids="zfs-on-linux-driver" names="zfs\ (on\ linux)\ driver">
        <title>ZFS (on Linux) driver</title>
        <paragraph>Manila ZFSonLinux share driver uses ZFS file system for exporting NFS shares.
            Written and tested using Linux version of ZFS.</paragraph>
        <section ids="requirements" names="requirements">
            <title>Requirements</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>NFS daemon that can be handled through <literal>exportfs</literal> app.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>ZFS file system packages, either Kernel or FUSE versions.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>ZFS zpools that are going to be used by Manila should exist and be
                        configured as desired. Manila will not change zpool configuration.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>For remote ZFS hosts according to manila-share service host SSH should be
                        installed.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>For ZFS hosts that support replication:</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>SSH access for each other should be passwordless.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Service IP addresses should be available by ZFS hosts for each other.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
        </section>
        <section ids="supported-shared-filesystems-and-operations" names="supported\ shared\ filesystems\ and\ operations">
            <title>Supported shared filesystems and operations</title>
            <paragraph>The driver supports NFS shares.</paragraph>
            <paragraph>The following operations are supported:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Create a share.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Delete a share.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Allow share access.</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>Only IP access type is supported.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Both access levels are supported - <literal>RW</literal> and <literal>RO</literal>.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Deny share access.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a snapshot.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Delete a snapshot.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a share from snapshot.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Extend a share.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Shrink a share.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Share replication (experimental):</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>Create, update, delete, and promote replica operations are supported.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
        </section>
        <section ids="possibilities" names="possibilities">
            <title>Possibilities</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Any amount of ZFS zpools can be used by share driver.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Allowed to configure default options for ZFS datasets that are used
                        for share creation.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Any amount of nested datasets is allowed to be used.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>All share replicas are read-only, only active one is read-write.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>All share replicas are synchronized periodically, not continuously.
                        Status <literal>in_sync</literal> means latest sync was successful.
                        Time range between syncs equals to the value
                        of the <literal>replica_state_update_interval</literal> configuration global option.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Driver can use qualified extra spec <literal>zfsonlinux:compression</literal>.
                        It can contain any value that ZFS app supports.
                        But if it is disabled through the configuration option
                        with the value <literal>compression=off</literal>, then it will not be used.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="restrictions" names="restrictions">
            <title>Restrictions</title>
            <paragraph>The ZFSonLinux share driver has the following restrictions:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Only IP access type is supported for NFS.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Only FLAT network is supported.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>Promote share replica</literal> operation will switch roles of
                        current <literal>secondary</literal> replica and <literal>active</literal>. It does not make more than
                        one active replica available.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The below items are not yet implemented:</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph><literal>Manage share</literal> operation.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph><literal>Manage snapshot</literal> operation.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph><literal>SaMBa</literal> based sharing.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph><literal>Thick provisioning</literal> capability.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
        </section>
        <section ids="known-problems" names="known\ problems">
            <title>Known problems</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><literal>Promote share replica</literal> operation will make ZFS file system that became
                        secondary as RO only on NFS level. On ZFS level system will
                        stay mounted as was - RW.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="back-end-configuration" names="back-end\ configuration">
            <title>Back-end configuration</title>
            <paragraph>The following parameters need to be configured in the manila configuration file
                for back-ends that use the ZFSonLinux driver:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><literal>share_driver</literal>
                        = manila.share.drivers.zfsonlinux.driver.ZFSonLinuxShareDriver</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>driver_handles_share_servers</literal> = False</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>replication_domain</literal> = custom_str_value_as_domain_name</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>If empty, then replication will be disabled.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>If set, then will be able to be used as replication peer for other
                                back ends with the same value.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph><literal>zfs_share_export_ip</literal> = &lt;user_facing IP address of ZFS host&gt;</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>zfs_service_ip</literal> = &lt;IP address of service network interface of ZFS host&gt;</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>zfs_zpool_list</literal> = zpoolname1,zpoolname2/nested_dataset_for_zpool2</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>Can be one or more zpools.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Can contain nested datasets.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph><literal>zfs_dataset_creation_options</literal> = &lt;list of ZFS dataset options&gt;</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>readonly, quota, sharenfs and sharesmb options will be ignored.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph><literal>zfs_dataset_name_prefix</literal> = &lt;prefix&gt;</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>Prefix to be used in each dataset name.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph><literal>zfs_dataset_snapshot_name_prefix</literal> = &lt;prefix&gt;</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>Prefix to be used in each dataset snapshot name.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph><literal>zfs_use_ssh</literal> = &lt;boolean_value&gt;</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>Set <literal>False</literal> if ZFS located on the same host as <title_reference>manila-share</title_reference> service.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Set <literal>True</literal> if <title_reference>manila-share</title_reference> service should use SSH
                                for ZFS configuration.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph><literal>zfs_ssh_username</literal> = &lt;ssh_username&gt;</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>Required for replication operations.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Required for SSH``ing to ZFS host if <literal>zfs_use_ssh</literal> is set to <literal>True</literal>.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph><literal>zfs_ssh_user_password</literal> = &lt;ssh_user_password&gt;</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>Password for <literal>zfs_ssh_username</literal> of ZFS host.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Used only if <literal>zfs_use_ssh</literal> is set to <literal>True</literal>.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph><literal>zfs_ssh_private_key_path</literal> = &lt;path_to_private_ssh_key&gt;</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>Used only if <literal>zfs_use_ssh</literal> is set to <literal>True</literal>.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph><literal>zfs_share_helpers</literal>
                        = NFS=manila.share.drivers.zfsonlinux.utils.NFSviaZFSHelper</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>Approach for setting up helpers is similar to various other share drivers.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>At least one helper should be used.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph><literal>zfs_replica_snapshot_prefix</literal> = &lt;prefix&gt;</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>Prefix to be used in dataset snapshot names that are created
                                by <literal>update replica</literal> operation.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
        </section>
        <section ids="driver-options" names="driver\ options">
            <title>Driver options</title>
            <comment xml:space="preserve">Warning: Do not edit this file. It is automatically generated from the
software project's code and your changes will be overwritten.

The tool to generate this file lives in openstack-doc-tools repository.

Please make any changes needed in the code, then run the
autogenerate-config-doc tool from the openstack-doc-tools repository, or
ask for help on the documentation mailing list, IRC channel or meeting.</comment>
            <target refid="manila-zfs"></target>
            <table classes="config-ref-table" ids="id1 manila-zfs" names="manila-zfs">
                <title>Description of ZFS share driver configuration options</title>
                <tgroup cols="2">
                    <colspec colwidth="50"></colspec>
                    <colspec colwidth="50"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Configuration option = Default value</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph><strong>[DEFAULT]</strong></paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfs_dataset_creation_options</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(List) Define here list of options that should be applied for each dataset creation if needed. Example: compression=gzip,dedup=off. Note that, for secondary replicas option ‘readonly’ will be set to ‘on’ and for active replicas to ‘off’ in any way. Also, ‘quota’ will be equal to share size. Optional.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfs_dataset_name_prefix</literal> = <literal>manila_share_</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Prefix to be used in each dataset name. Optional.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfs_dataset_snapshot_name_prefix</literal> = <literal>manila_share_snapshot_</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Prefix to be used in each dataset snapshot name. Optional.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfs_migration_snapshot_prefix</literal> = <literal>tmp_snapshot_for_share_migration_</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Set snapshot prefix for usage in ZFS migration. Required.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfs_replica_snapshot_prefix</literal> = <literal>tmp_snapshot_for_replication_</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Set snapshot prefix for usage in ZFS replication. Required.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfs_service_ip</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) IP to be added to admin-facing export location. Required.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfs_share_export_ip</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) IP to be added to user-facing export location. Required.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfs_share_helpers</literal> = <literal>NFS=manila.share.drivers.zfsonlinux.utils.NFSviaZFSHelper</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(List) Specify list of share export helpers for ZFS storage. It should look like following: ‘FOO_protocol=foo.FooClass,BAR_protocol=bar.BarClass’. Required.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfs_ssh_private_key_path</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Path to SSH private key that should be used for SSH’ing ZFS storage host. Not used for replication operations. Optional.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfs_ssh_user_password</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Password for user that is used for SSH’ing ZFS storage host. Not used for replication operations. They require passwordless SSH access. Optional.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfs_ssh_username</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) SSH user that will be used in 2 cases: 1) By manila-share service in case it is located on different host than its ZFS storage. 2) By manila-share services with other ZFS backends that perform replication. It is expected that SSH’ing will be key-based, passwordless. This user should be passwordless sudoer. Optional.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfs_use_ssh</literal> = <literal>False</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Boolean) Remote ZFS storage hostname that should be used for SSH’ing. Optional.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfs_zpool_list</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(List) Specify list of zpools that are allowed to be used by backend. Can contain nested datasets. Examples: Without nested dataset: ‘zpool_name’. With nested dataset: ‘zpool_name/nested_dataset_name’. Required.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
    </section>
</document>
