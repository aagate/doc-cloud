<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/manila/doc/source/configuration/shared-file-systems/drivers/hitachi-hsp-driver.rst">
    <section ids="hitachi-hyper-scale-out-platform-file-services-driver-for-openstack" names="hitachi\ hyper\ scale-out\ platform\ file\ services\ driver\ for\ openstack">
        <title>Hitachi Hyper Scale-Out Platform File Services Driver for OpenStack</title>
        <paragraph>The Hitachi Hyper Scale-Out Platform File Services Driver for OpenStack
            provides the management of file shares, supporting NFS shares with IP based
            rules to control access. It has a layer that handles the complexity of the
            protocol used to communicate to Hitachi Hyper Scale-Out Platform via a
            RESTful API, formatting and sending requests to the backend.</paragraph>
        <section ids="requirements" names="requirements">
            <title>Requirements</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Hitachi Hyper Scale-Out Platform (HSP) version 1.1.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>HSP user with <literal>file-system-full-access</literal> role.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Established network connection between the HSP interface and OpenStack
                        nodes.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="supported-shared-filesystems-and-operations" names="supported\ shared\ filesystems\ and\ operations">
            <title>Supported shared filesystems and operations</title>
            <paragraph>The driver supports NFS shares.</paragraph>
            <paragraph>The following operations are supported:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Create a share.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Delete a share.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Extend a share.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Shrink a share.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Allow share access.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Deny share access.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Manage a share.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Unmanage a share.</paragraph>
                </list_item>
            </bullet_list>
            <note>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Only <literal>IP</literal> access type is supported</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Both <literal>RW</literal> and <literal>RO</literal> access levels supported</paragraph>
                    </list_item>
                </bullet_list>
            </note>
        </section>
        <section ids="known-restrictions" names="known\ restrictions">
            <title>Known restrictions</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>The Hitachi HSP allows only 1024 virtual file systems per cluster. This
                        determines the limit of shares the driver can provide.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The Hitachi HSP file systems must have at least 128 GB. This means that
                        all shares created by Shared File Systems service should have 128 GB or
                        more.</paragraph>
                    <note>
                        <paragraph>The driver has an internal filter function that accepts only requests for
                            shares size greater than or equal to 128 GB, otherwise the request will
                            fail or be redirected to another available storage backend.</paragraph>
                    </note>
                </list_item>
            </bullet_list>
        </section>
        <section ids="driver-options" names="driver\ options">
            <title>Driver options</title>
            <paragraph>The following table contains the configuration options specific to the share
                driver.</paragraph>
            <comment xml:space="preserve">Warning: Do not edit this file. It is automatically generated from the
software project's code and your changes will be overwritten.

The tool to generate this file lives in openstack-doc-tools repository.

Please make any changes needed in the code, then run the
autogenerate-config-doc tool from the openstack-doc-tools repository, or
ask for help on the documentation mailing list, IRC channel or meeting.</comment>
            <target refid="manila-hds-hsp"></target>
            <table classes="config-ref-table" ids="id1 manila-hds-hsp" names="manila-hds_hsp">
                <title>Description of HDS HSP share driver configuration options</title>
                <tgroup cols="2">
                    <colspec colwidth="50"></colspec>
                    <colspec colwidth="50"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Configuration option = Default value</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph><strong>[hsp1]</strong></paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>share_backend_name</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) The backend name for a given driver implementation.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>share_driver</literal> = <literal>manila.share.drivers.generic.GenericShareDriver</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Driver to use for share creation.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
        <section ids="network-approach" names="network\ approach">
            <title>Network approach</title>
            <note>
                <paragraph>In the driver mode used by HSP Driver (DHSS = <literal>False</literal>), the driver does
                    not handle network configuration, it is up to the administrator to
                    configure it.</paragraph>
            </note>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Configure the network of the manila-share, Compute and Networking nodes to
                        reach HSP interface. For this, your provider network should be capable of
                        reaching HSP Cluster-Virtual-IP. These connections are mandatory so nova
                        instances are capable of accessing shares provided by the backend.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The following image represents a valid scenario:</paragraph>
                </list_item>
            </bullet_list>
            <image candidates="{'*': 'configuration/shared-file-systems/drivers/../../figures/hsp_network.png'}" uri="configuration/shared-file-systems/drivers/../../figures/hsp_network.png" width="60%"></image>
            <note>
                <paragraph>To HSP, the Virtual IP is the address through which clients access shares
                    and the Shared File Systems service sends commands to the management
                    interface.
                    This IP can be checked in HSP using its CLI:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ hspadm ip-address list</literal_block>
            </note>
        </section>
        <section ids="back-end-configuration" names="back\ end\ configuration">
            <title>Back end configuration</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Configure HSP driver according to your environment. This example
                        shows a valid HSP driver configuration:</paragraph>
                    <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
enabled_share_backends = hsp1
enabled_share_protocols = NFS
# ...

[hsp1]
share_backend_name = HITACHI1
share_driver = manila.share.drivers.hitachi.hsp.driver.HitachiHSPDriver
driver_handles_share_servers = False
hitachi_hsp_host = 172.24.47.190
hitachi_hsp_username = admin
hitachi_hsp_password = admin_password</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Configure HSP share type.</paragraph>
                    <note>
                        <paragraph>Shared File Systems service requires that the share type includes the
                            <literal>driver_handles_share_servers</literal> extra-spec. This ensures that the
                            share will be created on a backend that supports the requested
                            <literal>driver_handles_share_servers</literal> capability. Also,
                            <literal>snapshot_support</literal> extra-spec should be provided if its value
                            differs from the default value (<literal>True</literal>), as this driver version
                            that currently does not support snapshot operations. For this
                            driver both extra-specs must be set to <literal>False</literal>.</paragraph>
                    </note>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila type-create --snapshot_support False hsp False</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Restart all Shared File Systems services (<literal>manila-share</literal>,
                        <literal>manila-scheduler</literal> and <literal>manila-api</literal>).</paragraph>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="manage-and-unmanage-shares" names="manage\ and\ unmanage\ shares">
            <title>Manage and unmanage shares</title>
            <paragraph>The Shared File Systems service has the ability to manage and unmanage shares.
                If there is a share in the storage and it is not in OpenStack, you can manage
                that share and use it as a Shared File Systems share. Previous access rules
                are not imported by manila. The unmanage operation only unlinks the share from
                OpenStack, preserving all data in the share.</paragraph>
            <paragraph>In order to manage a HSP share, it must adhere to the following rules:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>File system and share name must not contain spaces.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Share name must not contain backslashes (<title_reference>\</title_reference>).</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>To <strong>manage</strong> a share use:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila manage [--name &lt;name&gt;] [--description &lt;description&gt;]
[--share_type &lt;share_type&gt;] [--driver_options [&lt;key=value&gt;
[&lt;key=value&gt; ...]]] &lt;service_host&gt; &lt;protocol&gt; &lt;export_path&gt;</literal_block>
            <paragraph>Where:</paragraph>
            <table>
                <tgroup cols="3">
                    <colspec colwidth="20"></colspec>
                    <colspec colwidth="21"></colspec>
                    <colspec colwidth="32"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph><strong>Parameter</strong></paragraph>
                            </entry>
                            <entry morecols="1">
                                <paragraph><strong>Description</strong></paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph><literal>service_host</literal></paragraph>
                            </entry>
                            <entry morecols="1">
                                <paragraph>Manila host, backend and share name. For example,
                                    <literal>ubuntu@hitachi1#hsp1</literal>. The available hosts can
                                    be listed with the command: <literal>manila pool-list</literal>
                                    (admin only).</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>protocol</literal></paragraph>
                            </entry>
                            <entry morecols="1">
                                <paragraph>Must be <strong>NFS</strong>, the only supported protocol in this
                                    driver version.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>export_path</literal></paragraph>
                            </entry>
                            <entry morecols="1">
                                <paragraph>The Hitachi Hyper Scale-Out Platform export path of
                                    the share, for example:
                                    <literal>172.24.47.190:/some_share_name</literal></paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <line_block>
                <line>To <strong>unmanage</strong> a share use:</line>
            </line_block>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila unmanage &lt;share&gt;</literal_block>
            <paragraph>Where:</paragraph>
            <table>
                <tgroup cols="3">
                    <colspec colwidth="18"></colspec>
                    <colspec colwidth="21"></colspec>
                    <colspec colwidth="35"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph><strong>Parameter</strong></paragraph>
                            </entry>
                            <entry morecols="1">
                                <paragraph><strong>Description</strong></paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph><literal>share</literal></paragraph>
                            </entry>
                            <entry morecols="1">
                                <paragraph>ID or name of the share to be unmanaged. This list can
                                    be fetched with: <literal>manila list</literal>.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
        <section ids="additional-notes" names="additional\ notes">
            <title>Additional notes</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Shares are thin provisioned. It is reported to manila only the
                        real used space in HSP.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Administrators should manage the tenant’s quota (<literal>manila quota-update</literal>)
                        to control the backend usage.</paragraph>
                </list_item>
            </bullet_list>
        </section>
    </section>
</document>
