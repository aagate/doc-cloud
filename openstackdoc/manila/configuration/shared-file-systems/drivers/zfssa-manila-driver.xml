<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/manila/doc/source/configuration/shared-file-systems/drivers/zfssa-manila-driver.rst">
    <section ids="oracle-zfs-storage-appliance-driver" names="oracle\ zfs\ storage\ appliance\ driver">
        <title>Oracle ZFS Storage Appliance driver</title>
        <paragraph>The Oracle ZFS Storage Appliance driver, version 1.0.0, enables the
            Oracle ZFS Storage Appliance (ZFSSA) to be used seamlessly as a shared
            storage resource for the OpenStack File System service (manila). The driver
            provides the ability to create and manage NFS and CIFS shares
            on the appliance, allowing virtual machines to access the shares
            simultaneously and securely.</paragraph>
        <section ids="requirements" names="requirements">
            <title>Requirements</title>
            <paragraph>Oracle ZFS Storage Appliance Software version 2013.1.2.0 or later.</paragraph>
        </section>
        <section ids="supported-operations" names="supported\ operations">
            <title>Supported operations</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Create NFS and CIFS shares.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Delete NFS and CIFS shares.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Allow or deny IP access to NFS shares.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create snapshots of a share.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Delete snapshots of a share.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create share from snapshot.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="restrictions" names="restrictions">
            <title>Restrictions</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Access to CIFS shares are open and cannot be changed from manila.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Version 1.0.0 of the driver only supports Single SVM networking mode.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="appliance-configuration" names="appliance\ configuration">
            <title>Appliance configuration</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Enable RESTful service on the ZFSSA Storage Appliance.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a new user on the appliance with the following authorizations:</paragraph>
                    <literal_block xml:space="preserve">scope=stmf - allow_configure=true
scope=nas - allow_clone=true, allow_createProject=true, allow_createShare=true, allow_changeSpaceProps=true, allow_changeGeneralProps=true, allow_destroy=true, allow_rollback=true, allow_takeSnap=true</literal_block>
                    <paragraph>You can create a role with authorizations as follows:</paragraph>
                    <literal_block xml:space="preserve">zfssa:&gt; configuration roles
zfssa:configuration roles&gt; role OpenStackRole
zfssa:configuration roles OpenStackRole (uncommitted)&gt; set description="OpenStack Manila Driver"
zfssa:configuration roles OpenStackRole (uncommitted)&gt; commit
zfssa:configuration roles&gt; select OpenStackRole
zfssa:configuration roles OpenStackRole&gt; authorizations create
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set scope=stmf
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_configure=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; commit</literal_block>
                    <paragraph>You can create a user with a specific role as follows:</paragraph>
                    <literal_block xml:space="preserve">zfssa:&gt; configuration users
zfssa:configuration users&gt; user cinder
zfssa:configuration users cinder (uncommitted)&gt; set fullname="OpenStack Manila Driver"
zfssa:configuration users cinder (uncommitted)&gt; set initial_password=12345
zfssa:configuration users cinder (uncommitted)&gt; commit
zfssa:configuration users&gt; select cinder set roles=OpenStackRole</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Create a storage pool.</paragraph>
                    <paragraph>An existing pool can also be used if required. You can create a pool
                        as follows:</paragraph>
                    <literal_block xml:space="preserve">zfssa:&gt; configuration storage
zfssa:configuration storage&gt; config pool
zfssa:configuration storage verify&gt; set data=2
zfssa:configuration storage verify&gt; done
zfssa:configuration storage config&gt; done</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Create a new project.</paragraph>
                    <paragraph>You can create a project as follows:</paragraph>
                    <literal_block xml:space="preserve">zfssa:&gt; shares
zfssa:shares&gt; project proj
zfssa:shares proj (uncommitted)&gt; commit</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Create a new or use an existing data IP address.</paragraph>
                    <paragraph>You can create an interface as follows:</paragraph>
                    <literal_block xml:space="preserve">zfssa:&gt; configuration net interfaces ip
zfssa:configuration net interfaces ip (uncommitted)&gt; set v4addrs=127.0.0.1/24
                     v4addrs = 127.0.0.1/24 (uncommitted)
zfssa:configuration net interfaces ip (uncommitted)&gt; set links=vnic1
                       links = vnic1 (uncommitted)
zfssa:configuration net interfaces ip (uncommitted)&gt; set admin=false
                       admin = false (uncommitted)
zfssa:configuration net interfaces ip (uncommitted)&gt; commit</literal_block>
                    <paragraph>It is required that both interfaces used for data and management are
                        configured properly. The data interface must be different from the
                        management interface.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Configure the cluster.</paragraph>
                    <paragraph>If a cluster is used as the manila storage resource, the following
                        verifications are required:</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>Verify that both the newly created pool and the network interface are of
                                type singleton and are not locked to the current controller.
                                This approach ensures that the pool and the interface used for data
                                always belong to the active controller, regardless of the current state
                                of the cluster.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Verify that the management IP, data IP and storage pool belong to the
                                same head.</paragraph>
                        </list_item>
                    </bullet_list>
                    <note>
                        <paragraph>A short service interruption occurs during failback or takeover,
                            but once the process is complete, manila should be able
                            to access the pool through the data IP.</paragraph>
                    </note>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="driver-options" names="driver\ options">
            <title>Driver options</title>
            <paragraph>The Oracle ZFSSA driver supports these options:</paragraph>
            <comment xml:space="preserve">Warning: Do not edit this file. It is automatically generated from the
software project's code and your changes will be overwritten.

The tool to generate this file lives in openstack-doc-tools repository.

Please make any changes needed in the code, then run the
autogenerate-config-doc tool from the openstack-doc-tools repository, or
ask for help on the documentation mailing list, IRC channel or meeting.</comment>
            <target refid="manila-zfssa"></target>
            <table classes="config-ref-table" ids="id1 manila-zfssa" names="manila-zfssa">
                <title>Description of ZFSSA share driver configuration options</title>
                <tgroup cols="2">
                    <colspec colwidth="50"></colspec>
                    <colspec colwidth="50"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Configuration option = Default value</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph><strong>[DEFAULT]</strong></paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_auth_password</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) ZFSSA management authorized userpassword.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_auth_user</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) ZFSSA management authorized username.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_data_ip</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) IP address for data.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_host</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) ZFSSA management IP address.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_manage_policy</literal> = <literal>loose</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Driver policy for share manage. A strict policy checks for a schema named manila_managed, and makes sure its value is true. A loose policy does not check for the schema.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_nas_checksum</literal> = <literal>fletcher4</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Controls checksum used for data blocks.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_nas_compression</literal> = <literal>off</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Data compression-off, lzjb, gzip-2, gzip, gzip-9.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_nas_logbias</literal> = <literal>latency</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Controls behavior when servicing synchronous writes.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_nas_mountpoint</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Location of project in ZFS/SA.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_nas_quota_snap</literal> = <literal>true</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Controls whether a share quota includes snapshot.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_nas_rstchown</literal> = <literal>true</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Controls whether file ownership can be changed.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_nas_vscan</literal> = <literal>false</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Controls whether the share is scanned for viruses.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_pool</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) ZFSSA storage pool name.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_project</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) ZFSSA project name.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_rest_timeout</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) REST connection timeout (in seconds).</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
    </section>
</document>
