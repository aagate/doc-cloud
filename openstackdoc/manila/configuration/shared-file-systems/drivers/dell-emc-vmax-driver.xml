<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/manila/doc/source/configuration/shared-file-systems/drivers/dell-emc-vmax-driver.rst">
    <section ids="dell-emc-vmax-driver" names="dell\ emc\ vmax\ driver">
        <title>Dell EMC VMAX driver</title>
        <paragraph>The Dell EMC Shared File Systems service driver framework (EMCShareDriver)
            utilizes the Dell EMC storage products to provide the shared file systems
            to OpenStack. The Dell EMC driver is a plug-in based driver which is designed
            to use different plug-ins to manage different Dell EMC storage products.</paragraph>
        <paragraph>The VMAX plug-in manages the VMAX to provide shared file systems. The EMC
            driver framework with the VMAX plug-in is referred to as the VMAX driver
            in this document.</paragraph>
        <paragraph>This driver performs the operations on VMAX eNAS by XMLAPI and the file
            command line. Each back end manages one Data Mover of VMAX. Multiple
            Shared File Systems service back ends need to be configured to manage
            multiple Data Movers.</paragraph>
        <section ids="requirements" names="requirements">
            <title>Requirements</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>VMAX eNAS OE for File version 8.1 or higher</paragraph>
                </list_item>
                <list_item>
                    <paragraph>VMAX Unified or File only</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The following licenses should be activated on VMAX for File:</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>CIFS</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>NFS</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>SnapSure (for snapshot)</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>ReplicationV2 (for create share from snapshot)</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
        </section>
        <section ids="supported-shared-file-systems-and-operations" names="supported\ shared\ file\ systems\ and\ operations">
            <title>Supported shared file systems and operations</title>
            <paragraph>The driver supports CIFS and NFS shares.</paragraph>
            <paragraph>The following operations are supported:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Create a share.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Delete a share.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Allow share access.</paragraph>
                    <paragraph>Note the following limitations:</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>Only IP access type is supported for NFS.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Only user access type is supported for CIFS.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Deny share access.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a snapshot.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Delete a snapshot.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a share from a snapshot.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>While the generic driver creates shared file systems based on cinder
                volumes attached to nova VMs, the VMAX driver performs similar operations
                using the Data Movers on the array.</paragraph>
        </section>
        <section ids="pre-configurations-on-vmax" names="pre-configurations\ on\ vmax">
            <title>Pre-configurations on VMAX</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Enable Unicode on Data Mover.</paragraph>
                    <paragraph>The VMAX driver requires that the Unicode is enabled on Data Mover.</paragraph>
                    <warning>
                        <paragraph>After enabling Unicode, you cannot disable it. If there are some
                            file systems created before Unicode is enabled on the VMAX,
                            consult the storage administrator before enabling Unicode.</paragraph>
                    </warning>
                    <paragraph>To check the Unicode status on Data Mover, use the following VMAX eNAS File
                        commands on the VMAX control station:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">server_cifs &lt;MOVER_NAME&gt; | head
# MOVER_NAME = &lt;name of the Data Mover&gt;</literal_block>
                    <paragraph>Check the value of I18N mode field. UNICODE mode is shown as
                        <literal>I18N mode = UNICODE</literal>.</paragraph>
                    <paragraph>To enable the Unicode for Data Mover, use the following command:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">uc_config -on -mover &lt;MOVER_NAME&gt;
# MOVER_NAME = &lt;name of the Data Mover&gt;</literal_block>
                    <paragraph>Refer to the document Using International Character Sets on VMAX for
                        File on <reference name="EMC support site" refuri="http://support.emc.com">EMC support site</reference><target ids="emc-support-site" names="emc\ support\ site" refuri="http://support.emc.com"></target> for more
                        information.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Enable CIFS service on Data Mover.</paragraph>
                    <paragraph>Ensure the CIFS service is enabled on the Data Mover which is going
                        to be managed by VMAX driver.</paragraph>
                    <paragraph>To start the CIFS service, use the following command:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">server_setup &lt;MOVER_NAME&gt; -Protocol cifs -option start [=&lt;n&gt;]
# MOVER_NAME = &lt;name of the Data Mover&gt;
# n = &lt;number of threads for CIFS users&gt;</literal_block>
                    <note>
                        <paragraph>If there is 1 GB of memory on the Data Mover, the default is 96
                            threads. However, if there is over 1 GB of memory, the default
                            number of threads is 256.</paragraph>
                    </note>
                    <paragraph>To check the CIFS service status, use the following command:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">server_cifs &lt;MOVER_NAME&gt; | head
# MOVER_NAME = &lt;name of the Data Mover&gt;</literal_block>
                    <paragraph>The command output will show the number of CIFS threads started.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>NTP settings on Data Mover.</paragraph>
                    <paragraph>VMAX driver only supports CIFS share creation with share network
                        which has an Active Directory security-service associated.</paragraph>
                    <paragraph>Creating CIFS share requires that the time on the Data Mover is in
                        sync with the Active Directory domain so that the CIFS server can
                        join the domain. Otherwise, the domain join will fail when creating
                        a share with this security service. There is a limitation that the
                        time of the domains used by security-services, even for different
                        tenants and different share networks, should be in sync. Time
                        difference should be less than 10 minutes.</paragraph>
                    <paragraph>We recommend setting the NTP server to the same public NTP
                        server on both the Data Mover and domains used in security services
                        to ensure the time is in sync everywhere.</paragraph>
                    <paragraph>Check the date and time on Data Mover with the following command:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">server_date &lt;MOVER_NAME&gt;
# MOVER_NAME = &lt;name of the Data Mover&gt;</literal_block>
                    <paragraph>Set the NTP server for Data Mover with the following command:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">server_date &lt;MOVER_NAME&gt; timesvc start ntp &lt;host&gt; [&lt;host&gt; ...]
# MOVER_NAME = &lt;name of the Data Mover&gt;
# host = &lt;IP address of the time server host&gt;</literal_block>
                    <note>
                        <paragraph>The host must be running the NTP protocol. Only 4 host entries
                            are allowed.</paragraph>
                    </note>
                </list_item>
                <list_item>
                    <paragraph>Configure User Mapping on the Data Mover.</paragraph>
                    <paragraph>Before creating CIFS share using VMAX driver, you must select a
                        method of mapping Windows SIDs to UIDs and GIDs. DELL EMC recommends
                        using usermapper in single protocol (CIFS) environment which is
                        enabled on VMAX eNAS by default.</paragraph>
                    <paragraph>To check usermapper status, use the following command syntax:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">server_usermapper &lt;movername&gt;
# movername = &lt;name of the Data Mover&gt;</literal_block>
                    <paragraph>If usermapper does not start, use the following command
                        to start the usermapper:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">server_usermapper &lt;movername&gt; -enable
# movername = &lt;name of the Data Mover&gt;</literal_block>
                    <paragraph>For a multiple protocol environment, refer to Configuring VMAX eNAS User
                        Mapping on <reference name="EMC support site" refuri="http://support.emc.com">EMC support site</reference><target dupnames="emc\ support\ site" ids="id1" refuri="http://support.emc.com"></target> for
                        additional information.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Configure network connection.</paragraph>
                    <paragraph>Find the network devices (physical port on NIC) of the Data Mover that
                        has access to the share network.</paragraph>
                    <paragraph>To check the device list, go
                        to <inline classes="menuselection" rawtext=":menuselection:`Unisphere &gt; Settings &gt; Network &gt; Device`">Unisphere &gt; Settings &gt; Network &gt; Device</inline>.</paragraph>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="back-end-configurations" names="back-end\ configurations">
            <title>Back-end configurations</title>
            <paragraph>The following parameters need to be configured in the
                <literal>/etc/manila/manila.conf</literal> file for the VMAX driver:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">emc_share_backend = vmax
emc_nas_server = &lt;IP address&gt;
emc_nas_password = &lt;password&gt;
emc_nas_login = &lt;user&gt;
emc_nas_server_container = &lt;Data Mover name&gt;
emc_nas_pool_names = &lt;Comma separated pool names&gt;
share_driver = manila.share.drivers.emc.driver.EMCShareDriver
emc_interface_ports = &lt;Comma separated ports list&gt;</literal_block>
            <bullet_list bullet="-">
                <list_item>
                    <definition_list>
                        <definition_list_item>
                            <term><title_reference>emc_share_backend</title_reference></term>
                            <definition>
                                <paragraph>The plug-in name. Set it to <literal>vmax</literal> for the VMAX driver.</paragraph>
                            </definition>
                        </definition_list_item>
                    </definition_list>
                </list_item>
                <list_item>
                    <definition_list>
                        <definition_list_item>
                            <term><title_reference>emc_nas_server</title_reference></term>
                            <definition>
                                <paragraph>The control station IP address of the VMAX system to be managed.</paragraph>
                            </definition>
                        </definition_list_item>
                    </definition_list>
                </list_item>
                <list_item>
                    <definition_list>
                        <definition_list_item>
                            <term><title_reference>emc_nas_password</title_reference> and <title_reference>emc_nas_login</title_reference></term>
                            <definition>
                                <paragraph>The fields that are used to provide credentials to the
                                    VMAX system. Only local users of VMAX File is supported.</paragraph>
                            </definition>
                        </definition_list_item>
                    </definition_list>
                </list_item>
                <list_item>
                    <definition_list>
                        <definition_list_item>
                            <term><title_reference>emc_nas_server_container</title_reference></term>
                            <definition>
                                <paragraph>Name of the Data Mover to serve the share service.</paragraph>
                            </definition>
                        </definition_list_item>
                    </definition_list>
                </list_item>
                <list_item>
                    <definition_list>
                        <definition_list_item>
                            <term><title_reference>emc_nas_pool_names</title_reference></term>
                            <definition>
                                <paragraph>Comma separated list specifying the name of the pools to be used
                                    by this back end. Do not set this option if all storage pools
                                    on the system can be used.
                                    Wild card character is supported.</paragraph>
                                <paragraph>Examples: pool_1, pool_*, *</paragraph>
                            </definition>
                        </definition_list_item>
                    </definition_list>
                </list_item>
                <list_item>
                    <definition_list>
                        <definition_list_item>
                            <term><title_reference>emc_interface_ports</title_reference></term>
                            <definition>
                                <paragraph>Comma-separated list specifying the ports (devices) of Data Mover
                                    that can be used for share server interface. Do not set this
                                    option if all ports on the Data Mover can be used.
                                    Wild card character is supported.</paragraph>
                                <paragraph>Examples: spa_eth1, spa_*, *</paragraph>
                            </definition>
                        </definition_list_item>
                    </definition_list>
                </list_item>
            </bullet_list>
            <paragraph>Restart of the <literal>manila-share</literal> service is needed for the configuration
                changes to take effect.</paragraph>
        </section>
        <section ids="restrictions" names="restrictions">
            <title>Restrictions</title>
            <paragraph>The VMAX driver has the following restrictions:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Only IP access type is supported for NFS.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Only user access type is supported for CIFS.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Only FLAT network and VLAN network are supported.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>VLAN network is supported with limitations. The neutron subnets in
                        different VLANs that are used to create share networks cannot have
                        overlapped address spaces. Otherwise, VMAX may have a problem to
                        communicate with the hosts in the VLANs. To create shares for
                        different VLANs with same subnet address, use different Data Movers.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The <strong>Active Directory</strong> security service is the only supported
                        security service type and it is required to create CIFS shares.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Only one security service can be configured for each share network.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The domain name of the <literal>active_directory</literal> security
                        service should be unique even for different tenants.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The time on the Data Mover and the Active Directory domains used in
                        security services should be in sync (time difference should be less
                        than 10 minutes). We recommended using same NTP server on both
                        the Data Mover and Active Directory domains.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>On eNAS, the snapshot is stored in the SavVols. eNAS system allows the
                        space used by SavVol to be created and extended until the sum of the
                        space consumed by all SavVols on the system exceeds the default 20%
                        of the total space available on the system. If the 20% threshold
                        value is reached, an alert will be generated on eNAS. Continuing to
                        create snapshot will cause the old snapshot to be inactivated (and
                        the snapshot data to be abandoned). The limit percentage value can be
                        changed manually by storage administrator based on the storage needs.
                        We recommend the administrator configures the notification on the
                        SavVol usage. Refer to Using eNAS SnapSure document on <reference name="EMC support site" refuri="http://support.emc.com">EMC support
                            site</reference><target dupnames="emc\ support\ site" ids="id2" refuri="http://support.emc.com"></target> for more information.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>eNAS has limitations on the overall numbers of Virtual Data Movers,
                        filesystems, shares, and checkpoints. Virtual Data Mover(VDM) is
                        created by the eNAS driver on the eNAS to serve as the Shared File
                        Systems service share server. Similarly, the filesystem is created,
                        mounted, and exported from the VDM over CIFS or NFS protocol to serve
                        as the Shared File Systems service share. The eNAS checkpoint serves
                        as the Shared File Systems service share snapshot. Refer to the NAS
                        Support Matrix document on <reference name="EMC support site" refuri="http://support.emc.com">EMC support
                            site</reference><target dupnames="emc\ support\ site" ids="id3" refuri="http://support.emc.com"></target> for the limitations and configure the
                        quotas accordingly.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="driver-options" names="driver\ options">
            <title>Driver options</title>
            <paragraph>Configuration options specific to this driver:</paragraph>
            <comment xml:space="preserve">Warning: Do not edit this file. It is automatically generated from the
software project's code and your changes will be overwritten.

The tool to generate this file lives in openstack-doc-tools repository.

Please make any changes needed in the code, then run the
autogenerate-config-doc tool from the openstack-doc-tools repository, or
ask for help on the documentation mailing list, IRC channel or meeting.</comment>
            <target refid="manila-vmax"></target>
            <table classes="config-ref-table" ids="id4 manila-vmax" names="manila-vmax">
                <title>Description of Dell EMC VMAX share driver configuration options</title>
                <tgroup cols="2">
                    <colspec colwidth="50"></colspec>
                    <colspec colwidth="50"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Configuration option = Default value</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph><strong>[DEFAULT]</strong></paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>vmax_ethernet_ports</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(List) Comma separated list of ports that can be used for share server interfaces. Members of the list can be Unix-style glob expressions.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>vmax_server_container</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Data mover to host the NAS server.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>vmax_share_data_pools</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(List) Comma separated list of pools that can be used to persist share data.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
    </section>
</document>
