<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/manila/doc/source/admin/shared-file-systems-quotas.rst">
    <target refid="shared-file-systems-quotas"></target>
    <section ids="quotas-and-limits shared-file-systems-quotas" names="quotas\ and\ limits shared_file_systems_quotas">
        <title>Quotas and limits</title>
        <section ids="limits" names="limits">
            <title>Limits</title>
            <paragraph>Limits are the resource limitations that are allowed for each project.
                An administrator can configure limits in the <literal>manila.conf</literal> file.</paragraph>
            <paragraph>Users can query their rate and absolute limits.</paragraph>
            <paragraph>To see the absolute limits, run:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila absolute-limits
+----------------------------+-------+
| Name                       | Value |
+----------------------------+-------+
| maxTotalShareGigabytes     | 1000  |
| maxTotalShareNetworks      | 10    |
| maxTotalShareSnapshots     | 50    |
| maxTotalShares             | 50    |
| maxTotalSnapshotGigabytes  | 1000  |
| totalShareGigabytesUsed    | 1     |
| totalShareNetworksUsed     | 2     |
| totalShareSnapshotsUsed    | 1     |
| totalSharesUsed            | 1     |
| totalSnapshotGigabytesUsed | 1     |
+----------------------------+-------+</literal_block>
            <paragraph>Rate limits control the frequency at which users can issue specific API
                requests. Administrators use rate limiting to configure limits on the type and
                number of API calls that can be made in a specific time interval. For example,
                a rate limit can control the number of <literal>GET</literal> requests processed
                during a one-minute period.</paragraph>
            <paragraph>To set the API rate limits, modify the
                <literal>etc/manila/api-paste.ini</literal> file, which is a part of the WSGI pipeline and
                defines the actual limits. You need to restart <literal>manila-api</literal> service after
                you edit the <literal>etc/manila/api-paste.ini</literal> file.</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[filter:ratelimit]
paste.filter_factory = manila.api.v1.limits:RateLimitingMiddleware.factory
limits = (POST, "*/shares", ^/shares, 120, MINUTE);(PUT, "*/shares", .*, 120, MINUTE);(DELETE, "*", .*, 120, MINUTE)</literal_block>
            <paragraph>Also, add the <literal>ratelimit</literal> to <literal>noauth</literal>, <literal>keystone</literal>, <literal>keystone_nolimit</literal>
                parameters in the <literal>[composite:openstack_share_api]</literal> and
                <literal>[composite:openstack_share_api_v2]</literal> groups.</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[composite:openstack_share_api]
use = call:manila.api.middleware.auth:pipeline_factory
noauth = cors faultwrap ssl ratelimit sizelimit noauth api
keystone = cors faultwrap ssl ratelimit sizelimit authtoken keystonecontext api
keystone_nolimit = cors faultwrap ssl ratelimit sizelimit authtoken keystonecontext api

[composite:openstack_share_api_v2]
use = call:manila.api.middleware.auth:pipeline_factory
noauth = cors faultwrap ssl ratelimit sizelimit noauth apiv2
keystone = cors faultwrap ssl ratelimit sizelimit authtoken keystonecontext apiv2
keystone_nolimit = cors faultwrap ssl ratelimit sizelimit authtoken keystonecontext apiv2</literal_block>
            <paragraph>To see the rate limits, run:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila rate-limits
+--------+------------+-------+--------+--------+----------------------+
| Verb   | URI        | Value | Remain | Unit   | Next_Available       |
+--------+------------+-------+--------+--------+----------------------+
| DELETE | "*"        | 120   | 120    | MINUTE | 2015-10-20T15:17:20Z |
| POST   | "*/shares" | 120   | 120    | MINUTE | 2015-10-20T15:17:20Z |
| PUT    | "*/shares" | 120   | 120    | MINUTE | 2015-10-20T15:17:20Z |
+--------+------------+-------+--------+--------+----------------------+</literal_block>
        </section>
        <section ids="quotas" names="quotas">
            <title>Quotas</title>
            <paragraph>Quota sets provide quota management support.</paragraph>
            <paragraph>To list the quotas for a project or user, use the <literal_strong classes="command">manila quota-show</literal_strong>
                command. If you specify the optional <literal>--user</literal> parameter, you get the
                quotas for this user in the specified project. If you omit this parameter,
                you get the quotas for the specified project.</paragraph>
            <note>
                <paragraph>The Shared File Systems service does not perform mapping of usernames and
                    project names to IDs. Provide only ID values to get correct setup
                    of quotas. Setting it by names you set quota for nonexistent project/user.
                    In case quota is not set explicitly by project/user ID,
                    The Shared File Systems service just applies default quotas.</paragraph>
            </note>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila quota-show --tenant %project_id% --user %user_id%
+--------------------+-------+
| Property           | Value |
+--------------------+-------+
| gigabytes          | 1000  |
| snapshot_gigabytes | 1000  |
| snapshots          | 50    |
| shares             | 50    |
| share_networks     | 10    |
+--------------------+-------+</literal_block>
            <paragraph>There are default quotas for a project that are set from the
                <literal>manila.conf</literal> file. To list the default quotas for a project, use
                the <literal_strong classes="command">manila quota-defaults</literal_strong> command:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila quota-defaults --tenant %project_id%
+--------------------+-------+
| Property           | Value |
+--------------------+-------+
| gigabytes          | 1000  |
| snapshot_gigabytes | 1000  |
| snapshots          | 50    |
| shares             | 50    |
| share_networks     | 10    |
+--------------------+-------+</literal_block>
            <paragraph>The administrator can update the quotas for a specific project, or for a
                specific user by providing both the <literal>--tenant</literal> and <literal>--user</literal> optional
                arguments. It is possible to update the <literal>shares</literal>, <literal>snapshots</literal>,
                <literal>gigabytes</literal>, <literal>snapshot-gigabytes</literal>, and <literal>share-networks</literal> quotas.</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila quota-update %project_id% --user %user_id% --shares 49 --snapshots 49</literal_block>
            <paragraph>As administrator, you can also permit or deny the force-update of a quota that
                is already used, or if the requested value exceeds the configured quota limit.
                To force-update a quota, use <literal>force</literal> optional key.</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila quota-update %project_id% --shares 51 --snapshots 51 --force</literal_block>
            <paragraph>To revert quotas to default for a project or for a user, delete quotas:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila quota-delete --tenant %project_id% --user %user_id%</literal_block>
        </section>
    </section>
</document>
