<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/manila/doc/source/admin/shared-file-systems-snapshots.rst">
    <target refid="shared-file-systems-snapshots"></target>
    <section ids="share-snapshots shared-file-systems-snapshots" names="share\ snapshots shared_file_systems_snapshots">
        <title>Share snapshots</title>
        <paragraph>The Shared File Systems service provides a snapshot mechanism to help users
            restore data by running the <literal_strong classes="command">manila snapshot-create</literal_strong> command.</paragraph>
        <paragraph>To export a snapshot, create a share from it, then mount the new share
            to an instance. Copy files from the attached share into the archive.</paragraph>
        <paragraph>To import a snapshot, create a new share with appropriate size, attach it to
            instance, and then copy a file from the archive to the attached file
            system.</paragraph>
        <note>
            <paragraph>You cannot delete a share while it has saved dependent snapshots.</paragraph>
        </note>
        <paragraph>Create a snapshot from the share:</paragraph>
        <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila snapshot-create Share1 --name Snapshot1 --description "Snapshot of Share1"
+-------------+--------------------------------------+
| Property    | Value                                |
+-------------+--------------------------------------+
| status      | creating                             |
| share_id    | aca648eb-8c03-4394-a5cc-755066b7eb66 |
| name        | Snapshot1                            |
| created_at  | 2015-09-25T05:27:38.862040           |
| share_proto | NFS                                  |
| id          | 962e8126-35c3-47bb-8c00-f0ee37f42ddd |
| size        | 1                                    |
| share_size  | 1                                    |
| description | Snapshot of Share1                   |
+-------------+--------------------------------------+</literal_block>
        <paragraph>Update snapshot name or description if needed:</paragraph>
        <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila snapshot-rename Snapshot1 Snapshot_1 --description "Snapshot of Share1. Updated."</literal_block>
        <paragraph>Check that status of a snapshot is <literal>available</literal>:</paragraph>
        <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila snapshot-show Snapshot1
+-------------+--------------------------------------+
| Property    | Value                                |
+-------------+--------------------------------------+
| status      | available                            |
| share_id    | aca648eb-8c03-4394-a5cc-755066b7eb66 |
| name        | Snapshot1                            |
| created_at  | 2015-09-25T05:27:38.000000           |
| share_proto | NFS                                  |
| id          | 962e8126-35c3-47bb-8c00-f0ee37f42ddd |
| size        | 1                                    |
| share_size  | 1                                    |
| description | Snapshot of Share1                   |
+-------------+--------------------------------------+</literal_block>
        <paragraph>To restore your data from a snapshot, use <literal_strong classes="command">manila create</literal_strong> with
            key <literal>--snapshot-id</literal>. This creates a new share from an
            existing snapshot. Create a share from a snapshot and check whether
            it is available:</paragraph>
        <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila create nfs 1 --name Share2 --metadata source=snapshot --description "Share from a snapshot." --snapshot-id 962e8126-35c3-47bb-8c00-f0ee37f42ddd
+-----------------------------+--------------------------------------+
| Property                    | Value                                |
+-----------------------------+--------------------------------------+
| status                      | None                                 |
| share_type_name             | default                              |
| description                 | Share from a snapshot.               |
| availability_zone           | None                                 |
| share_network_id            | None                                 |
| export_locations            | []                                   |
| share_server_id             | None                                 |
| host                        | None                                 |
| snapshot_id                 | 962e8126-35c3-47bb-8c00-f0ee37f42ddd |
| is_public                   | False                                |
| task_state                  | None                                 |
| snapshot_support            | True                                 |
| id                          | b6b0617c-ea51-4450-848e-e7cff69238c7 |
| size                        | 1                                    |
| name                        | Share2                               |
| share_type                  | c0086582-30a6-4060-b096-a42ec9d66b86 |
| created_at                  | 2015-09-25T06:25:50.240417           |
| export_location             | None                                 |
| share_proto                 | NFS                                  |
| consistency_group_id        | None                                 |
| source_cgsnapshot_member_id | None                                 |
| project_id                  | 20787a7ba11946adad976463b57d8a2f     |
| metadata                    | {u'source': u'snapshot'}             |
+-----------------------------+--------------------------------------+

$ manila show Share2
+-----------------------------+-------------------------------------------+
| Property                    | Value                                     |
+-----------------------------+-------------------------------------------+
| status                      | available                                 |
| share_type_name             | default                                   |
| description                 | Share from a snapshot.                    |
| availability_zone           | nova                                      |
| share_network_id            | 5c3cbabb-f4da-465f-bc7f-fadbe047b85a      |
| export_locations            | 10.254.0.3:/shares/share-1dc2a471-3d47-...|
| share_server_id             | 41b7829d-7f6b-4c96-aea5-d106c2959961      |
| host                        | manila@generic1#GENERIC1                  |
| snapshot_id                 | 962e8126-35c3-47bb-8c00-f0ee37f42ddd      |
| is_public                   | False                                     |
| task_state                  | None                                      |
| snapshot_support            | True                                      |
| id                          | b6b0617c-ea51-4450-848e-e7cff69238c7      |
| size                        | 1                                         |
| name                        | Share2                                    |
| share_type                  | c0086582-30a6-4060-b096-a42ec9d66b86      |
| created_at                  | 2015-09-25T06:25:50.000000                |
| share_proto                 | NFS                                       |
| consistency_group_id        | None                                      |
| source_cgsnapshot_member_id | None                                      |
| project_id                  | 20787a7ba11946adad976463b57d8a2f          |
| metadata                    | {u'source': u'snapshot'}                  |
+-----------------------------+-------------------------------------------+</literal_block>
        <paragraph>You can soft-delete a snapshot using <literal_strong classes="command">manila snapshot-delete
                &lt;snapshot_name_or_ID&gt;</literal_strong>. If a snapshot is in busy state, and during
            the delete an <literal>error_deleting</literal> status appeared, administrator can
            force-delete it or explicitly reset the state.</paragraph>
        <paragraph>Use <literal_strong classes="command">snapshot-reset-state [--state &lt;state&gt;] &lt;snapshot&gt;</literal_strong> to update
            the state of a snapshot explicitly. A valid value of a status are
            <literal>available</literal>, <literal>error</literal>, <literal>creating</literal>, <literal>deleting</literal>, <literal>error_deleting</literal>.
            If no state is provided, the <literal>available</literal> state will be used.</paragraph>
        <paragraph>Use <literal_strong classes="command">manila snapshot-force-delete &lt;snapshot&gt;</literal_strong> to force-delete
            a specified share snapshot in any state.</paragraph>
    </section>
</document>
