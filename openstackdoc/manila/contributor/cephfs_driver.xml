<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/manila/doc/source/contributor/cephfs_driver.rst">
    <comment xml:space="preserve">Copyright 2016 Red Hat, Inc.
All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License"); you may
not use this file except in compliance with the License. You may obtain
a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
License for the specific language governing permissions and limitations
under the License.</comment>
    <section ids="cephfs-driver" names="cephfs\ driver">
        <title>CephFS driver</title>
        <paragraph>The CephFS driver enables manila to export shared filesystems backed by Ceph’s
            File System (CephFS) using either the Ceph network protocol or NFS protocol.
            Guests require a native Ceph client or an NFS client in order to mount the
            filesystem.</paragraph>
        <paragraph>When guests access CephFS using the native Ceph protocol, access is
            controlled via Ceph’s cephx authentication system. If a user requests
            share access for an ID, Ceph creates a corresponding Ceph auth ID and a secret
            key, if they do not already exist, and authorizes the ID to access the share.
            The client can then mount the share using the ID and the secret key. To learn
            more about configuring Ceph clients to access the shares created using this
            driver, please see the Ceph documentation (<reference refuri="http://docs.ceph.com/docs/master/cephfs/">http://docs.ceph.com/docs/master/cephfs/</reference>).
            If you choose to use the kernel client rather than the FUSE client, the share
            size limits set in manila may not be obeyed.</paragraph>
        <paragraph>And when guests access CephFS through NFS, an NFS-Ganesha server mediates
            access to CephFS. The driver enables access control by managing the NFS-Ganesha
            server’s exports.</paragraph>
        <section ids="supported-operations" names="supported\ operations">
            <title>Supported Operations</title>
            <paragraph>The following operations are supported with CephFS backend:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Create/delete share</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Allow/deny CephFS native protocol access to share</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>Only <literal>cephx</literal> access type is supported for CephFS native protocol.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph><literal>read-only</literal> access level is supported in Newton or later versions
                                of manila.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph><literal>read-write</literal> access level is supported in Mitaka or later versions
                                of manila.</paragraph>
                        </list_item>
                    </bullet_list>
                    <paragraph>(or)</paragraph>
                    <paragraph>Allow/deny NFS access to share</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>Only <literal>ip</literal> access type is supported for NFS protocol.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph><literal>read-only</literal> and <literal>read-write</literal> access levels are supported in Pike or
                                later versions of manila.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Extend/shrink share</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create/delete snapshot</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create/delete consistency group (CG)</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create/delete CG snapshot</paragraph>
                </list_item>
            </bullet_list>
            <warning>
                <paragraph>CephFS currently supports snapshots as an experimental feature, therefore
                    the snapshot support with the CephFS Native driver is also experimental
                    and should not be used in production environments. For more information,
                    see
                    (<reference refuri="http://docs.ceph.com/docs/master/cephfs/experimental-features/#snapshots">http://docs.ceph.com/docs/master/cephfs/experimental-features/#snapshots</reference>).</paragraph>
            </warning>
        </section>
        <section ids="prerequisites" names="prerequisites">
            <title>Prerequisites</title>
            <important>
                <paragraph>A manila share backed by CephFS is only as good as the
                    underlying filesystem. Take care when configuring your Ceph
                    cluster, and consult the latest guidance on the use of
                    CephFS in the Ceph documentation (
                    <reference refuri="http://docs.ceph.com/docs/master/cephfs/">http://docs.ceph.com/docs/master/cephfs/</reference>)</paragraph>
            </important>
            <section ids="for-cephfs-native-shares" names="for\ cephfs\ native\ shares">
                <title>For CephFS native shares</title>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Mitaka or later versions of manila.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Jewel or later versions of Ceph.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>A Ceph cluster with a filesystem configured (
                            <reference refuri="http://docs.ceph.com/docs/master/cephfs/createfs/">http://docs.ceph.com/docs/master/cephfs/createfs/</reference>)</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>ceph-common</literal> package installed in the servers running the
                            <reference internal="True" refuri="../reference/glossary#term-manila-share"><inline classes="xref std std-term">manila-share</inline></reference> service.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Ceph client installed in the guest, preferably the FUSE based client,
                            <literal>ceph-fuse</literal>.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Network connectivity between your Ceph cluster’s public network and the
                            servers running the <reference internal="True" refuri="../reference/glossary#term-manila-share"><inline classes="xref std std-term">manila-share</inline></reference> service.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Network connectivity between your Ceph cluster’s public network and guests.
                            See :ref:security_cephfs_native</paragraph>
                    </list_item>
                </bullet_list>
            </section>
            <section ids="for-cephfs-nfs-shares" names="for\ cephfs\ nfs\ shares">
                <title>For CephFS NFS shares</title>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Pike or later versions of manila.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Kraken or later versions of Ceph.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>2.5 or later versions of NFS-Ganesha.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>A Ceph cluster with a filesystem configured (
                            <reference refuri="http://docs.ceph.com/docs/master/cephfs/createfs/">http://docs.ceph.com/docs/master/cephfs/createfs/</reference>)</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>ceph-common</literal> package installed in the servers running the
                            <reference internal="True" refuri="../reference/glossary#term-manila-share"><inline classes="xref std std-term">manila-share</inline></reference> service.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>NFS client installed in the guest.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Network connectivity between your Ceph cluster’s public network and the
                            servers running the <reference internal="True" refuri="../reference/glossary#term-manila-share"><inline classes="xref std std-term">manila-share</inline></reference> service.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Network connectivity between your Ceph cluster’s public network and
                            NFS-Ganesha server.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Network connectivity between your NFS-Ganesha server and the manila
                            guest.</paragraph>
                    </list_item>
                </bullet_list>
                <target refid="authorize-ceph-driver"></target>
            </section>
        </section>
        <section ids="authorizing-the-driver-to-communicate-with-ceph authorize-ceph-driver" names="authorizing\ the\ driver\ to\ communicate\ with\ ceph authorize_ceph_driver">
            <title>Authorizing the driver to communicate with Ceph</title>
            <paragraph>Run the following commands to create a Ceph identity for a driver instance
                to use:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">read -d '' MON_CAPS &lt;&lt; EOF
allow r,
allow command "auth del",
allow command "auth caps",
allow command "auth get",
allow command "auth get-or-create"
EOF

ceph auth get-or-create client.manila -o manila.keyring \
mds 'allow *' \
osd 'allow rw' \
mon "$MON_CAPS"</literal_block>
            <paragraph><literal>manila.keyring</literal>, along with your <literal>ceph.conf</literal> file, will then need to be
                placed on the server running the <reference internal="True" refuri="../reference/glossary#term-manila-share"><inline classes="xref std std-term">manila-share</inline></reference> service.</paragraph>
            <important>
                <paragraph>To communicate with the Ceph backend, a CephFS driver instance
                    (represented as a backend driver section in manila.conf) requires its own
                    Ceph auth ID that is not used by other CephFS driver instances running in
                    the same controller node.</paragraph>
            </important>
            <paragraph>In the server running the <reference internal="True" refuri="../reference/glossary#term-manila-share"><inline classes="xref std std-term">manila-share</inline></reference> service, you can place the
                <literal>ceph.conf</literal> and <literal>manila.keyring</literal> files in the /etc/ceph directory. Set the
                same owner for the <reference internal="True" refuri="../reference/glossary#term-manila-share"><inline classes="xref std std-term">manila-share</inline></reference> process and the <literal>manila.keyring</literal>
                file. Add the following section to the <literal>ceph.conf</literal> file.</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[client.manila]
client mount uid = 0
client mount gid = 0
log file = /opt/stack/logs/ceph-client.manila.log
admin socket = /opt/stack/status/stack/ceph-$name.$pid.asok
keyring = /etc/ceph/manila.keyring</literal_block>
            <paragraph>It is advisable to modify the Ceph client’s admin socket file and log file
                locations so that they are co-located with manila services’s pid files and
                log files respectively.</paragraph>
        </section>
        <section ids="enabling-snapshot-support-in-ceph-backend" names="enabling\ snapshot\ support\ in\ ceph\ backend">
            <title>Enabling snapshot support in Ceph backend</title>
            <paragraph>Enable snapshots in Ceph if you want to use them in manila:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">ceph mds set allow_new_snaps true --yes-i-really-mean-it</literal_block>
            <warning>
                <paragraph>Note that the snapshot support for the CephFS driver is experimental and is
                    known to have several caveats for use. Only enable this and the
                    equivalent <literal>manila.conf</literal> option if you understand these risks. See
                    (<reference refuri="http://docs.ceph.com/docs/master/cephfs/experimental-features/#snapshots">http://docs.ceph.com/docs/master/cephfs/experimental-features/#snapshots</reference>)
                    for more details.</paragraph>
            </warning>
        </section>
        <section ids="configuring-cephfs-backend-in-manila-conf" names="configuring\ cephfs\ backend\ in\ manila.conf">
            <title>Configuring CephFS backend in manila.conf</title>
            <section ids="configure-cephfs-native-share-backend-in-manila-conf" names="configure\ cephfs\ native\ share\ backend\ in\ manila.conf">
                <title>Configure CephFS native share backend in manila.conf</title>
                <paragraph>Add CephFS to <literal>enabled_share_protocols</literal> (enforced at manila api layer). In
                    this example we leave NFS and CIFS enabled, although you can remove these
                    if you will only use CephFS:</paragraph>
                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">enabled_share_protocols = NFS,CIFS,CEPHFS</literal_block>
                <paragraph>Create a section like this to define a CephFS native backend:</paragraph>
                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[cephfsnative1]
driver_handles_share_servers = False
share_backend_name = CEPHFSNATIVE1
share_driver = manila.share.drivers.cephfs.driver.CephFSDriver
cephfs_conf_path = /etc/ceph/ceph.conf
cephfs_protocol_helper_type = CEPHFS
cephfs_auth_id = manila
cephfs_cluster_name = ceph
cephfs_enable_snapshots = false</literal_block>
                <paragraph>Set <literal>driver-handles-share-servers</literal> to <literal>False</literal> as the driver does not
                    manage the lifecycle of <literal>share-servers</literal>. To let the driver perform snapshot
                    related operations, set <literal>cephfs_enable_snapshots</literal> to True. For the driver
                    backend to expose shares via the the native Ceph protocol, set
                    <literal>cephfs_protocol_helper_type</literal> to <literal>CEPHFS</literal>.</paragraph>
                <paragraph>Then edit <literal>enabled_share_backends</literal> to point to the driver’s backend section
                    using the section name. In this example we are also including another backend
                    (“generic1”), you would include whatever other backends you have configured.</paragraph>
                <note>
                    <paragraph>For Mitaka, Newton, and Ocata releases, the <literal>share_driver</literal> path
                        was <literal>manila.share.drivers.cephfs.cephfs_native.CephFSNativeDriver</literal></paragraph>
                </note>
                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">enabled_share_backends = generic1, cephfsnative1</literal_block>
            </section>
            <section ids="configure-cephfs-nfs-share-backend-in-manila-conf" names="configure\ cephfs\ nfs\ share\ backend\ in\ manila.conf">
                <title>Configure CephFS NFS share backend in manila.conf</title>
                <paragraph>Add NFS to <literal>enabled_share_protocols</literal> if it’s not already there:</paragraph>
                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">enabled_share_protocols = NFS,CIFS,CEPHFS</literal_block>
                <paragraph>Create a section to define a CephFS NFS share backend:</paragraph>
                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[cephfsnfs1]
driver_handles_share_servers = False
share_backend_name = CEPHFSNFS1
share_driver = manila.share.drivers.cephfs.driver.CephFSDriver
cephfs_protocol_helper_type = NFS
cephfs_conf_path = /etc/ceph/ceph.conf
cephfs_auth_id = manila1
cephfs_cluster_name = ceph
cephfs_enable_snapshots = False
cephfs_ganesha_server_is_remote= False
cephfs_ganesha_server_ip = 172.24.4.3</literal_block>
                <paragraph>The following options are set in the driver backend section above:</paragraph>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph><literal>driver-handles-share-servers</literal> to <literal>False</literal> as the driver does not
                            manage the lifecycle of <literal>share-servers</literal>.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>cephfs_protocol_helper_type</literal> to <literal>NFS</literal> to allow NFS protocol access to
                            the CephFS backed shares.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>ceph_auth_id</literal> to the ceph auth ID created in <reference internal="True" refid="authorize-ceph-driver"><inline classes="std std-ref">Authorizing the driver to communicate with Ceph</inline></reference>.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>cephfs_ganesha_server_is_remote</literal> to False if the NFS-ganesha server is
                            co-located with the <reference internal="True" refuri="../reference/glossary#term-manila-share"><inline classes="xref std std-term">manila-share</inline></reference>  service. If the NFS-Ganesha
                            server is remote, then set the options to <literal>True</literal>, and set other options
                            such as <literal>cephfs_ganesha_server_ip</literal>, <literal>cephfs_ganesha_server_username</literal>,
                            and <literal>cephfs_ganesha_server_password</literal> (or <literal>cephfs_ganesha_path_to_private_key</literal>)
                            to allow the driver to manage the NFS-Ganesha export entries over SSH.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>cephfs_ganesha_server_ip</literal> to the ganesha server IP address. It is
                            recommended to set this option even if the ganesha server is co-located
                            with the <reference internal="True" refuri="../reference/glossary#term-manila-share"><inline classes="xref std std-term">manila-share</inline></reference> service.</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>Edit <literal>enabled_share_backends</literal> to point to the driver’s backend section
                    using the section name, <literal>cephfnfs1</literal>.</paragraph>
                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">enabled_share_backends = generic1, cephfsnfs1</literal_block>
            </section>
        </section>
        <section ids="creating-shares" names="creating\ shares">
            <title>Creating shares</title>
            <section ids="create-cephfs-native-share" names="create\ cephfs\ native\ share">
                <title>Create CephFS native share</title>
                <paragraph>The default share type may have <literal>driver_handles_share_servers</literal> set to True.
                    Configure a share type suitable for CephFS native share:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">manila type-create cephfsnativetype false
manila type-key cephfsnativetype set vendor_name=Ceph storage_protocol=CEPHFS</literal_block>
                <paragraph>Then create yourself a share:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">manila create --share-type cephfsnativetype --name cephnativeshare1 cephfs 1</literal_block>
                <paragraph>Note the export location of the share:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">manila share-export-location-list cephnativeshare1</literal_block>
                <paragraph>The export location of the share contains the Ceph monitor (mon) addresses and
                    ports, and the path to be mounted. It is of the form,
                    <literal>{mon ip addr:port}[,{mon ip addr:port}]:{path to be mounted}</literal></paragraph>
            </section>
            <section ids="create-cephfs-nfs-share" names="create\ cephfs\ nfs\ share">
                <title>Create CephFS NFS share</title>
                <paragraph>Configure a share type suitable for CephFS NFS share:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">manila type-create cephfsnfstype false
manila type-key cephfsnfstype set vendor_name=Ceph storage_protocol=NFS</literal_block>
                <paragraph>Then create a share:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">manila create --share-type cephfsnfstype --name cephnfsshare1 nfs 1</literal_block>
                <paragraph>Note the export location of the share:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">manila share-export-location-list cephnfsshare1</literal_block>
                <paragraph>The export location of the share contains the IP address of the NFS-Ganesha
                    server and the path to be mounted. It is of the form,
                    <literal>{NFS-Ganesha server address}:{path to be mounted}</literal></paragraph>
            </section>
        </section>
        <section ids="allowing-access-to-shares" names="allowing\ access\ to\ shares">
            <title>Allowing access to shares</title>
            <section ids="allow-access-to-cephfs-native-share" names="allow\ access\ to\ cephfs\ native\ share">
                <title>Allow access to CephFS native share</title>
                <paragraph>Allow Ceph auth ID <literal>alice</literal> access to the share using <literal>cephx</literal> access type.</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">manila access-allow cephnativeshare1 cephx alice</literal_block>
                <paragraph>Note the access status, and the access/secret key of <literal>alice</literal>.</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">manila access-list cephnativeshare1</literal_block>
                <note>
                    <paragraph>In Mitaka release, the secret key is not exposed by any manila API. The
                        Ceph storage admin needs to pass the secret key to the guest out of band of
                        manila. You can refer to the link below to see how the storage admin
                        could obtain the secret key of an ID.
                        <reference refuri="http://docs.ceph.com/docs/jewel/rados/operations/user-management/#get-a-user">http://docs.ceph.com/docs/jewel/rados/operations/user-management/#get-a-user</reference></paragraph>
                    <paragraph>Alternatively, the cloud admin can create Ceph auth IDs for each of the
                        tenants. The users can then request manila to authorize the pre-created
                        Ceph auth IDs, whose secret keys are already shared with them out of band
                        of manila, to access the shares.</paragraph>
                    <paragraph>Following is a command that the cloud admin could run from the
                        server running the <reference internal="True" refuri="../reference/glossary#term-manila-share"><inline classes="xref std std-term">manila-share</inline></reference> service to create a Ceph auth ID
                        and get its keyring file.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">ceph --name=client.manila --keyring=/etc/ceph/manila.keyring auth \
get-or-create client.alice -o alice.keyring</literal_block>
                    <paragraph>For more details, please see the Ceph documentation.
                        <reference refuri="http://docs.ceph.com/docs/jewel/rados/operations/user-management/#add-a-user">http://docs.ceph.com/docs/jewel/rados/operations/user-management/#add-a-user</reference></paragraph>
                </note>
            </section>
            <section ids="allow-access-to-cephfs-nfs-share" names="allow\ access\ to\ cephfs\ nfs\ share">
                <title>Allow access to CephFS NFS share</title>
                <paragraph>Allow a guest access to the share using <literal>ip</literal> access type.</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">manila access-allow cephnfsshare1 ip 172.24.4.225</literal_block>
            </section>
        </section>
        <section ids="mounting-cephfs-shares" names="mounting\ cephfs\ shares">
            <title>Mounting CephFS shares</title>
            <section ids="mounting-cephfs-native-share-using-fuse-client" names="mounting\ cephfs\ native\ share\ using\ fuse\ client">
                <title>Mounting CephFS native share using FUSE client</title>
                <paragraph>Using the secret key of the authorized ID <literal>alice</literal> create a keyring file,
                    <literal>alice.keyring</literal> like:</paragraph>
                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[client.alice]
        key = AQA8+ANW/4ZWNRAAOtWJMFPEihBA1unFImJczA==</literal_block>
                <paragraph>Using the mon IP addresses from the share’s export location, create a
                    configuration file, <literal>ceph.conf</literal> like:</paragraph>
                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[client]
        client quota = true
        mon host = 192.168.1.7:6789, 192.168.1.8:6789, 192.168.1.9:6789</literal_block>
                <paragraph>Finally, mount the filesystem, substituting the filenames of the keyring and
                    configuration files you just created, and substituting the path to be mounted
                    from the share’s export location:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">sudo ceph-fuse ~/mnt \
--id=alice \
--conf=./ceph.conf \
--keyring=./alice.keyring \
--client-mountpoint=/volumes/_nogroup/4c55ad20-9c55-4a5e-9233-8ac64566b98c</literal_block>
            </section>
            <section ids="mount-cephfs-nfs-share-using-nfs-client" names="mount\ cephfs\ nfs\ share\ using\ nfs\ client">
                <title>Mount CephFS NFS share using NFS client</title>
                <paragraph>In the guest, mount the share using the NFS client and knowing the share’s
                    export location.</paragraph>
                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">sudo mount -t nfs 172.24.4.3:/volumes/_nogroup/6732900b-32c1-4816-a529-4d6d3f15811e /mnt/nfs/</literal_block>
            </section>
        </section>
        <section ids="known-restrictions" names="known\ restrictions">
            <title>Known restrictions</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>To communicate with the Ceph backend, a CephFS driver instance
                        (represented as a backend driver section in manila.conf) requires its own
                        Ceph auth ID that is not used by other CephFS driver instances running in
                        the same controller node.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The snapshot support of the driver is disabled by default. The
                        <literal>cephfs_enable_snapshots</literal> configuration option needs to be set to <literal>True</literal>
                        to allow snapshot operations. Snapshot support will also need to be enabled
                        on the backend CephFS storage.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Snapshots are read-only. A user can read a snapshot’s contents from the
                        <literal>.snap/{manila-snapshot-id}_{unknown-id}</literal> folder within the mounted
                        share.</paragraph>
                </list_item>
            </bullet_list>
            <section ids="restrictions-with-cephfs-native-share-backend" names="restrictions\ with\ cephfs\ native\ share\ backend">
                <title>Restrictions with CephFS native share backend</title>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>To restrict share sizes, CephFS uses quotas that are enforced in the client
                            side. The CephFS FUSE clients are relied on to respect quotas.</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>Mitaka release only</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>The secret-key of a Ceph auth ID required to mount a share is not exposed to
                            an user by a manila API. To workaround this, the storage admin would need to
                            pass the key out of band of manila, or the user would need to use the Ceph ID
                            and key already created and shared with her by the cloud admin.</paragraph>
                    </list_item>
                </bullet_list>
            </section>
        </section>
        <section ids="security" names="security">
            <title>Security</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Each share’s data is mapped to a distinct Ceph RADOS namespace. A guest is
                        restricted to access only that particular RADOS namespace.
                        <reference refuri="http://docs.ceph.com/docs/master/cephfs/file-layouts/">http://docs.ceph.com/docs/master/cephfs/file-layouts/</reference></paragraph>
                </list_item>
                <list_item>
                    <paragraph>An additional level of resource isolation can be provided by mapping a
                        share’s contents to a separate RADOS pool. This layout would be be preferred
                        only for cloud deployments with a limited number of shares needing strong
                        resource separation. You can do this by setting a share type specification,
                        <literal>cephfs:data_isolated</literal> for the share type used by the cephfs driver.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">manila type-key cephfstype set cephfs:data_isolated=True</literal_block>
                </list_item>
            </bullet_list>
            <target refid="security-cephfs-native"></target>
            <section ids="security-with-cephfs-native-share-backend security-cephfs-native" names="security\ with\ cephfs\ native\ share\ backend security_cephfs_native">
                <title>Security with CephFS native share backend</title>
                <paragraph>As the guests need direct access to Ceph’s public network, CephFS native
                    share backend is suitable only in private clouds where guests can be trusted.</paragraph>
            </section>
        </section>
        <section ids="the-manila-share-drivers-cephfs-driver-module" names="the\ manila.share.drivers.cephfs.driver\ module">
            <title>The <literal classes="xref py py-mod">manila.share.drivers.cephfs.driver</literal> Module</title>
            <index entries=""></index>
            <desc desctype="class" domain="py" noindex="True" objtype="class">
                <desc_signature class="" first="False" fullname="CephFSDriver" module="manila.share.drivers.cephfs.driver"><desc_annotation xml:space="preserve">class </desc_annotation><desc_name xml:space="preserve">CephFSDriver</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">*args</desc_parameter><desc_parameter xml:space="preserve">**kwargs</desc_parameter></desc_parameterlist></desc_signature>
                <desc_content>
                    <paragraph>Bases: <literal classes="xref py py-class">manila.share.driver.ExecuteMixin</literal>, <literal classes="xref py py-class">manila.share.driver.GaneshaMixin</literal>, <reference internal="True" reftitle="manila.share.driver.ShareDriver" refuri="share_replication#manila.share.driver.ShareDriver"><literal classes="xref py py-class">manila.share.driver.ShareDriver</literal></reference></paragraph>
                    <paragraph>Driver for the Ceph Filesystem.</paragraph>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="CephFSDriver" first="False" fullname="CephFSDriver.create_share" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">create_share</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">context</desc_parameter><desc_parameter xml:space="preserve">share</desc_parameter><desc_parameter xml:space="preserve">share_server=None</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                            <paragraph>Create a CephFS volume.</paragraph>
                            <field_list>
                                <field>
                                    <field_name>Parameters</field_name>
                                    <field_body>
                                        <bullet_list>
                                            <list_item>
                                                <paragraph><literal_strong refspecific="True">context</literal_strong> – A RequestContext.</paragraph>
                                            </list_item>
                                            <list_item>
                                                <paragraph><literal_strong refspecific="True">share</literal_strong> – A Share.</paragraph>
                                            </list_item>
                                            <list_item>
                                                <paragraph><literal_strong refspecific="True">share_server</literal_strong> – Always None for CephFS native.</paragraph>
                                            </list_item>
                                        </bullet_list>
                                    </field_body>
                                </field>
                                <field>
                                    <field_name>Returns</field_name>
                                    <field_body>
                                        <paragraph>The export locations dictionary.</paragraph>
                                    </field_body>
                                </field>
                            </field_list>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="CephFSDriver" first="False" fullname="CephFSDriver.create_share_group" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">create_share_group</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">context</desc_parameter><desc_parameter xml:space="preserve">sg_dict</desc_parameter><desc_parameter xml:space="preserve">share_server=None</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="CephFSDriver" first="False" fullname="CephFSDriver.create_share_group_snapshot" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">create_share_group_snapshot</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">context</desc_parameter><desc_parameter xml:space="preserve">snap_dict</desc_parameter><desc_parameter xml:space="preserve">share_server=None</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="CephFSDriver" first="False" fullname="CephFSDriver.create_snapshot" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">create_snapshot</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">context</desc_parameter><desc_parameter xml:space="preserve">snapshot</desc_parameter><desc_parameter xml:space="preserve">share_server=None</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="CephFSDriver" first="False" fullname="CephFSDriver.delete_share" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">delete_share</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">context</desc_parameter><desc_parameter xml:space="preserve">share</desc_parameter><desc_parameter xml:space="preserve">share_server=None</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="CephFSDriver" first="False" fullname="CephFSDriver.delete_share_group" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">delete_share_group</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">context</desc_parameter><desc_parameter xml:space="preserve">sg_dict</desc_parameter><desc_parameter xml:space="preserve">share_server=None</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="CephFSDriver" first="False" fullname="CephFSDriver.delete_share_group_snapshot" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">delete_share_group_snapshot</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">context</desc_parameter><desc_parameter xml:space="preserve">snap_dict</desc_parameter><desc_parameter xml:space="preserve">share_server=None</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="CephFSDriver" first="False" fullname="CephFSDriver.delete_snapshot" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">delete_snapshot</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">context</desc_parameter><desc_parameter xml:space="preserve">snapshot</desc_parameter><desc_parameter xml:space="preserve">share_server=None</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="CephFSDriver" first="False" fullname="CephFSDriver.do_setup" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">do_setup</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">context</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="CephFSDriver" first="False" fullname="CephFSDriver.ensure_share" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">ensure_share</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">context</desc_parameter><desc_parameter xml:space="preserve">share</desc_parameter><desc_parameter xml:space="preserve">share_server=None</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="CephFSDriver" first="False" fullname="CephFSDriver.extend_share" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">extend_share</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">share</desc_parameter><desc_parameter xml:space="preserve">new_size</desc_parameter><desc_parameter xml:space="preserve">share_server=None</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="CephFSDriver" first="False" fullname="CephFSDriver.shrink_share" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">shrink_share</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">share</desc_parameter><desc_parameter xml:space="preserve">new_size</desc_parameter><desc_parameter xml:space="preserve">share_server=None</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="CephFSDriver" first="False" fullname="CephFSDriver.update_access" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">update_access</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">context</desc_parameter><desc_parameter xml:space="preserve">share</desc_parameter><desc_parameter xml:space="preserve">access_rules</desc_parameter><desc_parameter xml:space="preserve">add_rules</desc_parameter><desc_parameter xml:space="preserve">delete_rules</desc_parameter><desc_parameter xml:space="preserve">share_server=None</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="attribute" domain="py" noindex="True" objtype="attribute">
                        <desc_signature class="CephFSDriver" first="False" fullname="CephFSDriver.volume_client" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">volume_client</desc_name></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                </desc_content>
            </desc>
            <index entries=""></index>
            <desc desctype="class" domain="py" noindex="True" objtype="class">
                <desc_signature class="" first="False" fullname="NFSProtocolHelper" module="manila.share.drivers.cephfs.driver"><desc_annotation xml:space="preserve">class </desc_annotation><desc_name xml:space="preserve">NFSProtocolHelper</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">execute</desc_parameter><desc_parameter xml:space="preserve">config_object</desc_parameter><desc_parameter xml:space="preserve">**kwargs</desc_parameter></desc_parameterlist></desc_signature>
                <desc_content>
                    <paragraph>Bases: <literal classes="xref py py-class">manila.share.drivers.ganesha.GaneshaNASHelper2</literal></paragraph>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="NFSProtocolHelper" first="False" fullname="NFSProtocolHelper.get_export_locations" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">get_export_locations</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">share</desc_parameter><desc_parameter xml:space="preserve">cephfs_volume</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="attribute" domain="py" noindex="True" objtype="attribute">
                        <desc_signature class="NFSProtocolHelper" first="False" fullname="NFSProtocolHelper.shared_data" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">shared_data</desc_name><desc_annotation xml:space="preserve"> = {}</desc_annotation></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="attribute" domain="py" noindex="True" objtype="attribute">
                        <desc_signature class="NFSProtocolHelper" first="False" fullname="NFSProtocolHelper.supported_protocols" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">supported_protocols</desc_name><desc_annotation xml:space="preserve"> = ('NFS',)</desc_annotation></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                </desc_content>
            </desc>
            <index entries=""></index>
            <desc desctype="class" domain="py" noindex="True" objtype="class">
                <desc_signature class="" first="False" fullname="NativeProtocolHelper" module="manila.share.drivers.cephfs.driver"><desc_annotation xml:space="preserve">class </desc_annotation><desc_name xml:space="preserve">NativeProtocolHelper</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">execute</desc_parameter><desc_parameter xml:space="preserve">config</desc_parameter><desc_parameter xml:space="preserve">**kwargs</desc_parameter></desc_parameterlist></desc_signature>
                <desc_content>
                    <paragraph>Bases: <literal classes="xref py py-class">manila.share.drivers.ganesha.NASHelperBase</literal></paragraph>
                    <paragraph>Helper class for native CephFS protocol</paragraph>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="NativeProtocolHelper" first="False" fullname="NativeProtocolHelper.get_export_locations" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">get_export_locations</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">share</desc_parameter><desc_parameter xml:space="preserve">cephfs_volume</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="attribute" domain="py" noindex="True" objtype="attribute">
                        <desc_signature class="NativeProtocolHelper" first="False" fullname="NativeProtocolHelper.supported_access_levels" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">supported_access_levels</desc_name><desc_annotation xml:space="preserve"> = ('rw', 'ro')</desc_annotation></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="attribute" domain="py" noindex="True" objtype="attribute">
                        <desc_signature class="NativeProtocolHelper" first="False" fullname="NativeProtocolHelper.supported_access_types" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">supported_access_types</desc_name><desc_annotation xml:space="preserve"> = ('cephx',)</desc_annotation></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="NativeProtocolHelper" first="False" fullname="NativeProtocolHelper.update_access" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">update_access</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">context</desc_parameter><desc_parameter xml:space="preserve">share</desc_parameter><desc_parameter xml:space="preserve">access_rules</desc_parameter><desc_parameter xml:space="preserve">add_rules</desc_parameter><desc_parameter xml:space="preserve">delete_rules</desc_parameter><desc_parameter xml:space="preserve">share_server=None</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                </desc_content>
            </desc>
            <index entries=""></index>
            <desc desctype="function" domain="py" noindex="True" objtype="function">
                <desc_signature class="" first="False" fullname="cephfs_share_path" module="manila.share.drivers.cephfs.driver"><desc_name xml:space="preserve">cephfs_share_path</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">share</desc_parameter></desc_parameterlist></desc_signature>
                <desc_content>
                    <paragraph>Get VolumePath from Share.</paragraph>
                </desc_content>
            </desc>
        </section>
    </section>
</document>
