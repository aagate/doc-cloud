<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/manila/doc/source/contributor/tempest_tests.rst">
    <section ids="tempest-tests" names="tempest\ tests">
        <title>Tempest Tests</title>
        <paragraph>Manila stores tempest tests as plugin under <literal>manila_tempest_tests</literal> directory.
            It contains functional and scenario tests.</paragraph>
        <section ids="installation-of-plugin-to-tempest" names="installation\ of\ plugin\ to\ tempest">
            <title>Installation of plugin to tempest</title>
            <paragraph>Tempest plugin installation is common for all its plugins and detailed
                information can be found in its <reference name="docs" refuri="https://docs.openstack.org/tempest/latest/plugin.html#using-plugins">docs</reference>.
                In simple words: if you have installed manila project on the same machine as
                tempest, then tempest will find it.</paragraph>
            <target ids="docs" names="docs" refuri="https://docs.openstack.org/tempest/latest/plugin.html#using-plugins"></target>
        </section>
        <section ids="configuration-of-manila-related-tests-in-tempest-conf" names="configuration\ of\ manila-related\ tests\ in\ tempest.conf">
            <title>Configuration of manila-related tests in tempest.conf</title>
            <paragraph>All config options for manila are defined in <literal>manila_tempest_tests/config.py</literal>
                module. They can be set/redefined in <literal>tempest.conf</literal> file.</paragraph>
            <paragraph>Here is a configuration example:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[service_available]
manila = True

[share]
# Capabilities
capability_storage_protocol = NFS
capability_snapshot_support = True
capability_create_share_from_snapshot_support = True
backend_names = Backendname1,BackendName2
backend_replication_type = readable

# Enable/Disable test groups
multi_backend = True
multitenancy_enabled = True
enable_protocols = nfs,cifs,glusterfs,cephfs
enable_ip_rules_for_protocols = nfs
enable_user_rules_for_protocols = cifs
enable_cert_rules_for_protocols = glusterfs
enable_cephx_rules_for_protocols = cephfs
username_for_user_rules = foouser
enable_ro_access_level_for_protocols = nfs
run_quota_tests = True
run_extend_tests = True
run_shrink_tests = True
run_snapshot_tests = True
run_consistency_group_tests = True
run_replication_tests = True
run_migration_tests = True
run_manage_unmanage_tests = True
run_manage_unmanage_snapshot_tests = True</literal_block>
            <note>
                <paragraph>None of existing share drivers support all features. So, make sure
                    that share backends really support features you enable in config.</paragraph>
            </note>
        </section>
        <section ids="running-tests" names="running\ tests">
            <title>Running tests</title>
            <paragraph>To run tests, it is required to install <reference name="pip" refuri="https://pypi.python.org/pypi/pip">pip</reference>, <reference name="tox" refuri="https://pypi.python.org/pypi/tox">tox</reference> and <reference name="virtualenv" refuri="https://pypi.python.org/pypi/virtualenv">virtualenv</reference>
                packages on host machine. Then run following command
                from tempest root directory:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ tox -e all-plugin -- manila_tempest_tests.tests.api</literal_block>
            <paragraph>or to run only scenario tests:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ tox -e all-plugin -- manila_tempest_tests.tests.scenario</literal_block>
            <target ids="pip" names="pip" refuri="https://pypi.python.org/pypi/pip"></target>
            <target ids="tox" names="tox" refuri="https://pypi.python.org/pypi/tox"></target>
            <target ids="virtualenv" names="virtualenv" refuri="https://pypi.python.org/pypi/virtualenv"></target>
        </section>
        <section ids="running-a-subset-of-tests-based-on-test-location" names="running\ a\ subset\ of\ tests\ based\ on\ test\ location">
            <title>Running a subset of tests based on test location</title>
            <paragraph>Instead of running all tests, you can specify an individual directory, file,
                class, or method that contains test code.</paragraph>
            <paragraph>To run the tests in the <literal>manila_tempest_tests/tests/api/admin</literal> directory:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ tox -e all-plugin -- manila_tempest_tests.tests.api.admin</literal_block>
            <paragraph>To run the tests in the
                <literal>manila_tempest_tests/tests/api/admin/test_admin_actions.py</literal> module:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ tox -e all-plugin -- manila_tempest_tests.tests.api.admin.test_admin_actions</literal_block>
            <paragraph>To run the tests in the <title_reference>AdminActionsTest</title_reference> class in
                <literal>manila_tempest_tests/tests/api/admin/test_admin_actions.py</literal> module:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ tox -e all-plugin -- manila_tempest_tests.tests.api.admin.test_admin_actions.AdminActionsTest</literal_block>
            <paragraph>To run the <title_reference>AdminActionsTest.test_reset_share_state</title_reference> test method in
                <literal>manila_tempest_tests/tests/api/admin/test_admin_actions.py</literal> module:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ tox -e all-plugin -- manila_tempest_tests.tests.api.admin.test_admin_actions.AdminActionsTest.test_reset_share_state</literal_block>
        </section>
        <section ids="running-a-subset-of-tests-based-on-service-involvement" names="running\ a\ subset\ of\ tests\ based\ on\ service\ involvement">
            <title>Running a subset of tests based on service involvement</title>
            <paragraph>To run the tests that require only <title_reference>manila-api</title_reference> service running:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ tox -e all-plugin -- \
  \(\?\=\.\*\\\[\.\*\\bapi\\b\.\*\\\]\) \
  \(\^manila_tempest_tests.tests.api\)</literal_block>
            <paragraph>To run the tests that require all manila services running,
                but intended to test API behaviour:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ tox -e all-plugin -- \
  \(\?\=\.\*\\\[\.\*\\b\(api\|api_with_backend\)\\b\.\*\\\]\) \
  \(\^manila_tempest_tests.tests.api\)</literal_block>
            <paragraph>To run the tests that require all manila services running,
                but intended to test back-end (manila-share) behaviour:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ tox -e all-plugin -- \
  \(\?\=\.\*\\\[\.\*\\bbackend\\b\.\*\\\]\) \
  \(\^manila_tempest_tests.tests.api\)</literal_block>
        </section>
        <section ids="running-a-subset-of-positive-or-negative-tests" names="running\ a\ subset\ of\ positive\ or\ negative\ tests">
            <title>Running a subset of positive or negative tests</title>
            <paragraph>To run only positive tests, use following command:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ tox -e all-plugin -- \
  \(\?\=\.\*\\\[\.\*\\bpositive\\b\.\*\\\]\) \
  \(\^manila_tempest_tests.tests.api\)</literal_block>
            <paragraph>To run only negative tests, use following command:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ tox -e all-plugin -- \
  \(\?\=\.\*\\\[\.\*\\bnegative\\b\.\*\\\]\) \
  \(\^manila_tempest_tests.tests.api\)</literal_block>
            <paragraph>To run only positive API tests, use following command:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ tox -e all-plugin -- \
  \(\?\=\.\*\\\[\.\*\\bpositive\\b\.\*\\\]\) \
  \(\?\=\.\*\\\[\.\*\\bapi\\b\.\*\\\]\) \
  \(\^manila_tempest_tests.tests.api\)</literal_block>
        </section>
    </section>
</document>
