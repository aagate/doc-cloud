<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/manila/doc/source/contributor/glusterfs_native_driver.rst">
    <comment xml:space="preserve">Copyright 2015 Red Hat, Inc.
All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License"); you may
not use this file except in compliance with the License. You may obtain
a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
License for the specific language governing permissions and limitations
under the License.</comment>
    <section ids="glusterfs-native-driver" names="glusterfs\ native\ driver">
        <title>GlusterFS Native driver</title>
        <paragraph>GlusterFS Native driver uses GlusterFS, an open source distributed file system,
            as the storage backend for serving file shares to manila clients.</paragraph>
        <paragraph>A manila share is a GlusterFS volume. This driver uses flat-network
            (share-server-less) model. Instances directly talk with the GlusterFS backend
            storage pool. The instances use ‘glusterfs’ protocol to mount the GlusterFS
            shares. Access to each share is allowed via TLS Certificates. Only the instance
            which has the TLS trust established with the GlusterFS backend can mount and
            hence use the share. Currently only ‘rw’ access is supported.</paragraph>
        <section ids="network-approach" names="network\ approach">
            <title>Network Approach</title>
            <paragraph>L3 connectivity between the storage backend and the host running the manila
                share service should exist.</paragraph>
        </section>
        <section ids="supported-shared-filesystems" names="supported\ shared\ filesystems">
            <title>Supported shared filesystems</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>GlusterFS (share protocol: <literal>glusterfs</literal>,
                        access by TLS certificates (<literal>cert</literal> access type))</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="multi-tenancy-model" names="multi-tenancy\ model">
            <title>Multi-tenancy model</title>
            <paragraph>The driver does not support network segmented multi-tenancy model. Instead
                multi-tenancy is supported using tenant specific TLS certificates.</paragraph>
        </section>
        <section ids="supported-operations" names="supported\ operations">
            <title>Supported Operations</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Create share</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Delete share</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Allow share access (rw)</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Deny share access</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create snapshot</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Delete snapshot</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create share from snapshot</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="requirements" names="requirements">
            <title>Requirements</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Install glusterfs-server package, version &gt;= 3.6.x, on the storage backend.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Install glusterfs and glusterfs-fuse package, version &gt;=3.6.x, on the manila
                        host.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Establish network connection between the manila host and the storage backend.</paragraph>
                </list_item>
            </bullet_list>
            <target refid="gluster-native-manila-conf"></target>
        </section>
        <section ids="manila-driver-configuration-setting gluster-native-manila-conf" names="manila\ driver\ configuration\ setting gluster_native_manila_conf">
            <title>Manila driver configuration setting</title>
            <paragraph>The following parameters in manila’s configuration file need to be set:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <definition_list>
                        <definition_list_item>
                            <term><title_reference>share_driver</title_reference> =</term>
                            <definition>
                                <paragraph>manila.share.drivers.glusterfs.glusterfs_native.GlusterfsNativeShareDriver</paragraph>
                            </definition>
                        </definition_list_item>
                    </definition_list>
                </list_item>
                <list_item>
                    <definition_list>
                        <definition_list_item>
                            <term><title_reference>glusterfs_servers</title_reference> = List of GlusterFS servers which provide volumes</term>
                            <definition>
                                <paragraph>that can be used to create shares. The servers are expected to be of
                                    distinct Gluster clusters (ie. should not be gluster peers). Each server
                                    should be of the form <literal>[&lt;remoteuser&gt;@]&lt;glustervolserver&gt;</literal>.</paragraph>
                                <paragraph>The optional <literal>&lt;remoteuser&gt;@</literal> part of the server URI indicates SSH
                                    access for cluster management (see related optional parameters below).
                                    If it is not given, direct command line management is performed (ie.
                                    manila host is assumed to be part of the GlusterFS cluster the server
                                    belongs to).</paragraph>
                            </definition>
                        </definition_list_item>
                    </definition_list>
                </list_item>
                <list_item>
                    <definition_list>
                        <definition_list_item>
                            <term><title_reference>glusterfs_volume_pattern</title_reference> = Regular expression template</term>
                            <definition>
                                <paragraph>used to filter GlusterFS volumes for share creation. The regex template can
                                    contain the #{size} parameter which matches a number (sequence of digits)
                                    and the value shall be interpreted as size of the volume in GB. Examples:
                                    <literal>manila-share-volume-\d+$</literal>, <literal>manila-share-volume-#{size}G-\d+$</literal>; with
                                    matching volume names, respectively: <emphasis>manila-share-volume-12</emphasis>,
                                    <emphasis>manila-share-volume-3G-13</emphasis>”. In latter example, the number that matches
                                    <literal>#{size}</literal>, that is, 3, is an indication that the size of volume is 3G.</paragraph>
                            </definition>
                        </definition_list_item>
                    </definition_list>
                </list_item>
            </bullet_list>
            <paragraph>The following configuration parameters are optional:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <definition_list>
                        <definition_list_item>
                            <term><title_reference>glusterfs_mount_point_base</title_reference> =  &lt;base path of GlusterFS volume mounted on</term>
                            <definition>
                                <paragraph>manila host&gt;</paragraph>
                            </definition>
                        </definition_list_item>
                    </definition_list>
                </list_item>
                <list_item>
                    <paragraph><title_reference>glusterfs_path_to_private_key</title_reference> = &lt;path to manila host’s private key file&gt;</paragraph>
                </list_item>
                <list_item>
                    <paragraph><title_reference>glusterfs_server_password</title_reference> = &lt;password of remote GlusterFS server machine&gt;</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="host-and-backend-configuration" names="host\ and\ backend\ configuration">
            <title>Host and backend configuration</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>SSL/TLS should be enabled on the I/O path for GlusterFS servers and
                        volumes involved (ie. ones specified in <literal>glusterfs_servers</literal>),
                        as described in <reference refuri="http://www.gluster.org/community/documentation/index.php/SSL">http://www.gluster.org/community/documentation/index.php/SSL</reference>.
                        (Enabling SSL/TLS for the management path is also possible but not
                        recommended currently.)</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The manila host should be also configured for GlusterFS SSL/TLS (ie.
                        <title_reference>/etc/ssl/glusterfs.{pem,key,ca}</title_reference> files has to be deployed as the above
                        document specifies).</paragraph>
                </list_item>
                <list_item>
                    <paragraph>There is a further requirement for the CA-s used: the set of CA-s involved
                        should be consensual, ie. <title_reference>/etc/ssl/glusterfs.ca</title_reference> should be identical
                        across all the servers and the manila host.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>There is a further requirement for the common names (CN-s) of the
                        certificates used: the certificates of the servers should have a common
                        name starting with <title_reference>glusterfs-server</title_reference>, and the certificate of the host
                        should have common name starting with <title_reference>manila-host</title_reference>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>To support snapshots, bricks that consist the GlusterFS volumes used
                        by manila should be thinly provisioned LVM ones (cf.
                        <reference refuri="https://gluster.readthedocs.org/en/latest/Administrator%20Guide/Managing%20Snapshots/">https://gluster.readthedocs.org/en/latest/Administrator%20Guide/Managing%20Snapshots/</reference>).</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="known-restrictions" names="known\ restrictions">
            <title>Known Restrictions</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>GlusterFS volumes are not created on demand. A pre-existing set of
                        GlusterFS volumes should be supplied by the GlusterFS cluster(s), conforming
                        to the naming convention encoded by <literal>glusterfs_volume_pattern</literal>. However,
                        the GlusterFS endpoint is allowed to extend this set any time (so manila
                        and GlusterFS endpoints are expected to communicate volume supply/demand
                        out-of-band). <literal>glusterfs_volume_pattern</literal> can include a size hint (with
                        <literal>#{size}</literal> syntax), which, if present, requires the GlusterFS end to
                        indicate the size of the shares in GB in the name. (On share creation,
                        manila picks volumes <emphasis>at least</emphasis> as big as the requested one.)</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Certificate setup (aka trust setup) between instance and storage backend is
                        out of band of manila.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>For manila to use GlusterFS volumes, the name of the trashcan directory in
                        GlusterFS volumes must not be changed from the default.</paragraph>
                </list_item>
            </bullet_list>
            <section ids="the-manila-share-drivers-glusterfs-glusterfs-native-glusterfsnativesharedriver-module" names="the\ manila.share.drivers.glusterfs.glusterfs_native.glusterfsnativesharedriver\ module">
                <title>The <literal classes="xref py py-mod">manila.share.drivers.glusterfs.glusterfs_native.GlusterfsNativeShareDriver</literal> Module</title>
                <paragraph>GlusterFS native protocol (glusterfs) driver for shares.</paragraph>
                <paragraph>Manila share is a GlusterFS volume. Unlike the generic driver, this
                    does not use service VM approach. Instances directly talk with the
                    GlusterFS backend storage pool. Instance use the ‘glusterfs’ protocol
                    to mount the GlusterFS share. Access to the share is allowed via
                    SSL Certificates. Only the instance which has the SSL trust established
                    with the GlusterFS backend can mount and hence use the share.</paragraph>
                <paragraph>Supports working with multiple glusterfs volumes.</paragraph>
                <index entries=""></index>
                <desc desctype="class" domain="py" noindex="True" objtype="class">
                    <desc_signature class="" first="False" fullname="GlusterfsNativeShareDriver" module="manila.share.drivers.glusterfs.glusterfs_native"><desc_annotation xml:space="preserve">class </desc_annotation><desc_name xml:space="preserve">GlusterfsNativeShareDriver</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">*args</desc_parameter><desc_parameter xml:space="preserve">**kwargs</desc_parameter></desc_parameterlist></desc_signature>
                    <desc_content>
                        <paragraph>Bases: <literal classes="xref py py-class">manila.share.driver.ExecuteMixin</literal>, <literal classes="xref py py-class">manila.share.drivers.glusterfs.layout.GlusterfsShareDriverBase</literal></paragraph>
                        <paragraph>GlusterFS native protocol (glusterfs) share driver.</paragraph>
                        <paragraph>Executes commands relating to Shares.
                            Supports working with multiple glusterfs volumes.</paragraph>
                        <paragraph>API version history:</paragraph>
                        <block_quote>
                            <paragraph>1.0 - Initial version.
                                1.1 - Support for working with multiple gluster volumes.</paragraph>
                        </block_quote>
                        <index entries=""></index>
                        <desc desctype="attribute" domain="py" noindex="True" objtype="attribute">
                            <desc_signature class="GlusterfsNativeShareDriver" first="False" fullname="GlusterfsNativeShareDriver.GLUSTERFS_VERSION_MIN" module="manila.share.drivers.glusterfs.glusterfs_native"><desc_name xml:space="preserve">GLUSTERFS_VERSION_MIN</desc_name><desc_annotation xml:space="preserve"> = (3, 6)</desc_annotation></desc_signature>
                            <desc_content>
                            </desc_content>
                        </desc>
                        <index entries=""></index>
                        <desc desctype="method" domain="py" noindex="True" objtype="method">
                            <desc_signature class="GlusterfsNativeShareDriver" first="False" fullname="GlusterfsNativeShareDriver.get_network_allocations_number" module="manila.share.drivers.glusterfs.glusterfs_native"><desc_name xml:space="preserve">get_network_allocations_number</desc_name><desc_parameterlist xml:space="preserve"></desc_parameterlist></desc_signature>
                            <desc_content>
                            </desc_content>
                        </desc>
                        <index entries=""></index>
                        <desc desctype="attribute" domain="py" noindex="True" objtype="attribute">
                            <desc_signature class="GlusterfsNativeShareDriver" first="False" fullname="GlusterfsNativeShareDriver.supported_layouts" module="manila.share.drivers.glusterfs.glusterfs_native"><desc_name xml:space="preserve">supported_layouts</desc_name><desc_annotation xml:space="preserve"> = ('layout_volume.GlusterfsVolumeMappedLayout',)</desc_annotation></desc_signature>
                            <desc_content>
                            </desc_content>
                        </desc>
                        <index entries=""></index>
                        <desc desctype="attribute" domain="py" noindex="True" objtype="attribute">
                            <desc_signature class="GlusterfsNativeShareDriver" first="False" fullname="GlusterfsNativeShareDriver.supported_protocols" module="manila.share.drivers.glusterfs.glusterfs_native"><desc_name xml:space="preserve">supported_protocols</desc_name><desc_annotation xml:space="preserve"> = ('GLUSTERFS',)</desc_annotation></desc_signature>
                            <desc_content>
                            </desc_content>
                        </desc>
                    </desc_content>
                </desc>
            </section>
        </section>
    </section>
</document>
