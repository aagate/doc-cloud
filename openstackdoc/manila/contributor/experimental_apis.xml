<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/manila/doc/source/contributor/experimental_apis.rst">
    <section ids="experimental-apis" names="experimental\ apis">
        <title>Experimental APIs</title>
        <section ids="background" names="background">
            <title>Background</title>
            <paragraph>Manila uses API microversions to allow natural evolution of its REST APIs
                over time.  But microversions alone cannot solve the question of how to
                ship APIs that are experimental in nature, are expected to change at any
                time, and could even be removed entirely without a typical deprecation
                period.</paragraph>
            <paragraph>In conjunction with microversions, manila has added a facility for marking
                individual REST APIs as experimental.  To call an experimental API, clients
                must include a specific HTTP header, <literal>X-OpenStack-Manila-API-Experimental</literal>,
                with a value of <literal>True</literal>.  If a user calls an experimental API without
                including the experimental header, the server would respond with <literal>HTTP/404</literal>.
                This forces the client to acknowledge the experimental status of the API and
                prevents anyone from building an application around a manila feature without
                realizing the feature could change significantly or even disappear.</paragraph>
            <paragraph>On the other hand, if a request is made to a non-experimental manila API with
                <literal>X-OpenStack-Manila-API-Experimental: True</literal>, the server would respond as if
                the header had not been included.  This is a convenience mechanism, as it
                allows the client to specify both the requested API version as well as the
                experimental header (if desired) in one place instead of having to set the
                headers separately for each API call (although that would be fine, too).</paragraph>
        </section>
        <section ids="when-do-i-need-to-set-an-api-experimental" names="when\ do\ i\ need\ to\ set\ an\ api\ experimental?">
            <title>When do I need to set an API experimental?</title>
            <paragraph>An API should be marked as experimental if any of the following is true:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>the API is not yet considered a stable, core API</paragraph>
                </list_item>
                <list_item>
                    <paragraph>the API is expected to change in later releases</paragraph>
                </list_item>
                <list_item>
                    <paragraph>the API could be removed altogether if a feature is redesigned</paragraph>
                </list_item>
                <list_item>
                    <paragraph>the API controls a feature that could change or be removed</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="when-do-i-need-to-remove-the-experimental-annotation-from-an-api" names="when\ do\ i\ need\ to\ remove\ the\ experimental\ annotation\ from\ an\ api?">
            <title>When do I need to remove the experimental annotation from an API?</title>
            <paragraph>When the community is satisfied that an experimental feature and its APIs
                have had sufficient time to gather and incorporate user feedback to consider
                it stable, which could be one or more OpenStack release cycles, any relevant
                APIs must be re-released with a microversion bump and without the experimental
                flag. The maturation period can vary between features, but experimental is NOT
                a stable state, and an experimental feature should not be left in that state
                any longer than necessary.</paragraph>
            <paragraph>Because experimental APIs have no conventional deprecation period, the manila
                core team may optionally choose to remove any experimental versions of an API
                at the same time that a microversioned stable version is added.</paragraph>
        </section>
        <section ids="in-code" names="in\ code">
            <title>In Code</title>
            <paragraph>The <literal>@api_version</literal> decorator defined in <literal>manila/api/openstack/wsgi.py</literal>,
                which is used for specifying API versions on top-level Controller methods,
                also allows for tagging an API as experimental. For example:</paragraph>
            <paragraph>In the controller class:</paragraph>
            <literal_block xml:space="preserve">@wsgi.Controller.api_version("2.4", experimental=True)
def my_api_method(self, req, id):
    ....</literal_block>
            <paragraph>This method would only be available if the caller had specified an
                <literal>X-OpenStack-Manila-API-Version</literal> of &gt;= <literal>2.4</literal>. and had also included
                <literal>X-OpenStack-Manila-API-Experimental: True</literal>. If they had specified a
                lower version (or not specified it and received a lower default version),
                or if they had failed to include the experimental header, the server would
                respond with <literal>HTTP/404</literal>.</paragraph>
        </section>
    </section>
</document>
