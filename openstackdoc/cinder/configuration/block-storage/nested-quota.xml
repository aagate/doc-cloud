<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/cinder/doc/source/configuration/block-storage/nested-quota.rst">
    <section ids="nested-quotas" names="nested\ quotas">
        <title>Nested quotas</title>
        <paragraph>Nested quota is a change in how OpenStack services (such as Block Storage and
            Compute) handle their quota resources by being hierarchy-aware. The main
            reason for this change is to fully appreciate the hierarchical multi-tenancy
            concept, which was introduced in keystone in the Kilo release.</paragraph>
        <paragraph>Once you have a project hierarchy created in keystone, nested quotas let you
            define how much of a project’s quota you want to give to its subprojects. In
            that way, hierarchical projects can have hierarchical quotas (also known as
            nested quotas).</paragraph>
        <paragraph>Projects and subprojects have similar behaviors, but they differ from each
            other when it comes to default quota values. The default quota value for
            resources in a subproject is 0, so that when a subproject is created it will
            not consume all of its parent’s quota.</paragraph>
        <paragraph>In order to keep track of how much of each quota was allocated to a
            subproject, a column <literal>allocated</literal> was added to the quotas table. This column
            is updated after every delete and update quota operation.</paragraph>
        <paragraph>This example shows you how to use nested quotas.</paragraph>
        <note>
            <paragraph>Assume that you have created a project hierarchy in keystone, such as
                follows:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">+-----------+
|           |
|     A     |
|    / \    |
|   B   C   |
|  /        |
| D         |
+-----------+</literal_block>
        </note>
        <section ids="getting-default-quotas" names="getting\ default\ quotas">
            <title>Getting default quotas</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Get the quota for root projects.</paragraph>
                    <paragraph>Use the <literal_strong classes="command">openstack quota show</literal_strong> command and specify:</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>The <literal>PROJECT</literal> of the relevant project. In this case, the name of
                                project A.</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack quota show PROJECT
+----------------------+-------+
| Field                | Value |
+----------------------+-------+
| ...                  | ...   |
| backup_gigabytes     | 1000  |
| backups              | 10    |
| gigabytes            | 1000  |
| per_volume_gigabytes | -1    |
| snapshots            | 10    |
| volumes              | 10    |
+----------------------+-------+</literal_block>
                            <note>
                                <paragraph>This command returns the default values for resources.
                                    This is because the quotas for this project were not explicitly set.</paragraph>
                            </note>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Get the quota for subprojects.</paragraph>
                    <paragraph>In this case, use the same <literal_strong classes="command">openstack quota show</literal_strong> command and
                        specify:</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>The <literal>PROJECT</literal> of the relevant project. In this case the name of
                                project B, which is a child of A.</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack quota show PROJECT
+----------------------+-------+
| Field                | Value |
+----------------------+-------+
| ...                  | ...   |
| backup_gigabytes     | 0     |
| backups              | 0     |
| gigabytes            | 0     |
| per_volume_gigabytes | 0     |
| snapshots            | 0     |
| volumes              | 0     |
+----------------------+-------+</literal_block>
                            <note>
                                <paragraph>In this case, 0 was the value returned as the quota for all the
                                    resources. This is because project B is a subproject of A, thus,
                                    the default quota value is 0, so that it will not consume all the
                                    quota of its parent project.</paragraph>
                            </note>
                        </list_item>
                    </bullet_list>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="setting-the-quotas-for-subprojects" names="setting\ the\ quotas\ for\ subprojects">
            <title>Setting the quotas for subprojects</title>
            <paragraph>Now that the projects were created, assume that the admin of project B wants
                to use it. First of all, you need to set the quota limit of the project,
                because as a subproject it does not have quotas allocated by default.</paragraph>
            <paragraph>In this example, when all of the parent project is allocated to its
                subprojects the user will not be able to create more resources in the parent
                project.</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Update the quota of B.</paragraph>
                    <paragraph>Use the <literal_strong classes="command">openstack quota set</literal_strong> command and specify:</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>The <literal>PROJECT</literal> of the relevant project.
                                In this case the name of project B.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>The <literal>--volumes</literal> option, followed by the number to which you wish to
                                increase the volumes quota.</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack quota set --volumes 10 PROJECT
+----------------------+-------+
|        Property      | Value |
+----------------------+-------+
| ...                  | ...   |
| backup_gigabytes     | 0     |
| backups              | 0     |
| gigabytes            | 0     |
| per_volume_gigabytes | 0     |
| snapshots            | 0     |
| volumes              | 10    |
+----------------------+-------+</literal_block>
                            <note>
                                <paragraph>The volumes resource quota is updated.</paragraph>
                            </note>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Try to create a volume in project A.</paragraph>
                    <paragraph>Use the <literal_strong classes="command">openstack volume create</literal_strong> command and specify:</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>The <literal>SIZE</literal> of the volume that will be created;</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>The <literal>NAME</literal> of the volume.</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack volume create --size SIZE NAME
VolumeLimitExceeded: Maximum number of volumes allowed (10) exceeded for quota 'volumes'. (HTTP 413) (Request-ID: req-f6f7cc89-998e-4a82-803d-c73c8ee2016c)</literal_block>
                            <note>
                                <paragraph>As the entirety of project A’s volumes quota has been assigned to
                                    project B, it is treated as if all of the quota has been used. This
                                    is true even when project B has not created any volumes.</paragraph>
                            </note>
                        </list_item>
                    </bullet_list>
                </list_item>
            </enumerated_list>
            <paragraph>See <reference name="cinder nested quota spec" refuri="https://specs.openstack.org/openstack/cinder-specs/specs/liberty/cinder-nested-quota-driver.html">cinder nested quota spec</reference><target ids="cinder-nested-quota-spec" names="cinder\ nested\ quota\ spec" refuri="https://specs.openstack.org/openstack/cinder-specs/specs/liberty/cinder-nested-quota-driver.html"></target>
                and <reference name="hierarchical multi-tenancy spec" refuri="https://blueprints.launchpad.net/keystone/+spec/hierarchical-multitenancy">hierarchical multi-tenancy spec</reference><target ids="hierarchical-multi-tenancy-spec" names="hierarchical\ multi-tenancy\ spec" refuri="https://blueprints.launchpad.net/keystone/+spec/hierarchical-multitenancy"></target>
                for details.</paragraph>
        </section>
    </section>
</document>
