<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/cinder/doc/source/configuration/block-storage/drivers/zfssa-nfs-driver.rst">
    <section ids="oracle-zfs-storage-appliance-nfs-driver" names="oracle\ zfs\ storage\ appliance\ nfs\ driver">
        <title>Oracle ZFS Storage Appliance NFS driver</title>
        <paragraph>The Oracle ZFS Storage Appliance (ZFSSA) NFS driver enables the ZFSSA to
            be used seamlessly as a block storage resource. The driver enables you
            to to create volumes on a ZFS share that is NFS mounted.</paragraph>
        <section ids="requirements" names="requirements">
            <title>Requirements</title>
            <paragraph>Oracle ZFS Storage Appliance Software version <literal>2013.1.2.0</literal> or later.</paragraph>
        </section>
        <section ids="supported-operations" names="supported\ operations">
            <title>Supported operations</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Create, delete, attach, detach, manage, and unmanage volumes.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create and delete snapshots.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a volume from a snapshot.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Extend a volume.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Copy an image to a volume.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Copy a volume to an image.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Clone a volume.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Volume migration.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Local cache of a bootable volume</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="appliance-configuration" names="appliance\ configuration">
            <title>Appliance configuration</title>
            <paragraph>Appliance configuration using the command-line interface (CLI) is
                described below. To access the CLI, ensure SSH remote access is enabled,
                which is the default. You can also perform configuration using the
                browser user interface (BUI) or the RESTful API. Please refer to the
                <reference name="Oracle ZFS Storage Appliance documentation" refuri="http://www.oracle.com/technetwork/documentation/oracle-unified-ss-193371.html">Oracle ZFS Storage Appliance
                    documentation</reference>
                for details on how to configure the Oracle ZFS Storage Appliance using
                the BUI, CLI, and RESTful API.</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Log in to the Oracle ZFS Storage Appliance CLI and enable the REST
                        service. REST service needs to stay online for this driver to function.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">zfssa:&gt;configuration services rest enable</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Create a new storage pool on the appliance if you do not want to use an
                        existing one. This storage pool is named <literal>'mypool'</literal> for the sake of this
                        documentation.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a new project and share in the storage pool (<literal>mypool</literal>) if you do
                        not want to use existing ones. This driver will create a project and share
                        by the names specified in the <literal>cinder.conf</literal> file, if a project and share
                        by that name does not already exist in the storage pool (<literal>mypool</literal>).
                        The project and share are named <literal>NFSProject</literal> and <literal>nfs_share</literal>â€™ in the
                        sample <literal>cinder.conf</literal> file as entries below.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>To perform driver operations, create a role with the following
                        authorizations:</paragraph>
                    <literal_block highlight_args="{}" language="bash" linenos="False" xml:space="preserve">scope=svc - allow_administer=true, allow_restart=true, allow_configure=true
scope=nas - pool=pool_name, project=project_name, share=share_name, allow_clone=true, allow_createProject=true, allow_createShare=true, allow_changeSpaceProps=true, allow_changeGeneralProps=true, allow_destroy=true, allow_rollback=true, allow_takeSnap=true, allow_changeAccessProps=true, allow_changeProtocolProps=true</literal_block>
                    <paragraph>The following examples show how to create a role with authorizations.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">zfssa:&gt; configuration roles
zfssa:configuration roles&gt; role OpenStackRole
zfssa:configuration roles OpenStackRole (uncommitted)&gt; set description="OpenStack NFS Cinder Driver"
zfssa:configuration roles OpenStackRole (uncommitted)&gt; commit
zfssa:configuration roles&gt; select OpenStackRole
zfssa:configuration roles OpenStackRole&gt; authorizations create
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set scope=svc
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_administer=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_restart=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_configure=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; commit</literal_block>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">zfssa:&gt; configuration roles OpenStackRole authorizations&gt; set scope=nas</literal_block>
                    <paragraph>The following properties need to be set when the scope of this role needs to
                        be limited to a pool (<literal>mypool</literal>), a project (<literal>NFSProject</literal>) and a share
                        (<literal>nfs_share</literal>) created in the steps above. This will prevent the user
                        assigned to this role from being used to modify other pools, projects and
                        shares.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set pool=mypool
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set project=NFSProject
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set share=nfs_share</literal_block>
                </list_item>
                <list_item>
                    <paragraph>The following properties only need to be set when a share and project has
                        not been created following the steps above and wish to allow the driver to
                        create them for you.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_createProject=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_createShare=true</literal_block>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_clone=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_changeSpaceProps=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_destroy=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_rollback=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_takeSnap=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_changeAccessProps=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_changeProtocolProps=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; commit</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Create a new user or modify an existing one and assign the new role to
                        the user.</paragraph>
                    <paragraph>The following example shows how to create a new user and assign the new
                        role to the user.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">zfssa:&gt; configuration users
zfssa:configuration users&gt; user cinder
zfssa:configuration users cinder (uncommitted)&gt; set fullname="OpenStack Cinder Driver"
zfssa:configuration users cinder (uncommitted)&gt; set initial_password=12345
zfssa:configuration users cinder (uncommitted)&gt; commit
zfssa:configuration users&gt; select cinder set roles=OpenStackRole</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Ensure that NFS and HTTP services on the appliance are online. Note the
                        HTTPS port number for later entry in the cinder service configuration file
                        (<literal>cinder.conf</literal>). This driver uses WebDAV over HTTPS to create snapshots
                        and clones of volumes, and therefore needs to have the HTTP service online.</paragraph>
                    <paragraph>The following example illustrates enabling the services and showing their
                        properties.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">zfssa:&gt; configuration services nfs
zfssa:configuration services nfs&gt; enable
zfssa:configuration services nfs&gt; show
Properties:
&lt;status&gt;= online
...</literal_block>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">zfssa:configuration services http&gt; enable
zfssa:configuration services http&gt; show
Properties:
&lt;status&gt;= online
require_login = true
protocols = http/https
listen_port = 80
https_port = 443</literal_block>
                    <note>
                        <paragraph>You can also run this <reference name="workflow" refuri="https://openstackci.oracle.com/openstack_docs/zfssa_cinder_workflow.akwf">workflow</reference>
                            to automate the above tasks.
                            Refer to <reference name="Oracle documentation" refuri="https://docs.oracle.com/cd/E37831_01/html/E52872/godgw.html">Oracle documentation</reference>
                            on how to download, view, and execute a workflow.</paragraph>
                    </note>
                </list_item>
                <list_item>
                    <paragraph>Create a network interface to be used exclusively for data. An existing
                        network interface may also be used. The following example illustrates how to
                        make a network interface for data traffic flow only.</paragraph>
                    <note>
                        <paragraph>For better performance and reliability, it is recommended to configure a
                            separate subnet exclusively for data traffic in your cloud environment.</paragraph>
                    </note>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">zfssa:&gt; configuration net interfaces
zfssa:configuration net interfaces&gt; select igbx
zfssa:configuration net interfaces igbx&gt; set admin=false
zfssa:configuration net interfaces igbx&gt; commit</literal_block>
                </list_item>
                <list_item>
                    <paragraph>For clustered controller systems, the following verification is required in
                        addition to the above steps. Skip this step if a standalone system is used.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">zfssa:&gt; configuration cluster resources list</literal_block>
                    <paragraph>Verify that both the newly created pool and the network interface are of
                        type <literal>singleton</literal> and are not locked to the current controller.  This
                        approach ensures that the pool and the interface used for data always belong
                        to the active controller, regardless of the current state of the cluster.
                        Verify that both the network interface used for management and data, and the
                        storage pool belong to the same head.</paragraph>
                    <note>
                        <paragraph>There will be a short service interruption during failback/takeover, but
                            once the process is complete, the driver should be able to access the
                            ZFSSA for data as well as for management.</paragraph>
                    </note>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="cinder-service-configuration" names="cinder\ service\ configuration">
            <title>Cinder service configuration</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Define the following required properties in the <literal>cinder.conf</literal>
                        configuration file:</paragraph>
                    <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">volume_driver = cinder.volume.drivers.zfssa.zfssanfs.ZFSSANFSDriver
san_ip = myhost
san_login = username
san_password = password
zfssa_data_ip = mydata
zfssa_nfs_pool = mypool</literal_block>
                    <note>
                        <paragraph>Management interface <literal>san_ip</literal> can be used instead of <literal>zfssa_data_ip</literal>,
                            but it is not recommended.</paragraph>
                    </note>
                </list_item>
                <list_item>
                    <paragraph>You can also define the following additional properties in the
                        <literal>cinder.conf</literal> configuration file:</paragraph>
                    <literal_block classes="code ini" xml:space="preserve"><inline classes="name attribute">zfssa_nfs_project</inline> <inline classes="operator">=</inline> <inline classes="literal string">NFSProject</inline>
<inline classes="name attribute">zfssa_nfs_share</inline> <inline classes="operator">=</inline> <inline classes="literal string">nfs_share</inline>
<inline classes="name attribute">zfssa_nfs_mount_options</inline> <inline classes="operator">=</inline>
<inline classes="name attribute">zfssa_nfs_share_compression</inline> <inline classes="operator">=</inline> <inline classes="literal string">off</inline>
<inline classes="name attribute">zfssa_nfs_share_logbias</inline> <inline classes="operator">=</inline> <inline classes="literal string">latency</inline>
<inline classes="name attribute">zfssa_https_port</inline> <inline classes="operator">=</inline> <inline classes="literal string">443</inline></literal_block>
                    <note>
                        <paragraph>The driver does not use the file specified in the <literal>nfs_shares_config</literal>
                            option.</paragraph>
                    </note>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="zfssa-local-cache" names="zfssa\ local\ cache">
            <title>ZFSSA local cache</title>
            <paragraph>The local cache feature enables ZFSSA drivers to serve the usage of
                bootable volumes significantly better. With the feature, the first
                bootable volume created from an image is cached, so that subsequent
                volumes can be created directly from the cache, instead of having image
                data transferred over the network multiple times.</paragraph>
            <paragraph>The following conditions must be met in order to use ZFSSA local cache
                feature:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>A storage pool needs to be configured.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>REST and NFS services need to be turned on.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>On an OpenStack controller, <literal>cinder.conf</literal> needs to contain
                        necessary properties used to configure and set up the ZFSSA NFS
                        driver, including the following new properties:</paragraph>
                    <definition_list>
                        <definition_list_item>
                            <term>zfssa_enable_local_cache</term>
                            <definition>
                                <paragraph>(True/False) To enable/disable the feature.</paragraph>
                            </definition>
                        </definition_list_item>
                        <definition_list_item>
                            <term>zfssa_cache_directory</term>
                            <definition>
                                <paragraph>The directory name inside zfssa_nfs_share where cache volumes
                                    are stored.</paragraph>
                            </definition>
                        </definition_list_item>
                    </definition_list>
                </list_item>
            </bullet_list>
            <paragraph>Every cache volume has two additional properties stored as WebDAV
                properties. It is important that they are not altered outside of Block
                Storage when the driver is in use:</paragraph>
            <definition_list>
                <definition_list_item>
                    <term>image_id</term>
                    <definition>
                        <paragraph>stores the image id as in Image service.</paragraph>
                    </definition>
                </definition_list_item>
                <definition_list_item>
                    <term>updated_at</term>
                    <definition>
                        <paragraph>stores the most current timestamp when the image is
                            updated in Image service.</paragraph>
                    </definition>
                </definition_list_item>
            </definition_list>
        </section>
        <section ids="driver-options" names="driver\ options">
            <title>Driver options</title>
            <paragraph>The Oracle ZFS Storage Appliance NFS driver supports these options:</paragraph>
            <comment xml:space="preserve">Warning: Do not edit this file. It is automatically generated from the
software project's code and your changes will be overwritten.

The tool to generate this file lives in openstack-doc-tools repository.

Please make any changes needed in the code, then run the
autogenerate-config-doc tool from the openstack-doc-tools repository, or
ask for help on the documentation mailing list, IRC channel or meeting.</comment>
            <target refid="cinder-zfssa-nfs"></target>
            <table classes="config-ref-table" ids="id1 cinder-zfssa-nfs" names="cinder-zfssa-nfs">
                <title>Description of ZFS Storage Appliance NFS driver configuration options</title>
                <tgroup cols="2">
                    <colspec colwidth="50"></colspec>
                    <colspec colwidth="50"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Configuration option = Default value</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph><strong>[DEFAULT]</strong></paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_cache_directory</literal> = <literal>os-cinder-cache</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Name of directory inside zfssa_nfs_share where cache volumes are stored.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_cache_project</literal> = <literal>os-cinder-cache</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Name of ZFSSA project where cache volumes are stored.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_data_ip</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Data path IP address</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_enable_local_cache</literal> = <literal>True</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Boolean) Flag to enable local caching: True, False.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_https_port</literal> = <literal>443</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) HTTPS port number</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_manage_policy</literal> = <literal>loose</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Driver policy for volume manage.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_nfs_mount_options</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Options to be passed while mounting share over nfs</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_nfs_pool</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Storage pool name.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_nfs_project</literal> = <literal>NFSProject</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Project name.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_nfs_share</literal> = <literal>nfs_share</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Share name.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_nfs_share_compression</literal> = <literal>off</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Data compression.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_nfs_share_logbias</literal> = <literal>latency</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Synchronous write bias-latency, throughput.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_rest_timeout</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Integer) REST connection timeout. (seconds)</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <paragraph>This driver shares additional NFS configuration options with the generic
                NFS driver. For a description of these, see <reference internal="True" refuri="nfs-volume-driver#cinder-storage-nfs"><inline classes="std std-ref">Description of NFS storage configuration options</inline></reference>.</paragraph>
        </section>
    </section>
</document>
