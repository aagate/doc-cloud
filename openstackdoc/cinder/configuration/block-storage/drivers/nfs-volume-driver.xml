<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/cinder/doc/source/configuration/block-storage/drivers/nfs-volume-driver.rst">
    <section ids="nfs-driver" names="nfs\ driver">
        <title>NFS driver</title>
        <paragraph>The Network File System (NFS) is a distributed file system protocol
            originally developed by Sun Microsystems in 1984. An NFS server
            <literal>exports</literal> one or more of its file systems, known as <literal>shares</literal>.
            An NFS client can mount these exported shares on its own file system.
            You can perform file actions on this mounted remote file system as
            if the file system were local.</paragraph>
        <section ids="how-the-nfs-driver-works" names="how\ the\ nfs\ driver\ works">
            <title>How the NFS driver works</title>
            <paragraph>The NFS driver, and other drivers based on it, work quite differently
                than a traditional block storage driver.</paragraph>
            <paragraph>The NFS driver does not actually allow an instance to access a storage
                device at the block level. Instead, files are created on an NFS share
                and mapped to instances, which emulates a block device.
                This works in a similar way to QEMU, which stores instances in the
                <literal>/var/lib/nova/instances</literal> directory.</paragraph>
        </section>
        <section ids="enable-the-nfs-driver-and-related-options" names="enable\ the\ nfs\ driver\ and\ related\ options">
            <title>Enable the NFS driver and related options</title>
            <paragraph>To use Cinder with the NFS driver, first set the <literal>volume_driver</literal>
                in the <literal>cinder.conf</literal> configuration file:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">volume_driver=cinder.volume.drivers.nfs.NfsDriver</literal_block>
            <paragraph>The following table contains the options supported by the NFS driver.</paragraph>
            <comment xml:space="preserve">Warning: Do not edit this file. It is automatically generated from the
software project's code and your changes will be overwritten.

The tool to generate this file lives in openstack-doc-tools repository.

Please make any changes needed in the code, then run the
autogenerate-config-doc tool from the openstack-doc-tools repository, or
ask for help on the documentation mailing list, IRC channel or meeting.</comment>
            <target refid="cinder-storage-nfs"></target>
            <table classes="config-ref-table" ids="id1 cinder-storage-nfs" names="cinder-storage_nfs">
                <title>Description of NFS storage configuration options</title>
                <tgroup cols="2">
                    <colspec colwidth="50"></colspec>
                    <colspec colwidth="50"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Configuration option = Default value</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph><strong>[DEFAULT]</strong></paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nfs_mount_attempts</literal> = <literal>3</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Integer) The number of attempts to mount NFS shares before raising an error. At least one attempt will be made to mount an NFS share, regardless of the value specified.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nfs_mount_options</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Mount options passed to the NFS client. See section of the NFS man page for details.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nfs_mount_point_base</literal> = <literal>$state_path/mnt</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Base dir containing mount points for NFS shares.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nfs_qcow2_volumes</literal> = <literal>False</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Boolean) Create volumes as QCOW2 files rather than raw files.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nfs_shares_config</literal> = <literal>/etc/cinder/nfs_shares</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) File with the list of available NFS shares.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nfs_snapshot_support</literal> = <literal>False</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Boolean) Enable support for snapshots on the NFS driver. Platforms using libvirt &lt;1.2.7 will encounter issues with this feature.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nfs_sparsed_volumes</literal> = <literal>True</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Boolean) Create volumes as sparsed files which take no space. If set to False volume is created as regular file. In such case volume creation takes a lot of time.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <note>
                <paragraph>As of the Icehouse release, the NFS driver (and other drivers based
                    off it) will attempt to mount shares using version 4.1 of the NFS
                    protocol (including pNFS). If the mount attempt is unsuccessful due
                    to a lack of client or server support, a subsequent mount attempt
                    that requests the default behavior of the <literal_strong classes="command">mount.nfs</literal_strong> command
                    will be performed. On most distributions, the default behavior is to
                    attempt mounting first with NFS v4.0, then silently fall back to NFS
                    v3.0 if necessary. If the <literal>nfs_mount_options</literal> configuration option
                    contains a request for a specific version of NFS to be used, or if
                    specific options are specified in the shares configuration file
                    specified by the <literal>nfs_shares_config</literal> configuration option, the
                    mount will be attempted as requested with no subsequent attempts.</paragraph>
            </note>
        </section>
        <section ids="how-to-use-the-nfs-driver" names="how\ to\ use\ the\ nfs\ driver">
            <title>How to use the NFS driver</title>
            <paragraph>Creating an NFS server is outside the scope of this document.</paragraph>
            <section ids="configure-with-one-nfs-server" names="configure\ with\ one\ nfs\ server">
                <title>Configure with one NFS server</title>
                <paragraph>This example assumes access to the following NFS server and mount point:</paragraph>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph>192.168.1.200:/storage</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>This example demonstrates the usage of this driver with one NFS server.</paragraph>
                <paragraph>Set the <literal>nas_host</literal> option to the IP address or host name of your NFS
                    server, and the <literal>nas_share_path</literal> option to the NFS export path:</paragraph>
                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">nas_host = 192.168.1.200
nas_share_path = /storage</literal_block>
            </section>
            <section ids="configure-with-multiple-nfs-servers" names="configure\ with\ multiple\ nfs\ servers">
                <title>Configure with multiple NFS servers</title>
                <note>
                    <paragraph>You can use the multiple NFS servers with <reference name="cinder multi back ends" refuri="https://wiki.openstack.org/wiki/Cinder-multi-backend">cinder multi back ends</reference><target ids="cinder-multi-back-ends" names="cinder\ multi\ back\ ends" refuri="https://wiki.openstack.org/wiki/Cinder-multi-backend"></target> feature.
                        Configure the <reference internal="True" refuri="../config-options#cinder-storage"><inline classes="std std-ref">enabled_backends</inline></reference> option with
                        multiple values, and use the <literal>nas_host</literal> and <literal>nas_share</literal> options
                        for each back end as described above.</paragraph>
                </note>
                <paragraph>The below example is another method to use multiple NFS servers,
                    and demonstrates the usage of this driver with multiple NFS servers.
                    Multiple servers are not required. One is usually enough.</paragraph>
                <paragraph>This example assumes access to the following NFS servers and mount points:</paragraph>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph>192.168.1.200:/storage</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>192.168.1.201:/storage</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>192.168.1.202:/storage</paragraph>
                    </list_item>
                </bullet_list>
                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                    <list_item>
                        <paragraph>Add your list of NFS servers to the file you specified with the
                            <literal>nfs_shares_config</literal> option. For example, if the value of this option
                            was set to <literal>/etc/cinder/shares.txt</literal> file, then:</paragraph>
                        <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># cat /etc/cinder/shares.txt
192.168.1.200:/storage
192.168.1.201:/storage
192.168.1.202:/storage</literal_block>
                        <paragraph>Comments are allowed in this file. They begin with a <literal>#</literal>.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Configure the <literal>nfs_mount_point_base</literal> option. This is a directory
                            where <literal>cinder-volume</literal> mounts all NFS shares stored in the <literal>shares.txt</literal>
                            file. For this example, <literal>/var/lib/cinder/nfs</literal> is used. You can,
                            of course, use the default value of <literal>$state_path/mnt</literal>.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Start the <literal>cinder-volume</literal> service. <literal>/var/lib/cinder/nfs</literal> should
                            now contain a directory for each NFS share specified in the <literal>shares.txt</literal>
                            file. The name of each directory is a hashed name:</paragraph>
                        <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># ls /var/lib/cinder/nfs/
...
46c5db75dc3a3a50a10bfd1a456a9f3f
...</literal_block>
                    </list_item>
                    <list_item>
                        <paragraph>You can now create volumes as you normally would:</paragraph>
                        <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack volume create --size 5 MYVOLUME
# ls /var/lib/cinder/nfs/46c5db75dc3a3a50a10bfd1a456a9f3f
volume-a8862558-e6d6-4648-b5df-bb84f31c8935</literal_block>
                    </list_item>
                </enumerated_list>
                <paragraph>This volume can also be attached and deleted just like other volumes.
                    However, snapshotting is <strong>not</strong> supported.</paragraph>
            </section>
        </section>
        <section ids="nfs-driver-notes" names="nfs\ driver\ notes">
            <title>NFS driver notes</title>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph><literal>cinder-volume</literal> manages the mounting of the NFS shares as well as
                        volume creation on the shares. Keep this in mind when planning your
                        OpenStack architecture. If you have one master NFS server, it might
                        make sense to only have one <literal>cinder-volume</literal> service to handle all
                        requests to that NFS server. However, if that single server is unable
                        to handle all requests, more than one <literal>cinder-volume</literal> service is
                        needed as well as potentially more than one NFS server.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Because data is stored in a file and not actually on a block storage
                        device, you might not see the same IO performance as you would with
                        a traditional block storage driver. Please test accordingly.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Despite possible IO performance loss, having volume data stored in
                        a file might be beneficial. For example, backing up volumes can be
                        as easy as copying the volume files.</paragraph>
                </list_item>
            </bullet_list>
            <note>
                <paragraph>Regular IO flushing and syncing still stands.</paragraph>
            </note>
        </section>
    </section>
</document>
