<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/cinder/doc/source/configuration/block-storage/drivers/kaminario-driver.rst">
    <section ids="kaminario-k2-all-flash-array-iscsi-and-fc-volume-drivers" names="kaminario\ k2\ all-flash\ array\ iscsi\ and\ fc\ volume\ drivers">
        <title>Kaminario K2 all-flash array iSCSI and FC volume drivers</title>
        <paragraph>Kaminario’s K2 all-flash array leverages a unique software-defined
            architecture that delivers highly valued predictable performance, scalability
            and cost-efficiency.</paragraph>
        <paragraph>Kaminario’s K2 all-flash iSCSI and FC arrays can be used in
            OpenStack Block Storage for providing block storage using
            <literal>KaminarioISCSIDriver</literal> class and <literal>KaminarioFCDriver</literal> class respectively.</paragraph>
        <paragraph>This documentation explains how to configure and connect the block storage
            nodes to one or more K2 all-flash arrays.</paragraph>
        <section ids="driver-requirements" names="driver\ requirements">
            <title>Driver requirements</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Kaminario’s K2 all-flash iSCSI and/or FC array</paragraph>
                </list_item>
                <list_item>
                    <paragraph>K2 REST API version &gt;= 2.2.0</paragraph>
                </list_item>
                <list_item>
                    <paragraph>K2 version 5.8 or later are supported</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>krest</literal> python library(version 1.3.1 or later) should be installed on the
                        Block Storage node using <literal_strong classes="command">sudo pip install krest</literal_strong></paragraph>
                </list_item>
                <list_item>
                    <paragraph>The Block Storage Node should also have a data path to the K2 array
                        for the following operations:</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>Create a volume from snapshot</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Clone a volume</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Copy volume to image</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Copy image to volume</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Retype ‘dedup without replication’&lt;-&gt;’nodedup without replication’</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
        </section>
        <section ids="supported-operations" names="supported\ operations">
            <title>Supported operations</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Create, delete, attach, and detach volumes.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create and delete volume snapshots.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a volume from a snapshot.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Copy an image to a volume.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Copy a volume to an image.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Clone a volume.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Extend a volume.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Retype a volume.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Manage and unmanage a volume.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Replicate volume with failover and failback support to K2 array.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="limitations-and-known-issues" names="limitations\ and\ known\ issues">
            <title>Limitations and known issues</title>
            <paragraph>If your OpenStack deployment is not setup to use multipath, the network
                connectivity of the K2 all-flash array will use a single physical port.</paragraph>
            <paragraph>This may significantly limit the following benefits provided by K2:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>available bandwidth</paragraph>
                </list_item>
                <list_item>
                    <paragraph>high-availability</paragraph>
                </list_item>
                <list_item>
                    <paragraph>non disruptive-upgrade</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>The following steps are required to setup multipath access on the
                Compute and the Block Storage nodes</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Install multipath software on both Compute and Block Storage nodes.</paragraph>
                    <paragraph>For example:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># apt-get install sg3-utils multipath-tools</literal_block>
                </list_item>
                <list_item>
                    <paragraph>In the <literal>[libvirt]</literal> section of the <literal>nova.conf</literal> configuration file,
                        specify <literal>iscsi_use_multipath=True</literal>. This option is valid for both iSCSI
                        and FC drivers.</paragraph>
                    <paragraph>Additional resources: Kaminario Host Configuration Guide
                        for Linux (for configuring multipath)</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Restart the compute service for the changes to take effect.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># service nova-compute restart</literal_block>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="configure-single-kaminario-iscsi-fc-back-end" names="configure\ single\ kaminario\ iscsi/fc\ back\ end">
            <title>Configure single Kaminario iSCSI/FC back end</title>
            <paragraph>This section details the steps required to configure the Kaminario
                Cinder Driver for single FC or iSCSI backend.</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>In the <literal>cinder.conf</literal> configuration file under the <literal>[DEFAULT]</literal>
                        section, set the  <literal>scheduler_default_filters</literal> parameter:</paragraph>
                    <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
scheduler_default_filters = DriverFilter,CapabilitiesFilter</literal_block>
                    <paragraph>See following links for more information:
                        <reference name="https://docs.openstack.org/developer/cinder/scheduler-filters.html" refuri="https://docs.openstack.org/developer/cinder/scheduler-filters.html">https://docs.openstack.org/developer/cinder/scheduler-filters.html</reference><target ids="https-docs-openstack-org-developer-cinder-scheduler-filters-html" names="https://docs.openstack.org/developer/cinder/scheduler-filters.html" refuri="https://docs.openstack.org/developer/cinder/scheduler-filters.html"></target>
                        <reference name="https://docs.openstack.org/admin-guide/blockstorage-driver-filter-weighing.html" refuri="https://docs.openstack.org/admin-guide/blockstorage-driver-filter-weighing.html">https://docs.openstack.org/admin-guide/blockstorage-driver-filter-weighing.html</reference><target ids="https-docs-openstack-org-admin-guide-blockstorage-driver-filter-weighing-html" names="https://docs.openstack.org/admin-guide/blockstorage-driver-filter-weighing.html" refuri="https://docs.openstack.org/admin-guide/blockstorage-driver-filter-weighing.html"></target></paragraph>
                </list_item>
                <list_item>
                    <paragraph>Under the <literal>[DEFAULT]</literal> section, set the enabled_backends parameter
                        with the iSCSI or FC back-end group</paragraph>
                    <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# For iSCSI
enabled_backends = kaminario-iscsi-1

# For FC
# enabled_backends = kaminario-fc-1</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Add a back-end group section for back-end group specified
                        in the enabled_backends parameter</paragraph>
                </list_item>
                <list_item>
                    <paragraph>In the newly created back-end group section, set the
                        following configuration options:</paragraph>
                    <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[kaminario-iscsi-1]
# Management IP of Kaminario K2 All-Flash iSCSI/FC array
san_ip = 10.0.0.10
# Management username of Kaminario K2 All-Flash iSCSI/FC array
san_login = username
# Management password of Kaminario K2 All-Flash iSCSI/FC array
san_password = password
# Enable Kaminario K2 iSCSI/FC driver
volume_driver = cinder.volume.drivers.kaminario.kaminario_iscsi.KaminarioISCSIDriver
# volume_driver = cinder.volume.drivers.kaminario.kaminario_fc.KaminarioFCDriver

# Backend name
# volume_backend_name = kaminario_fc_1
volume_backend_name = kaminario_iscsi_1

# K2 driver calculates max_oversubscription_ratio on setting below
# option as True. Default value is False
# auto_calc_max_oversubscription_ratio = False

# Set a limit on total number of volumes to be created on K2 array, for example:
# filter_function = "capabilities.total_volumes &lt; 250"

# For replication, replication_device must be set and the replication peer must be configured
# on the primary and the secondary K2 arrays
# Syntax:
#     replication_device = backend_id:&lt;s-array-ip&gt;,login:&lt;s-username&gt;,password:&lt;s-password&gt;,rpo:&lt;value&gt;
# where:
#     s-array-ip is the secondary K2 array IP
#     rpo must be either 60(1 min) or multiple of 300(5 min)
# Example:
# replication_device = backend_id:10.0.0.50,login:kaminario,password:kaminario,rpo:300

# Suppress requests library SSL certificate warnings on setting this option as True
# Default value is 'False'
# suppress_requests_ssl_warnings = False</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Restart the Block Storage services for the changes to take effect:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># service cinder-api restart
# service cinder-scheduler restart
# service cinder-volume restart</literal_block>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="setting-multiple-kaminario-iscsi-fc-back-ends" names="setting\ multiple\ kaminario\ iscsi/fc\ back\ ends">
            <title>Setting multiple Kaminario iSCSI/FC back ends</title>
            <paragraph>The following steps are required to configure multiple K2 iSCSI/FC backends:</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>In the <literal classes="file" role="file">cinder.conf</literal> file under the [DEFAULT] section,
                        set the enabled_backends parameter with the comma-separated
                        iSCSI/FC back-end groups.</paragraph>
                    <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
enabled_backends = kaminario-iscsi-1, kaminario-iscsi-2, kaminario-iscsi-3</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Add a back-end group section for each back-end group specified
                        in the enabled_backends parameter</paragraph>
                </list_item>
                <list_item>
                    <paragraph>For each back-end group section, enter the configuration options as
                        described in the above section
                        <literal>Configure single Kaminario iSCSI/FC back end</literal></paragraph>
                    <paragraph>See <reference name="Configure multiple-storage back ends" refuri="https://docs.openstack.org/admin-guide/blockstorage-multi-backend.html">Configure multiple-storage back ends</reference>
                        for additional information.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Restart the cinder volume service for the changes to take effect.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># service cinder-volume restart</literal_block>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="creating-volume-types" names="creating\ volume\ types">
            <title>Creating volume types</title>
            <paragraph>Create volume types for supporting volume creation on
                the multiple K2 iSCSI/FC backends.
                Set following extras-specs in the volume types:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>volume_backend_name : Set value of this spec according to the
                        value of <literal>volume_backend_name</literal> in the back-end group sections.
                        If only this spec is set, then dedup Kaminario cinder volumes will be
                        created without replication support</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack volume type create kaminario_iscsi_dedup_noreplication
$ openstack volume type set --property volume_backend_name=kaminario_iscsi_1 \
  kaminario_iscsi_dedup_noreplication</literal_block>
                </list_item>
                <list_item>
                    <paragraph>kaminario:thin_prov_type :  Set this spec in the volume type for creating
                        nodedup Kaminario cinder volumes. If this spec is not set, dedup Kaminario
                        cinder volumes will be created.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>kaminario:replication : Set this spec in the volume type for creating
                        replication supported Kaminario cinder volumes. If this spec is not set,
                        then Kaminario cinder volumes will be created without replication support.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack volume type create kaminario_iscsi_dedup_replication
$ openstack volume type set --property volume_backend_name=kaminario_iscsi_1 \
  kaminario:replication=enabled kaminario_iscsi_dedup_replication

$ openstack volume type create kaminario_iscsi_nodedup_replication
$ openstack volume type set --property volume_backend_name=kaminario_iscsi_1 \
  kaminario:replication=enabled kaminario:thin_prov_type=nodedup \
  kaminario_iscsi_nodedup_replication

$ openstack volume type create kaminario_iscsi_nodedup_noreplication
$ openstack volume type set --property volume_backend_name=kaminario_iscsi_1 \
  kaminario:thin_prov_type=nodedup kaminario_iscsi_nodedup_noreplication</literal_block>
                </list_item>
            </bullet_list>
        </section>
        <section ids="supported-retype-cases" names="supported\ retype\ cases">
            <title>Supported retype cases</title>
            <paragraph>The following are the supported retypes for Kaminario cinder volumes:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Nodedup-noreplication &lt;–&gt; Nodedup-replication</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ cinder retype volume-id new-type</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Dedup-noreplication &lt;–&gt; Dedup-replication</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ cinder retype volume-id new-type</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Dedup-noreplication &lt;–&gt; Nodedup-noreplication</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ cinder retype --migration-policy on-demand volume-id new-type</literal_block>
                </list_item>
            </bullet_list>
            <paragraph>For non-supported cases, try combinations of the
                <literal_strong classes="command">cinder retype</literal_strong> command.</paragraph>
        </section>
        <section ids="driver-options" names="driver\ options">
            <title>Driver options</title>
            <paragraph>The following table contains the configuration options that are specific
                to the Kaminario K2 FC and iSCSI Block Storage drivers.</paragraph>
            <comment xml:space="preserve">Warning: Do not edit this file. It is automatically generated from the
software project's code and your changes will be overwritten.

The tool to generate this file lives in openstack-doc-tools repository.

Please make any changes needed in the code, then run the
autogenerate-config-doc tool from the openstack-doc-tools repository, or
ask for help on the documentation mailing list, IRC channel or meeting.</comment>
            <target refid="cinder-kaminario"></target>
            <table classes="config-ref-table" ids="id1 cinder-kaminario" names="cinder-kaminario">
                <title>Description of Kaminario volume driver configuration options</title>
                <tgroup cols="2">
                    <colspec colwidth="50"></colspec>
                    <colspec colwidth="50"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Configuration option = Default value</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph><strong>[DEFAULT]</strong></paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>auto_calc_max_oversubscription_ratio</literal> = <literal>False</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Boolean) K2 driver will calculate max_oversubscription_ratio on setting this option as True.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
    </section>
</document>
