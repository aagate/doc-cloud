<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/cinder/doc/source/configuration/block-storage/drivers/pure-storage-driver.rst">
    <section ids="pure-storage-iscsi-and-fibre-channel-volume-drivers" names="pure\ storage\ iscsi\ and\ fibre\ channel\ volume\ drivers">
        <title>Pure Storage iSCSI and Fibre Channel volume drivers</title>
        <paragraph>The Pure Storage FlashArray volume drivers for OpenStack Block Storage
            interact with configured Pure Storage arrays and support various
            operations.</paragraph>
        <paragraph>Support for iSCSI storage protocol is available with the PureISCSIDriver
            Volume Driver class, and Fibre Channel with PureFCDriver.</paragraph>
        <paragraph>All drivers are compatible with Purity FlashArrays that support the REST
            API version 1.2, 1.3, 1.4, or 1.5 (Purity 4.0.0 and newer).</paragraph>
        <section ids="limitations-and-known-issues" names="limitations\ and\ known\ issues">
            <title>Limitations and known issues</title>
            <paragraph>If you do not set up the nodes hosting instances to use multipathing,
                all network connectivity will use a single physical port on the array.
                In addition to significantly limiting the available bandwidth, this
                means you do not have the high-availability and non-disruptive upgrade
                benefits provided by FlashArray. Multipathing must be used to take advantage
                of these benefits.</paragraph>
        </section>
        <section ids="supported-operations" names="supported\ operations">
            <title>Supported operations</title>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Create, delete, attach, detach, retype, clone, and extend volumes.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a volume from snapshot.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create, list, and delete volume snapshots.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create, list, update, and delete consistency groups.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create, list, and delete consistency group snapshots.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Manage and unmanage a volume.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Manage and unmanage a snapshot.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Get volume statistics.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a thin provisioned volume.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Replicate volumes to remote Pure Storage array(s).</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="configure-openstack-and-purity" names="configure\ openstack\ and\ purity">
            <title>Configure OpenStack and Purity</title>
            <paragraph>You need to configure both your Purity array and your OpenStack cluster.</paragraph>
            <note>
                <paragraph>These instructions assume that the <literal>cinder-api</literal> and <literal>cinder-scheduler</literal>
                    services are installed and configured in your OpenStack cluster.</paragraph>
            </note>
            <section ids="configure-the-openstack-block-storage-service" names="configure\ the\ openstack\ block\ storage\ service">
                <title>Configure the OpenStack Block Storage service</title>
                <paragraph>In these steps, you will edit the <literal>cinder.conf</literal> file to configure the
                    OpenStack Block Storage service to enable multipathing and to use the
                    Pure Storage FlashArray as back-end storage.</paragraph>
                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                    <list_item>
                        <paragraph>Install Pure Storage PyPI module.
                            A requirement for the Pure Storage driver is the installation of the
                            Pure Storage Python SDK version 1.4.0 or later from PyPI.</paragraph>
                        <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ pip install purestorage</literal_block>
                    </list_item>
                    <list_item>
                        <paragraph>Retrieve an API token from Purity.
                            The OpenStack Block Storage service configuration requires an API token
                            from Purity. Actions performed by the volume driver use this token for
                            authorization. Also, Purity logs the volume driver’s actions as being
                            performed by the user who owns this API token.</paragraph>
                        <paragraph>If you created a Purity user account that is dedicated to managing your
                            OpenStack Block Storage volumes, copy the API token from that user
                            account.</paragraph>
                        <paragraph>Use the appropriate create or list command below to display and copy the
                            Purity API token:</paragraph>
                        <bullet_list bullet="*">
                            <list_item>
                                <paragraph>To create a new API token:</paragraph>
                                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ pureadmin create --api-token USER</literal_block>
                                <paragraph>The following is an example output:</paragraph>
                                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ pureadmin create --api-token pureuser
Name      API Token                             Created
pureuser  902fdca3-7e3f-d2e4-d6a6-24c2285fe1d9  2014-08-04 14:50:30</literal_block>
                            </list_item>
                            <list_item>
                                <paragraph>To list an existing API token:</paragraph>
                                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ pureadmin list --api-token --expose USER</literal_block>
                                <paragraph>The following is an example output:</paragraph>
                                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ pureadmin list --api-token --expose pureuser
Name      API Token                             Created
pureuser  902fdca3-7e3f-d2e4-d6a6-24c2285fe1d9  2014-08-04 14:50:30</literal_block>
                            </list_item>
                        </bullet_list>
                    </list_item>
                    <list_item>
                        <paragraph>Copy the API token retrieved (<literal>902fdca3-7e3f-d2e4-d6a6-24c2285fe1d9</literal> from
                            the examples above) to use in the next step.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Edit the OpenStack Block Storage service configuration file.
                            The following sample <literal>/etc/cinder/cinder.conf</literal> configuration lists the
                            relevant settings for a typical Block Storage service using a single
                            Pure Storage array:</paragraph>
                        <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
enabled_backends = puredriver-1
default_volume_type = puredriver-1

[puredriver-1]
volume_backend_name = puredriver-1
volume_driver = PURE_VOLUME_DRIVER
san_ip = IP_PURE_MGMT
pure_api_token = PURE_API_TOKEN
use_multipath_for_image_xfer = True</literal_block>
                        <paragraph>Replace the following variables accordingly:</paragraph>
                        <definition_list>
                            <definition_list_item>
                                <term>PURE_VOLUME_DRIVER</term>
                                <definition>
                                    <paragraph>Use either <literal>cinder.volume.drivers.pure.PureISCSIDriver</literal> for iSCSI or
                                        <literal>cinder.volume.drivers.pure.PureFCDriver</literal> for Fibre Channel
                                        connectivity.</paragraph>
                                </definition>
                            </definition_list_item>
                            <definition_list_item>
                                <term>IP_PURE_MGMT</term>
                                <definition>
                                    <paragraph>The IP address of the Pure Storage array’s management interface or a
                                        domain name that resolves to that IP address.</paragraph>
                                </definition>
                            </definition_list_item>
                            <definition_list_item>
                                <term>PURE_API_TOKEN</term>
                                <definition>
                                    <paragraph>The Purity Authorization token that the volume driver uses to
                                        perform volume management on the Pure Storage array.</paragraph>
                                </definition>
                            </definition_list_item>
                        </definition_list>
                    </list_item>
                </enumerated_list>
                <note>
                    <paragraph>The volume driver automatically creates Purity host objects for
                        initiators as needed. If CHAP authentication is enabled via the
                        <literal>use_chap_auth</literal> setting, you must ensure there are no manually
                        created host objects with IQN’s that will be used by the OpenStack
                        Block Storage service. The driver will only modify credentials on hosts that
                        it manages.</paragraph>
                </note>
                <note>
                    <paragraph>If using the PureFCDriver it is recommended to use the OpenStack
                        Block Storage Fibre Channel Zone Manager.</paragraph>
                </note>
            </section>
        </section>
        <section ids="volume-auto-eradication" names="volume\ auto-eradication">
            <title>Volume auto-eradication</title>
            <paragraph>To enable auto-eradication of deleted volumes, snapshots, and consistency
                groups on deletion, modify the following option in the <literal>cinder.conf</literal> file:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">pure_eradicate_on_delete = true</literal_block>
            <paragraph>By default, auto-eradication is disabled and all deleted volumes, snapshots,
                and consistency groups are retained on the Pure Storage array in a recoverable
                state for 24 hours from time of deletion.</paragraph>
        </section>
        <section ids="ssl-certification" names="ssl\ certification">
            <title>SSL certification</title>
            <paragraph>To enable SSL certificate validation, modify the following option in the
                <literal>cinder.conf</literal> file:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">driver_ssl_cert_verify = true</literal_block>
            <paragraph>By default, SSL certificate validation is disabled.</paragraph>
            <paragraph>To specify a non-default path to <literal>CA_Bundle</literal> file or directory with
                certificates of trusted CAs:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">driver_ssl_cert_path = Certificate path</literal_block>
            <note>
                <paragraph>This requires the use of Pure Storage Python SDK &gt; 1.4.0.</paragraph>
            </note>
        </section>
        <section ids="replication-configuration" names="replication\ configuration">
            <title>Replication configuration</title>
            <paragraph>Add the following to the back-end specification to specify another Flash
                Array to replicate to:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[puredriver-1]
replication_device = backend_id:PURE2_NAME,san_ip:IP_PURE2_MGMT,api_token:PURE2_API_TOKEN</literal_block>
            <paragraph>Where <literal>PURE2_NAME</literal> is the name of the remote Pure Storage system,
                <literal>IP_PURE2_MGMT</literal> is the management IP address of the remote array,
                and <literal>PURE2_API_TOKEN</literal> is the Purity Authorization token
                of the remote array.</paragraph>
            <paragraph>Note that more than one <literal>replication_device</literal> line can be added to allow for
                multi-target device replication.</paragraph>
            <paragraph>A volume is only replicated if the volume is of a volume-type that has
                the extra spec <literal>replication_enabled</literal> set to <literal>&lt;is&gt; True</literal>.</paragraph>
            <paragraph>To create a volume type that specifies replication to remote back ends:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack volume type create ReplicationType
$ openstack volume type set --property replication_enabled='&lt;is&gt; True' ReplicationType</literal_block>
            <paragraph>The following table contains the optional configuration parameters available
                for replication configuration with the Pure Storage array.</paragraph>
            <table>
                <tgroup cols="3">
                    <colspec colwidth="52"></colspec>
                    <colspec colwidth="13"></colspec>
                    <colspec colwidth="9"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Option</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Default</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph><literal>pure_replica_interval_default</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Snapshot
                                    replication
                                    interval in
                                    seconds.</paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>3600</literal></paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>pure_replica_retention_short_term_default</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Retain all
                                    snapshots on
                                    target for
                                    this time
                                    (in seconds).</paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>14400</literal></paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>pure_replica_retention_long_term_per_day_default</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Retain how
                                    many
                                    snapshots
                                    for each
                                    day.</paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>3</literal></paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>pure_replica_retention_long_term_default</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Retain
                                    snapshots
                                    per day
                                    on target
                                    for this
                                    time (in
                                    days).</paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>7</literal></paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <note>
                <paragraph><literal>replication-failover</literal> is only supported from the primary array to any of the
                    multiple secondary arrays, but subsequent <literal>replication-failover</literal> is only
                    supported back to the original primary array.</paragraph>
            </note>
        </section>
        <section ids="automatic-thin-provisioning-oversubscription-ratio" names="automatic\ thin-provisioning/oversubscription\ ratio">
            <title>Automatic thin-provisioning/oversubscription ratio</title>
            <paragraph>To enable this feature where we calculate the array oversubscription ratio as
                (total provisioned/actual used), add the following option in the
                <literal>cinder.conf</literal> file:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[puredriver-1]
pure_automatic_max_oversubscription_ratio = True</literal_block>
            <paragraph>By default, this is disabled and we honor the hard-coded configuration option
                <literal>max_over_subscription_ratio</literal>.</paragraph>
            <note>
                <paragraph>Arrays with very good data reduction rates (compression/data deduplication/thin provisioning)
                    can get <emphasis>very</emphasis> large oversubscription rates applied.</paragraph>
            </note>
        </section>
        <section ids="scheduling-metrics" names="scheduling\ metrics">
            <title>Scheduling metrics</title>
            <paragraph>A large number of metrics are reported by the volume driver which can be useful
                in implementing more control over volume placement in multi-backend
                environments using the driver filter and weighter methods.</paragraph>
            <paragraph>Metrics reported include, but are not limited to:</paragraph>
            <literal_block highlight_args="{}" language="text" linenos="False" xml:space="preserve">total_capacity_gb
free_capacity_gb
provisioned_capacity
total_volumes
total_snapshots
total_hosts
total_pgroups
writes_per_sec
reads_per_sec
input_per_sec
output_per_sec
usec_per_read_op
usec_per_read_op
queue_depth</literal_block>
            <note>
                <paragraph>All total metrics include non-OpenStack managed objects on the array.</paragraph>
            </note>
            <paragraph>In conjunction with QOS extra-specs, you can create very complex algorithms to
                manage volume placement. More detailed documentation on this is available in
                other external documentation.</paragraph>
        </section>
    </section>
</document>
