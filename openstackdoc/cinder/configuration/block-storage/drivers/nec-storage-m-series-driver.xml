<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/cinder/doc/source/configuration/block-storage/drivers/nec-storage-m-series-driver.rst">
    <section ids="nec-storage-m-series-driver" names="nec\ storage\ m\ series\ driver">
        <title>NEC Storage M series driver</title>
        <paragraph>NEC Storage M series are dual-controller disk arrays which support
            online maintenance.
            This driver supports both iSCSI and Fibre Channel.</paragraph>
        <section ids="system-requirements" names="system\ requirements">
            <title>System requirements</title>
            <paragraph>Supported models:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>NEC Storage M110, M310, M510 and M710 (SSD/HDD hybrid)</paragraph>
                </list_item>
                <list_item>
                    <paragraph>NEC Storage M310F and M710F (all flash)</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>Requirements:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Storage control software (firmware) revision 0950 or later</paragraph>
                </list_item>
                <list_item>
                    <paragraph>NEC Storage DynamicDataReplication license</paragraph>
                </list_item>
                <list_item>
                    <paragraph>(Optional) NEC Storage IO Load Manager license for QoS</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="supported-operations" names="supported\ operations">
            <title>Supported operations</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Create, delete, attach, and detach volumes.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create, list, and delete volume snapshots.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a volume from a snapshot.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Copy an image to a volume.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Clone a volume.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Extend a volume.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Get volume statistics.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="preparation" names="preparation">
            <title>Preparation</title>
            <paragraph>Below is minimum preparation to a disk array.
                For details of each command, see the NEC Storage Manager Command Reference
                (IS052).</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Common (iSCSI and Fibre Channel)</paragraph>
                    <enumerated_list enumtype="arabic" prefix="" suffix=".">
                        <list_item>
                            <paragraph>Initial setup</paragraph>
                            <bullet_list bullet="*">
                                <list_item>
                                    <paragraph>Set IP addresses for management and BMC with the network configuration
                                        tool.</paragraph>
                                </list_item>
                                <list_item>
                                    <paragraph>Enter license keys. (iSMcfg licenserelease)</paragraph>
                                </list_item>
                            </bullet_list>
                        </list_item>
                        <list_item>
                            <paragraph>Create pools</paragraph>
                            <bullet_list bullet="*">
                                <list_item>
                                    <paragraph>Create pools for volumes. (iSMcfg poolbind)</paragraph>
                                </list_item>
                                <list_item>
                                    <paragraph>Create pools for snapshots. (iSMcfg poolbind)</paragraph>
                                </list_item>
                            </bullet_list>
                        </list_item>
                        <list_item>
                            <paragraph>Create system volumes</paragraph>
                            <bullet_list bullet="*">
                                <list_item>
                                    <paragraph>Create a Replication Reserved Volume (RSV) in one of pools.
                                        (iSMcfg ldbind)</paragraph>
                                </list_item>
                                <list_item>
                                    <paragraph>Create Snapshot Reserve Areas (SRAs) in each snapshot pool.
                                        (iSMcfg srabind)</paragraph>
                                </list_item>
                            </bullet_list>
                        </list_item>
                        <list_item>
                            <paragraph>Create control volumes</paragraph>
                            <bullet_list bullet="*">
                                <list_item>
                                    <paragraph>Create control volumes for each controller node. (iSMcfg ldbind)</paragraph>
                                </list_item>
                            </bullet_list>
                        </list_item>
                        <list_item>
                            <paragraph>(Optional) Register SSH public key</paragraph>
                        </list_item>
                    </enumerated_list>
                </list_item>
                <list_item>
                    <paragraph>iSCSI only</paragraph>
                    <enumerated_list enumtype="arabic" prefix="" suffix=".">
                        <list_item>
                            <paragraph>Set IP addresses of each iSCSI port. (iSMcfg setiscsiport)</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Create LD Sets with setting multi-target mode on for each controller
                                and compute nodes. (iSMcfg addldset)</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>For each node, register the initiator name (/etc/iscsi/initiatorname.iscsi)
                                to LD set for the node. (iSMcfg addldsetinitiator)</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>For each controller node, add the control volume created above to LD set
                                for the node. (iSMcfg addldsetld)</paragraph>
                        </list_item>
                    </enumerated_list>
                </list_item>
                <list_item>
                    <paragraph>Fibre Channel only</paragraph>
                    <enumerated_list enumtype="arabic" prefix="" suffix=".">
                        <list_item>
                            <paragraph>Start access control. (iSMcfg startacc)</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Create LD Sets for each controller and compute nodes.
                                (iSMcfg addldset)</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>For each node, register WWPNs (/sys/class/fc_host/hostX/port_name)
                                to LD set for the node. (iSMcfg addldsetpath)</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>For each controller node, add the control volume created above to LD set
                                for the node. (iSMcfg addldsetld)</paragraph>
                        </list_item>
                    </enumerated_list>
                </list_item>
            </bullet_list>
        </section>
        <section ids="configuration" names="configuration">
            <title>Configuration</title>
            <paragraph>Set the following in your <literal>cinder.conf</literal>, and use the following options
                to configure it.</paragraph>
            <paragraph>If you use Fibre Channel:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[Storage1]
volume_driver = cinder.volume.drivers.nec.volume.MStorageFCDriver</literal_block>
            <comment xml:space="preserve">end</comment>
            <paragraph>If you use iSCSI:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[Storage1]
volume_driver = cinder.volume.drivers.nec.volume.MStorageISCSIDriver</literal_block>
            <comment xml:space="preserve">end</comment>
            <paragraph>Also, set <literal>volume_backend_name</literal>.</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
volume_backend_name = Storage1</literal_block>
            <comment xml:space="preserve">end</comment>
            <paragraph>This table shows configuration options for NEC Storage M series driver.</paragraph>
            <comment xml:space="preserve">Warning: Do not edit this file. It is automatically generated from the
software project's code and your changes will be overwritten.

The tool to generate this file lives in openstack-doc-tools repository.

Please make any changes needed in the code, then run the
autogenerate-config-doc tool from the openstack-doc-tools repository, or
ask for help on the documentation mailing list, IRC channel or meeting.</comment>
            <target refid="cinder-nec-m"></target>
            <table classes="config-ref-table" ids="id1 cinder-nec-m" names="cinder-nec_m">
                <title>Description of NEC Storage M series driver configuration options</title>
                <tgroup cols="2">
                    <colspec colwidth="50"></colspec>
                    <colspec colwidth="50"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Configuration option = Default value</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph><strong>[DEFAULT]</strong></paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_actual_free_capacity</literal> = <literal>False</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Boolean) Return actual free capacity.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_backend_max_ld_count</literal> = <literal>1024</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Integer) Maximum number of managing sessions.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_backup_ldname_format</literal> = <literal>LX:%s</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) M-Series Storage LD name format for snapshots.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_backup_pools</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(List) M-Series Storage backup pool number to be used.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_diskarray_name</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Diskarray name of M-Series Storage.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_iscsi_portals_per_cont</literal> = <literal>1</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Integer) Number of iSCSI portals.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_ismcli_fip</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(IP) FIP address of M-Series Storage iSMCLI.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_ismcli_password</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Password for M-Series Storage iSMCLI.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_ismcli_privkey</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Filename of RSA private key for M-Series Storage iSMCLI.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_ismcli_user</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) User name for M-Series Storage iSMCLI.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_ismview_alloptimize</literal> = <literal>False</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Boolean) Use legacy iSMCLI command with optimization.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_ismview_dir</literal> = <literal>/tmp/nec/cinder</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Output path of iSMview file.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_ldname_format</literal> = <literal>LX:%s</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) M-Series Storage LD name format for volumes.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_ldset</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) M-Series Storage LD Set name for Compute Node.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_ldset_for_controller_node</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) M-Series Storage LD Set name for Controller Node.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_pools</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(List) M-Series Storage pool numbers list to be used.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_queryconfig_view</literal> = <literal>False</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Boolean) Use legacy iSMCLI command.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_ssh_pool_port_number</literal> = <literal>22</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Integer) Port number of ssh pool.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>nec_unpairthread_timeout</literal> = <literal>3600</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Integer) Timeout value of Unpairthread.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <section ids="required-options" names="required\ options">
                <title>Required options</title>
                <bullet_list bullet="-">
                    <list_item>
                        <definition_list>
                            <definition_list_item>
                                <term><literal>nec_ismcli_fip</literal></term>
                                <definition>
                                    <paragraph>FIP address of M-Series Storage.</paragraph>
                                </definition>
                            </definition_list_item>
                        </definition_list>
                    </list_item>
                    <list_item>
                        <definition_list>
                            <definition_list_item>
                                <term><literal>nec_ismcli_user</literal></term>
                                <definition>
                                    <paragraph>User name for M-Series Storage iSMCLI.</paragraph>
                                </definition>
                            </definition_list_item>
                        </definition_list>
                    </list_item>
                    <list_item>
                        <definition_list>
                            <definition_list_item>
                                <term><literal>nec_ismcli_password</literal></term>
                                <definition>
                                    <paragraph>Password for M-Series Storage iSMCLI.</paragraph>
                                </definition>
                            </definition_list_item>
                        </definition_list>
                    </list_item>
                    <list_item>
                        <definition_list>
                            <definition_list_item>
                                <term><literal>nec_ismcli_privkey</literal></term>
                                <definition>
                                    <paragraph>RSA secret key file name for iSMCLI (for public key authentication only).
                                        Encrypted RSA secret key file cannot be specified.</paragraph>
                                </definition>
                            </definition_list_item>
                        </definition_list>
                    </list_item>
                    <list_item>
                        <definition_list>
                            <definition_list_item>
                                <term><literal>nec_diskarray_name</literal></term>
                                <definition>
                                    <paragraph>Diskarray name of M-Series Storage.
                                        This parameter must be specified to configure multiple groups
                                        (multi back end) by using the same storage device (storage
                                        device that has the same <literal>nec_ismcli_fip</literal>). Specify the disk
                                        array name targeted by the relevant config-group for this
                                        parameter.</paragraph>
                                </definition>
                            </definition_list_item>
                        </definition_list>
                    </list_item>
                    <list_item>
                        <definition_list>
                            <definition_list_item>
                                <term><literal>nec_backup_pools</literal></term>
                                <definition>
                                    <paragraph>Specify a pool number where snapshots are created.</paragraph>
                                </definition>
                            </definition_list_item>
                        </definition_list>
                    </list_item>
                </bullet_list>
            </section>
            <section ids="timeout-configuration" names="timeout\ configuration">
                <title>Timeout configuration</title>
                <bullet_list bullet="-">
                    <list_item>
                        <definition_list>
                            <definition_list_item>
                                <term><literal>rpc_response_timeout</literal></term>
                                <definition>
                                    <paragraph>Set the timeout value in seconds. If three or more volumes can be created
                                        at the same time, the reference value is 30 seconds multiplied by the
                                        number of volumes created at the same time.
                                        Also, Specify nova parameters below in <literal>nova.conf</literal> file.</paragraph>
                                    <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
block_device_allocate_retries = 120
block_device_allocate_retries_interval = 10</literal_block>
                                    <comment xml:space="preserve">end</comment>
                                </definition>
                            </definition_list_item>
                        </definition_list>
                    </list_item>
                    <list_item>
                        <definition_list>
                            <definition_list_item>
                                <term><literal>timeout server (HAProxy configuration)</literal></term>
                                <definition>
                                    <paragraph>In addition, you need to edit the following value in the HAProxy
                                        configuration file (<literal>/etc/haproxy/haproxy.cfg</literal>) in an environment where
                                        HAProxy is used.</paragraph>
                                    <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">timeout server = 600 #Specify a value greater than rpc_response_timeout.</literal_block>
                                    <comment xml:space="preserve">end</comment>
                                    <paragraph>Run the <literal_strong classes="command">service haproxy reload</literal_strong> command after editing the
                                        value to reload the HAProxy settings.</paragraph>
                                    <note>
                                        <paragraph>The OpenStack environment set up using Red Hat OpenStack Platform
                                            Director may be set to use HAProxy.</paragraph>
                                    </note>
                                </definition>
                            </definition_list_item>
                        </definition_list>
                    </list_item>
                </bullet_list>
            </section>
        </section>
        <section ids="configuration-example-for-etc-cinder-cinder-conf" names="configuration\ example\ for\ /etc/cinder/cinder.conf">
            <title>Configuration example for /etc/cinder/cinder.conf</title>
            <section ids="when-using-one-config-group" names="when\ using\ one\ config-group">
                <title>When using one config-group</title>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>When using <literal>nec_ismcli_password</literal> to authenticate iSMCLI
                            (Password authentication):</paragraph>
                        <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
enabled_backends = Storage1

[Storage1]
volume_driver = cinder.volume.drivers.nec.volume.MStorageISCSIDriver
volume_backend_name = Storage1
nec_ismcli_fip = 192.168.1.10
nec_ismcli_user = sysadmin
nec_ismcli_password = sys123
nec_pools = 0
nec_backup_pools = 1</literal_block>
                        <comment xml:space="preserve">end</comment>
                    </list_item>
                    <list_item>
                        <paragraph>When using <literal>nec_ismcli_privkey</literal> to authenticate iSMCLI
                            (Public key authentication):</paragraph>
                        <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
enabled_backends = Storage1

[Storage1]
volume_driver = cinder.volume.drivers.nec.volume.MStorageISCSIDriver
volume_backend_name = Storage1
nec_ismcli_fip = 192.168.1.10
nec_ismcli_user = sysadmin
nec_ismcli_privkey = /etc/cinder/id_rsa
nec_pools = 0
nec_backup_pools = 1</literal_block>
                        <comment xml:space="preserve">end</comment>
                    </list_item>
                </bullet_list>
            </section>
            <section ids="when-using-multi-config-group-multi-backend" names="when\ using\ multi\ config-group\ (multi-backend)">
                <title>When using multi config-group (multi-backend)</title>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Four config-groups (backends)</paragraph>
                        <paragraph>Storage1, Storage2, Storage3, Storage4</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Two disk arrays</paragraph>
                        <definition_list>
                            <definition_list_item>
                                <term>200000255C3A21CC(192.168.1.10)</term>
                                <definition>
                                    <paragraph>Example for using config-group, Storage1 and Storage2</paragraph>
                                </definition>
                            </definition_list_item>
                            <definition_list_item>
                                <term>2000000991000316(192.168.1.20)</term>
                                <definition>
                                    <paragraph>Example for using config-group, Storage3 and Storage4</paragraph>
                                </definition>
                            </definition_list_item>
                        </definition_list>
                        <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
enabled_backends = Storage1,Storage2,Storage3,Storage4

[Storage1]
volume_driver = cinder.volume.drivers.nec.volume.MStorageISCSIDriver
volume_backend_name = Gold
nec_ismcli_fip = 192.168.1.10
nec_ismcli_user = sysadmin
nec_ismcli_password = sys123
nec_pools = 0
nec_backup_pools = 2
nec_diskarray_name = 200000255C3A21CC

[Storage2]
volume_driver = cinder.volume.drivers.nec.volume.MStorageISCSIDriver
volume_backend_name = Silver
nec_ismcli_fip = 192.168.1.10
nec_ismcli_user = sysadmin
nec_ismcli_password = sys123
nec_pools = 1
nec_backup_pools = 3
nec_diskarray_name = 200000255C3A21CC

[Storage3]
volume_driver = cinder.volume.drivers.nec.volume.MStorageISCSIDriver
volume_backend_name = Gold
nec_ismcli_fip = 192.168.1.20
nec_ismcli_user = sysadmin
nec_ismcli_password = sys123
nec_pools = 0
nec_backup_pools = 2
nec_diskarray_name = 2000000991000316

[Storage4]
volume_driver = cinder.volume.drivers.nec.volume.MStorageISCSIDriver
volume_backend_name = Silver
nec_ismcli_fip = 192.168.1.20
nec_ismcli_user = sysadmin
nec_ismcli_password = sys123
nec_pools = 1
nec_backup_pools = 3
nec_diskarray_name = 2000000991000316</literal_block>
                        <comment xml:space="preserve">end</comment>
                    </list_item>
                </bullet_list>
            </section>
        </section>
    </section>
</document>
