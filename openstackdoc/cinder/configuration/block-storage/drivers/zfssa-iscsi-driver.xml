<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/cinder/doc/source/configuration/block-storage/drivers/zfssa-iscsi-driver.rst">
    <section ids="oracle-zfs-storage-appliance-iscsi-driver" names="oracle\ zfs\ storage\ appliance\ iscsi\ driver">
        <title>Oracle ZFS Storage Appliance iSCSI driver</title>
        <paragraph>Oracle ZFS Storage Appliances (ZFSSAs) provide advanced software to
            protect data, speed tuning and troubleshooting, and deliver high
            performance and high availability. Through the Oracle ZFSSA iSCSI
            Driver, OpenStack Block Storage can use an Oracle ZFSSA as a block
            storage resource. The driver enables you to create iSCSI volumes that an
            OpenStack Block Storage server can allocate to any virtual machine
            running on a compute host.</paragraph>
        <section ids="requirements" names="requirements">
            <title>Requirements</title>
            <paragraph>The Oracle ZFSSA iSCSI Driver, version <literal>1.0.0</literal> and later, supports
                ZFSSA software release <literal>2013.1.2.0</literal> and later.</paragraph>
        </section>
        <section ids="supported-operations" names="supported\ operations">
            <title>Supported operations</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Create, delete, attach, detach, manage, and unmanage volumes.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create and delete snapshots.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create volume from snapshot.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Extend a volume.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Attach and detach volumes.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Get volume stats.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Clone volumes.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Migrate a volume.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Local cache of a bootable volume.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="configuration" names="configuration">
            <title>Configuration</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Enable RESTful service on the ZFSSA Storage Appliance.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a new user on the appliance with the following authorizations:</paragraph>
                    <literal_block highlight_args="{}" language="bash" linenos="False" xml:space="preserve">scope=stmf - allow_configure=true
scope=nas - allow_clone=true, allow_createProject=true, allow_createShare=true, allow_changeSpaceProps=true, allow_changeGeneralProps=true, allow_destroy=true, allow_rollback=true, allow_takeSnap=true
scope=schema - allow_modify=true</literal_block>
                    <paragraph>You can create a role with authorizations as follows:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">zfssa:&gt; configuration roles
zfssa:configuration roles&gt; role OpenStackRole
zfssa:configuration roles OpenStackRole (uncommitted)&gt; set description="OpenStack Cinder Driver"
zfssa:configuration roles OpenStackRole (uncommitted)&gt; commit
zfssa:configuration roles&gt; select OpenStackRole
zfssa:configuration roles OpenStackRole&gt; authorizations create
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set scope=stmf
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_configure=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; commit
zfssa:configuration roles OpenStackRole&gt; authorizations create
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set scope=nas
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_clone=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_createProject=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_createShare=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_changeSpaceProps=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_changeGeneralProps=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_destroy=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_rollback=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_takeSnap=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; commit</literal_block>
                    <paragraph>You can create a user with a specific role as follows:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">zfssa:&gt; configuration users
zfssa:configuration users&gt; user cinder
zfssa:configuration users cinder (uncommitted)&gt; set fullname="OpenStack Cinder Driver"
zfssa:configuration users cinder (uncommitted)&gt; set initial_password=12345
zfssa:configuration users cinder (uncommitted)&gt; commit
zfssa:configuration users&gt; select cinder set roles=OpenStackRole</literal_block>
                    <note>
                        <paragraph>You can also run this <reference name="workflow" refuri="https://openstackci.oracle.com/openstack_docs/zfssa_cinder_workflow.akwf">workflow</reference>
                            to automate the above tasks.
                            Refer to <reference name="Oracle documentation" refuri="https://docs.oracle.com/cd/E37831_01/html/E52872/godgw.html">Oracle documentation</reference>
                            on how to download, view, and execute a workflow.</paragraph>
                    </note>
                </list_item>
                <list_item>
                    <paragraph>Ensure that the ZFSSA iSCSI service is online. If the ZFSSA iSCSI service is
                        not online, enable the service by using the BUI, CLI or REST API in the
                        appliance.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">zfssa:&gt; configuration services iscsi
zfssa:configuration services iscsi&gt; enable
zfssa:configuration services iscsi&gt; show
Properties:
&lt;status&gt;= online
...</literal_block>
                    <paragraph>Define the following required properties in the <literal>cinder.conf</literal> file:</paragraph>
                    <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">volume_driver = cinder.volume.drivers.zfssa.zfssaiscsi.ZFSSAISCSIDriver
san_ip = myhost
san_login = username
san_password = password
zfssa_pool = mypool
zfssa_project = myproject
zfssa_initiator_group = default
zfssa_target_portal = w.x.y.z:3260
zfssa_target_interfaces = e1000g0</literal_block>
                    <paragraph>Optionally, you can define additional properties.</paragraph>
                    <paragraph>Target interfaces can be seen as follows in the CLI:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">zfssa:&gt; configuration net interfaces
zfssa:configuration net interfaces&gt; show
Interfaces:
INTERFACE STATE CLASS LINKS    ADDRS          LABEL
e1000g0   up    ip    e1000g0  1.10.20.30/24  Untitled Interface
...</literal_block>
                    <note>
                        <paragraph>Do not use management interfaces for <literal>zfssa_target_interfaces</literal>.</paragraph>
                    </note>
                </list_item>
                <list_item>
                    <paragraph>Configure the cluster:</paragraph>
                    <paragraph>If a cluster is used as the cinder storage resource, the following
                        verifications are required on your Oracle ZFS Storage Appliance:</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>Verify that both the pool and the network interface are of type
                                singleton and are not locked to the current controller. This
                                approach ensures that the pool and the interface used for data
                                always belong to the active controller, regardless of the current
                                state of the cluster.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Verify that the management IP, data IP and storage pool belong to
                                the same head.</paragraph>
                        </list_item>
                    </bullet_list>
                    <note>
                        <paragraph>Most configuration settings, including service properties, users, roles,
                            and iSCSI initiator definitions are replicated on both heads
                            automatically. If the driver modifies any of these settings, they will be
                            modified automatically on both heads.</paragraph>
                    </note>
                    <note>
                        <paragraph>A short service interruption occurs during failback or takeover,
                            but once the process is complete, the <literal>cinder-volume</literal> service should be able
                            to access the pool through the data IP.</paragraph>
                    </note>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="zfssa-assisted-volume-migration" names="zfssa\ assisted\ volume\ migration">
            <title>ZFSSA assisted volume migration</title>
            <paragraph>The ZFSSA iSCSI driver supports storage assisted volume migration
                starting in the Liberty release. This feature uses remote replication
                feature on the ZFSSA. Volumes can be migrated between two backends
                configured not only to the same ZFSSA but also between two separate
                ZFSSAs altogether.</paragraph>
            <paragraph>The following conditions must be met in order to use ZFSSA assisted
                volume migration:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Both the source and target backends are configured to ZFSSAs.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Remote replication service on the source and target appliance is enabled.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The ZFSSA to which the target backend is configured should be configured as a
                        target in the remote replication service of the ZFSSA configured to the
                        source backend. The remote replication target needs to be configured even
                        when the source and the destination for volume migration are the same ZFSSA.
                        Define <literal>zfssa_replication_ip</literal> in the <literal>cinder.conf</literal> file of the source
                        backend as the IP address used to register the target ZFSSA in the remote
                        replication service of the source ZFSSA.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The name of the iSCSI target group(<literal>zfssa_target_group</literal>) on the source and
                        the destination ZFSSA is the same.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The volume is not attached and is in available state.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>If any of the above conditions are not met, the driver will proceed with
                generic volume migration.</paragraph>
            <paragraph>The ZFSSA user on the source and target appliances will need to have
                additional role authorizations for assisted volume migration to work. In
                scope nas, set <literal>allow_rrtarget</literal> and <literal>allow_rrsource</literal> to <literal>true</literal>.</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set scope=nas
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_rrtarget=true
zfssa:configuration roles OpenStackRole auth (uncommitted)&gt; set allow_rrsource=true</literal_block>
        </section>
        <section ids="zfssa-local-cache" names="zfssa\ local\ cache">
            <title>ZFSSA local cache</title>
            <paragraph>The local cache feature enables ZFSSA drivers to serve the usage of bootable
                volumes significantly better. With the feature, the first bootable volume
                created from an image is cached, so that subsequent volumes can be created
                directly from the cache, instead of having image data transferred over the
                network multiple times.</paragraph>
            <paragraph>The following conditions must be met in order to use ZFSSA local cache feature:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>A storage pool needs to be configured.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>REST and iSCSI services need to be turned on.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>On an OpenStack controller, <literal>cinder.conf</literal> needs to contain necessary
                        properties used to configure and set up the ZFSSA iSCSI driver, including the
                        following new properties:</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph><literal>zfssa_enable_local_cache</literal>: (True/False) To enable/disable the feature.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph><literal>zfssa_cache_project</literal>: The ZFSSA project name where cache volumes are
                                stored.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
            <paragraph>Every cache volume has two additional properties stored as ZFSSA custom
                schema. It is important that the schema are not altered outside of Block
                Storage when the driver is in use:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><literal>image_id</literal>: stores the image id as in Image service.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>updated_at</literal>: stores the most current timestamp when the image is updated
                        in Image service.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="supported-extra-specs" names="supported\ extra\ specs">
            <title>Supported extra specs</title>
            <paragraph>Extra specs provide the OpenStack storage admin the flexibility to create
                volumes with different characteristics from the ones specified in the
                <literal>cinder.conf</literal> file. The admin will specify the volume properties as keys
                at volume type creation. When a user requests a volume of this volume type,
                the volume will be created with the properties specified as extra specs.</paragraph>
            <paragraph>The following extra specs scoped keys are supported by the driver:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><literal>zfssa:volblocksize</literal></paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>zfssa:sparse</literal></paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>zfssa:compression</literal></paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>zfssa:logbias</literal></paragraph>
                </list_item>
            </bullet_list>
            <paragraph>Volume types can be created using the <literal_strong classes="command">openstack volume type create</literal_strong>
                command.
                Extra spec keys can be added using <literal_strong classes="command">openstack volume type set</literal_strong>
                command.</paragraph>
        </section>
        <section ids="driver-options" names="driver\ options">
            <title>Driver options</title>
            <paragraph>The Oracle ZFSSA iSCSI Driver supports these options:</paragraph>
            <comment xml:space="preserve">Warning: Do not edit this file. It is automatically generated from the
software project's code and your changes will be overwritten.

The tool to generate this file lives in openstack-doc-tools repository.

Please make any changes needed in the code, then run the
autogenerate-config-doc tool from the openstack-doc-tools repository, or
ask for help on the documentation mailing list, IRC channel or meeting.</comment>
            <target refid="cinder-zfssa-iscsi"></target>
            <table classes="config-ref-table" ids="id1 cinder-zfssa-iscsi" names="cinder-zfssa-iscsi">
                <title>Description of ZFS Storage Appliance iSCSI driver configuration options</title>
                <tgroup cols="2">
                    <colspec colwidth="50"></colspec>
                    <colspec colwidth="50"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Configuration option = Default value</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph><strong>[DEFAULT]</strong></paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_initiator</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) iSCSI initiator IQNs. (comma separated)</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_initiator_config</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) iSCSI initiators configuration.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_initiator_group</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) iSCSI initiator group.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_initiator_password</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Secret of the iSCSI initiator CHAP user.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_initiator_user</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) iSCSI initiator CHAP user (name).</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_lun_compression</literal> = <literal>off</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Data compression.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_lun_logbias</literal> = <literal>latency</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Synchronous write bias.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_lun_sparse</literal> = <literal>False</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Boolean) Flag to enable sparse (thin-provisioned): True, False.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_lun_volblocksize</literal> = <literal>8k</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Block size.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_pool</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Storage pool name.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_project</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Project name.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_replication_ip</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) IP address used for replication data. (maybe the same as data ip)</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_rest_timeout</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Integer) REST connection timeout. (seconds)</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_target_group</literal> = <literal>tgt-grp</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) iSCSI target group name.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_target_interfaces</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Network interfaces of iSCSI targets. (comma separated)</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_target_password</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) Secret of the iSCSI target CHAP user.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_target_portal</literal> = <literal>None</literal></paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) iSCSI target portal (Data-IP:Port, w.x.y.z:3260).</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><literal>zfssa_target_user</literal> =</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(String) iSCSI target CHAP user (name).</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
    </section>
</document>
