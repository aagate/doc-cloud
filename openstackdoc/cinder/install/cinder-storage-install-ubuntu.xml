<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/cinder/doc/source/install/cinder-storage-install-ubuntu.rst">
    <section ids="install-and-configure-a-storage-node" names="install\ and\ configure\ a\ storage\ node">
        <title>Install and configure a storage node</title>
        <section ids="prerequisites" names="prerequisites">
            <title>Prerequisites</title>
            <paragraph>Before you install and configure the Block Storage service on the
                storage node, you must prepare the storage device.</paragraph>
            <note>
                <paragraph>Perform these steps on the storage node.</paragraph>
            </note>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Install the supporting utility packages:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># apt install lvm2 thin-provisioning-tools</literal_block>
                    <comment xml:space="preserve">end</comment>
                    <note>
                        <paragraph>Some distributions include LVM by default.</paragraph>
                    </note>
                </list_item>
                <list_item>
                    <paragraph>Create the LVM physical volume <literal>/dev/sdb</literal>:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># pvcreate /dev/sdb

Physical volume "/dev/sdb" successfully created</literal_block>
                    <comment xml:space="preserve">end</comment>
                </list_item>
                <list_item>
                    <paragraph>Create the LVM volume group <literal>cinder-volumes</literal>:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># vgcreate cinder-volumes /dev/sdb

Volume group "cinder-volumes" successfully created</literal_block>
                    <comment xml:space="preserve">end</comment>
                    <paragraph>The Block Storage service creates logical volumes in this volume group.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Only instances can access Block Storage volumes. However, the
                        underlying operating system manages the devices associated with
                        the volumes. By default, the LVM volume scanning tool scans the
                        <literal>/dev</literal> directory for block storage devices that
                        contain volumes. If projects use LVM on their volumes, the scanning
                        tool detects these volumes and attempts to cache them which can cause
                        a variety of problems with both the underlying operating system
                        and project volumes. You must reconfigure LVM to scan only the devices
                        that contain the <literal>cinder-volumes</literal> volume group. Edit the
                        <literal>/etc/lvm/lvm.conf</literal> file and complete the following actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>devices</literal> section, add a filter that accepts the
                                <literal>/dev/sdb</literal> device and rejects all other devices:</paragraph>
                            <comment xml:space="preserve">path /etc/lvm/lvm.conf</comment>
                            <literal_block highlight_args="{}" language="bash" linenos="False" xml:space="preserve">devices {
...
filter = [ "a/sdb/", "r/.*/"]</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Each item in the filter array begins with <literal>a</literal> for <strong>accept</strong> or
                                <literal>r</literal> for <strong>reject</strong> and includes a regular expression for the
                                device name. The array must end with <literal>r/.*/</literal> to reject any
                                remaining devices. You can use the <literal_strong classes="command">vgs -vvvv</literal_strong> command
                                to test filters.</paragraph>
                            <warning>
                                <paragraph>If your storage nodes use LVM on the operating system disk, you
                                    must also add the associated device to the filter. For example,
                                    if the <literal>/dev/sda</literal> device contains the operating system:</paragraph>
                                <comment xml:space="preserve">ignore_path /etc/lvm/lvm.conf</comment>
                                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">filter = [ "a/sda/", "a/sdb/", "r/.*/"]</literal_block>
                                <comment xml:space="preserve">end</comment>
                                <paragraph>Similarly, if your compute nodes use LVM on the operating
                                    system disk, you must also modify the filter in the
                                    <literal>/etc/lvm/lvm.conf</literal> file on those nodes to include only
                                    the operating system disk. For example, if the <literal>/dev/sda</literal>
                                    device contains the operating system:</paragraph>
                                <comment xml:space="preserve">path /etc/openstack-dashboard/local_settings.py</comment>
                                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">filter = [ "a/sda/", "r/.*/"]</literal_block>
                                <comment xml:space="preserve">end</comment>
                            </warning>
                        </list_item>
                    </bullet_list>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="install-and-configure-components" names="install\ and\ configure\ components">
            <title>Install and configure components</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Install the packages:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># apt install cinder-volume</literal_block>
                    <comment xml:space="preserve">end</comment>
                </list_item>
                <list_item>
                    <paragraph>Edit the <literal>/etc/cinder/cinder.conf</literal> file
                        and complete the following actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[database]</literal> section, configure database access:</paragraph>
                            <comment xml:space="preserve">path /etc/cinder/cinder.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[database]
# ...
connection = mysql+pymysql://cinder:CINDER_DBPASS@controller/cinder</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>CINDER_DBPASS</literal> with the password you chose for
                                the Block Storage database.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, configure <literal>RabbitMQ</literal>
                                message queue access:</paragraph>
                            <comment xml:space="preserve">path /etc/cinder/cinder.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
transport_url = rabbit://openstack:RABBIT_PASS@controller</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>RABBIT_PASS</literal> with the password you chose for
                                the <literal>openstack</literal> account in <literal>RabbitMQ</literal>.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> and <literal>[keystone_authtoken]</literal> sections,
                                configure Identity service access:</paragraph>
                            <comment xml:space="preserve">path /etc/cinder/cinder.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
auth_strategy = keystone

[keystone_authtoken]
# ...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = cinder
password = CINDER_PASS</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>CINDER_PASS</literal> with the password you chose for the
                                <literal>cinder</literal> user in the Identity service.</paragraph>
                            <note>
                                <paragraph>Comment out or remove any other options in the
                                    <literal>[keystone_authtoken]</literal> section.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, configure the <literal>my_ip</literal> option:</paragraph>
                            <comment xml:space="preserve">path /etc/cinder/cinder.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
my_ip = MANAGEMENT_INTERFACE_IP_ADDRESS</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>MANAGEMENT_INTERFACE_IP_ADDRESS</literal> with the IP address
                                of the management network interface on your storage node,
                                typically 10.0.0.41 for the first node in the
                                <reference internal="True" refuri="overview#overview-example-architectures"><inline classes="std std-ref">example architecture</inline></reference>.</paragraph>
                        </list_item>
                    </bullet_list>
                    <block_quote>
                        <bullet_list bullet="*">
                            <list_item>
                                <paragraph>In the <literal>[lvm]</literal> section, configure the LVM back end with the
                                    LVM driver, <literal>cinder-volumes</literal> volume group, iSCSI protocol,
                                    and appropriate iSCSI service:</paragraph>
                                <comment xml:space="preserve">path /etc/cinder/cinder.conf</comment>
                                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[lvm]
# ...
volume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver
volume_group = cinder-volumes
iscsi_protocol = iscsi
iscsi_helper = tgtadm</literal_block>
                                <comment xml:space="preserve">end</comment>
                            </list_item>
                        </bullet_list>
                    </block_quote>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, enable the LVM back end:</paragraph>
                            <comment xml:space="preserve">path /etc/cinder/cinder.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
enabled_backends = lvm</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <note>
                                <paragraph>Back-end names are arbitrary. As an example, this guide
                                    uses the name of the driver as the name of the back end.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, configure the location of the
                                Image service API:</paragraph>
                            <comment xml:space="preserve">path /etc/cinder/cinder.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
glance_api_servers = http://controller:9292</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[oslo_concurrency]</literal> section, configure the lock path:</paragraph>
                            <comment xml:space="preserve">path /etc/cinder/cinder.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[oslo_concurrency]
# ...
lock_path = /var/lib/cinder/tmp</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                    </bullet_list>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="finalize-installation" names="finalize\ installation">
            <title>Finalize installation</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Restart the Block Storage volume service including its dependencies:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># service tgt restart
# service cinder-volume restart</literal_block>
                    <comment xml:space="preserve">end</comment>
                </list_item>
            </enumerated_list>
        </section>
    </section>
</document>
