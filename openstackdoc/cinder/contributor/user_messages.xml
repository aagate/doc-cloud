<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/cinder/doc/source/contributor/user_messages.rst">
    <section ids="user-messages" names="user\ messages">
        <title>User Messages</title>
        <paragraph>User messages are a way to inform users about the state of asynchronous
            operations. One example would be notifying the user of why a volume
            provisioning request failed. These messages can be requested via the
            /messages API. All user visible messages must be defined in the permitted
            messages module in order to prevent sharing sensitive information with users.</paragraph>
        <paragraph>Example message generation:</paragraph>
        <literal_block xml:space="preserve">from cinder import context
from cinder.message import api as message_api
from cinder.message import defined_messages
from cinder.message import resource_types

self.message_api = message_api.API()

context = context.RequestContext()
project_id = '6c430ede-9476-4128-8838-8d3929ced223'
volume_id = 'f292cc0c-54a7-4b3b-8174-d2ff82d87008'

self.message_api.create(
    context,
    defined_messages.EventIds.UNABLE_TO_ALLOCATE,
    project_id,
    resource_type=resource_types.VOLUME,
    resource_uuid=volume_id)</literal_block>
        <paragraph>Will produce the following:</paragraph>
        <literal_block xml:space="preserve">GET /v3/6c430ede-9476-4128-8838-8d3929ced223/messages
{
  "messages": [
    {
     "id": "5429fffa-5c76-4d68-a671-37a8e24f37cf",
     "event_id": "000002",
     "user_message": "No storage could be allocated for this volume request.",
     "message_level": "ERROR",
     "resource_type": "VOLUME",
     "resource_uuid": "f292cc0c-54a7-4b3b-8174-d2ff82d87008",
     "created_at": 2015-08-27T09:49:58-05:00,
     "guaranteed_until": 2015-09-27T09:49:58-05:00,
     "request_id": "req-936666d2-4c8f-4e41-9ac9-237b43f8b848",
    }
  ]
}</literal_block>
        <section ids="the-message-api-module" names="the\ message\ api\ module">
            <title>The Message API Module</title>
            <paragraph>Handles all requests related to user facing messages.</paragraph>
            <index entries=""></index>
            <desc desctype="class" domain="py" noindex="True" objtype="class">
                <desc_signature class="" first="False" fullname="API" module="cinder.message.api"><desc_annotation xml:space="preserve">class </desc_annotation><desc_name xml:space="preserve">API</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">db_driver=None</desc_parameter></desc_parameterlist></desc_signature>
                <desc_content>
                    <paragraph>API for handling user messages.</paragraph>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="API" first="False" fullname="API.cleanup_expired_messages" module="cinder.message.api"><desc_name xml:space="preserve">cleanup_expired_messages</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">context</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="API" first="False" fullname="API.create" module="cinder.message.api"><desc_name xml:space="preserve">create</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">context</desc_parameter><desc_parameter xml:space="preserve">action</desc_parameter><desc_parameter xml:space="preserve">resource_type='VOLUME'</desc_parameter><desc_parameter xml:space="preserve">resource_uuid=None</desc_parameter><desc_parameter xml:space="preserve">exception=None</desc_parameter><desc_parameter xml:space="preserve">detail=None</desc_parameter><desc_parameter xml:space="preserve">level='ERROR'</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                            <paragraph>Create a message with the specified information.</paragraph>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="API" first="False" fullname="API.delete" module="cinder.message.api"><desc_name xml:space="preserve">delete</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">context</desc_parameter><desc_parameter xml:space="preserve">id</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                            <paragraph>Delete message with the specified id.</paragraph>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="API" first="False" fullname="API.get" module="cinder.message.api"><desc_name xml:space="preserve">get</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">context</desc_parameter><desc_parameter xml:space="preserve">id</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                            <paragraph>Return message with the specified id.</paragraph>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="method" domain="py" noindex="True" objtype="method">
                        <desc_signature class="API" first="False" fullname="API.get_all" module="cinder.message.api"><desc_name xml:space="preserve">get_all</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">context</desc_parameter><desc_parameter xml:space="preserve">filters=None</desc_parameter><desc_parameter xml:space="preserve">marker=None</desc_parameter><desc_parameter xml:space="preserve">limit=None</desc_parameter><desc_parameter xml:space="preserve">offset=None</desc_parameter><desc_parameter xml:space="preserve">sort_keys=None</desc_parameter><desc_parameter xml:space="preserve">sort_dirs=None</desc_parameter></desc_parameterlist></desc_signature>
                        <desc_content>
                            <paragraph>Return all messages for the given context.</paragraph>
                        </desc_content>
                    </desc>
                </desc_content>
            </desc>
        </section>
        <section ids="the-message-field-module" names="the\ message\ field\ module">
            <title>The Message Field Module</title>
            <paragraph>Message Resource, Action, Detail and user visible message.</paragraph>
            <paragraph>Use Resource, Action and Detail’s combination to indicate the Event
                in the format of:</paragraph>
            <paragraph>EVENT: VOLUME_RESOURCE_ACTION_DETAIL</paragraph>
            <paragraph>Also, use exception-to-detail mapping to decrease the workload of
                classifying event in cinder’s task code.</paragraph>
        </section>
        <section ids="the-permitted-messages-module" names="the\ permitted\ messages\ module">
            <title>The Permitted Messages Module</title>
            <paragraph>Event ID and user visible message mapping.</paragraph>
            <paragraph>Event IDs are used to look up the message to be displayed for an API Message
                object. All defined messages should be appropriate for any API user to see
                and not contain any sensitive information. A good rule-of-thumb is to be very
                general in error messages unless the issue is due to a bad user action, then be
                specific.</paragraph>
            <index entries=""></index>
            <desc desctype="class" domain="py" noindex="True" objtype="class">
                <desc_signature class="" first="False" fullname="EventIds" module="cinder.message.defined_messages"><desc_annotation xml:space="preserve">class </desc_annotation><desc_name xml:space="preserve">EventIds</desc_name></desc_signature>
                <desc_content>
                    <paragraph>Bases: <literal classes="xref py py-class">object</literal></paragraph>
                    <index entries=""></index>
                    <desc desctype="attribute" domain="py" noindex="True" objtype="attribute">
                        <desc_signature class="EventIds" first="False" fullname="EventIds.ATTACH_READONLY_VOLUME" module="cinder.message.defined_messages"><desc_name xml:space="preserve">ATTACH_READONLY_VOLUME</desc_name><desc_annotation xml:space="preserve"> = 'VOLUME_000003'</desc_annotation></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="attribute" domain="py" noindex="True" objtype="attribute">
                        <desc_signature class="EventIds" first="False" fullname="EventIds.IMAGE_FROM_VOLUME_OVER_QUOTA" module="cinder.message.defined_messages"><desc_name xml:space="preserve">IMAGE_FROM_VOLUME_OVER_QUOTA</desc_name><desc_annotation xml:space="preserve"> = 'VOLUME_000004'</desc_annotation></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="attribute" domain="py" noindex="True" objtype="attribute">
                        <desc_signature class="EventIds" first="False" fullname="EventIds.UNABLE_TO_ALLOCATE" module="cinder.message.defined_messages"><desc_name xml:space="preserve">UNABLE_TO_ALLOCATE</desc_name><desc_annotation xml:space="preserve"> = 'VOLUME_000002'</desc_annotation></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="attribute" domain="py" noindex="True" objtype="attribute">
                        <desc_signature class="EventIds" first="False" fullname="EventIds.UNKNOWN_ERROR" module="cinder.message.defined_messages"><desc_name xml:space="preserve">UNKNOWN_ERROR</desc_name><desc_annotation xml:space="preserve"> = 'VOLUME_000001'</desc_annotation></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                    <index entries=""></index>
                    <desc desctype="attribute" domain="py" noindex="True" objtype="attribute">
                        <desc_signature class="EventIds" first="False" fullname="EventIds.UNMANAGE_ENCRYPTED_VOLUME_UNSUPPORTED" module="cinder.message.defined_messages"><desc_name xml:space="preserve">UNMANAGE_ENCRYPTED_VOLUME_UNSUPPORTED</desc_name><desc_annotation xml:space="preserve"> = 'VOLUME_000005'</desc_annotation></desc_signature>
                        <desc_content>
                        </desc_content>
                    </desc>
                </desc_content>
            </desc>
            <index entries=""></index>
            <desc desctype="function" domain="py" noindex="True" objtype="function">
                <desc_signature class="" first="False" fullname="get_message_text" module="cinder.message.defined_messages"><desc_name xml:space="preserve">get_message_text</desc_name><desc_parameterlist xml:space="preserve"><desc_parameter xml:space="preserve">event_id</desc_parameter></desc_parameterlist></desc_signature>
                <desc_content>
                </desc_content>
            </desc>
        </section>
    </section>
</document>
