<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/cinder/doc/source/admin/blockstorage-volume-backed-image.rst">
    <target refid="volume-backed-image"></target>
    <section ids="volume-backed-image id1" names="volume-backed\ image volume_backed_image">
        <title>Volume-backed image</title>
        <paragraph>OpenStack Block Storage can quickly create a volume from an image that refers
            to a volume storing image data (Image-Volume). Compared to the other stores
            such as file and swift, creating a volume from a Volume-backed image performs
            better when the block storage driver supports efficient volume cloning.</paragraph>
        <paragraph>If the image is set to public in the Image service, the volume data can be
            shared among projects.</paragraph>
        <section ids="configure-the-volume-backed-image" names="configure\ the\ volume-backed\ image">
            <title>Configure the Volume-backed image</title>
            <paragraph>Volume-backed image feature requires locations information from the cinder
                store of the Image service. To enable the Image service to use the cinder
                store, add <literal>cinder</literal> to the <literal>stores</literal> option in the <literal>glance_store</literal> section
                of the <literal>glance-api.conf</literal> file:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">stores = file, http, swift, cinder</literal_block>
            <paragraph>To expose locations information, set the following options in the <literal>DEFAULT</literal>
                section of the <literal>glance-api.conf</literal> file:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">show_multiple_locations = True</literal_block>
            <paragraph>To enable the Block Storage services to create a new volume by cloning Image-
                Volume, set the following options in the <literal>DEFAULT</literal> section of the
                <literal>cinder.conf</literal> file. For example:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">glance_api_version = 2
allowed_direct_url_schemes = cinder</literal_block>
            <paragraph>To enable the <literal_strong classes="command">openstack image create --volume &lt;volume&gt;</literal_strong> command to
                create an image that refers an <literal>Image-Volume</literal>, set the following options in
                each back-end section of the <literal>cinder.conf</literal> file:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">image_upload_use_cinder_backend = True</literal_block>
            <paragraph>By default, the <literal_strong classes="command">openstack image create --volume &lt;volume&gt;</literal_strong> command
                creates the Image-Volume in the current project. To store the Image-Volume into
                the internal project, set the following options in each back-end section of the
                <literal>cinder.conf</literal> file:</paragraph>
            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">image_upload_use_internal_tenant = True</literal_block>
            <paragraph>To make the Image-Volume in the internal project accessible from the Image
                service, set the following options in the <literal>glance_store</literal> section of
                the <literal>glance-api.conf</literal> file:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><literal>cinder_store_auth_address</literal></paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>cinder_store_user_name</literal></paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>cinder_store_password</literal></paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>cinder_store_project_name</literal></paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="creating-a-volume-backed-image" names="creating\ a\ volume-backed\ image">
            <title>Creating a Volume-backed image</title>
            <paragraph>To register an existing volume as a new Volume-backed image, use the following
                commands:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack image create --disk-format raw --container-format bare IMAGE_NAME

$ glance location-add &lt;image-uuid&gt; --url cinder://&lt;volume-uuid&gt;</literal_block>
            <paragraph>If the <literal>image_upload_use_cinder_backend</literal> option is enabled, the following
                command creates a new Image-Volume by cloning the specified volume and then
                registers its location to a new image. The disk format and the container format
                must be raw and bare (default). Otherwise, the image is uploaded to the default
                store of the Image service.</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack image create --volume SOURCE_VOLUME IMAGE_NAME</literal_block>
        </section>
    </section>
</document>
