<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/cinder/doc/source/admin/blockstorage-nfs-backend.rst">
    <section ids="configure-an-nfs-storage-back-end" names="configure\ an\ nfs\ storage\ back\ end">
        <title>Configure an NFS storage back end</title>
        <paragraph>This section explains how to configure OpenStack Block Storage to use
            NFS storage. You must be able to access the NFS shares from the server
            that hosts the <literal>cinder</literal> volume service.</paragraph>
        <note>
            <paragraph>The <literal>cinder</literal> volume service is named <literal>openstack-cinder-volume</literal>
                on the following distributions:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>CentOS</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Fedora</paragraph>
                </list_item>
                <list_item>
                    <paragraph>openSUSE</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Red Hat Enterprise Linux</paragraph>
                </list_item>
                <list_item>
                    <paragraph>SUSE Linux Enterprise</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>In Ubuntu and Debian distributions, the <literal>cinder</literal> volume service is
                named <literal>cinder-volume</literal>.</paragraph>
        </note>
        <paragraph><strong>Configure Block Storage to use an NFS storage back end</strong></paragraph>
        <enumerated_list enumtype="arabic" prefix="" suffix=".">
            <list_item>
                <paragraph>Log in as <literal>root</literal> to the system hosting the <literal>cinder</literal> volume
                    service.</paragraph>
            </list_item>
            <list_item>
                <paragraph>Create a text file named <literal>nfsshares</literal> in the <literal>/etc/cinder/</literal> directory.</paragraph>
            </list_item>
            <list_item>
                <paragraph>Add an entry to <literal>/etc/cinder/nfsshares</literal> for each NFS share
                    that the <literal>cinder</literal> volume service should use for back end storage.
                    Each entry should be a separate line, and should use the following
                    format:</paragraph>
                <literal_block highlight_args="{}" language="bash" linenos="False" xml:space="preserve">HOST:SHARE</literal_block>
                <paragraph>Where:</paragraph>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph>HOST is the IP address or host name of the NFS server.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>SHARE is the absolute path to an existing and accessible NFS share.</paragraph>
                    </list_item>
                </bullet_list>
                <line_block>
                    <line></line>
                </line_block>
            </list_item>
            <list_item>
                <paragraph>Set <literal>/etc/cinder/nfsshares</literal> to be owned by the <literal>root</literal> user and
                    the <literal>cinder</literal> group:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># chown root:cinder /etc/cinder/nfsshares</literal_block>
            </list_item>
            <list_item>
                <paragraph>Set <literal>/etc/cinder/nfsshares</literal> to be readable by members of the
                    cinder group:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># chmod 0640 /etc/cinder/nfsshares</literal_block>
            </list_item>
            <list_item>
                <paragraph>Configure the <literal>cinder</literal> volume service to use the
                    <literal>/etc/cinder/nfsshares</literal> file created earlier. To do so, open
                    the <literal>/etc/cinder/cinder.conf</literal> configuration file and set
                    the <literal>nfs_shares_config</literal> configuration key
                    to <literal>/etc/cinder/nfsshares</literal>.</paragraph>
                <paragraph>On distributions that include <literal>openstack-config</literal>, you can configure
                    this by running the following command instead:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># openstack-config --set /etc/cinder/cinder.conf \
  DEFAULT nfs_shares_config /etc/cinder/nfsshares</literal_block>
                <paragraph>The following distributions include openstack-config:</paragraph>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph>CentOS</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Fedora</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>openSUSE</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Red Hat Enterprise Linux</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>SUSE Linux Enterprise</paragraph>
                    </list_item>
                </bullet_list>
            </list_item>
            <list_item>
                <paragraph>Optionally, provide any additional NFS mount options required in
                    your environment in the <literal>nfs_mount_options</literal> configuration key
                    of <literal>/etc/cinder/cinder.conf</literal>. If your NFS shares do not
                    require any additional mount options (or if you are unsure),
                    skip this step.</paragraph>
                <paragraph>On distributions that include <literal>openstack-config</literal>, you can
                    configure this by running the following command instead:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># openstack-config --set /etc/cinder/cinder.conf \
  DEFAULT nfs_mount_options OPTIONS</literal_block>
                <paragraph>Replace OPTIONS with the mount options to be used when accessing
                    NFS shares. See the manual page for NFS for more information on
                    available mount options (<literal_strong classes="command">man nfs</literal_strong>).</paragraph>
            </list_item>
            <list_item>
                <paragraph>Configure the <literal>cinder</literal> volume service to use the correct volume
                    driver, namely <literal>cinder.volume.drivers.nfs.NfsDriver</literal>. To do so,
                    open the <literal>/etc/cinder/cinder.conf</literal> configuration file and
                    set the volume_driver configuration key
                    to <literal>cinder.volume.drivers.nfs.NfsDriver</literal>.</paragraph>
                <paragraph>On distributions that include <literal>openstack-config</literal>, you can configure
                    this by running the following command instead:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># openstack-config --set /etc/cinder/cinder.conf \
  DEFAULT volume_driver cinder.volume.drivers.nfs.NfsDriver</literal_block>
            </list_item>
            <list_item>
                <paragraph>You can now restart the service to apply the configuration.</paragraph>
                <note>
                    <paragraph>The <literal>nfs_sparsed_volumes</literal> configuration key determines whether
                        volumes are created as sparse files and grown as needed or fully
                        allocated up front. The default and recommended value is <literal>true</literal>,
                        which ensures volumes are initially created as sparse files.</paragraph>
                    <paragraph>Setting <literal>nfs_sparsed_volumes</literal> to <literal>false</literal> will result in
                        volumes being fully allocated at the time of creation. This leads
                        to increased delays in volume creation.</paragraph>
                    <paragraph>However, should you choose to set <literal>nfs_sparsed_volumes</literal> to
                        <literal>false</literal>, you can do so directly in <literal>/etc/cinder/cinder.conf</literal>.</paragraph>
                    <paragraph>On distributions that include <literal>openstack-config</literal>, you can
                        configure this by running the following command instead:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># openstack-config --set /etc/cinder/cinder.conf \
  DEFAULT nfs_sparsed_volumes false</literal_block>
                </note>
                <warning>
                    <paragraph>If a client host has SELinux enabled, the <literal>virt_use_nfs</literal>
                        boolean should also be enabled if the host requires access to
                        NFS volumes on an instance. To enable this boolean, run the
                        following command as the <literal>root</literal> user:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># setsebool -P virt_use_nfs on</literal_block>
                    <paragraph>This command also makes the boolean persistent across reboots.
                        Run this command on all client hosts that require access to NFS
                        volumes on an instance. This includes all compute nodes.</paragraph>
                </warning>
            </list_item>
        </enumerated_list>
    </section>
</document>
