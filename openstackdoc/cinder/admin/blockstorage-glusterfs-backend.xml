<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/cinder/doc/source/admin/blockstorage-glusterfs-backend.rst">
    <section ids="configure-a-glusterfs-back-end" names="configure\ a\ glusterfs\ back\ end">
        <title>Configure a GlusterFS back end</title>
        <paragraph>This section explains how to configure OpenStack Block Storage to use
            GlusterFS as a back end. You must be able to access the GlusterFS shares
            from the server that hosts the <literal>cinder</literal> volume service.</paragraph>
        <note>
            <paragraph>The GlusterFS volume driver, which was deprecated in the Newton release,
                has been removed in the Ocata release.</paragraph>
        </note>
        <note>
            <paragraph>The cinder volume service is named <literal>openstack-cinder-volume</literal> on the
                following distributions:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>CentOS</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Fedora</paragraph>
                </list_item>
                <list_item>
                    <paragraph>openSUSE</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Red Hat Enterprise Linux</paragraph>
                </list_item>
                <list_item>
                    <paragraph>SUSE Linux Enterprise</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>In Ubuntu and Debian distributions, the <literal>cinder</literal> volume service is
                named <literal>cinder-volume</literal>.</paragraph>
        </note>
        <paragraph>Mounting GlusterFS volumes requires utilities and libraries from the
            <literal>glusterfs-fuse</literal> package. This package must be installed on all systems
            that will access volumes backed by GlusterFS.</paragraph>
        <note>
            <paragraph>The utilities and libraries required for mounting GlusterFS volumes on
                Ubuntu and Debian distributions are available from the <literal>glusterfs-client</literal>
                package instead.</paragraph>
        </note>
        <paragraph>For information on how to install and configure GlusterFS, refer to the
            <reference name="GlusterFS Documentation" refuri="https://gluster.readthedocs.io/en/latest/">GlusterFS Documentation</reference> page.</paragraph>
        <paragraph><strong>Configure GlusterFS for OpenStack Block Storage</strong></paragraph>
        <paragraph>The GlusterFS server must also be configured accordingly in order to allow
            OpenStack Block Storage to use GlusterFS shares:</paragraph>
        <enumerated_list enumtype="arabic" prefix="" suffix=".">
            <list_item>
                <paragraph>Log in as <literal>root</literal> to the GlusterFS server.</paragraph>
            </list_item>
            <list_item>
                <paragraph>Set each Gluster volume to use the same UID and GID as the <literal>cinder</literal> user:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># gluster volume set VOL_NAME storage.owner-uid CINDER_UID
# gluster volume set VOL_NAME storage.owner-gid CINDER_GID</literal_block>
                <paragraph>Where:</paragraph>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph>VOL_NAME is the Gluster volume name.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>CINDER_UID is the UID of the <literal>cinder</literal> user.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>CINDER_GID is the GID of the <literal>cinder</literal> user.</paragraph>
                    </list_item>
                </bullet_list>
                <note>
                    <paragraph>The default UID and GID of the <literal>cinder</literal> user is 165 on
                        most distributions.</paragraph>
                </note>
            </list_item>
            <list_item>
                <paragraph>Configure each Gluster volume to accept <literal>libgfapi</literal> connections.
                    To do this, set each Gluster volume to allow insecure ports:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># gluster volume set VOL_NAME server.allow-insecure on</literal_block>
            </list_item>
            <list_item>
                <paragraph>Enable client connections from unprivileged ports. To do this,
                    add the following line to <literal>/etc/glusterfs/glusterd.vol</literal>:</paragraph>
                <literal_block highlight_args="{}" language="bash" linenos="False" xml:space="preserve">option rpc-auth-allow-insecure on</literal_block>
            </list_item>
            <list_item>
                <paragraph>Restart the <literal>glusterd</literal> service:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># service glusterd restart</literal_block>
            </list_item>
        </enumerated_list>
        <paragraph><strong>Configure Block Storage to use a GlusterFS back end</strong></paragraph>
        <paragraph>After you configure the GlusterFS service, complete these steps:</paragraph>
        <enumerated_list enumtype="arabic" prefix="" suffix=".">
            <list_item>
                <paragraph>Log in as <literal>root</literal> to the system hosting the Block Storage service.</paragraph>
            </list_item>
            <list_item>
                <paragraph>Create a text file named <literal>glusterfs</literal> in <literal>/etc/cinder/</literal> directory.</paragraph>
            </list_item>
            <list_item>
                <paragraph>Add an entry to <literal>/etc/cinder/glusterfs</literal> for each GlusterFS
                    share that OpenStack Block Storage should use for back end storage.
                    Each entry should be a separate line, and should use the following
                    format:</paragraph>
                <literal_block highlight_args="{}" language="bash" linenos="False" xml:space="preserve">HOST:/VOL_NAME</literal_block>
                <paragraph>Where:</paragraph>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph>HOST is the IP address or host name of the Red Hat Storage server.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>VOL_NAME is the name of an existing and accessible volume on the
                            GlusterFS server.</paragraph>
                    </list_item>
                </bullet_list>
                <line_block>
                    <line></line>
                </line_block>
                <paragraph>Optionally, if your environment requires additional mount options for
                    a share, you can add them to the shareâ€™s entry:</paragraph>
                <literal_block highlight_args="{}" language="yaml" linenos="False" xml:space="preserve">HOST:/VOL_NAME -o OPTIONS</literal_block>
                <paragraph>Replace OPTIONS with a comma-separated list of mount options.</paragraph>
            </list_item>
            <list_item>
                <paragraph>Set <literal>/etc/cinder/glusterfs</literal> to be owned by the root user
                    and the <literal>cinder</literal> group:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># chown root:cinder /etc/cinder/glusterfs</literal_block>
            </list_item>
            <list_item>
                <paragraph>Set <literal>/etc/cinder/glusterfs</literal> to be readable by members of
                    the <literal>cinder</literal> group:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># chmod 0640 /etc/cinder/glusterfs</literal_block>
            </list_item>
            <list_item>
                <paragraph>Configure OpenStack Block Storage to use the <literal>/etc/cinder/glusterfs</literal>
                    file created earlier. To do so, open the <literal>/etc/cinder/cinder.conf</literal>
                    configuration file and set the <literal>glusterfs_shares_config</literal> configuration
                    key to <literal>/etc/cinder/glusterfs</literal>.</paragraph>
                <paragraph>On distributions that include openstack-config, you can configure this
                    by running the following command instead:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># openstack-config --set /etc/cinder/cinder.conf \
  DEFAULT glusterfs_shares_config /etc/cinder/glusterfs</literal_block>
                <paragraph>The following distributions include <literal>openstack-config</literal>:</paragraph>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph>CentOS</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Fedora</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>openSUSE</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Red Hat Enterprise Linux</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>SUSE Linux Enterprise</paragraph>
                    </list_item>
                </bullet_list>
                <line_block>
                    <line></line>
                </line_block>
            </list_item>
            <list_item>
                <paragraph>Configure OpenStack Block Storage to use the correct volume driver,
                    namely <literal>cinder.volume.drivers.glusterfs.GlusterfsDriver</literal>. To do so,
                    open the <literal>/etc/cinder/cinder.conf</literal> configuration file and set
                    the <literal>volume_driver</literal> configuration key to
                    <literal>cinder.volume.drivers.glusterfs.GlusterfsDriver</literal>.</paragraph>
                <paragraph>On distributions that include <literal>openstack-config</literal>, you can configure
                    this by running the following command instead:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># openstack-config --set /etc/cinder/cinder.conf \
  DEFAULT volume_driver cinder.volume.drivers.glusterfs.GlusterfsDriver</literal_block>
            </list_item>
            <list_item>
                <paragraph>You can now restart the service to apply the configuration.</paragraph>
            </list_item>
        </enumerated_list>
        <paragraph>OpenStack Block Storage is now configured to use a GlusterFS back end.</paragraph>
        <warning>
            <paragraph>If a client host has SELinux enabled, the <literal>virt_use_fusefs</literal> boolean
                should also be enabled if the host requires access to GlusterFS volumes
                on an instance. To enable this Boolean, run the following command as
                the <literal>root</literal> user:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># setsebool -P virt_use_fusefs on</literal_block>
            <paragraph>This command also makes the Boolean persistent across reboots. Run
                this command on all client hosts that require access to GlusterFS
                volumes on an instance. This includes all compute nodes.</paragraph>
        </warning>
        <comment xml:space="preserve">Links</comment>
        <target ids="glusterfs-documentation" names="glusterfs\ documentation" refuri="https://gluster.readthedocs.io/en/latest/"></target>
    </section>
</document>
