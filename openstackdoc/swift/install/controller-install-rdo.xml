<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.14 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/swift/doc/source/install/controller-install-rdo.rst">
    <target refid="controller-rdo"></target>
    <section ids="install-and-configure-the-controller-node-for-red-hat-enterprise-linux-and-centos controller-rdo" names="install\ and\ configure\ the\ controller\ node\ for\ red\ hat\ enterprise\ linux\ and\ centos controller-rdo">
        <title>Install and configure the controller node for Red Hat Enterprise Linux and CentOS</title>
        <paragraph>This section describes how to install and configure the proxy service that
            handles requests for the account, container, and object services operating
            on the storage nodes. For simplicity, this guide installs and configures
            the proxy service on the controller node. However, you can run the proxy
            service on any node with network connectivity to the storage nodes.
            Additionally, you can install and configure the proxy service on multiple
            nodes to increase performance and redundancy. For more information, see the
            <reference name="Deployment Guide" refuri="http://docs.openstack.org/developer/swift/deployment_guide.html">Deployment Guide</reference>.</paragraph>
        <paragraph>This section applies to Red Hat Enterprise Linux 7 and CentOS 7.</paragraph>
        <section ids="prerequisites" names="prerequisites">
            <title>Prerequisites</title>
            <paragraph>The proxy service relies on an authentication and authorization mechanism such
                as the Identity service. However, unlike other services, it also offers an
                internal mechanism that allows it to operate without any other OpenStack
                services. Before you configure the Object Storage service, you must
                create service credentials and an API endpoint.</paragraph>
            <note>
                <paragraph>The Object Storage service does not use an SQL database on the controller
                    node. Instead, it uses distributed SQLite databases on each storage node.</paragraph>
            </note>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Source the <literal>admin</literal> credentials to gain access to admin-only CLI commands:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ . admin-openrc</literal_block>
                </list_item>
                <list_item>
                    <paragraph>To create the Identity service credentials, complete these steps:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>Create the <literal>swift</literal> user:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack user create --domain default --password-prompt swift
User Password:
Repeat User Password:
+-----------+----------------------------------+
| Field     | Value                            |
+-----------+----------------------------------+
| domain_id | default                          |
| enabled   | True                             |
| id        | d535e5cbd2b74ac7bfb97db9cced3ed6 |
| name      | swift                            |
+-----------+----------------------------------+</literal_block>
                        </list_item>
                        <list_item>
                            <paragraph>Add the <literal>admin</literal> role to the <literal>swift</literal> user:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack role add --project service --user swift admin</literal_block>
                            <note>
                                <paragraph>This command provides no output.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>Create the <literal>swift</literal> service entity:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack service create --name swift \
  --description "OpenStack Object Storage" object-store
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | OpenStack Object Storage         |
| enabled     | True                             |
| id          | 75ef509da2c340499d454ae96a2c5c34 |
| name        | swift                            |
| type        | object-store                     |
+-------------+----------------------------------+</literal_block>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Create the Object Storage service API endpoints:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack endpoint create --region RegionOne \
  object-store public http://controller:8080/v1/AUTH_%\(project_id\)s
+--------------+----------------------------------------------+
| Field        | Value                                        |
+--------------+----------------------------------------------+
| enabled      | True                                         |
| id           | 12bfd36f26694c97813f665707114e0d             |
| interface    | public                                       |
| region       | RegionOne                                    |
| region_id    | RegionOne                                    |
| service_id   | 75ef509da2c340499d454ae96a2c5c34             |
| service_name | swift                                        |
| service_type | object-store                                 |
| url          | http://controller:8080/v1/AUTH_%(project_id)s |
+--------------+----------------------------------------------+

$ openstack endpoint create --region RegionOne \
  object-store internal http://controller:8080/v1/AUTH_%\(project_id\)s
+--------------+----------------------------------------------+
| Field        | Value                                        |
+--------------+----------------------------------------------+
| enabled      | True                                         |
| id           | 7a36bee6733a4b5590d74d3080ee6789             |
| interface    | internal                                     |
| region       | RegionOne                                    |
| region_id    | RegionOne                                    |
| service_id   | 75ef509da2c340499d454ae96a2c5c34             |
| service_name | swift                                        |
| service_type | object-store                                 |
| url          | http://controller:8080/v1/AUTH_%(project_id)s |
+--------------+----------------------------------------------+

$ openstack endpoint create --region RegionOne \
  object-store admin http://controller:8080/v1
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | ebb72cd6851d4defabc0b9d71cdca69b |
| interface    | admin                            |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 75ef509da2c340499d454ae96a2c5c34 |
| service_name | swift                            |
| service_type | object-store                     |
| url          | http://controller:8080/v1        |
+--------------+----------------------------------+</literal_block>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="install-and-configure-components" names="install\ and\ configure\ components">
            <title>Install and configure components</title>
            <note>
                <paragraph>Default configuration files vary by distribution. You might need
                    to add these sections and options rather than modifying existing
                    sections and options. Also, an ellipsis (<literal>...</literal>) in the configuration
                    snippets indicates potential default configuration options that you
                    should retain.</paragraph>
            </note>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Install the packages:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># yum install openstack-swift-proxy python-swiftclient \
  python-keystoneclient python-keystonemiddleware \
  memcached</literal_block>
                    <note>
                        <paragraph>Complete OpenStack environments already include some of these
                            packages.</paragraph>
                    </note>
                    <enumerated_list enumtype="arabic" prefix="" start="2" suffix=".">
                        <list_item>
                            <paragraph>Obtain the proxy service configuration file from the Object Storage
                                source repository:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># curl -o /etc/swift/proxy-server.conf https://git.openstack.org/cgit/openstack/swift/plain/etc/proxy-server.conf-sample?h=stable/pike</literal_block>
                        </list_item>
                        <list_item>
                            <paragraph>Edit the <literal>/etc/swift/proxy-server.conf</literal> file and complete the
                                following actions:</paragraph>
                            <bullet_list bullet="*">
                                <list_item>
                                    <paragraph>In the <literal>[DEFAULT]</literal> section, configure the bind port, user, and
                                        configuration directory:</paragraph>
                                    <literal_block highlight_args="{}" language="none" linenos="False" xml:space="preserve">[DEFAULT]
...
bind_port = 8080
user = swift
swift_dir = /etc/swift</literal_block>
                                </list_item>
                                <list_item>
                                    <paragraph>In the <literal>[pipeline:main]</literal> section, remove the <literal>tempurl</literal> and
                                        <literal>tempauth</literal> modules and add the <literal>authtoken</literal> and <literal>keystoneauth</literal>
                                        modules:</paragraph>
                                    <literal_block highlight_args="{}" language="none" linenos="False" xml:space="preserve">[pipeline:main]
pipeline = catch_errors gatekeeper healthcheck proxy-logging cache container_sync bulk ratelimit authtoken keystoneauth container-quotas account-quotas slo dlo versioned_writes proxy-logging proxy-server</literal_block>
                                    <note>
                                        <paragraph>Do not change the order of the modules.</paragraph>
                                    </note>
                                    <note>
                                        <paragraph>For more information on other modules that enable additional features,
                                            see the <reference name="Deployment Guide" refuri="http://docs.openstack.org/developer/swift/deployment_guide.html">Deployment Guide</reference>.</paragraph>
                                    </note>
                                </list_item>
                                <list_item>
                                    <paragraph>In the <literal>[app:proxy-server]</literal> section, enable automatic account creation:</paragraph>
                                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">[app:proxy-server]
use = egg:swift#proxy
...
account_autocreate = True</literal_block>
                                </list_item>
                                <list_item>
                                    <paragraph>In the <literal>[filter:keystoneauth]</literal> section, configure the operator roles:</paragraph>
                                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">[filter:keystoneauth]
use = egg:swift#keystoneauth
...
operator_roles = admin,user</literal_block>
                                </list_item>
                                <list_item>
                                    <paragraph>In the <literal>[filter:authtoken]</literal> section, configure Identity service access:</paragraph>
                                    <literal_block highlight_args="{}" language="none" linenos="False" xml:space="preserve">[filter:authtoken]
paste.filter_factory = keystonemiddleware.auth_token:filter_factory
...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_id = default
user_domain_id = default
project_name = service
username = swift
password = SWIFT_PASS
delay_auth_decision = True</literal_block>
                                    <paragraph>Replace <literal>SWIFT_PASS</literal> with the password you chose for the <literal>swift</literal> user
                                        in the Identity service.</paragraph>
                                    <note>
                                        <paragraph>Comment out or remove any other options in the <literal>[filter:authtoken]</literal>
                                            section.</paragraph>
                                    </note>
                                </list_item>
                                <list_item>
                                    <paragraph>In the <literal>[filter:cache]</literal> section, configure the <literal>memcached</literal> location:</paragraph>
                                    <literal_block highlight_args="{}" language="none" linenos="False" xml:space="preserve">[filter:cache]
use = egg:swift#memcache
...
memcache_servers = controller:11211</literal_block>
                                </list_item>
                            </bullet_list>
                        </list_item>
                    </enumerated_list>
                </list_item>
            </enumerated_list>
        </section>
    </section>
</document>
