<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.14 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/swift/doc/source/install/storage-install-ubuntu-debian.rst">
    <target refid="storage-ubuntu-debian"></target>
    <section ids="install-and-configure-the-storage-nodes-for-ubuntu-and-debian storage-ubuntu-debian" names="install\ and\ configure\ the\ storage\ nodes\ for\ ubuntu\ and\ debian storage-ubuntu-debian">
        <title>Install and configure the storage nodes for Ubuntu and Debian</title>
        <paragraph>This section describes how to install and configure storage nodes
            that operate the account, container, and object services. For
            simplicity, this configuration references two storage nodes, each
            containing two empty local block storage devices. The instructions
            use <literal>/dev/sdb</literal> and <literal>/dev/sdc</literal>, but you can substitute different
            values for your particular nodes.</paragraph>
        <paragraph>Although Object Storage supports any file system with
            extended attributes (xattr), testing and benchmarking
            indicate the best performance and reliability on XFS. For
            more information on horizontally scaling your environment, see the
            <reference name="Deployment Guide" refuri="http://docs.openstack.org/developer/swift/deployment_guide.html">Deployment Guide</reference><target ids="deployment-guide" names="deployment\ guide" refuri="http://docs.openstack.org/developer/swift/deployment_guide.html"></target>.</paragraph>
        <paragraph>This section applies to Ubuntu 14.04 (LTS) and Debian.</paragraph>
        <section ids="prerequisites" names="prerequisites">
            <title>Prerequisites</title>
            <paragraph>Before you install and configure the Object Storage service on the
                storage nodes, you must prepare the storage devices.</paragraph>
            <note>
                <paragraph>Perform these steps on each storage node.</paragraph>
            </note>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Install the supporting utility packages:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># apt-get install xfsprogs rsync</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Format the <literal>/dev/sdb</literal> and <literal>/dev/sdc</literal> devices as XFS:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># mkfs.xfs /dev/sdb
# mkfs.xfs /dev/sdc</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Create the mount point directory structure:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># mkdir -p /srv/node/sdb
# mkdir -p /srv/node/sdc</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Edit the <literal>/etc/fstab</literal> file and add the following to it:</paragraph>
                    <literal_block highlight_args="{}" language="none" linenos="False" xml:space="preserve">/dev/sdb /srv/node/sdb xfs noatime,nodiratime,nobarrier,logbufs=8 0 2
/dev/sdc /srv/node/sdc xfs noatime,nodiratime,nobarrier,logbufs=8 0 2</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Mount the devices:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># mount /srv/node/sdb
# mount /srv/node/sdc</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Create or edit the <literal>/etc/rsyncd.conf</literal> file to contain the following:</paragraph>
                    <literal_block highlight_args="{}" language="none" linenos="False" xml:space="preserve">uid = swift
gid = swift
log file = /var/log/rsyncd.log
pid file = /var/run/rsyncd.pid
address = MANAGEMENT_INTERFACE_IP_ADDRESS

[account]
max connections = 2
path = /srv/node/
read only = False
lock file = /var/lock/account.lock

[container]
max connections = 2
path = /srv/node/
read only = False
lock file = /var/lock/container.lock

[object]
max connections = 2
path = /srv/node/
read only = False
lock file = /var/lock/object.lock</literal_block>
                    <paragraph>Replace <literal>MANAGEMENT_INTERFACE_IP_ADDRESS</literal> with the IP address of the
                        management network on the storage node.</paragraph>
                    <note>
                        <paragraph>The <literal>rsync</literal> service requires no authentication, so consider running
                            it on a private network in production environments.</paragraph>
                    </note>
                </list_item>
            </enumerated_list>
            <enumerated_list enumtype="arabic" prefix="" start="7" suffix=".">
                <list_item>
                    <paragraph>Edit the <literal>/etc/default/rsync</literal> file and enable the <literal>rsync</literal>
                        service:</paragraph>
                    <literal_block highlight_args="{}" language="none" linenos="False" xml:space="preserve">RSYNC_ENABLE=true</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Start the <literal>rsync</literal> service:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># service rsync start</literal_block>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="install-and-configure-components" names="install\ and\ configure\ components">
            <title>Install and configure components</title>
            <note>
                <paragraph>Default configuration files vary by distribution. You might need
                    to add these sections and options rather than modifying existing
                    sections and options. Also, an ellipsis (<literal>...</literal>) in the configuration
                    snippets indicates potential default configuration options that you
                    should retain.</paragraph>
            </note>
            <note>
                <paragraph>Perform these steps on each storage node.</paragraph>
            </note>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Install the packages:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># apt-get install swift swift-account swift-container swift-object</literal_block>
                </list_item>
            </enumerated_list>
            <enumerated_list enumtype="arabic" prefix="" start="2" suffix=".">
                <list_item>
                    <paragraph>Obtain the accounting, container, and object service configuration
                        files from the Object Storage source repository:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># curl -o /etc/swift/account-server.conf https://git.openstack.org/cgit/openstack/swift/plain/etc/account-server.conf-sample?h=stable/pike
# curl -o /etc/swift/container-server.conf https://git.openstack.org/cgit/openstack/swift/plain/etc/container-server.conf-sample?h=stable/pike
# curl -o /etc/swift/object-server.conf https://git.openstack.org/cgit/openstack/swift/plain/etc/object-server.conf-sample?h=stable/pike</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Edit the <literal>/etc/swift/account-server.conf</literal> file and complete the
                        following actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, configure the bind IP address, bind port,
                                user, configuration directory, and mount point directory:</paragraph>
                            <literal_block highlight_args="{}" language="none" linenos="False" xml:space="preserve">[DEFAULT]
...
bind_ip = MANAGEMENT_INTERFACE_IP_ADDRESS
bind_port = 6202
user = swift
swift_dir = /etc/swift
devices = /srv/node
mount_check = True</literal_block>
                            <paragraph>Replace <literal>MANAGEMENT_INTERFACE_IP_ADDRESS</literal> with the IP address of the
                                management network on the storage node.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[pipeline:main]</literal> section, enable the appropriate modules:</paragraph>
                            <literal_block highlight_args="{}" language="none" linenos="False" xml:space="preserve">[pipeline:main]
pipeline = healthcheck recon account-server</literal_block>
                            <note>
                                <paragraph>For more information on other modules that enable additional features,
                                    see the <reference name="Deployment Guide" refuri="http://docs.openstack.org/developer/swift/deployment_guide.html">Deployment Guide</reference>.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[filter:recon]</literal> section, configure the recon (meters) cache
                                directory:</paragraph>
                            <literal_block highlight_args="{}" language="none" linenos="False" xml:space="preserve">[filter:recon]
use = egg:swift#recon
...
recon_cache_path = /var/cache/swift</literal_block>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Edit the <literal>/etc/swift/container-server.conf</literal> file and complete the
                        following actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, configure the bind IP address, bind port,
                                user, configuration directory, and mount point directory:</paragraph>
                            <literal_block highlight_args="{}" language="none" linenos="False" xml:space="preserve">[DEFAULT]
...
bind_ip = MANAGEMENT_INTERFACE_IP_ADDRESS
bind_port = 6201
user = swift
swift_dir = /etc/swift
devices = /srv/node
mount_check = True</literal_block>
                            <paragraph>Replace <literal>MANAGEMENT_INTERFACE_IP_ADDRESS</literal> with the IP address of the
                                management network on the storage node.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[pipeline:main]</literal> section, enable the appropriate modules:</paragraph>
                            <literal_block highlight_args="{}" language="none" linenos="False" xml:space="preserve">[pipeline:main]
pipeline = healthcheck recon container-server</literal_block>
                            <note>
                                <paragraph>For more information on other modules that enable additional features,
                                    see the <reference name="Deployment Guide" refuri="http://docs.openstack.org/developer/swift/deployment_guide.html">Deployment Guide</reference>.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[filter:recon]</literal> section, configure the recon (meters) cache
                                directory:</paragraph>
                            <literal_block highlight_args="{}" language="none" linenos="False" xml:space="preserve">[filter:recon]
use = egg:swift#recon
...
recon_cache_path = /var/cache/swift</literal_block>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Edit the <literal>/etc/swift/object-server.conf</literal> file and complete the
                        following actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, configure the bind IP address, bind port,
                                user, configuration directory, and mount point directory:</paragraph>
                            <literal_block highlight_args="{}" language="none" linenos="False" xml:space="preserve">[DEFAULT]
...
bind_ip = MANAGEMENT_INTERFACE_IP_ADDRESS
bind_port = 6200
user = swift
swift_dir = /etc/swift
devices = /srv/node
mount_check = True</literal_block>
                            <paragraph>Replace <literal>MANAGEMENT_INTERFACE_IP_ADDRESS</literal> with the IP address of the
                                management network on the storage node.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[pipeline:main]</literal> section, enable the appropriate modules:</paragraph>
                            <literal_block highlight_args="{}" language="none" linenos="False" xml:space="preserve">[pipeline:main]
pipeline = healthcheck recon object-server</literal_block>
                            <note>
                                <paragraph>For more information on other modules that enable additional features,
                                    see the <reference name="Deployment Guide" refuri="http://docs.openstack.org/developer/swift/deployment_guide.html">Deployment Guide</reference>.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[filter:recon]</literal> section, configure the recon (meters) cache
                                and lock directories:</paragraph>
                            <literal_block highlight_args="{}" language="none" linenos="False" xml:space="preserve">[filter:recon]
use = egg:swift#recon
...
recon_cache_path = /var/cache/swift
recon_lock_path = /var/lock</literal_block>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Ensure proper ownership of the mount point directory structure:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># chown -R swift:swift /srv/node</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Create the <literal>recon</literal> directory and ensure proper ownership of it:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># mkdir -p /var/cache/swift
# chown -R root:swift /var/cache/swift
# chmod -R 775 /var/cache/swift</literal_block>
                </list_item>
            </enumerated_list>
        </section>
    </section>
</document>
