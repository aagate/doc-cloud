<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.14 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/swift/doc/source/api/object_versioning.rst">
    <section ids="object-versioning" names="object\ versioning">
        <title>Object versioning</title>
        <paragraph>You can store multiple versions of your content so that you can recover
            from unintended overwrites. Object versioning is an easy way to
            implement version control, which you can use with any type of content.</paragraph>
        <note>
            <paragraph>You cannot version a large-object manifest file, but the large-object
                manifest file can point to versioned segments.</paragraph>
        </note>
        <note>
            <paragraph>It is strongly recommended that you put non-current objects in a
                different container than the container where current object versions
                reside.</paragraph>
        </note>
        <paragraph>To allow object versioning within a cluster, the cloud provider should add the
            <literal>versioned_writes</literal> filter to the pipeline and set the
            <literal>allow_versioned_writes</literal> option to <literal>true</literal> in the
            <literal>[filter:versioned_writes]</literal> section of the proxy-server configuration file.</paragraph>
        <paragraph>To enable object versioning for a container, you must specify an “archive
            container” that will retain non-current versions via either the
            <literal>X-Versions-Location</literal> or <literal>X-History-Location</literal> header. These two headers
            enable two distinct modes of operation. Either mode may be used within a
            cluster, but only one mode may be active for any given container. You must
            UTF-8-encode and then URL-encode the container name before you include it in
            the header.</paragraph>
        <paragraph>For both modes, <strong>PUT</strong> requests will archive any pre-existing objects before
            writing new data, and <strong>GET</strong> requests will serve the current version. <strong>COPY</strong>
            requests behave like a <strong>GET</strong> followed by a <strong>PUT</strong>; that is, if the copy
            <emphasis>source</emphasis> is in a versioned container then the current version will be copied,
            and if the copy <emphasis>destination</emphasis> is in a versioned container then any pre-existing
            object will be archived before writing new data.</paragraph>
        <paragraph>If object versioning was enabled using <literal>X-History-Location</literal>, then object
            <strong>DELETE</strong> requests will copy the current version to the archive container then
            remove it from the versioned container.</paragraph>
        <paragraph>If object versioning was enabled using <literal>X-Versions-Location</literal>, then object
            <strong>DELETE</strong> requests will restore the most-recent version from the archive
            container, overwriting the current version.</paragraph>
        <section ids="example-using-x-versions-location" names="example\ using\ x-versions-location">
            <title>Example Using <literal>X-Versions-Location</literal></title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Create the <literal>current</literal> container:</paragraph>
                </list_item>
            </enumerated_list>
            <block_quote>
                <literal_block classes="code" xml:space="preserve"># curl -i $publicURL/current -X PUT -H "Content-Length: 0" -H "X-Auth-Token: $token" -H "X-Versions-Location: archive"</literal_block>
                <literal_block classes="code" xml:space="preserve">HTTP/1.1 201 Created
Content-Length: 0
Content-Type: text/html; charset=UTF-8
X-Trans-Id: txb91810fb717347d09eec8-0052e18997
X-Openstack-Request-Id: txb91810fb717347d09eec8-0052e18997
Date: Thu, 23 Jan 2014 21:28:55 GMT</literal_block>
            </block_quote>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Create the first version of an object in the <literal>current</literal> container:</paragraph>
                    <literal_block classes="code" xml:space="preserve"># curl -i $publicURL/current/my_object --data-binary 1 -X PUT -H "Content-Length: 0" -H "X-Auth-Token: $token"</literal_block>
                    <literal_block classes="code" xml:space="preserve">HTTP/1.1 201 Created
Last-Modified: Thu, 23 Jan 2014 21:31:22 GMT
Content-Length: 0
Etag: d41d8cd98f00b204e9800998ecf8427e
Content-Type: text/html; charset=UTF-8
X-Trans-Id: tx5992d536a4bd4fec973aa-0052e18a2a
X-Openstack-Request-Id: tx5992d536a4bd4fec973aa-0052e18a2a
Date: Thu, 23 Jan 2014 21:31:22 GMT</literal_block>
                    <paragraph>Nothing is written to the non-current version container when you
                        initially <strong>PUT</strong> an object in the <literal>current</literal> container. However,
                        subsequent <strong>PUT</strong> requests that edit an object trigger the creation
                        of a version of that object in the <literal>archive</literal> container.</paragraph>
                    <paragraph>These non-current versions are named as follows:</paragraph>
                    <literal_block classes="code" xml:space="preserve">&lt;length&gt;&lt;object_name&gt;/&lt;timestamp&gt;</literal_block>
                    <paragraph>Where <literal>length</literal> is the 3-character, zero-padded hexadecimal
                        character length of the object, <literal>&lt;object_name&gt;</literal> is the object name,
                        and <literal>&lt;timestamp&gt;</literal> is the time when the object was initially created
                        as a current version.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a second version of the object in the <literal>current</literal> container:</paragraph>
                    <literal_block classes="code" xml:space="preserve"># curl -i $publicURL/current/my_object --data-binary 2 -X PUT -H "Content-Length: 0" -H "X-Auth-Token: $token"</literal_block>
                    <literal_block classes="code" xml:space="preserve">HTTP/1.1 201 Created
Last-Modified: Thu, 23 Jan 2014 21:41:32 GMT
Content-Length: 0
Etag: d41d8cd98f00b204e9800998ecf8427e
Content-Type: text/html; charset=UTF-8
X-Trans-Id: tx468287ce4fc94eada96ec-0052e18c8c
X-Openstack-Request-Id: tx468287ce4fc94eada96ec-0052e18c8c
Date: Thu, 23 Jan 2014 21:41:32 GMT</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Issue a <strong>GET</strong> request to a versioned object to get the current
                        version of the object. You do not have to do any request redirects or
                        metadata lookups.</paragraph>
                    <paragraph>List older versions of the object in the <literal>archive</literal> container:</paragraph>
                    <literal_block classes="code" xml:space="preserve"># curl -i $publicURL/archive?prefix=009my_object -X GET -H "X-Auth-Token: $token"</literal_block>
                    <literal_block classes="code" xml:space="preserve">HTTP/1.1 200 OK
Content-Length: 30
X-Container-Object-Count: 1
Accept-Ranges: bytes
X-Timestamp: 1390513280.79684
X-Container-Bytes-Used: 0
Content-Type: text/plain; charset=utf-8
X-Trans-Id: tx9a441884997542d3a5868-0052e18d8e
X-Openstack-Request-Id: tx9a441884997542d3a5868-0052e18d8e
Date: Thu, 23 Jan 2014 21:45:50 GMT

009my_object/1390512682.92052</literal_block>
                    <note>
                        <paragraph>A <strong>POST</strong> request to a versioned object updates only the metadata
                            for the object and does not create a new version of the object. New
                            versions are created only when the content of the object changes.</paragraph>
                    </note>
                </list_item>
                <list_item>
                    <paragraph>Issue a <strong>DELETE</strong> request to a versioned object to remove the
                        current version of the object and replace it with the next-most
                        current version in the non-current container.</paragraph>
                    <literal_block classes="code" xml:space="preserve"># curl -i $publicURL/current/my_object -X DELETE -H "X-Auth-Token: $token"</literal_block>
                    <literal_block classes="code" xml:space="preserve">HTTP/1.1 204 No Content
Content-Length: 0
Content-Type: text/html; charset=UTF-8
X-Trans-Id: tx006d944e02494e229b8ee-0052e18edd
X-Openstack-Request-Id: tx006d944e02494e229b8ee-0052e18edd
Date: Thu, 23 Jan 2014 21:51:25 GMT</literal_block>
                    <paragraph>List objects in the <literal>archive</literal> container to show that the archived
                        object was moved back to the <literal>current</literal> container:</paragraph>
                    <literal_block classes="code" xml:space="preserve"># curl -i $publicURL/archive?prefix=009my_object -X GET -H "X-Auth-Token: $token"</literal_block>
                    <literal_block classes="code" xml:space="preserve">HTTP/1.1 204 No Content
Content-Length: 0
X-Container-Object-Count: 0
Accept-Ranges: bytes
X-Timestamp: 1390513280.79684
X-Container-Bytes-Used: 0
Content-Type: text/html; charset=UTF-8
X-Trans-Id: tx044f2a05f56f4997af737-0052e18eed
X-Openstack-Request-Id: tx044f2a05f56f4997af737-0052e18eed
Date: Thu, 23 Jan 2014 21:51:41 GMT</literal_block>
                    <paragraph>This next-most current version carries with it any metadata last set
                        on it. If want to completely remove an object and you have five
                        versions of it, you must <strong>DELETE</strong> it five times.</paragraph>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="example-using-x-history-location" names="example\ using\ x-history-location">
            <title>Example Using <literal>X-History-Location</literal></title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Create the <literal>current</literal> container:</paragraph>
                </list_item>
            </enumerated_list>
            <block_quote>
                <literal_block classes="code" xml:space="preserve"># curl -i $publicURL/current -X PUT -H "Content-Length: 0" -H "X-Auth-Token: $token" -H "X-History-Location: archive"</literal_block>
                <literal_block classes="code" xml:space="preserve">HTTP/1.1 201 Created
Content-Length: 0
Content-Type: text/html; charset=UTF-8
X-Trans-Id: txb91810fb717347d09eec8-0052e18997
X-Openstack-Request-Id: txb91810fb717347d09eec8-0052e18997
Date: Thu, 23 Jan 2014 21:28:55 GMT</literal_block>
            </block_quote>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Create the first version of an object in the <literal>current</literal> container:</paragraph>
                    <literal_block classes="code" xml:space="preserve"># curl -i $publicURL/current/my_object --data-binary 1 -X PUT -H "Content-Length: 0" -H "X-Auth-Token: $token"</literal_block>
                    <literal_block classes="code" xml:space="preserve">HTTP/1.1 201 Created
Last-Modified: Thu, 23 Jan 2014 21:31:22 GMT
Content-Length: 0
Etag: d41d8cd98f00b204e9800998ecf8427e
Content-Type: text/html; charset=UTF-8
X-Trans-Id: tx5992d536a4bd4fec973aa-0052e18a2a
X-Openstack-Request-Id: tx5992d536a4bd4fec973aa-0052e18a2a
Date: Thu, 23 Jan 2014 21:31:22 GMT</literal_block>
                    <paragraph>Nothing is written to the non-current version container when you
                        initially <strong>PUT</strong> an object in the <literal>current</literal> container. However,
                        subsequent <strong>PUT</strong> requests that edit an object trigger the creation
                        of a version of that object in the <literal>archive</literal> container.</paragraph>
                    <paragraph>These non-current versions are named as follows:</paragraph>
                    <literal_block classes="code" xml:space="preserve">&lt;length&gt;&lt;object_name&gt;/&lt;timestamp&gt;</literal_block>
                    <paragraph>Where <literal>length</literal> is the 3-character, zero-padded hexadecimal
                        character length of the object, <literal>&lt;object_name&gt;</literal> is the object name,
                        and <literal>&lt;timestamp&gt;</literal> is the time when the object was initially created
                        as a current version.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a second version of the object in the <literal>current</literal> container:</paragraph>
                    <literal_block classes="code" xml:space="preserve"># curl -i $publicURL/current/my_object --data-binary 2 -X PUT -H "Content-Length: 0" -H "X-Auth-Token: $token"</literal_block>
                    <literal_block classes="code" xml:space="preserve">HTTP/1.1 201 Created
Last-Modified: Thu, 23 Jan 2014 21:41:32 GMT
Content-Length: 0
Etag: d41d8cd98f00b204e9800998ecf8427e
Content-Type: text/html; charset=UTF-8
X-Trans-Id: tx468287ce4fc94eada96ec-0052e18c8c
X-Openstack-Request-Id: tx468287ce4fc94eada96ec-0052e18c8c
Date: Thu, 23 Jan 2014 21:41:32 GMT</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Issue a <strong>GET</strong> request to a versioned object to get the current
                        version of the object. You do not have to do any request redirects or
                        metadata lookups.</paragraph>
                    <paragraph>List older versions of the object in the <literal>archive</literal> container:</paragraph>
                    <literal_block classes="code" xml:space="preserve"># curl -i $publicURL/archive?prefix=009my_object -X GET -H "X-Auth-Token: $token"</literal_block>
                    <literal_block classes="code" xml:space="preserve">HTTP/1.1 200 OK
Content-Length: 30
X-Container-Object-Count: 1
Accept-Ranges: bytes
X-Timestamp: 1390513280.79684
X-Container-Bytes-Used: 0
Content-Type: text/plain; charset=utf-8
X-Trans-Id: tx9a441884997542d3a5868-0052e18d8e
X-Openstack-Request-Id: tx9a441884997542d3a5868-0052e18d8e
Date: Thu, 23 Jan 2014 21:45:50 GMT

009my_object/1390512682.92052</literal_block>
                    <note>
                        <paragraph>A <strong>POST</strong> request to a versioned object updates only the metadata
                            for the object and does not create a new version of the object. New
                            versions are created only when the content of the object changes.</paragraph>
                    </note>
                </list_item>
                <list_item>
                    <paragraph>Issue a <strong>DELETE</strong> request to a versioned object to copy the
                        current version of the object to the archive container then delete it from
                        the current container. Subsequent <strong>GET</strong> requests to the object in the
                        current container will return <literal>404 Not Found</literal>.</paragraph>
                    <literal_block classes="code" xml:space="preserve"># curl -i $publicURL/current/my_object -X DELETE -H "X-Auth-Token: $token"</literal_block>
                    <literal_block classes="code" xml:space="preserve">HTTP/1.1 204 No Content
Content-Length: 0
Content-Type: text/html; charset=UTF-8
X-Trans-Id: tx006d944e02494e229b8ee-0052e18edd
X-Openstack-Request-Id: tx006d944e02494e229b8ee-0052e18edd
Date: Thu, 23 Jan 2014 21:51:25 GMT</literal_block>
                    <paragraph>List older versions of the object in the <literal>archive</literal> container:</paragraph>
                    <literal_block xml:space="preserve">.. code::</literal_block>
                    <block_quote>
                        <paragraph># curl -i $publicURL/archive?prefix=009my_object -X GET -H “X-Auth-Token: $token”</paragraph>
                    </block_quote>
                    <literal_block classes="code" xml:space="preserve">HTTP/1.1 200 OK
Content-Length: 90
X-Container-Object-Count: 3
Accept-Ranges: bytes
X-Timestamp: 1390513280.79684
X-Container-Bytes-Used: 0
Content-Type: text/html; charset=UTF-8
X-Trans-Id: tx044f2a05f56f4997af737-0052e18eed
X-Openstack-Request-Id: tx044f2a05f56f4997af737-0052e18eed
Date: Thu, 23 Jan 2014 21:51:41 GMT

009my_object/1390512682.92052
009my_object/1390512692.23062
009my_object/1390513885.67732</literal_block>
                    <paragraph>In addition to the two previous versions of the object, the archive
                        container has a “delete marker” to record when the object was deleted.</paragraph>
                    <paragraph>To permanently delete a previous version, issue a <strong>DELETE</strong> to the version
                        in the archive container.</paragraph>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="disabling-object-versioning" names="disabling\ object\ versioning">
            <title>Disabling Object Versioning</title>
            <paragraph>To disable object versioning for the <literal>current</literal> container, remove
                its <literal>X-Versions-Location</literal> metadata header by sending an empty key
                value.</paragraph>
            <literal_block classes="code" xml:space="preserve"># curl -i $publicURL/current -X PUT -H "Content-Length: 0" -H "X-Auth-Token: $token" -H "X-Versions-Location: "</literal_block>
            <literal_block classes="code" xml:space="preserve">HTTP/1.1 202 Accepted
Content-Length: 76
Content-Type: text/html; charset=UTF-8
X-Trans-Id: txe2476de217134549996d0-0052e19038
X-Openstack-Request-Id: txe2476de217134549996d0-0052e19038
Date: Thu, 23 Jan 2014 21:57:12 GMT

&lt;html&gt;&lt;h1&gt;Accepted&lt;/h1&gt;&lt;p&gt;The request is accepted for processing.&lt;/p&gt;&lt;/html&gt;</literal_block>
        </section>
    </section>
</document>
