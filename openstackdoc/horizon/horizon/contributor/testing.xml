<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/horizon/doc/source/contributor/testing.rst">
    <section ids="horizon-s-tests-and-you" names="horizon's\ tests\ and\ you">
        <title>Horizon’s tests and you</title>
        <section ids="how-to-run-the-tests" names="how\ to\ run\ the\ tests">
            <title>How to run the tests</title>
            <paragraph>Because Horizon is composed of both the <literal>horizon</literal> app and the
                <literal>openstack_dashboard</literal> reference project, there are in fact two sets of unit
                tests. While they can be run individually without problem, there is an easier
                way:</paragraph>
            <paragraph>Included at the root of the repository is the <literal>tox.ini</literal> config
                which invokes both sets of tests, and optionally generates analyses on both
                components in the process. <literal>tox</literal> is what Jenkins uses to verify the
                stability of the project, so you should make sure you run it and it passes
                before you submit any pull requests/patches.</paragraph>
            <paragraph>To run all tests:</paragraph>
            <literal_block xml:space="preserve">$ tox</literal_block>
            <paragraph>It’s also possible to run a subset of the tests. Open <literal>tox.ini</literal> in the
                Horizon root directory to see a list of test environments. You can read more
                about tox in general at <reference refuri="https://tox.readthedocs.io/en/latest/">https://tox.readthedocs.io/en/latest/</reference>.</paragraph>
            <paragraph>By default running the Selenium tests will open your Firefox browser (you have
                to install it first, else an error is raised), and you will be able to see the
                tests actions:</paragraph>
            <literal_block xml:space="preserve">$ tox -e selenium</literal_block>
            <paragraph>If you want to run the suite headless, without being able to see them (as they
                are ran on Jenkins), you can run the tests:</paragraph>
            <literal_block xml:space="preserve">$ tox -e selenium-headless</literal_block>
            <paragraph>Selenium will use a virtual display in this case, instead of your own. In order
                to run the tests this way you have to install the dependency <title_reference>xvfb</title_reference>, like
                this:</paragraph>
            <literal_block xml:space="preserve">$ sudo apt-get install xvfb</literal_block>
            <paragraph>for a Debian OS flavour, or for Fedora/Red Hat flavours:</paragraph>
            <literal_block xml:space="preserve">$ sudo yum install xorg-x11-server-Xvfb</literal_block>
            <paragraph>If you can’t run a virtual display, or would prefer not to, you can use the
                PhantomJS web driver instead:</paragraph>
            <literal_block xml:space="preserve">$ tox -e selenium-phantomjs</literal_block>
            <paragraph>If you need to install PhantomJS, you may do so with <title_reference>npm</title_reference> like this:</paragraph>
            <literal_block xml:space="preserve">$ npm -g install phantomjs</literal_block>
            <paragraph>Alternatively, many distributions have system packages for PhantomJS, or
                it can be downloaded from <reference refuri="http://phantomjs.org/download.html">http://phantomjs.org/download.html</reference>.</paragraph>
        </section>
        <section ids="tox-test-environments" names="tox\ test\ environments">
            <title>tox Test Environments</title>
            <paragraph>This is a list of test environments available to be executed by
                <literal>tox -e &lt;name&gt;</literal>.</paragraph>
            <section ids="pep8" names="pep8">
                <title>pep8</title>
                <paragraph>Runs pep8, which is a tool that checks Python code style. You can read more
                    about pep8 at <reference refuri="https://www.python.org/dev/peps/pep-0008/">https://www.python.org/dev/peps/pep-0008/</reference></paragraph>
            </section>
            <section ids="py27" names="py27">
                <title>py27</title>
                <paragraph>Runs the Python unit tests against the current default version of Django
                    with Python 2.7 environment. Check <literal>requirements.txt</literal> in horizon
                    repository to know which version of Django is actually used.</paragraph>
                <paragraph>All other dependencies are as defined by the upper-constraints file at
                    <reference refuri="https://git.openstack.org/cgit/openstack/requirements/plain/upper-constraints.txt">https://git.openstack.org/cgit/openstack/requirements/plain/upper-constraints.txt</reference></paragraph>
                <paragraph>You can run a subset of the tests by passing the test path as an argument to
                    tox:</paragraph>
                <literal_block xml:space="preserve">$ tox -e py27 -- openstack_dashboard.dashboards.identity.users.tests</literal_block>
                <paragraph>The following is more example to run a specific test class and a
                    specific test:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ tox -e py27 -- openstack_dashboard.dashboards.identity.users.tests:UsersViewTests
$ tox -e py27 -- openstack_dashboard.dashboards.identity.users.tests:UsersViewTests.test_index</literal_block>
                <paragraph>You can also pass other arguments. For example, to drop into a live debugger
                    when a test fails you can use:</paragraph>
                <literal_block xml:space="preserve">$ tox -e py27 -- --pdb</literal_block>
            </section>
            <section ids="py27dj18-py27dj19-py27dj110" names="py27dj18,\ py27dj19,\ py27dj110">
                <title>py27dj18, py27dj19, py27dj110</title>
                <paragraph>Runs the Python unit tests against Django 1.8, Django 1.9 and Django 1.10
                    respectively</paragraph>
            </section>
            <section ids="py35" names="py35">
                <title>py35</title>
                <paragraph>Runs the Python unit tests with a Python 3.5 environment.</paragraph>
            </section>
            <section ids="releasenotes" names="releasenotes">
                <title>releasenotes</title>
                <paragraph>Outputs Horizons release notes as HTML to <literal>releasenotes/build/html</literal>.</paragraph>
                <paragraph>Also takes an alternative builder as an optional argument, such as
                    <literal>tox -e docs -- &lt;builder&gt;</literal>, which will output to
                    <literal>releasenotes/build/&lt;builder&gt;</literal>. Available builders are listed at
                    <reference refuri="http://www.sphinx-doc.org/en/latest/builders.html">http://www.sphinx-doc.org/en/latest/builders.html</reference></paragraph>
                <paragraph>This environment also runs the documentation style checker <literal>doc8</literal> against
                    RST and YAML files under <literal>releasenotes/source</literal> to keep the documentation
                    style consistent. If you would like to run <literal>doc8</literal> manually, see <strong>docs</strong>
                    environment below.</paragraph>
            </section>
            <section ids="npm" names="npm">
                <title>npm</title>
                <paragraph>Installs the npm dependencies listed in <literal>package.json</literal> and runs the
                    JavaScript tests. Can also take optional arguments, which will be executed
                    as an npm script following the dependency install, instead of <literal>test</literal>.</paragraph>
                <paragraph>Example:</paragraph>
                <literal_block xml:space="preserve">$ tox -e npm -- lintq</literal_block>
            </section>
            <section ids="docs" names="docs">
                <title>docs</title>
                <paragraph>Outputs Horizons documentation as HTML to <literal>doc/build/html</literal>.</paragraph>
                <paragraph>Also takes an alternative builder as an optional argument, such as
                    <literal>tox -e docs -- &lt;builder&gt;</literal>, which will output to <literal>doc/build/&lt;builder&gt;</literal>.
                    Available builders are listed at
                    <reference refuri="http://www.sphinx-doc.org/en/latest/builders.html">http://www.sphinx-doc.org/en/latest/builders.html</reference></paragraph>
                <paragraph>Example:</paragraph>
                <literal_block xml:space="preserve">$ tox -e docs -- latexpdf</literal_block>
                <paragraph>This environment also runs the documentation style checker <literal>doc8</literal> against
                    RST files under <literal>doc/source</literal> to keep the documentation style consistent.
                    If you would like to run <literal>doc8</literal> manually, run:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># Activate virtualenv
$ . .tox/docs/bin/activate
$ doc8 doc/source</literal_block>
            </section>
        </section>
        <section ids="writing-tests" names="writing\ tests">
            <title>Writing tests</title>
            <paragraph>Horizon uses Django’s unit test machinery (which extends Python’s <literal>unittest2</literal>
                library) as the core of its test suite. As such, all tests for the Python code
                should be written as unit tests. No doctests please.</paragraph>
            <paragraph>In general new code without unit tests will not be accepted, and every bugfix
                <emphasis>must</emphasis> include a regression test.</paragraph>
            <paragraph>For a much more in-depth discussion of testing, see the <reference internal="True" refuri="topics/testing#topics-testing"><inline classes="std std-ref">testing topic
                        guide</inline></reference>.</paragraph>
        </section>
    </section>
</document>
