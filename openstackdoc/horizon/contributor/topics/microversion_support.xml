<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/horizon/doc/source/contributor/topics/microversion_support.rst">
    <section ids="horizon-microversion-support" names="horizon\ microversion\ support">
        <title>Horizon Microversion Support</title>
        <section ids="introduction" names="introduction">
            <title>Introduction</title>
            <paragraph>Several services use API microversions, which allows consumers of that API to
                specify an exact version when making a request. This can be useful in ensuring
                a feature continues to work as expected across many service releases.</paragraph>
        </section>
        <section ids="adding-a-feature-that-was-introduced-in-a-microversion" names="adding\ a\ feature\ that\ was\ introduced\ in\ a\ microversion">
            <title>Adding a feature that was introduced in a microversion</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Add the feature to the <literal>MICROVERSION_FEATURES</literal> dict in
                        <literal>openstack_dashboard/api/microversions.py</literal> under the appropriate
                        service name. The feature should have at least two versions listed; the
                        minimum version (i.e. the version that introduced the feature) and
                        the current working version. Providing multiple versions reduces project
                        maintenance overheads and helps Horizon work with older service
                        deployments.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Use the <literal>is_feature_available</literal> function for your service to show or hide
                        the function.:</paragraph>
                    <literal_block xml:space="preserve">from openstack_dashboard.api import service

...

def allowed(self, request):
    return service.is_feature_available('feature')</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Send the correct microversion with <literal>get_microversion</literal> function in the API
                        layer.:</paragraph>
                    <literal_block xml:space="preserve">def resource_list(request):
    try:
        microversion = get_microversion(request, 'feature')
        client = serviceclient(request, microversion)
        return client.resource_list()</literal_block>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="microversion-references" names="microversion\ references">
            <title>Microversion references</title>
            <field_list>
                <field>
                    <field_name>Nova</field_name>
                    <field_body>
                        <paragraph><reference refuri="https://docs.openstack.org/nova/latest/reference/api-microversion-history.html">https://docs.openstack.org/nova/latest/reference/api-microversion-history.html</reference></paragraph>
                    </field_body>
                </field>
                <field>
                    <field_name>Cinder</field_name>
                    <field_body>
                        <paragraph><reference refuri="https://docs.openstack.org/cinder/latest/contributor/api_microversion_history.html">https://docs.openstack.org/cinder/latest/contributor/api_microversion_history.html</reference></paragraph>
                    </field_body>
                </field>
                <field>
                    <field_name>API-WG</field_name>
                    <field_body>
                        <paragraph><reference refuri="https://specs.openstack.org/openstack/api-wg/guidelines/microversion_specification.html">https://specs.openstack.org/openstack/api-wg/guidelines/microversion_specification.html</reference></paragraph>
                    </field_body>
                </field>
            </field_list>
        </section>
    </section>
</document>
