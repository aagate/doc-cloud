<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/glance/doc/source/install/install-ubuntu.rst">
    <section ids="install-and-configure-ubuntu" names="install\ and\ configure\ (ubuntu)">
        <title>Install and configure (Ubuntu)</title>
        <paragraph>This section describes how to install and configure the Image service,
            code-named glance, on the controller node. For simplicity, this
            configuration stores images on the local file system.</paragraph>
        <section ids="prerequisites" names="prerequisites">
            <title>Prerequisites</title>
            <paragraph>Before you install and configure the Image service, you must
                create a database, service credentials, and API endpoints.</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>To create the database, complete these steps:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>Use the database access client to connect to the database
                                server as the <literal>root</literal> user:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ mysql -u root -p</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>Create the <literal>glance</literal> database:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">MariaDB [(none)]&gt; CREATE DATABASE glance;</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>Grant proper access to the <literal>glance</literal> database:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'localhost' \
  IDENTIFIED BY 'GLANCE_DBPASS';
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'%' \
  IDENTIFIED BY 'GLANCE_DBPASS';</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>GLANCE_DBPASS</literal> with a suitable password.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Exit the database access client.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Source the <literal>admin</literal> credentials to gain access to
                        admin-only CLI commands:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ . admin-openrc</literal_block>
                    <comment xml:space="preserve">end</comment>
                </list_item>
                <list_item>
                    <paragraph>To create the service credentials, complete these steps:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>Create the <literal>glance</literal> user:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack user create --domain default --password-prompt glance

User Password:
Repeat User Password:
+---------------------+----------------------------------+
| Field               | Value                            |
+---------------------+----------------------------------+
| domain_id           | default                          |
| enabled             | True                             |
| id                  | 3f4e777c4062483ab8d9edd7dff829df |
| name                | glance                           |
| options             | {}                               |
| password_expires_at | None                             |
+---------------------+----------------------------------+</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                        <list_item>
                            <paragraph>Add the <literal>admin</literal> role to the <literal>glance</literal> user and
                                <literal>service</literal> project:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack role add --project service --user glance admin</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <note>
                                <paragraph>This command provides no output.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>Create the <literal>glance</literal> service entity:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack service create --name glance \
  --description "OpenStack Image" image

+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | OpenStack Image                  |
| enabled     | True                             |
| id          | 8c2c7f1b9b5049ea9e63757b5533e6d2 |
| name        | glance                           |
| type        | image                            |
+-------------+----------------------------------+</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Create the Image service API endpoints:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack endpoint create --region RegionOne \
  image public http://controller:9292

+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 340be3625e9b4239a6415d034e98aace |
| interface    | public                           |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 8c2c7f1b9b5049ea9e63757b5533e6d2 |
| service_name | glance                           |
| service_type | image                            |
| url          | http://controller:9292           |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne \
  image internal http://controller:9292

+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | a6e4b153c2ae4c919eccfdbb7dceb5d2 |
| interface    | internal                         |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 8c2c7f1b9b5049ea9e63757b5533e6d2 |
| service_name | glance                           |
| service_type | image                            |
| url          | http://controller:9292           |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne \
  image admin http://controller:9292

+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 0c37ed58103f4300a84ff125a539032d |
| interface    | admin                            |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 8c2c7f1b9b5049ea9e63757b5533e6d2 |
| service_name | glance                           |
| service_type | image                            |
| url          | http://controller:9292           |
+--------------+----------------------------------+</literal_block>
                    <comment xml:space="preserve">end</comment>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="install-and-configure-components" names="install\ and\ configure\ components">
            <title>Install and configure components</title>
            <note>
                <paragraph>Default configuration files vary by distribution. You might need
                    to add these sections and options rather than modifying existing
                    sections and options. Also, an ellipsis (<literal>...</literal>) in the configuration
                    snippets indicates potential default configuration options that you
                    should retain.</paragraph>
            </note>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Install the packages:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># apt install glance</literal_block>
                    <comment xml:space="preserve">end</comment>
                </list_item>
            </enumerated_list>
            <enumerated_list enumtype="arabic" prefix="" start="2" suffix=".">
                <list_item>
                    <paragraph>Edit the <literal>/etc/glance/glance-api.conf</literal> file and complete the
                        following actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[database]</literal> section, configure database access:</paragraph>
                            <comment xml:space="preserve">path /etc/glance/glance.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[database]
# ...
connection = mysql+pymysql://glance:GLANCE_DBPASS@controller/glance</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>GLANCE_DBPASS</literal> with the password you chose for the
                                Image service database.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[keystone_authtoken]</literal> and <literal>[paste_deploy]</literal> sections,
                                configure Identity service access:</paragraph>
                            <comment xml:space="preserve">path /etc/glance/glance.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[keystone_authtoken]
# ...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = glance
password = GLANCE_PASS

[paste_deploy]
# ...
flavor = keystone</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>GLANCE_PASS</literal> with the password you chose for the
                                <literal>glance</literal> user in the Identity service.</paragraph>
                            <note>
                                <paragraph>Comment out or remove any other options in the
                                    <literal>[keystone_authtoken]</literal> section.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[glance_store]</literal> section, configure the local file
                                system store and location of image files:</paragraph>
                            <comment xml:space="preserve">path /etc/glance/glance.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[glance_store]
# ...
stores = file,http
default_store = file
filesystem_store_datadir = /var/lib/glance/images/</literal_block>
                            <comment xml:space="preserve">end</comment>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Edit the <literal>/etc/glance/glance-registry.conf</literal> file and complete
                        the following actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[database]</literal> section, configure database access:</paragraph>
                            <comment xml:space="preserve">path /etc/glance/glance-registry.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[database]
# ...
connection = mysql+pymysql://glance:GLANCE_DBPASS@controller/glance</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>GLANCE_DBPASS</literal> with the password you chose for the
                                Image service database.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[keystone_authtoken]</literal> and <literal>[paste_deploy]</literal> sections,
                                configure Identity service access:</paragraph>
                            <comment xml:space="preserve">path /etc/glance/glance-registry.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[keystone_authtoken]
# ...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = glance
password = GLANCE_PASS

[paste_deploy]
# ...
flavor = keystone</literal_block>
                            <comment xml:space="preserve">end</comment>
                            <paragraph>Replace <literal>GLANCE_PASS</literal> with the password you chose for the
                                <literal>glance</literal> user in the Identity service.</paragraph>
                            <note>
                                <paragraph>Comment out or remove any other options in the
                                    <literal>[keystone_authtoken]</literal> section.</paragraph>
                            </note>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Populate the Image service database:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># su -s /bin/sh -c "glance-manage db_sync" glance</literal_block>
                    <comment xml:space="preserve">end</comment>
                    <note>
                        <paragraph>Ignore any deprecation messages in this output.</paragraph>
                    </note>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="finalize-installation" names="finalize\ installation">
            <title>Finalize installation</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Restart the Image services:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># service glance-registry restart
# service glance-api restart</literal_block>
                    <comment xml:space="preserve">end</comment>
                </list_item>
            </enumerated_list>
        </section>
    </section>
</document>
