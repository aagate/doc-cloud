<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/glance/doc/source/admin/property-protections.rst">
    <comment xml:space="preserve">Copyright 2013 OpenStack Foundation
All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License"); you may
not use this file except in compliance with the License. You may obtain
a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
License for the specific language governing permissions and limitations
under the License.</comment>
    <target refid="property-protections"></target>
    <section ids="property-protections id1" names="property\ protections property-protections">
        <title>Property Protections</title>
        <paragraph>There are two types of image properties in Glance:</paragraph>
        <bullet_list bullet="*">
            <list_item>
                <paragraph>Core Properties, as specified by the image schema.</paragraph>
            </list_item>
            <list_item>
                <paragraph>Meta Properties, which are arbitrary key/value pairs that can be added to an
                    image.</paragraph>
            </list_item>
        </bullet_list>
        <paragraph>Access to meta properties through Glance’s public API calls may be
            restricted to certain sets of users, using a property protections configuration
            file.</paragraph>
        <paragraph>This document explains exactly how property protections are configured and what
            they apply to.</paragraph>
        <section ids="constructing-a-property-protections-configuration-file" names="constructing\ a\ property\ protections\ configuration\ file">
            <title>Constructing a Property Protections Configuration File</title>
            <paragraph>A property protections configuration file follows the format of the Glance API
                configuration file, which consists of sections, led by a <literal>[section]</literal> header
                and followed by <literal>name = value</literal> entries.  Each section header is a regular
                expression matching a set of properties to be protected.</paragraph>
            <note>
                <paragraph>Section headers must compile to a valid regular expression, otherwise
                    glance api service will not start. Regular expressions
                    will be handled by python’s re module which is PERL like.</paragraph>
            </note>
            <paragraph>Each section describes four key-value pairs, where the key is one of
                <literal>create/read/update/delete</literal>, and the value is a comma separated list of user
                roles that are permitted to perform that operation in the Glance API. <strong>If any of
                    the keys are not specified, then the glance api service will not start
                    successfully.</strong></paragraph>
            <paragraph>In the list of user roles, <literal>@</literal> means all roles and <literal>!</literal> means no role.
                <strong>If both @ and ! are specified for the same rule then the glance api service
                    will not start</strong></paragraph>
            <note>
                <paragraph>Only one policy rule is allowed per property operation. <strong>If multiple are
                        specified, then the glance api service will not start.</strong></paragraph>
            </note>
            <paragraph>The path to the file should be specified in the <literal>[DEFAULT]</literal> section of
                <literal>glance-api.conf</literal> as follows.</paragraph>
            <block_quote>
                <literal_block xml:space="preserve">property_protection_file=/path/to/file</literal_block>
            </block_quote>
            <paragraph>If this config value is not specified, property protections are not enforced.
                <strong>If the path is invalid, glance api service will not start successfully.</strong></paragraph>
            <paragraph>The file may use either roles or policies to describe the property protections.
                The config value should be specified in the <literal>[DEFAULT]</literal> section of
                <literal>glance-api.conf</literal> as follows.</paragraph>
            <block_quote>
                <literal_block xml:space="preserve">property_protection_rule_format=&lt;roles|policies&gt;</literal_block>
            </block_quote>
            <paragraph>The default value for <literal>property_protection_rule_format</literal> is <literal>roles</literal>.</paragraph>
            <paragraph>Property protections are applied in the order specified in the configuration
                file.  This means that if for example you specify a section with <literal>[.*]</literal> at
                the top of the file, all proceeding sections will be ignored.</paragraph>
            <paragraph>If a property does not match any of the given rules, all operations will be
                disabled for all roles.</paragraph>
            <paragraph>If an operation is misspelled or omitted, that operation will be disabled for
                all roles.</paragraph>
            <paragraph>Disallowing <literal>read</literal> operations will also disallow <literal>update/delete</literal> operations.</paragraph>
            <paragraph>A successful HTTP request will return status <literal>200 OK</literal>. If the user is not
                permitted to perform the requested action, <literal>403 Forbidden</literal> will be returned.</paragraph>
        </section>
        <section ids="v1-api-x-glance-registry-purge-props" names="v1\ api\ x-glance-registry-purge-props">
            <title>V1 API X-glance-registry-Purge-props</title>
            <paragraph>Property protections will still be honoured if
                <literal>X-glance-registry-Purge-props</literal> is set to <literal>True</literal>. That is, if you request
                to modify properties with this header set to <literal>True</literal>, you will not be able to
                delete or update properties for which you do not have the relevant permissions.
                Properties which are not included in the request and for which you do have
                delete permissions will still be removed.</paragraph>
        </section>
        <section ids="examples" names="examples">
            <title>Examples</title>
            <paragraph><strong>Example 1</strong>. Limit all property interactions to admin only.</paragraph>
            <block_quote>
                <literal_block xml:space="preserve">[.*]
create = admin
read = admin
update = admin
delete = admin</literal_block>
            </block_quote>
            <paragraph><strong>Example 2</strong>. Allow both admins and users with the billing role to read
                and modify properties prefixed with <literal>x_billing_code_</literal>. Allow admins to
                read and modify any properties.</paragraph>
            <block_quote>
                <literal_block xml:space="preserve">[^x_billing_code_.*]
create = admin,billing
read = admin, billing
update = admin,billing
delete = admin,billing

[.*]
create = admin
read = admin
update = admin
delete = admin</literal_block>
            </block_quote>
            <paragraph><strong>Example 3</strong>. Limit all property interactions to admin only using policy
                rule context_is_admin defined in policy.json.</paragraph>
            <block_quote>
                <literal_block xml:space="preserve">[.*]
create = context_is_admin
read = context_is_admin
update = context_is_admin
delete = context_is_admin</literal_block>
            </block_quote>
        </section>
    </section>
</document>
