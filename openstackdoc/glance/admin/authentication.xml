<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/glance/doc/source/admin/authentication.rst">
    <comment xml:space="preserve">Copyright 2010 OpenStack Foundation
All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License"); you may
not use this file except in compliance with the License. You may obtain
a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
License for the specific language governing permissions and limitations
under the License.</comment>
    <target refid="authentication"></target>
    <section ids="authentication-with-keystone authentication" names="authentication\ with\ keystone authentication">
        <title>Authentication With Keystone</title>
        <paragraph>Glance may optionally be integrated with Keystone.  Setting this up is
            relatively straightforward, as the Keystone distribution includes the
            necessary middleware. Once you have installed Keystone
            and edited your configuration files, newly created images will have
            their <title_reference>owner</title_reference> attribute set to the tenant of the authenticated users,
            and the <title_reference>is_public</title_reference> attribute will cause access to those images for
            which it is <title_reference>false</title_reference> to be restricted to only the owner, users with
            admin context, or tenants/users with whom the image has been shared.</paragraph>
        <section ids="configuring-the-glance-servers-to-use-keystone" names="configuring\ the\ glance\ servers\ to\ use\ keystone">
            <title>Configuring the Glance servers to use Keystone</title>
            <paragraph>Keystone is integrated with Glance through the use of middleware. The
                default configuration files for both the Glance API and the Glance
                Registry use a single piece of middleware called <literal>unauthenticated-context</literal>,
                which generates a request context containing blank authentication
                information. In order to configure Glance to use Keystone, the
                <literal>authtoken</literal> and <literal>context</literal> middlewares must be deployed in place of the
                <literal>unauthenticated-context</literal> middleware. The <literal>authtoken</literal> middleware performs
                the authentication token validation and retrieves actual user authentication
                information. It can be found in the Keystone distribution.</paragraph>
        </section>
        <section ids="configuring-glance-api-to-use-keystone" names="configuring\ glance\ api\ to\ use\ keystone">
            <title>Configuring Glance API to use Keystone</title>
            <paragraph>Configuring Glance API to use Keystone is relatively straight
                forward.  The first step is to ensure that declarations for the two
                pieces of middleware exist in the <literal>glance-api-paste.ini</literal>.  Here is
                an example for <literal>authtoken</literal>:</paragraph>
            <literal_block xml:space="preserve">[filter:authtoken]
paste.filter_factory = keystonemiddleware.auth_token:filter_factory
auth_url = http://localhost:35357
project_domain_id = default
project_name = service_admins
user_domain_id = default
username = glance_admin
password = password1234</literal_block>
            <paragraph>The actual values for these variables will need to be set depending on
                your situation.  For more information, please refer to the Keystone
                <reference name="documentation" refuri="https://docs.openstack.org/keystonemiddleware/latest/middlewarearchitecture.html#configuration">documentation</reference> on the <literal>auth_token</literal> middleware.</paragraph>
            <target ids="documentation" names="documentation" refuri="https://docs.openstack.org/keystonemiddleware/latest/middlewarearchitecture.html#configuration"></target>
            <paragraph>In short:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>The <literal>auth_url</literal> variable points to the Keystone service.
                        This information is used by the middleware to actually query Keystone about
                        the validity of the authentication tokens.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The auth credentials (<literal>project_name</literal>, <literal>project_domain_id</literal>,
                        <literal>user_domain_id</literal>, <literal>username</literal>, and <literal>password</literal>) will be used to
                        retrieve a service token. That token will be used to authorize user
                        tokens behind the scenes.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>Finally, to actually enable using Keystone authentication, the
                application pipeline must be modified.  By default, it looks like:</paragraph>
            <literal_block xml:space="preserve">[pipeline:glance-api]
pipeline = versionnegotiation unauthenticated-context apiv1app</literal_block>
            <paragraph>Your particular pipeline may vary depending on other options, such as
                the image cache. This must be changed by replacing <literal>unauthenticated-context</literal>
                with <literal>authtoken</literal> and <literal>context</literal>:</paragraph>
            <literal_block xml:space="preserve">[pipeline:glance-api]
pipeline = versionnegotiation authtoken context apiv1app</literal_block>
        </section>
        <section ids="configuring-glance-registry-to-use-keystone" names="configuring\ glance\ registry\ to\ use\ keystone">
            <title>Configuring Glance Registry to use Keystone</title>
            <paragraph>Configuring Glance Registry to use Keystone is also relatively
                straight forward.  The same middleware needs to be added
                to <literal>glance-registry-paste.ini</literal> as was needed by Glance API;
                see above for an example of the <literal>authtoken</literal> configuration.</paragraph>
            <paragraph>Again, to enable using Keystone authentication, the appropriate
                application pipeline must be selected.  By default, it looks like:</paragraph>
            <literal_block xml:space="preserve">[pipeline:glance-registry-keystone]
pipeline = authtoken context registryapp</literal_block>
            <paragraph>To enable the above application pipeline, in your main <literal>glance-registry.conf</literal>
                configuration file, select the appropriate deployment flavor by adding a
                <literal>flavor</literal> attribute in the <literal>paste_deploy</literal> group:</paragraph>
            <literal_block xml:space="preserve">[paste_deploy]
flavor = keystone</literal_block>
            <note>
                <paragraph>If your authentication service uses a role other than <literal>admin</literal> to identify
                    which users should be granted admin-level privileges, you must define it
                    in the <literal>admin_role</literal> config attribute in both <literal>glance-registry.conf</literal> and
                    <literal>glance-api.conf</literal>.</paragraph>
            </note>
        </section>
    </section>
</document>
