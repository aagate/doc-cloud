<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/glance/doc/source/admin/manage-images.rst">
    <section ids="manage-images" names="manage\ images">
        <title>Manage images</title>
        <paragraph>The cloud operator assigns roles to users. Roles determine who can
            upload and manage images. The operator might restrict image upload and
            management to only cloud administrators or operators.</paragraph>
        <paragraph>You can upload images through the <literal_strong classes="command">openstack image create</literal_strong>
            command or the Image service API. You can use the <literal>openstack</literal> client
            for the image management. It provides mechanisms to list and
            delete images, set and delete image metadata, and create images of a
            running instance or snapshot and backup types.</paragraph>
        <paragraph>After you upload an image, you cannot change it.</paragraph>
        <paragraph>For details about image creation, see the <reference name="Virtual Machine Image Guide" refuri="https://docs.openstack.org/image-guide/">Virtual Machine Image
                Guide</reference>.</paragraph>
        <section ids="list-or-get-details-for-images-glance" names="list\ or\ get\ details\ for\ images\ (glance)">
            <title>List or get details for images (glance)</title>
            <paragraph>To get a list of images and to get further details about a single
                image, use <literal_strong classes="command">openstack image list</literal_strong> and <literal_strong classes="command">openstack image show</literal_strong>
                commands.</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack image list
+--------------------------------------+---------------------------------+--------+
| ID                                   | Name                            | Status |
+--------------------------------------+---------------------------------+--------+
| dfc1dfb0-d7bf-4fff-8994-319dd6f703d7 | cirros-0.3.5-x86_64-uec         | active |
| a3867e29-c7a1-44b0-9e7f-10db587cad20 | cirros-0.3.5-x86_64-uec-kernel  | active |
| 4b916fba-6775-4092-92df-f41df7246a6b | cirros-0.3.5-x86_64-uec-ramdisk | active |
| d07831df-edc3-4817-9881-89141f9134c3 | myCirrosImage                   | active |
+--------------------------------------+---------------------------------+--------+</literal_block>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack image show myCirrosImage
+------------------+------------------------------------------------------+
| Field            | Value                                                |
+------------------+------------------------------------------------------+
| checksum         | ee1eca47dc88f4879d8a229cc70a07c6                     |
| container_format | ami                                                  |
| created_at       | 2016-08-11T15:07:26Z                                 |
| disk_format      | ami                                                  |
| file             | /v2/images/d07831df-edc3-4817-9881-89141f9134c3/file |
| id               | d07831df-edc3-4817-9881-89141f9134c3                 |
| min_disk         | 0                                                    |
| min_ram          | 0                                                    |
| name             | myCirrosImage                                        |
| owner            | d88310717a8e4ebcae84ed075f82c51e                     |
| protected        | False                                                |
| schema           | /v2/schemas/image                                    |
| size             | 13287936                                             |
| status           | active                                               |
| tags             |                                                      |
| updated_at       | 2016-08-11T15:20:02Z                                 |
| virtual_size     | None                                                 |
| visibility       | private                                              |
+------------------+------------------------------------------------------+</literal_block>
            <paragraph>When viewing a list of images, you can also use <literal>grep</literal> to filter the
                list, as follows:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack image list | grep 'cirros'
| dfc1dfb0-d7bf-4fff-8994-319dd6f703d7 | cirros-0.3.5-x86_64-uec         | active |
| a3867e29-c7a1-44b0-9e7f-10db587cad20 | cirros-0.3.5-x86_64-uec-kernel  | active |
| 4b916fba-6775-4092-92df-f41df7246a6b | cirros-0.3.5-x86_64-uec-ramdisk | active |</literal_block>
            <note>
                <paragraph>To store location metadata for images, which enables direct file access for a client,
                    update the <literal>/etc/glance/glance-api.conf</literal> file with the following statements:</paragraph>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph><literal>show_multiple_locations = True</literal></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>filesystem_store_metadata_file = filePath</literal></paragraph>
                        <paragraph>where filePath points to a JSON file that defines the mount point for OpenStack
                            images on your system and a unique ID. For example:</paragraph>
                    </list_item>
                </bullet_list>
                <literal_block highlight_args="{}" language="json" linenos="False" xml:space="preserve">[{
    "id": "2d9bb53f-70ea-4066-a68b-67960eaae673",
    "mountpoint": "/var/lib/glance/images/"
}]</literal_block>
                <paragraph>After you restart the Image service, you can use the following syntax to view
                    the imageâ€™s location information:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack --os-image-api-version 2 image show imageID</literal_block>
                <paragraph>For example, using the image ID shown above, you would issue the command as follows:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack --os-image-api-version 2 image show 2d9bb53f-70ea-4066-a68b-67960eaae673</literal_block>
            </note>
        </section>
        <section ids="create-or-update-an-image-glance" names="create\ or\ update\ an\ image\ (glance)">
            <title>Create or update an image (glance)</title>
            <paragraph>To create an image, use <literal_strong classes="command">openstack image create</literal_strong>:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack image create imageName</literal_block>
            <paragraph>To update an image by name or ID, use <literal_strong classes="command">openstack image set</literal_strong>:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack image set imageName</literal_block>
            <paragraph>The following list explains the optional arguments that you can use with
                the <literal>create</literal> and <literal>set</literal> commands to modify image properties. For
                more information, refer to the <reference name="OpenStack Image command reference" refuri="https://docs.openstack.org/developer/python-openstackclient/command-objects/image.html">OpenStack Image command reference</reference><target ids="openstack-image-command-reference" names="openstack\ image\ command\ reference" refuri="https://docs.openstack.org/developer/python-openstackclient/command-objects/image.html"></target>.</paragraph>
            <paragraph>The following example shows the command that you would use to upload a
                CentOS 6.3 image in qcow2 format and configure it for public access:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack image create --disk-format qcow2 --container-format bare \
  --public --file ./centos63.qcow2 centos63-image</literal_block>
            <paragraph>The following example shows how to update an existing image with a
                properties that describe the disk bus, the CD-ROM bus, and the VIF
                model:</paragraph>
            <note>
                <paragraph>When you use OpenStack with VMware vCenter Server, you need to specify
                    the <literal>vmware_disktype</literal> and <literal>vmware_adaptertype</literal> properties with
                    <literal_strong classes="command">openstack image create</literal_strong>.
                    Also, we recommend that you set the <literal>hypervisor_type="vmware"</literal> property.
                    For more information, see <reference name="Images with VMware vSphere" refuri="https://docs.openstack.org/ocata/config-reference/compute/hypervisor-vmware.html#images-with-vmware-vsphere">Images with VMware vSphere</reference><target ids="images-with-vmware-vsphere" names="images\ with\ vmware\ vsphere" refuri="https://docs.openstack.org/ocata/config-reference/compute/hypervisor-vmware.html#images-with-vmware-vsphere"></target>
                    in the OpenStack Configuration Reference.</paragraph>
            </note>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack image set \
    --property hw_disk_bus=scsi \
    --property hw_cdrom_bus=ide \
    --property hw_vif_model=e1000 \
    f16-x86_64-openstack-sda</literal_block>
            <paragraph>Currently the libvirt virtualization tool determines the disk, CD-ROM,
                and VIF device models based on the configured hypervisor type
                (<literal>libvirt_type</literal> in <literal>/etc/nova/nova.conf</literal> file). For the sake of optimal
                performance, libvirt defaults to using virtio for both disk and VIF
                (NIC) models. The disadvantage of this approach is that it is not
                possible to run operating systems that lack virtio drivers, for example,
                BSD, Solaris, and older versions of Linux and Windows.</paragraph>
            <paragraph>If you specify a disk or CD-ROM bus model that is not supported, see
                the <reference name="Disk_and_CD-ROM_bus_model_values_table" refid="disk-and-cd-rom-bus-model-values-table">Disk_and_CD-ROM_bus_model_values_table</reference>.
                If you specify a VIF model that is not supported, the instance fails to
                launch. See the <reference name="VIF_model_values_table" refid="vif-model-values-table">VIF_model_values_table</reference>.</paragraph>
            <paragraph>The valid model values depend on the <literal>libvirt_type</literal> setting, as shown
                in the following tables.</paragraph>
            <target refid="disk-and-cd-rom-bus-model-values-table"></target>
            <paragraph ids="disk-and-cd-rom-bus-model-values-table" names="disk_and_cd-rom_bus_model_values_table"><strong>Disk and CD-ROM bus model values</strong></paragraph>
            <table>
                <tgroup cols="2">
                    <colspec colwidth="25"></colspec>
                    <colspec colwidth="26"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>libvirt_type setting</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Supported model values</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>qemu or kvm</paragraph>
                            </entry>
                            <entry>
                                <bullet_list bullet="*">
                                    <list_item>
                                        <paragraph>ide</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>scsi</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>virtio</paragraph>
                                    </list_item>
                                </bullet_list>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>xen</paragraph>
                            </entry>
                            <entry>
                                <bullet_list bullet="*">
                                    <list_item>
                                        <paragraph>ide</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>xen</paragraph>
                                    </list_item>
                                </bullet_list>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <target refid="vif-model-values-table"></target>
            <paragraph ids="vif-model-values-table" names="vif_model_values_table"><strong>VIF model values</strong></paragraph>
            <table>
                <tgroup cols="2">
                    <colspec colwidth="25"></colspec>
                    <colspec colwidth="26"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>libvirt_type setting</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Supported model values</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>qemu or kvm</paragraph>
                            </entry>
                            <entry>
                                <bullet_list bullet="*">
                                    <list_item>
                                        <paragraph>e1000</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>ne2k_pci</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>pcnet</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>rtl8139</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>virtio</paragraph>
                                    </list_item>
                                </bullet_list>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>xen</paragraph>
                            </entry>
                            <entry>
                                <bullet_list bullet="*">
                                    <list_item>
                                        <paragraph>e1000</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>netfront</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>ne2k_pci</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>pcnet</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>rtl8139</paragraph>
                                    </list_item>
                                </bullet_list>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>vmware</paragraph>
                            </entry>
                            <entry>
                                <bullet_list bullet="*">
                                    <list_item>
                                        <paragraph>VirtualE1000</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>VirtualPCNet32</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>VirtualVmxnet</paragraph>
                                    </list_item>
                                </bullet_list>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <note>
                <paragraph>By default, hardware properties are retrieved from the image
                    properties. However, if this information is not available, the
                    <literal>libosinfo</literal> database provides an alternative source for these
                    values.</paragraph>
                <paragraph>If the guest operating system is not in the database, or if the use
                    of <literal>libosinfo</literal> is disabled, the default system values are used.</paragraph>
                <paragraph>Users can set the operating system ID or a <literal>short-id</literal> in image
                    properties. For example:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack image set --property short-id=fedora23 \
  name-of-my-fedora-image</literal_block>
                <paragraph>Alternatively, users can set <literal>id</literal> to a URL:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack image set \
  --property id=http://fedoraproject.org/fedora/23 \
  ID-of-my-fedora-image</literal_block>
            </note>
            <section ids="create-an-image-from-iso-image" names="create\ an\ image\ from\ iso\ image">
                <title>Create an image from ISO image</title>
                <paragraph>You can upload ISO images to the Image service (glance).
                    You can subsequently boot an ISO image using Compute.</paragraph>
                <paragraph>In the Image service, run the following command:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack image create ISO_IMAGE --file IMAGE.iso \
  --disk-format iso --container-format bare</literal_block>
                <paragraph>Optionally, to confirm the upload in Image service, run:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack image list</literal_block>
            </section>
        </section>
        <section ids="troubleshoot-image-creation" names="troubleshoot\ image\ creation">
            <title>Troubleshoot image creation</title>
            <paragraph>If you encounter problems in creating an image in the Image service or
                Compute, the following information may help you troubleshoot the
                creation process.</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Ensure that the version of qemu you are using is version 0.14 or
                        later. Earlier versions of qemu result in an <literal>unknown option -s</literal>
                        error message in the <literal>/var/log/nova/nova-compute.log</literal> file.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Examine the <literal>/var/log/nova/nova-api.log</literal> and
                        <literal>/var/log/nova/nova-compute.log</literal> log files for error messages.</paragraph>
                </list_item>
            </bullet_list>
        </section>
    </section>
</document>
