<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/nova/doc/source/admin/configuration/iscsi-offload.rst">
    <section ids="configuring-iscsi-interface-and-offload-support" names="configuring\ iscsi\ interface\ and\ offload\ support">
        <title>Configuring iSCSI interface and offload support</title>
        <paragraph>Compute supports open-iscsi iSCSI interfaces for offload cards.  Offload
            hardware must be present and configured on every compute node where offload is
            desired. Once an open-iscsi interface is configured, the iface name
            (<literal>iface.iscsi_ifacename</literal>) should be passed to libvirt via the <literal>iscsi_iface</literal>
            parameter for use.  All iSCSI sessions will be bound to this iSCSI interface.</paragraph>
        <paragraph>Currently supported transports (<literal>iface.transport_name</literal>) are <literal>be2iscsi</literal>,
            <literal>bnx2i</literal>, <literal>cxgb3i</literal>, <literal>cxgb4i</literal>, <literal>qla4xxx</literal>, <literal>ocs</literal>.  Configuration changes
            are required on the compute node only.</paragraph>
        <paragraph>iSER is supported using the separate iSER LibvirtISERVolumeDriver and will be
            rejected if used via the <literal>iscsi_iface</literal> parameter.</paragraph>
        <section ids="iscsi-iface-configuration" names="iscsi\ iface\ configuration">
            <title>iSCSI iface configuration</title>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Note the distinction between the transport name (<literal>iface.transport_name</literal>)
                        and iface name (<literal>iface.iscsi_ifacename</literal>). The actual iface name must be
                        specified via the iscsi_iface parameter to libvirt for offload to work.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The default name for an iSCSI iface (open-iscsi parameter
                        <literal>iface.iscsi_ifacename</literal>) is in the format transport_name.hwaddress when
                        generated by <literal>iscsiadm</literal>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>iscsiadm</literal> can be used to view and generate current iface configuration.
                        Every network interface that supports an open-iscsi transport can have one or
                        more iscsi ifaces associated with it. If no ifaces have been configured for a
                        network interface supported by an open-iscsi transport, this command will
                        create a default iface configuration for that network interface. For example
                        :</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># iscsiadm -m iface
default tcp,&lt;empty&gt;,&lt;empty&gt;,&lt;empty&gt;,&lt;empty&gt;
iser iser,&lt;empty&gt;,&lt;empty&gt;,&lt;empty&gt;,&lt;empty&gt;
bnx2i.00:05:b5:d2:a0:c2 bnx2i,00:05:b5:d2:a0:c2,5.10.10.20,&lt;empty&gt;,&lt;empty&gt;</literal_block>
                    <paragraph>The output is in the format:</paragraph>
                    <literal_block xml:space="preserve">iface_name transport_name,hwaddress,ipaddress,net_ifacename,initiatorname</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Individual iface configuration can be viewed via</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># iscsiadm -m iface -I IFACE_NAME
# BEGIN RECORD 2.0-873
iface.iscsi_ifacename = cxgb4i.00:07:43:28:b2:58
iface.net_ifacename = &lt;empty&gt;
iface.ipaddress = 102.50.50.80
iface.hwaddress = 00:07:43:28:b2:58
iface.transport_name = cxgb4i
iface.initiatorname = &lt;empty&gt;
# END RECORD</literal_block>
                    <paragraph>Configuration can be updated as desired via</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># iscsiadm -m iface-I IFACE_NAME--op=update -n iface.SETTING -v VALUE</literal_block>
                </list_item>
                <list_item>
                    <paragraph>All iface configurations need a minimum of <literal>iface.iface_name</literal>,
                        <literal>iface.transport_name</literal> and <literal>iface.hwaddress</literal> to be correctly configured
                        to work. Some transports may require <literal>iface.ipaddress</literal> and
                        <literal>iface.net_ifacename</literal> as well to bind correctly.</paragraph>
                    <paragraph>Detailed configuration instructions can be found at
                        <reference refuri="http://www.open-iscsi.org/docs/README">http://www.open-iscsi.org/docs/README</reference>.</paragraph>
                </list_item>
            </bullet_list>
        </section>
    </section>
</document>
