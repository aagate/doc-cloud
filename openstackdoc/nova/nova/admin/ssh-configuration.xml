<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/nova/doc/source/admin/ssh-configuration.rst">
    <target refid="cli-os-migrate-cfg-ssh"></target>
    <section ids="configure-ssh-between-compute-nodes cli-os-migrate-cfg-ssh" names="configure\ ssh\ between\ compute\ nodes cli-os-migrate-cfg-ssh">
        <title>Configure SSH between compute nodes</title>
        <target refid="index-0"></target>
        <todo_node classes="admonition-todo" ids="index-0">
            <title>Todo</title>
            <paragraph>Consider merging this into a larger "live-migration" document or to the
                installation guide</paragraph>
        </todo_node>
        <paragraph>If you are resizing or migrating an instance between hypervisors, you might
            encounter an SSH (Permission denied) error. Ensure that each node is configured
            with SSH key authentication so that the Compute service can use SSH to move
            disks to other nodes.</paragraph>
        <paragraph>To share a key pair between compute nodes, complete the following steps:</paragraph>
        <enumerated_list enumtype="arabic" prefix="" suffix=".">
            <list_item>
                <paragraph>On the first node, obtain a key pair (public key and private key). Use the
                    root key that is in the <literal>/root/.ssh/id_rsa</literal> and <literal>/root/.ssh/id_ras.pub</literal>
                    directories or generate a new key pair.</paragraph>
            </list_item>
            <list_item>
                <paragraph>Run <literal_strong classes="command">setenforce 0</literal_strong> to put SELinux into permissive mode.</paragraph>
            </list_item>
            <list_item>
                <paragraph>Enable login abilities for the nova user:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># usermod -s /bin/bash nova</literal_block>
                <paragraph>Switch to the nova account.</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># su nova</literal_block>
            </list_item>
            <list_item>
                <paragraph>As root, create the folder that is needed by SSH and place the private key
                    that you obtained in step 1 into this folder:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">mkdir -p /var/lib/nova/.ssh
cp &lt;private key&gt;  /var/lib/nova/.ssh/id_rsa
echo 'StrictHostKeyChecking no' &gt;&gt; /var/lib/nova/.ssh/config
chmod 600 /var/lib/nova/.ssh/id_rsa /var/lib/nova/.ssh/authorized_keys</literal_block>
            </list_item>
            <list_item>
                <paragraph>Repeat steps 2-4 on each node.</paragraph>
                <note>
                    <paragraph>The nodes must share the same key pair, so do not generate a new key pair
                        for any subsequent nodes.</paragraph>
                </note>
            </list_item>
            <list_item>
                <paragraph>From the first node, where you created the SSH key, run:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">ssh-copy-id -i &lt;pub key&gt; nova@remote-host</literal_block>
                <paragraph>This command installs your public key in a remote machine's
                    <literal>authorized_keys</literal> folder.</paragraph>
            </list_item>
            <list_item>
                <paragraph>Ensure that the nova user can now log in to each node without using a
                    password:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># su nova
$ ssh *computeNodeAddress*
$ exit</literal_block>
            </list_item>
            <list_item>
                <paragraph>As root on each node, restart both libvirt and the Compute services:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># systemctl restart libvirtd.service
# systemctl restart openstack-nova-compute.service</literal_block>
            </list_item>
        </enumerated_list>
    </section>
</document>
