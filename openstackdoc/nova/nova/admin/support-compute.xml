<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/nova/doc/source/admin/support-compute.rst">
    <section ids="troubleshoot-compute" names="troubleshoot\ compute">
        <title>Troubleshoot Compute</title>
        <paragraph>Common problems for Compute typically involve misconfigured networking or
            credentials that are not sourced properly in the environment. Also, most flat
            networking configurations do not enable <literal_strong classes="command">ping</literal_strong> or <literal_strong classes="command">ssh</literal_strong> from
            a compute node to the instances that run on that node. Another common problem
            is trying to run 32-bit images on a 64-bit compute node.  This section shows
            you how to troubleshoot Compute.</paragraph>
        <section ids="compute-service-logging" names="compute\ service\ logging">
            <title>Compute service logging</title>
            <paragraph>Compute stores a log file for each service in <literal>/var/log/nova</literal>. For example,
                <literal>nova-compute.log</literal> is the log for the <literal>nova-compute</literal> service. You can set
                the following options to format log strings for the <literal>nova.log</literal> module in the
                <literal>nova.conf</literal> file:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph><literal>logging_context_format_string</literal></paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>logging_default_format_string</literal></paragraph>
                </list_item>
            </bullet_list>
            <paragraph>If the log level is set to <literal>debug</literal>, you can also specify
                <literal>logging_debug_format_suffix</literal> to append extra formatting.  For information
                about what variables are available for the formatter, see <reference name="Formatter Objects" refuri="https://docs.python.org/library/logging.html#formatter-objects">Formatter Objects</reference><target ids="formatter-objects" names="formatter\ objects" refuri="https://docs.python.org/library/logging.html#formatter-objects"></target>.</paragraph>
            <paragraph>You have two logging options for OpenStack Compute based on configuration
                settings. In <literal>nova.conf</literal>, include the <literal>logfile</literal> option to enable logging.
                Alternatively you can set <literal>use_syslog = 1</literal> so that the nova daemon logs to
                syslog.</paragraph>
        </section>
        <section dupnames="guru\ meditation\ reports" ids="guru-meditation-reports">
            <title>Guru Meditation reports</title>
            <paragraph>A Guru Meditation report is sent by the Compute service upon receipt of the
                <literal>SIGUSR2</literal> signal (<literal>SIGUSR1</literal> before Mitaka). This report is a
                general-purpose error report that includes details about the current state of
                the service. The error report is sent to <literal>stderr</literal>.</paragraph>
            <paragraph>For example, if you redirect error output to <literal>nova-api-err.log</literal> using
                <literal_strong classes="command">nova-api 2&gt;/var/log/nova/nova-api-err.log</literal_strong>, resulting in the process
                ID 8675, you can then run:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># kill -USR2 8675</literal_block>
            <paragraph>This command triggers the Guru Meditation report to be printed to
                <literal>/var/log/nova/nova-api-err.log</literal>.</paragraph>
            <paragraph>The report has the following sections:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Package: Displays information about the package to which the process belongs,
                        including version information.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Threads: Displays stack traces and thread IDs for each of the threads within
                        the process.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Green Threads: Displays stack traces for each of the green threads within the
                        process (green threads do not have thread IDs).</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Configuration: Lists all configuration options currently accessible through
                        the CONF object for the current process.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>For more information, see <reference name="Guru Meditation Reports" refuri="https://docs.openstack.org/developer/nova/devref/gmr.html">Guru Meditation Reports</reference><target ids="id1" names="guru\ meditation\ reports" refuri="https://docs.openstack.org/developer/nova/devref/gmr.html"></target>.</paragraph>
            <target refid="compute-common-errors-and-fixes"></target>
        </section>
        <section ids="common-errors-and-fixes-for-compute compute-common-errors-and-fixes" names="common\ errors\ and\ fixes\ for\ compute compute-common-errors-and-fixes">
            <title>Common errors and fixes for Compute</title>
            <paragraph>The <reference name="ask.openstack.org" refuri="http://ask.openstack.org">ask.openstack.org</reference><target ids="ask-openstack-org" names="ask.openstack.org" refuri="http://ask.openstack.org"></target> site offers a place to ask
                and answer questions, and you can also mark questions as frequently asked
                questions. This section describes some errors people have posted previously.
                Bugs are constantly being fixed, so online resources are a great way to get the
                most up-to-date errors and fixes.</paragraph>
        </section>
        <section ids="credential-errors-401-and-403-forbidden-errors" names="credential\ errors,\ 401,\ and\ 403\ forbidden\ errors">
            <title>Credential errors, 401, and 403 forbidden errors</title>
            <section dupnames="problem" ids="problem">
                <title>Problem</title>
                <paragraph>Missing credentials cause a <literal>403 forbidden</literal> error.</paragraph>
            </section>
            <section dupnames="solution" ids="solution">
                <title>Solution</title>
                <paragraph>To resolve this issue, use one of these methods:</paragraph>
                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                    <list_item>
                        <paragraph>Manual method</paragraph>
                        <paragraph>Gets the <literal>novarc</literal> file from the project ZIP file, saves existing
                            credentials in case of override, and manually sources the <literal>novarc</literal> file.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Script method</paragraph>
                        <paragraph>Generates <literal>novarc</literal> from the project ZIP file and sources it for you.</paragraph>
                    </list_item>
                </enumerated_list>
                <paragraph>When you run <literal>nova-api</literal> the first time, it generates the certificate
                    authority information, including <literal>openssl.cnf</literal>. If you start the CA services
                    before this, you might not be able to create your ZIP file. Restart the
                    services.  When your CA information is available, create your ZIP file.</paragraph>
                <paragraph>Also, check your HTTP proxy settings to see whether they cause problems with
                    <literal>novarc</literal> creation.</paragraph>
            </section>
        </section>
        <section ids="instance-errors" names="instance\ errors">
            <title>Instance errors</title>
            <section dupnames="problem" ids="id2">
                <title>Problem</title>
                <paragraph>Sometimes a particular instance shows <literal>pending</literal> or you cannot SSH to it.
                    Sometimes the image itself is the problem. For example, when you use flat
                    manager networking, you do not have a DHCP server and certain images do not
                    support interface injection; you cannot connect to them.</paragraph>
            </section>
            <section dupnames="solution" ids="id3">
                <title>Solution</title>
                <paragraph>To fix instance errors use an image that does support this method, such as
                    Ubuntu, which obtains an IP address correctly with FlatManager network
                    settings.</paragraph>
                <paragraph>To troubleshoot other possible problems with an instance, such as an instance
                    that stays in a spawning state, check the directory for the particular instance
                    under <literal>/var/lib/nova/instances</literal> on the <literal>nova-compute</literal> host and make sure
                    that these files are present:</paragraph>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph><literal>libvirt.xml</literal></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>disk</literal></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>disk-raw</literal></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>kernel</literal></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>ramdisk</literal></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>console.log</literal>, after the instance starts.</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>If any files are missing, empty, or very small, the <literal>nova-compute</literal> service
                    did not successfully download the images from the Image service.</paragraph>
                <paragraph>Also check <literal>nova-compute.log</literal> for exceptions. Sometimes they do not appear in
                    the console output.</paragraph>
                <paragraph>Next, check the log file for the instance in the <literal>/var/log/libvirt/qemu</literal>
                    directory to see if it exists and has any useful error messages in it.</paragraph>
                <paragraph>Finally, from the <literal>/var/lib/nova/instances</literal> directory for the instance, see
                    if this command returns an error:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># virsh create libvirt.xml</literal_block>
            </section>
        </section>
        <section ids="empty-log-output-for-linux-instances" names="empty\ log\ output\ for\ linux\ instances">
            <title>Empty log output for Linux instances</title>
            <section dupnames="problem" ids="id4">
                <title>Problem</title>
                <paragraph>You can view the log output of running instances from either the
                    <inline classes="guilabel" rawtext=":guilabel:`Log`">Log</inline> tab of the dashboard or the output of <literal_strong classes="command">nova
                        console-log</literal_strong>. In some cases, the log output of a running Linux instance will be
                    empty or only display a single character (for example, the <title_reference>?</title_reference> character).</paragraph>
                <paragraph>This occurs when the Compute service attempts to retrieve the log output of the
                    instance via a serial console while the instance itself is not configured to
                    send output to the console.</paragraph>
            </section>
            <section dupnames="solution" ids="id5">
                <title>Solution</title>
                <paragraph>To rectify this, append the following parameters to kernel arguments specified
                    in the instance's boot loader:</paragraph>
                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">console=tty0 console=ttyS0,115200n8</literal_block>
                <paragraph>Upon rebooting, the instance will be configured to send output to the Compute
                    service.</paragraph>
            </section>
        </section>
        <section ids="reset-the-state-of-an-instance" names="reset\ the\ state\ of\ an\ instance">
            <title>Reset the state of an instance</title>
            <section dupnames="problem" ids="id6">
                <title>Problem</title>
                <paragraph>Instances can remain in an intermediate state, such as <literal>deleting</literal>.</paragraph>
            </section>
            <section dupnames="solution" ids="id7">
                <title>Solution</title>
                <paragraph>You can use the <literal_strong classes="command">nova reset-state</literal_strong> command to manually reset the state
                    of an instance to an error state. You can then delete the instance. For
                    example:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ nova reset-state c6bbbf26-b40a-47e7-8d5c-eb17bf65c485
$ openstack server delete c6bbbf26-b40a-47e7-8d5c-eb17bf65c485</literal_block>
                <paragraph>You can also use the <literal>--active</literal> parameter to force the instance back to an
                    active state instead of an error state. For example:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ nova reset-state --active c6bbbf26-b40a-47e7-8d5c-eb17bf65c485</literal_block>
            </section>
        </section>
        <section ids="injection-problems" names="injection\ problems">
            <title>Injection problems</title>
            <section dupnames="problem" ids="id8">
                <title>Problem</title>
                <paragraph>Instances may boot slowly, or do not boot. File injection can cause this
                    problem.</paragraph>
            </section>
            <section dupnames="solution" ids="id9">
                <title>Solution</title>
                <paragraph>To disable injection in libvirt, set the following in <literal>nova.conf</literal>:</paragraph>
                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[libvirt]
inject_partition = -2</literal_block>
                <note>
                    <paragraph>If you have not enabled the configuration drive and you want to make
                        user-specified files available from the metadata server for to improve
                        performance and avoid boot failure if injection fails, you must disable
                        injection.</paragraph>
                </note>
            </section>
        </section>
        <section ids="disable-live-snapshotting" names="disable\ live\ snapshotting">
            <title>Disable live snapshotting</title>
            <section dupnames="problem" ids="id10">
                <title>Problem</title>
                <paragraph>Administrators using libvirt version <literal>1.2.2</literal> may experience problems with
                    live snapshot creation. Occasionally, libvirt version <literal>1.2.2</literal> fails to create
                    live snapshots under the load of creating concurrent snapshot.</paragraph>
            </section>
            <section dupnames="solution" ids="id11">
                <title>Solution</title>
                <paragraph>To effectively disable the libvirt live snapshotting, until the problem is
                    resolved, configure the <literal>disable_libvirt_livesnapshot</literal> option.  You can turn
                    off the live snapshotting mechanism by setting up its value to <literal>True</literal> in the
                    <literal>[workarounds]</literal> section of the <literal>nova.conf</literal> file:</paragraph>
                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[workarounds]
disable_libvirt_livesnapshot = True</literal_block>
            </section>
        </section>
        <section ids="cannot-find-suitable-emulator-for-x86-64" names="cannot\ find\ suitable\ emulator\ for\ x86_64">
            <title>Cannot find suitable emulator for x86_64</title>
            <section dupnames="problem" ids="id12">
                <title>Problem</title>
                <paragraph>When you attempt to create a VM, the error shows the VM is in the <literal>BUILD</literal>
                    then <literal>ERROR</literal> state.</paragraph>
            </section>
            <section dupnames="solution" ids="id13">
                <title>Solution</title>
                <paragraph>On the KVM host, run <literal_strong classes="command">cat /proc/cpuinfo</literal_strong>. Make sure the <literal>vmx</literal> or
                    <literal>svm</literal> flags are set.</paragraph>
                <paragraph>Follow the instructions in the <reference internal="True" refuri="configuration/hypervisor-kvm#enable-kvm"><inline classes="std std-ref">Enable KVM</inline></reference>
                    section in the Nova Configuration Reference to enable hardware
                    virtualization support in your BIOS.</paragraph>
            </section>
        </section>
        <section ids="failed-to-attach-volume-after-detaching" names="failed\ to\ attach\ volume\ after\ detaching">
            <title>Failed to attach volume after detaching</title>
            <section dupnames="problem" ids="id14">
                <title>Problem</title>
                <paragraph>Failed to attach a volume after detaching the same volume.</paragraph>
            </section>
            <section dupnames="solution" ids="id15">
                <title>Solution</title>
                <paragraph>You must change the device name on the <literal_strong classes="command">nova-attach</literal_strong> command. The VM
                    might not clean up after a <literal_strong classes="command">nova-detach</literal_strong> command runs. This example
                    shows how the <literal_strong classes="command">nova-attach</literal_strong> command fails when you use the <literal>vdb</literal>,
                    <literal>vdc</literal>, or <literal>vdd</literal> device names:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># ls -al /dev/disk/by-path/
total 0
drwxr-xr-x 2 root root 200 2012-08-29 17:33 .
drwxr-xr-x 5 root root 100 2012-08-29 17:33 ..
lrwxrwxrwx 1 root root 9 2012-08-29 17:33 pci-0000:00:04.0-virtio-pci-virtio0 -&gt; ../../vda
lrwxrwxrwx 1 root root 10 2012-08-29 17:33 pci-0000:00:04.0-virtio-pci-virtio0-part1 -&gt; ../../vda1
lrwxrwxrwx 1 root root 10 2012-08-29 17:33 pci-0000:00:04.0-virtio-pci-virtio0-part2 -&gt; ../../vda2
lrwxrwxrwx 1 root root 10 2012-08-29 17:33 pci-0000:00:04.0-virtio-pci-virtio0-part5 -&gt; ../../vda5
lrwxrwxrwx 1 root root 9 2012-08-29 17:33 pci-0000:00:06.0-virtio-pci-virtio2 -&gt; ../../vdb
lrwxrwxrwx 1 root root 9 2012-08-29 17:33 pci-0000:00:08.0-virtio-pci-virtio3 -&gt; ../../vdc
lrwxrwxrwx 1 root root 9 2012-08-29 17:33 pci-0000:00:09.0-virtio-pci-virtio4 -&gt; ../../vdd
lrwxrwxrwx 1 root root 10 2012-08-29 17:33 pci-0000:00:09.0-virtio-pci-virtio4-part1 -&gt; ../../vdd1</literal_block>
                <paragraph>You might also have this problem after attaching and detaching the same volume
                    from the same VM with the same mount point multiple times. In this case,
                    restart the KVM host.</paragraph>
            </section>
        </section>
        <section ids="failed-to-attach-volume-systool-is-not-installed" names="failed\ to\ attach\ volume,\ systool\ is\ not\ installed">
            <title>Failed to attach volume, systool is not installed</title>
            <section dupnames="problem" ids="id16">
                <title>Problem</title>
                <paragraph>This warning and error occurs if you do not have the required <literal>sysfsutils</literal>
                    package installed on the compute node:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">WARNING nova.virt.libvirt.utils [req-1200f887-c82b-4e7c-a891-fac2e3735dbb\
admin admin|req-1200f887-c82b-4e7c-a891-fac2e3735dbb admin admin] systool\
is not installed
ERROR nova.compute.manager [req-1200f887-c82b-4e7c-a891-fac2e3735dbb admin\
admin|req-1200f887-c82b-4e7c-a891-fac2e3735dbb admin admin]
[instance: df834b5a-8c3f-477a-be9b-47c97626555c|instance: df834b5a-8c3f-47\
7a-be9b-47c97626555c]
Failed to attach volume 13d5c633-903a-4764-a5a0-3336945b1db1 at /dev/vdk.</literal_block>
            </section>
            <section dupnames="solution" ids="id17">
                <title>Solution</title>
                <paragraph>Install the <literal>sysfsutils</literal> package on the compute node. For example:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># apt-get install sysfsutils</literal_block>
            </section>
        </section>
        <section ids="failed-to-connect-volume-in-fc-san" names="failed\ to\ connect\ volume\ in\ fc\ san">
            <title>Failed to connect volume in FC SAN</title>
            <section dupnames="problem" ids="id18">
                <title>Problem</title>
                <paragraph>The compute node failed to connect to a volume in a Fibre Channel (FC) SAN
                    configuration. The WWN may not be zoned correctly in your FC SAN that links the
                    compute host to the storage array:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">ERROR nova.compute.manager [req-2ddd5297-e405-44ab-aed3-152cd2cfb8c2 admin\
demo|req-2ddd5297-e405-44ab-aed3-152cd2cfb8c2 admin demo] [instance: 60ebd\
6c7-c1e3-4bf0-8ef0-f07aa4c3d5f3|instance: 60ebd6c7-c1e3-4bf0-8ef0-f07aa4c3\
d5f3]
Failed to connect to volume 6f6a6a9c-dfcf-4c8d-b1a8-4445ff883200 while\
attaching at /dev/vdjTRACE nova.compute.manager [instance: 60ebd6c7-c1e3-4\
bf0-8ef0-f07aa4c3d5f3|instance: 60ebd6c7-c1e3-4bf0-8ef0-f07aa4c3d5f3]
Traceback (most recent call last):…f07aa4c3d5f3\] ClientException: The\
server has either erred or is incapable of performing the requested\
operation.(HTTP 500)(Request-ID: req-71e5132b-21aa-46ee-b3cc-19b5b4ab2f00)</literal_block>
            </section>
            <section dupnames="solution" ids="id19">
                <title>Solution</title>
                <paragraph>The network administrator must configure the FC SAN fabric by correctly zoning
                    the WWN (port names) from your compute node HBAs.</paragraph>
            </section>
        </section>
        <section ids="multipath-call-failed-exit" names="multipath\ call\ failed\ exit">
            <title>Multipath call failed exit</title>
            <section dupnames="problem" ids="id20">
                <title>Problem</title>
                <paragraph>Multipath call failed exit. This warning occurs in the Compute log if you do
                    not have the optional <literal>multipath-tools</literal> package installed on the compute
                    node. This is an optional package and the volume attachment does work without
                    the multipath tools installed.  If the <literal>multipath-tools</literal> package is installed
                    on the compute node, it is used to perform the volume attachment.  The IDs in
                    your message are unique to your system.</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">WARNING nova.storage.linuxscsi [req-cac861e3-8b29-4143-8f1b-705d0084e571 \
admin admin|req-cac861e3-8b29-4143-8f1b-705d0084e571 admin admin] \
Multipath call failed exit (96)</literal_block>
            </section>
            <section dupnames="solution" ids="id21">
                <title>Solution</title>
                <paragraph>Install the <literal>multipath-tools</literal> package on the compute node. For example:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># apt-get install multipath-tools</literal_block>
            </section>
        </section>
        <section ids="failed-to-attach-volume-missing-sg-scan" names="failed\ to\ attach\ volume,\ missing\ sg_scan">
            <title>Failed to Attach Volume, Missing sg_scan</title>
            <section dupnames="problem" ids="id22">
                <title>Problem</title>
                <paragraph>Failed to attach volume to an instance, <literal>sg_scan</literal> file not found. This error
                    occurs when the sg3-utils package is not installed on the compute node.  The
                    IDs in your message are unique to your system:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">ERROR nova.compute.manager [req-cf2679fd-dd9e-4909-807f-48fe9bda3642 admin admin|req-cf2679fd-dd9e-4909-807f-48fe9bda3642 admin admin]
[instance: 7d7c92e0-49fa-4a8e-87c7-73f22a9585d5|instance:  7d7c92e0-49fa-4a8e-87c7-73f22a9585d5]
Failed to attach volume  4cc104c4-ac92-4bd6-9b95-c6686746414a at /dev/vdcTRACE nova.compute.manager
[instance:  7d7c92e0-49fa-4a8e-87c7-73f22a9585d5|instance: 7d7c92e0-49fa-4a8e-87c7-73f22a9585d5]
Stdout: '/usr/local/bin/nova-rootwrap: Executable not found: /usr/bin/sg_scan'</literal_block>
            </section>
            <section dupnames="solution" ids="id23">
                <title>Solution</title>
                <paragraph>Install the <literal>sg3-utils</literal> package on the compute node. For example:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># apt-get install sg3-utils</literal_block>
            </section>
        </section>
    </section>
</document>
