<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/nova/doc/source/admin/migration.rst">
    <section ids="migrate-instances" names="migrate\ instances">
        <title>Migrate instances</title>
        <paragraph>When you want to move an instance from one compute host to another, you can use
            the <literal_strong classes="command">openstack server migrate</literal_strong> command. The scheduler chooses the
            destination compute host based on its settings. This process does not assume
            that the instance has shared storage available on the target host. If you are
            using SSH tunneling, you must ensure that each node is configured with SSH key
            authentication so that the Compute service can use SSH to move disks to other
            nodes. For more information, see <reference internal="True" refuri="ssh-configuration#cli-os-migrate-cfg-ssh"><inline classes="std std-ref">Configure SSH between compute nodes</inline></reference>.</paragraph>
        <enumerated_list enumtype="arabic" prefix="" suffix=".">
            <list_item>
                <paragraph>To list the VMs you want to migrate, run:</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack server list</literal_block>
            </list_item>
            <list_item>
                <paragraph>Use the <literal_strong classes="command">openstack server migrate</literal_strong> command.</paragraph>
                <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack server migrate --live TARGET_HOST VM_INSTANCE</literal_block>
            </list_item>
            <list_item>
                <paragraph>To migrate an instance and watch the status, use this example script:</paragraph>
                <literal_block highlight_args="{}" language="bash" linenos="False" xml:space="preserve">#!/bin/bash

# Provide usage
usage() {
echo "Usage: $0 VM_ID"
exit 1
}

[[ $# -eq 0 ]] &amp;&amp; usage

# Migrate the VM to an alternate hypervisor
echo -n "Migrating instance to alternate host"
VM_ID=$1
openstack server migrate $VM_ID
VM_OUTPUT=$(openstack server show $VM_ID)
VM_STATUS=$(echo "$VM_OUTPUT" | grep status | awk '{print $4}')
while [[ "$VM_STATUS" != "VERIFY_RESIZE" ]]; do
echo -n "."
sleep 2
VM_OUTPUT=$(openstack server show $VM_ID)
VM_STATUS=$(echo "$VM_OUTPUT" | grep status | awk '{print $4}')
done
nova resize-confirm $VM_ID
echo " instance migrated and resized."
echo;

# Show the details for the VM
echo "Updated instance details:"
openstack server show $VM_ID

# Pause to allow users to examine VM details
read -p "Pausing, press &lt;enter&gt; to exit."</literal_block>
            </list_item>
        </enumerated_list>
        <note>
            <paragraph>If you see the following error, it means you are either running the command
                with the wrong credentials, such as a non-admin user, or the <literal>policy.json</literal>
                file prevents migration for your user:</paragraph>
            <literal_block xml:space="preserve">ERROR (Forbidden): Policy doesn't allow compute_extension:admin_actions:migrate to be performed. (HTTP 403)``</literal_block>
        </note>
        <note>
            <paragraph>If you see the following error, similar to this message, SSH tunneling was
                not set up between the compute nodes:</paragraph>
            <literal_block xml:space="preserve">ProcessExecutionError: Unexpected error while running command.
Stderr: u Host key verification failed.\r\n</literal_block>
        </note>
        <paragraph>The instance is booted from a new host, but preserves its configuration
            including instance ID, name, IP address, any metadata, and other properties.</paragraph>
    </section>
</document>
