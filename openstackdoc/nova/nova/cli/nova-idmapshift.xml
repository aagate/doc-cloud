<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/nova/doc/source/cli/nova-idmapshift.rst">
    <section ids="nova-idmapshift" names="nova-idmapshift">
        <title>nova-idmapshift</title>
        <section ids="tool-used-by-nova-libvirt-lxc-virt-driver" names="tool\ used\ by\ nova\ libvirt-lxc\ virt\ driver">
            <title>Tool used by Nova libvirt-lxc virt driver</title>
            <field_list>
                <field>
                    <field_name>Author</field_name>
                    <field_body>
                        <paragraph><reference refuri="mailto:openstack@lists.openstack.org">openstack@lists.openstack.org</reference></paragraph>
                    </field_body>
                </field>
                <field>
                    <field_name>Date</field_name>
                    <field_body>
                        <paragraph>2012-09-27</paragraph>
                    </field_body>
                </field>
                <field>
                    <field_name>Copyright</field_name>
                    <field_body>
                        <paragraph>OpenStack Foundation</paragraph>
                    </field_body>
                </field>
                <field>
                    <field_name>Version</field_name>
                    <field_body>
                        <paragraph>2012.1</paragraph>
                    </field_body>
                </field>
                <field>
                    <field_name>Manual section</field_name>
                    <field_body>
                        <paragraph>1</paragraph>
                    </field_body>
                </field>
                <field>
                    <field_name>Manual group</field_name>
                    <field_body>
                        <paragraph>cloud computing</paragraph>
                    </field_body>
                </field>
            </field_list>
            <section ids="synopsis" names="synopsis">
                <title>SYNOPSIS</title>
                <paragraph>nova-idmapshift [options] path</paragraph>
            </section>
            <section ids="description" names="description">
                <title>DESCRIPTION</title>
                <paragraph>nova-idmapshift is a tool that properly sets the ownership of a filesystem for use
                    with linux user namespaces.  This tool can only be used with linux lxc containers.</paragraph>
                <paragraph>When using user namespaces with linux lxc containers, the filesystem of the
                    container must be owned by the targeted user and group ids being applied
                    to that container. Otherwise, processes inside the container won't be able
                    to access the filesystem.</paragraph>
                <paragraph>For example:
                    nova-idmapshift -i -u 0:10000:2000 -g 0:10000:2000 path</paragraph>
                <paragraph>This command will idempotently shift <title_reference>path</title_reference> to proper ownership using
                    the provided uid and gid mappings.</paragraph>
                <paragraph>When using the uid map string '0:10000:2000', this means that
                    user ids inside the container between 0 and 1999 will map to user ids on
                    the host between 10000 and 11999. Root (0) becomes 10000, user 1 becomes
                    10001, user 50 becomes 10050 and user 1999 becomes 11999. This means that
                    files that are owned by root need to actually be owned by user 10000, and
                    files owned by 50 need to be owned by 10050, and so on.</paragraph>
                <paragraph>nova-idmapshift will take the uid and gid strings used for user namespaces and
                    properly set up the filesystem for use by those users. Uids and gids outside
                    of provided ranges will be mapped to nobody-id (default is max uid/gid)
                    so that they are inaccessible inside the container.</paragraph>
            </section>
            <section ids="options" names="options">
                <title>OPTIONS</title>
                <section ids="positional-arguments" names="positional\ arguments">
                    <title>Positional arguments</title>
                    <block_quote>
                        <paragraph>path                 Root path of the filesystem to be shifted</paragraph>
                    </block_quote>
                </section>
                <section ids="optional-arguments" names="optional\ arguments">
                    <title>Optional arguments</title>
                    <block_quote>
                        <option_list>
                            <option_list_item>
                                <option_group>
                                    <option>
                                        <option_string>-h</option_string>
                                    </option>
                                    <option>
                                        <option_string>--help</option_string>
                                    </option>
                                </option_group>
                                <description>
                                    <paragraph>Show this help message and exit.</paragraph>
                                </description>
                            </option_list_item>
                            <option_list_item>
                                <option_group>
                                    <option>
                                        <option_string>-u</option_string>
                                        <option_argument delimiter=" ">USER_MAPS</option_argument>
                                    </option>
                                    <option>
                                        <option_string>--uid</option_string>
                                        <option_argument delimiter="=">USER_MAPS</option_argument>
                                    </option>
                                </option_group>
                                <description>
                                    <paragraph>User ID mappings, in the form:
                                        [[guest-uid:host-uid:count],...]</paragraph>
                                </description>
                            </option_list_item>
                            <option_list_item>
                                <option_group>
                                    <option>
                                        <option_string>-g</option_string>
                                        <option_argument delimiter=" ">GROUP_MAPS</option_argument>
                                    </option>
                                    <option>
                                        <option_string>--gid</option_string>
                                        <option_argument delimiter="=">GROUP_MAPS</option_argument>
                                    </option>
                                </option_group>
                                <description>
                                    <paragraph>Group ID mappings, in the form:
                                        [[guest-gid:host-gid:count],...]</paragraph>
                                </description>
                            </option_list_item>
                            <option_list_item>
                                <option_group>
                                    <option>
                                        <option_string>-n</option_string>
                                        <option_argument delimiter=" ">nobody-id</option_argument>
                                    </option>
                                    <option>
                                        <option_string>--nobody</option_string>
                                        <option_argument delimiter=" ">nobody-id</option_argument>
                                    </option>
                                </option_group>
                                <description>
                                    <paragraph>ID to map all unmapped uid and gids to.
                                        Defaults to 65534.</paragraph>
                                </description>
                            </option_list_item>
                            <option_list_item>
                                <option_group>
                                    <option>
                                        <option_string>-i</option_string>
                                    </option>
                                    <option>
                                        <option_string>--idempotent</option_string>
                                    </option>
                                </option_group>
                                <description>
                                    <paragraph>Shift operation will only be performed if filesystem appears unshifted.
                                        Defaults to false.</paragraph>
                                </description>
                            </option_list_item>
                            <option_list_item>
                                <option_group>
                                    <option>
                                        <option_string>-c</option_string>
                                    </option>
                                    <option>
                                        <option_string>--confirm</option_string>
                                    </option>
                                </option_group>
                                <description>
                                    <paragraph>Will perform check on the filesystem:</paragraph>
                                    <paragraph>Returns 0 when filesystem appears shifted.</paragraph>
                                    <paragraph>Returns 1 when filesystem appears unshifted.</paragraph>
                                    <paragraph>Defaults to false.</paragraph>
                                </description>
                            </option_list_item>
                            <option_list_item>
                                <option_group>
                                    <option>
                                        <option_string>-d</option_string>
                                    </option>
                                    <option>
                                        <option_string>--dry-run</option_string>
                                    </option>
                                </option_group>
                                <description>
                                    <paragraph>Print chown operations, but won't perform them.
                                        Defaults to false.</paragraph>
                                </description>
                            </option_list_item>
                            <option_list_item>
                                <option_group>
                                    <option>
                                        <option_string>-v</option_string>
                                    </option>
                                    <option>
                                        <option_string>--verbose</option_string>
                                    </option>
                                </option_group>
                                <description>
                                    <paragraph>Print chown operations while performing them.
                                        Defaults to false.</paragraph>
                                </description>
                            </option_list_item>
                        </option_list>
                    </block_quote>
                </section>
            </section>
            <section ids="see-also" names="see\ also">
                <title>SEE ALSO</title>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph><reference name="OpenStack Nova" refuri="https://docs.openstack.org/developer/nova">OpenStack Nova</reference></paragraph>
                    </list_item>
                </bullet_list>
            </section>
            <section ids="bugs" names="bugs">
                <title>BUGS</title>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph>Nova bugs are managed at Launchpad <reference name="Bugs : Nova" refuri="https://bugs.launchpad.net/nova">Bugs : Nova</reference></paragraph>
                    </list_item>
                </bullet_list>
            </section>
        </section>
    </section>
</document>
