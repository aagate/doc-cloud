<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/nova/doc/source/install/controller-install-rdo.rst">
    <section ids="install-and-configure-controller-node-for-red-hat-enterprise-linux-and-centos" names="install\ and\ configure\ controller\ node\ for\ red\ hat\ enterprise\ linux\ and\ centos">
        <title>Install and configure controller node for Red Hat Enterprise Linux and CentOS</title>
        <paragraph>This section describes how to install and configure the Compute service,
            code-named nova, on the controller node.</paragraph>
        <section ids="prerequisites" names="prerequisites">
            <title>Prerequisites</title>
            <paragraph>Before you install and configure the Compute service, you must create
                databases, service credentials, and API endpoints.</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>To create the databases, complete these steps:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>Use the database access client to connect to the database server as the
                                <literal>root</literal> user:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ mysql -u root -p</literal_block>
                        </list_item>
                        <list_item>
                            <paragraph>Create the <literal>nova_api</literal>, <literal>nova</literal>, and <literal>nova_cell0</literal> databases:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">MariaDB [(none)]&gt; CREATE DATABASE nova_api;
MariaDB [(none)]&gt; CREATE DATABASE nova;
MariaDB [(none)]&gt; CREATE DATABASE nova_cell0;</literal_block>
                        </list_item>
                        <list_item>
                            <paragraph>Grant proper access to the databases:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'localhost' \
  IDENTIFIED BY 'NOVA_DBPASS';
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'%' \
  IDENTIFIED BY 'NOVA_DBPASS';

MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'localhost' \
  IDENTIFIED BY 'NOVA_DBPASS';
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'%' \
  IDENTIFIED BY 'NOVA_DBPASS';

MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'localhost' \
  IDENTIFIED BY 'NOVA_DBPASS';
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'%' \
  IDENTIFIED BY 'NOVA_DBPASS';</literal_block>
                            <paragraph>Replace <literal>NOVA_DBPASS</literal> with a suitable password.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Exit the database access client.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Source the <literal>admin</literal> credentials to gain access to admin-only CLI commands:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ . admin-openrc</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Create the Compute service credentials:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>Create the <literal>nova</literal> user:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack user create --domain default --password-prompt nova

User Password:
Repeat User Password:
+---------------------+----------------------------------+
| Field               | Value                            |
+---------------------+----------------------------------+
| domain_id           | default                          |
| enabled             | True                             |
| id                  | 8a7dbf5279404537b1c7b86c033620fe |
| name                | nova                             |
| options             | {}                               |
| password_expires_at | None                             |
+---------------------+----------------------------------+</literal_block>
                        </list_item>
                        <list_item>
                            <paragraph>Add the <literal>admin</literal> role to the <literal>nova</literal> user:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack role add --project service --user nova admin</literal_block>
                            <note>
                                <paragraph>This command provides no output.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>Create the <literal>nova</literal> service entity:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack service create --name nova \
  --description "OpenStack Compute" compute

+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | OpenStack Compute                |
| enabled     | True                             |
| id          | 060d59eac51b4594815603d75a00aba2 |
| name        | nova                             |
| type        | compute                          |
+-------------+----------------------------------+</literal_block>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Create the Compute API service endpoints:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack endpoint create --region RegionOne \
  compute public http://controller:8774/v2.1

+--------------+-------------------------------------------+
| Field        | Value                                     |
+--------------+-------------------------------------------+
| enabled      | True                                      |
| id           | 3c1caa473bfe4390a11e7177894bcc7b          |
| interface    | public                                    |
| region       | RegionOne                                 |
| region_id    | RegionOne                                 |
| service_id   | 060d59eac51b4594815603d75a00aba2          |
| service_name | nova                                      |
| service_type | compute                                   |
| url          | http://controller:8774/v2.1               |
+--------------+-------------------------------------------+

$ openstack endpoint create --region RegionOne \
  compute internal http://controller:8774/v2.1

+--------------+-------------------------------------------+
| Field        | Value                                     |
+--------------+-------------------------------------------+
| enabled      | True                                      |
| id           | e3c918de680746a586eac1f2d9bc10ab          |
| interface    | internal                                  |
| region       | RegionOne                                 |
| region_id    | RegionOne                                 |
| service_id   | 060d59eac51b4594815603d75a00aba2          |
| service_name | nova                                      |
| service_type | compute                                   |
| url          | http://controller:8774/v2.1               |
+--------------+-------------------------------------------+

$ openstack endpoint create --region RegionOne \
  compute admin http://controller:8774/v2.1

+--------------+-------------------------------------------+
| Field        | Value                                     |
+--------------+-------------------------------------------+
| enabled      | True                                      |
| id           | 38f7af91666a47cfb97b4dc790b94424          |
| interface    | admin                                     |
| region       | RegionOne                                 |
| region_id    | RegionOne                                 |
| service_id   | 060d59eac51b4594815603d75a00aba2          |
| service_name | nova                                      |
| service_type | compute                                   |
| url          | http://controller:8774/v2.1               |
+--------------+-------------------------------------------+</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Create a Placement service user using your chosen <literal>PLACEMENT_PASS</literal>:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack user create --domain default --password-prompt placement

User Password:
Repeat User Password:
+---------------------+----------------------------------+
| Field               | Value                            |
+---------------------+----------------------------------+
| domain_id           | default                          |
| enabled             | True                             |
| id                  | fa742015a6494a949f67629884fc7ec8 |
| name                | placement                        |
| options             | {}                               |
| password_expires_at | None                             |
+---------------------+----------------------------------+</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Add the Placement user to the service project with the admin role:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack role add --project service --user placement admin</literal_block>
                    <note>
                        <paragraph>This command provides no output.</paragraph>
                    </note>
                </list_item>
                <list_item>
                    <paragraph>Create the Placement API entry in the service catalog:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack service create --name placement --description "Placement API" placement
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Placement API                    |
| enabled     | True                             |
| id          | 2d1a27022e6e4185b86adac4444c495f |
| name        | placement                        |
| type        | placement                        |
+-------------+----------------------------------+</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Create the Placement API service endpoints:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ openstack endpoint create --region RegionOne placement public http://controller:8778
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 2b1b2637908b4137a9c2e0470487cbc0 |
| interface    | public                           |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 2d1a27022e6e4185b86adac4444c495f |
| service_name | placement                        |
| service_type | placement                        |
| url          | http://controller:8778           |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne placement internal http://controller:8778
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 02bcda9a150a4bd7993ff4879df971ab |
| interface    | internal                         |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 2d1a27022e6e4185b86adac4444c495f |
| service_name | placement                        |
| service_type | placement                        |
| url          | http://controller:8778           |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne placement admin http://controller:8778
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 3d71177b9e0f406f98cbff198d74b182 |
| interface    | admin                            |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 2d1a27022e6e4185b86adac4444c495f |
| service_name | placement                        |
| service_type | placement                        |
| url          | http://controller:8778           |
+--------------+----------------------------------+</literal_block>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="install-and-configure-components" names="install\ and\ configure\ components">
            <title>Install and configure components</title>
            <note>
                <paragraph>Default configuration files vary by distribution. You might need to add
                    these sections and options rather than modifying existing sections and
                    options. Also, an ellipsis (<literal>...</literal>) in the configuration snippets indicates
                    potential default configuration options that you should retain.</paragraph>
            </note>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Install the packages:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># yum install openstack-nova-api openstack-nova-conductor \
  openstack-nova-console openstack-nova-novncproxy \
  openstack-nova-scheduler openstack-nova-placement-api</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Edit the <literal>/etc/nova/nova.conf</literal> file and complete the following actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, enable only the compute and metadata APIs:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
enabled_apis = osapi_compute,metadata</literal_block>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[api_database]</literal> and <literal>[database]</literal> sections, configure database
                                access:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[api_database]
# ...
connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova_api

[database]
# ...
connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova</literal_block>
                            <paragraph>Replace <literal>NOVA_DBPASS</literal> with the password you chose for the Compute
                                databases.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, configure <literal>RabbitMQ</literal> message queue access:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
transport_url = rabbit://openstack:RABBIT_PASS@controller</literal_block>
                            <paragraph>Replace <literal>RABBIT_PASS</literal> with the password you chose for the <literal>openstack</literal>
                                account in <literal>RabbitMQ</literal>.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[api]</literal> and <literal>[keystone_authtoken]</literal> sections, configure Identity
                                service access:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[api]
# ...
auth_strategy = keystone

[keystone_authtoken]
# ...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = nova
password = NOVA_PASS</literal_block>
                            <paragraph>Replace <literal>NOVA_PASS</literal> with the password you chose for the <literal>nova</literal> user in
                                the Identity service.</paragraph>
                            <note>
                                <paragraph>Comment out or remove any other options in the <literal>[keystone_authtoken]</literal>
                                    section.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, configure the <literal>my_ip</literal> option to use the
                                management interface IP address of the controller node:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
my_ip = 10.0.0.11</literal_block>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, enable support for the Networking service:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
use_neutron = True
firewall_driver = nova.virt.firewall.NoopFirewallDriver</literal_block>
                            <note>
                                <paragraph>By default, Compute uses an internal firewall driver. Since the
                                    Networking service includes a firewall driver, you must disable the
                                    Compute firewall driver by using the
                                    <literal>nova.virt.firewall.NoopFirewallDriver</literal> firewall driver.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[vnc]</literal> section, configure the VNC proxy to use the management
                                interface IP address of the controller node:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[vnc]
enabled = true
# ...
vncserver_listen = $my_ip
vncserver_proxyclient_address = $my_ip</literal_block>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[glance]</literal> section, configure the location of the Image service
                                API:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[glance]
# ...
api_servers = http://controller:9292</literal_block>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[oslo_concurrency]</literal> section, configure the lock path:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[oslo_concurrency]
# ...
lock_path = /var/lib/nova/tmp</literal_block>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[placement]</literal> section, configure the Placement API:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[placement]
# ...
os_region_name = RegionOne
project_domain_name = Default
project_name = service
auth_type = password
user_domain_name = Default
auth_url = http://controller:35357/v3
username = placement
password = PLACEMENT_PASS</literal_block>
                            <paragraph>Replace <literal>PLACEMENT_PASS</literal> with the password you choose for the
                                <literal>placement</literal> user in the Identity service. Comment out any other options
                                in the <literal>[placement]</literal> section.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Due to a <reference name="packaging bug" refuri="https://bugzilla.redhat.com/show_bug.cgi?id=1430540">packaging bug</reference><target ids="packaging-bug" names="packaging\ bug" refuri="https://bugzilla.redhat.com/show_bug.cgi?id=1430540"></target>, you must enable
                                access to the Placement API by adding the following configuration to
                                <literal>/etc/httpd/conf.d/00-nova-placement-api.conf</literal>:</paragraph>
                            <block_quote>
                                <comment xml:space="preserve">path /etc/httpd/conf.d/00-nova-placement-api.conf</comment>
                                <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">&lt;Directory /usr/bin&gt;
   &lt;IfVersion &gt;= 2.4&gt;
      Require all granted
   &lt;/IfVersion&gt;
   &lt;IfVersion &lt; 2.4&gt;
      Order allow,deny
      Allow from all
   &lt;/IfVersion&gt;
&lt;/Directory&gt;</literal_block>
                            </block_quote>
                        </list_item>
                        <list_item>
                            <paragraph>Restart the httpd service:</paragraph>
                            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># systemctl restart httpd</literal_block>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Populate the <literal>nova-api</literal> database:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># su -s /bin/sh -c "nova-manage api_db sync" nova</literal_block>
                    <note>
                        <paragraph>Ignore any deprecation messages in this output.</paragraph>
                    </note>
                </list_item>
            </enumerated_list>
            <enumerated_list enumtype="arabic" prefix="" start="4" suffix=".">
                <list_item>
                    <paragraph>Register the <literal>cell0</literal> database:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># su -s /bin/sh -c "nova-manage cell_v2 map_cell0" nova</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Create the <literal>cell1</literal> cell:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># su -s /bin/sh -c "nova-manage cell_v2 create_cell --name=cell1 --verbose" nova
109e1d4b-536a-40d0-83c6-5f121b82b650</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Populate the nova database:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># su -s /bin/sh -c "nova-manage db sync" nova</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Verify nova cell0 and cell1 are registered correctly:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># nova-manage cell_v2 list_cells
+-------+--------------------------------------+
| Name  | UUID                                 |
+-------+--------------------------------------+
| cell1 | 109e1d4b-536a-40d0-83c6-5f121b82b650 |
| cell0 | 00000000-0000-0000-0000-000000000000 |
+-------+--------------------------------------+</literal_block>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="finalize-installation" names="finalize\ installation">
            <title>Finalize installation</title>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Start the Compute services and configure them to start when the system boots:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># systemctl enable openstack-nova-api.service \
  openstack-nova-consoleauth.service openstack-nova-scheduler.service \
  openstack-nova-conductor.service openstack-nova-novncproxy.service
# systemctl start openstack-nova-api.service \
  openstack-nova-consoleauth.service openstack-nova-scheduler.service \
  openstack-nova-conductor.service openstack-nova-novncproxy.service</literal_block>
                </list_item>
            </bullet_list>
        </section>
    </section>
</document>
