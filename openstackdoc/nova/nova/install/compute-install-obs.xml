<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/nova/doc/source/install/compute-install-obs.rst">
    <section ids="install-and-configure-a-compute-node-for-opensuse-and-suse-linux-enterprise" names="install\ and\ configure\ a\ compute\ node\ for\ opensuse\ and\ suse\ linux\ enterprise">
        <title>Install and configure a compute node for openSUSE and SUSE Linux Enterprise</title>
        <paragraph>This section describes how to install and configure the Compute service on a
            compute node. The service supports several hypervisors to deploy instances or
            virtual machines (VMs). For simplicity, this configuration uses the Quick
            EMUlator (QEMU) hypervisor with the kernel-based VM (KVM) extension on compute
            nodes that support hardware acceleration for virtual machines.  On legacy
            hardware, this configuration uses the generic QEMU hypervisor.  You can follow
            these instructions with minor modifications to horizontally scale your
            environment with additional compute nodes.</paragraph>
        <note>
            <paragraph>This section assumes that you are following the instructions in this guide
                step-by-step to configure the first compute node. If you want to configure
                additional compute nodes, prepare them in a similar fashion to the first
                compute node in the <reference internal="True" refuri="overview#overview-example-architectures"><inline classes="std std-ref">example architectures</inline></reference> section. Each additional compute node
                requires a unique IP address.</paragraph>
        </note>
        <section ids="install-and-configure-components" names="install\ and\ configure\ components">
            <title>Install and configure components</title>
            <note>
                <paragraph>Default configuration files vary by distribution. You might need to add
                    these sections and options rather than modifying existing sections and
                    options. Also, an ellipsis (<literal>...</literal>) in the configuration snippets indicates
                    potential default configuration options that you should retain.</paragraph>
            </note>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Install the packages:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># zypper install openstack-nova-compute genisoimage qemu-kvm libvirt</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Edit the <literal>/etc/nova/nova.conf</literal> file and complete the following actions:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, enable only the compute and metadata APIs:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
enabled_apis = osapi_compute,metadata</literal_block>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, set the <literal>compute_driver</literal>:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
compute_driver = libvirt.LibvirtDriver</literal_block>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, configure <literal>RabbitMQ</literal> message queue access:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
transport_url = rabbit://openstack:RABBIT_PASS@controller</literal_block>
                            <paragraph>Replace <literal>RABBIT_PASS</literal> with the password you chose for the <literal>openstack</literal>
                                account in <literal>RabbitMQ</literal>.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[api]</literal> and <literal>[keystone_authtoken]</literal> sections, configure Identity
                                service access:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[api]
# ...
auth_strategy = keystone

[keystone_authtoken]
# ...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = nova
password = NOVA_PASS</literal_block>
                            <paragraph>Replace <literal>NOVA_PASS</literal> with the password you chose for the <literal>nova</literal> user in
                                the Identity service.</paragraph>
                            <note>
                                <paragraph>Comment out or remove any other options in the <literal>[keystone_authtoken]</literal>
                                    section.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, configure the <literal>my_ip</literal> option:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
my_ip = MANAGEMENT_INTERFACE_IP_ADDRESS</literal_block>
                            <paragraph>Replace <literal>MANAGEMENT_INTERFACE_IP_ADDRESS</literal> with the IP address of the
                                management network interface on your compute node, typically <literal>10.0.0.31</literal>
                                for the first node in the <reference internal="True" refuri="overview#overview-example-architectures"><inline classes="std std-ref">example architecture</inline></reference>.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[DEFAULT]</literal> section, enable support for the Networking service:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[DEFAULT]
# ...
use_neutron = True
firewall_driver = nova.virt.firewall.NoopFirewallDriver</literal_block>
                            <note>
                                <paragraph>By default, Compute uses an internal firewall service. Since
                                    Networking includes a firewall service, you must disable the Compute
                                    firewall service by using the
                                    <literal>nova.virt.firewall.NoopFirewallDriver</literal> firewall driver.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[vnc]</literal> section, enable and configure remote console access:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[vnc]
# ...
enabled = True
vncserver_listen = 0.0.0.0
vncserver_proxyclient_address = $my_ip
novncproxy_base_url = http://controller:6080/vnc_auto.html</literal_block>
                            <paragraph>The server component listens on all IP addresses and the proxy
                                component only listens on the management interface IP address of
                                the compute node. The base URL indicates the location where you
                                can use a web browser to access remote consoles of instances
                                on this compute node.</paragraph>
                            <note>
                                <paragraph>If the web browser to access remote consoles resides on
                                    a host that cannot resolve the <literal>controller</literal> hostname,
                                    you must replace <literal>controller</literal> with the management
                                    interface IP address of the controller node.</paragraph>
                            </note>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[glance]</literal> section, configure the location of the Image service
                                API:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[glance]
# ...
api_servers = http://controller:9292</literal_block>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[oslo_concurrency]</literal> section, configure the lock path:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[oslo_concurrency]
# ...
lock_path = /var/run/nova</literal_block>
                        </list_item>
                        <list_item>
                            <paragraph>In the <literal>[placement]</literal> section, configure the Placement API:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[placement]
# ...
os_region_name = RegionOne
project_domain_name = Default
project_name = service
auth_type = password
user_domain_name = Default
auth_url = http://controller:35357/v3
username = placement
password = PLACEMENT_PASS</literal_block>
                            <paragraph>Replace <literal>PLACEMENT_PASS</literal> with the password you choose for the
                                <literal>placement</literal> user in the Identity service. Comment out any other options
                                in the <literal>[placement]</literal> section.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Ensure the kernel module <literal>nbd</literal> is loaded.</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># modprobe nbd</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Ensure the module loads on every boot by adding <literal>nbd</literal> to the
                        <literal>/etc/modules-load.d/nbd.conf</literal> file.</paragraph>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="finalize-installation" names="finalize\ installation">
            <title>Finalize installation</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Determine whether your compute node supports hardware acceleration for
                        virtual machines:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ egrep -c '(vmx|svm)' /proc/cpuinfo</literal_block>
                    <paragraph>If this command returns a value of <literal>one or greater</literal>, your compute node
                        supports hardware acceleration which typically requires no additional
                        configuration.</paragraph>
                    <paragraph>If this command returns a value of <literal>zero</literal>, your compute node does not
                        support hardware acceleration and you must configure <literal>libvirt</literal> to use QEMU
                        instead of KVM.</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>Edit the <literal>[libvirt]</literal> section in the <literal>/etc/nova/nova.conf</literal> file as
                                follows:</paragraph>
                            <comment xml:space="preserve">path /etc/nova/nova.conf</comment>
                            <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[libvirt]
# ...
virt_type = qemu</literal_block>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Start the Compute service including its dependencies and configure them to
                        start automatically when the system boots:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># systemctl enable libvirtd.service openstack-nova-compute.service
# systemctl start libvirtd.service openstack-nova-compute.service</literal_block>
                </list_item>
            </enumerated_list>
            <note>
                <paragraph>If the <literal>nova-compute</literal> service fails to start, check
                    <literal>/var/log/nova/nova-compute.log</literal>. The error message <literal>AMQP server on
controller:5672 is unreachable</literal> likely indicates that the firewall on the
                    controller node is preventing access to port 5672.  Configure the firewall
                    to open port 5672 on the controller node and restart <literal>nova-compute</literal>
                    service on the compute node.</paragraph>
            </note>
        </section>
        <section ids="add-the-compute-node-to-the-cell-database" names="add\ the\ compute\ node\ to\ the\ cell\ database">
            <title>Add the compute node to the cell database</title>
            <important>
                <paragraph>Run the following commands on the <strong>controller</strong> node.</paragraph>
            </important>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Source the admin credentials to enable admin-only CLI commands, then confirm
                        there are compute hosts in the database:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ . admin-openrc

$ openstack compute service list --service nova-compute
+----+-------+--------------+------+-------+---------+----------------------------+
| ID | Host  | Binary       | Zone | State | Status  | Updated At                 |
+----+-------+--------------+------+-------+---------+----------------------------+
| 1  | node1 | nova-compute | nova | up    | enabled | 2017-04-14T15:30:44.000000 |
+----+-------+--------------+------+-------+---------+----------------------------+</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Discover compute hosts:</paragraph>
                    <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve"># su -s /bin/sh -c "nova-manage cell_v2 discover_hosts --verbose" nova

Found 2 cell mappings.
Skipping cell0 since it does not contain hosts.
Getting compute nodes from cell 'cell1': ad5a5985-a719-4567-98d8-8d148aaae4bc
Found 1 computes in cell: ad5a5985-a719-4567-98d8-8d148aaae4bc
Checking host mapping for compute host 'compute': fe58ddc1-1d65-4f87-9456-bc040dc106b3
Creating host mapping for compute host 'compute': fe58ddc1-1d65-4f87-9456-bc040dc106b3</literal_block>
                    <note>
                        <paragraph>When you add new compute nodes, you must run <literal>nova-manage cell_v2
discover_hosts</literal> on the controller node to register those new compute
                            nodes. Alternatively, you can set an appropriate interval in
                            <literal>/etc/nova/nova.conf</literal>:</paragraph>
                        <literal_block highlight_args="{}" language="ini" linenos="False" xml:space="preserve">[scheduler]
discover_hosts_in_cells_interval = 300</literal_block>
                    </note>
                </list_item>
            </enumerated_list>
        </section>
    </section>
</document>
