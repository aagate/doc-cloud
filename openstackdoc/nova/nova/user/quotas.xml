<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/nova/doc/source/user/quotas.rst">
    <comment xml:space="preserve">Licensed under the Apache License, Version 2.0 (the "License"); you may
not use this file except in compliance with the License. You may obtain
a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
License for the specific language governing permissions and limitations
under the License.</comment>
    <section ids="quotas" names="quotas">
        <title>Quotas</title>
        <paragraph>Nova uses a quota system for setting limits on resources such as number of
            instances or amount of CPU that a specific project or user can use.</paragraph>
        <paragraph>Quotas are enforced by making a claim, or reservation, on resources when a
            request is made, such as creating a new server. If the claim fails, the request
            is rejected. If the reservation succeeds then the operation progresses until
            such a point that the reservation is either converted into usage (the operation
            was successful) or rolled back (the operation failed).</paragraph>
        <paragraph>Typically the quota reservation is made in the nova-api service and the usage
            or rollback is performed in the nova-compute service, at least when dealing
            with a server creation or move operation.</paragraph>
        <paragraph>Quota limits and usage can be retrieved via the <literal>limits</literal> REST API.</paragraph>
        <section ids="checking-quota" names="checking\ quota">
            <title>Checking quota</title>
            <paragraph>When calculating limits for a given resource and tenant, the following
                checks are made in order:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Depending on the resource, is there a tenant-specific limit on the resource
                        in either the <title_reference>quotas</title_reference> or <title_reference>project_user_quotas</title_reference> tables in the database? If
                        so, use that as the limit. You can create these resources by doing:</paragraph>
                    <literal_block xml:space="preserve">openstack quota set --instances 5 &lt;project&gt;</literal_block>
                </list_item>
                <list_item>
                    <paragraph>Check to see if there is a hard limit for the given resource in the
                        <title_reference>quota_classes</title_reference> table in the database for the <title_reference>default</title_reference> quota class. If so,
                        use that as the limit. You can modify the default quota limit for a resource
                        by doing:</paragraph>
                    <literal_block xml:space="preserve">openstack quota set --class --instances 5 default</literal_block>
                </list_item>
                <list_item>
                    <paragraph>If the above does not provide a resource limit, then rely on the <literal>quota_*</literal>
                        configuration options for the default limit.</paragraph>
                </list_item>
            </bullet_list>
            <note>
                <paragraph>The API sets the limit in the <title_reference>quota_classes</title_reference> table. Once a default
                    limit is set via the <title_reference>default</title_reference> quota class, that takes precedence over
                    any changes to that resource limit in the configuration options. In other
                    words, once you've changed things via the API, you either have to keep those
                    synchronized with the configuration values or remove the default limit from
                    the database manually as there is no REST API for removing quota class
                    values from the database.</paragraph>
            </note>
        </section>
        <section ids="known-issues" names="known\ issues">
            <title>Known issues</title>
            <paragraph>TODO: talk about quotas getting out of sync and <reference name="how to recover" refuri="https://specs.openstack.org/openstack/nova-specs/specs/newton/implemented/refresh-quotas-usage.html">how to recover</reference></paragraph>
            <target ids="how-to-recover" names="how\ to\ recover" refuri="https://specs.openstack.org/openstack/nova-specs/specs/newton/implemented/refresh-quotas-usage.html"></target>
        </section>
        <section ids="future-plans" names="future\ plans">
            <title>Future plans</title>
            <paragraph>TODO: talk about quotas in the  <reference name="resource counting spec" refuri="https://specs.openstack.org/openstack/nova-specs/specs/ocata/approved/cells-count-resources-to-check-quota-in-api.html">resource counting spec</reference> and <reference name="nested quotas" refuri="https://specs.openstack.org/openstack/nova-specs/specs/mitaka/approved/nested-quota-driver-api.html">nested quotas</reference></paragraph>
            <target ids="resource-counting-spec" names="resource\ counting\ spec" refuri="https://specs.openstack.org/openstack/nova-specs/specs/ocata/approved/cells-count-resources-to-check-quota-in-api.html"></target>
            <target ids="nested-quotas" names="nested\ quotas" refuri="https://specs.openstack.org/openstack/nova-specs/specs/mitaka/approved/nested-quota-driver-api.html"></target>
        </section>
    </section>
</document>
