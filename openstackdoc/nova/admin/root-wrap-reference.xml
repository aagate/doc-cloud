<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/nova/doc/source/admin/root-wrap-reference.rst">
    <section ids="secure-with-rootwrap" names="secure\ with\ rootwrap">
        <title>Secure with rootwrap</title>
        <paragraph>Rootwrap allows unprivileged users to safely run Compute actions as the root
            user. Compute previously used <literal_strong classes="command">sudo</literal_strong> for this purpose, but this was
            difficult to maintain, and did not allow advanced filters. The
            <literal_strong classes="command">rootwrap</literal_strong> command replaces <literal_strong classes="command">sudo</literal_strong> for Compute.</paragraph>
        <paragraph>To use rootwrap, prefix the Compute command with <literal_strong classes="command">nova-rootwrap</literal_strong>. For
            example:</paragraph>
        <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ sudo nova-rootwrap /etc/nova/rootwrap.conf command</literal_block>
        <paragraph>A generic <literal>sudoers</literal> entry lets the Compute user run <literal_strong classes="command">nova-rootwrap</literal_strong>
            as root. The <literal_strong classes="command">nova-rootwrap</literal_strong> code looks for filter definition
            directories in its configuration file, and loads command filters from them. It
            then checks if the command requested by Compute matches one of those filters
            and, if so, executes the command (as root). If no filter matches, it denies the
            request.</paragraph>
        <note>
            <paragraph>Be aware of issues with using NFS and root-owned files. The NFS share must
                be configured with the <literal>no_root_squash</literal> option enabled, in order for
                rootwrap to work correctly.</paragraph>
        </note>
        <paragraph>Rootwrap is fully controlled by the root user. The root user owns the sudoers
            entry which allows Compute to run a specific rootwrap executable as root, and
            only with a specific configuration file (which should also be owned by root).
            The <literal_strong classes="command">nova-rootwrap</literal_strong> command imports the Python modules it needs from a
            cleaned, system-default PYTHONPATH.  The root-owned configuration file points
            to root-owned filter definition directories, which contain root-owned filters
            definition files. This chain ensures that the Compute user itself is not in
            control of the configuration or modules used by the <literal_strong classes="command">nova-rootwrap</literal_strong>
            executable.</paragraph>
        <section ids="configure-rootwrap" names="configure\ rootwrap">
            <title>Configure rootwrap</title>
            <paragraph>Configure rootwrap in the <literal>rootwrap.conf</literal> file. Because it is in the trusted
                security path, it must be owned and writable by only the root user. The
                <literal>rootwrap_config=entry</literal> parameter specifies the file's location in the
                sudoers entry and in the <literal>nova.conf</literal> configuration file.</paragraph>
            <paragraph>The <literal>rootwrap.conf</literal> file uses an INI file format with these sections and
                parameters:</paragraph>
            <table classes="colwidths-given" ids="id1">
                <title><strong>rootwrap.conf configuration options</strong></title>
                <tgroup cols="2">
                    <colspec colwidth="64"></colspec>
                    <colspec colwidth="31"></colspec>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>Configuration option=Default value</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Type) Description</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[DEFAULT]
                                    filters_path=/etc/nova/rootwrap.d,/usr/share/nova/rootwrap</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(ListOpt) Comma-separated list of directories
                                    containing filter definition files.
                                    Defines where rootwrap filters are stored.
                                    Directories defined on this line should all
                                    exist, and be owned and writable only by the
                                    root user.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <paragraph>If the root wrapper is not performing correctly, you can add a workaround
                option into the <literal>nova.conf</literal> configuration file. This workaround re-configures
                the root wrapper configuration to fall back to running commands as <literal>sudo</literal>,
                and is a Kilo release feature.</paragraph>
            <paragraph>Including this workaround in your configuration file safeguards your
                environment from issues that can impair root wrapper performance. Tool changes
                that have impacted <reference name="Python Build Reasonableness (PBR)" refuri="https://git.openstack.org/cgit/openstack-dev/pbr/">Python Build Reasonableness (PBR)</reference> for example, are a known
                issue that affects root wrapper performance.</paragraph>
            <paragraph>To set up this workaround, configure the <literal>disable_rootwrap</literal> option in the
                <literal>[workaround]</literal> section of the <literal>nova.conf</literal> configuration file.</paragraph>
            <paragraph>The filters definition files contain lists of filters that rootwrap will use to
                allow or deny a specific command. They are generally suffixed by <literal>.filters</literal> .
                Since they are in the trusted security path, they need to be owned and writable
                only by the root user. Their location is specified in the <literal>rootwrap.conf</literal>
                file.</paragraph>
            <paragraph>Filter definition files use an INI file format with a <literal>[Filters]</literal> section and
                several lines, each with a unique parameter name, which should be different for
                each filter you define:</paragraph>
            <table classes="colwidths-given" ids="id2">
                <title><strong>Filters configuration options</strong></title>
                <tgroup cols="2">
                    <colspec colwidth="72"></colspec>
                    <colspec colwidth="39"></colspec>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>Configuration option=Default value</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(Type) Description</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[Filters]
                                    filter_name=kpartx: CommandFilter, /sbin/kpartx, root</paragraph>
                            </entry>
                            <entry>
                                <paragraph>(ListOpt) Comma-separated list containing the filter class to
                                    use, followed by the Filter arguments (which vary depending
                                    on the Filter class selected).</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
        <section ids="configure-the-rootwrap-daemon" names="configure\ the\ rootwrap\ daemon">
            <title>Configure the rootwrap daemon</title>
            <paragraph>Administrators can use rootwrap daemon support instead of running rootwrap with
                <literal_strong classes="command">sudo</literal_strong>. The rootwrap daemon reduces the overhead and performance loss
                that results from running <literal>oslo.rootwrap</literal> with <literal_strong classes="command">sudo</literal_strong>. Each call
                that needs rootwrap privileges requires a new instance of rootwrap. The daemon
                prevents overhead from the repeated calls. The daemon does not support long
                running processes, however.</paragraph>
            <paragraph>To enable the rootwrap daemon, set <literal>use_rootwrap_daemon</literal> to <literal>True</literal> in the
                Compute service configuration file.</paragraph>
        </section>
    </section>
</document>
